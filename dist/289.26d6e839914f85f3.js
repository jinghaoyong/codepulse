"use strict";(self.webpackChunkcodepulse=self.webpackChunkcodepulse||[]).push([[289],{8289:(D,m,a)=>{a.r(m),a.d(m,{ChatModule:()=>I});var g=a(6814),p=a(8145),f=a(1333),h=a(5861),c=a(6223),t=a(5879),v=a(1216),C=a(981),_=a(5257);let b=(()=>{class n{constructor(e,o,i){this.firestore=e,this.afAuth=o,this.authServ=i,this.user=this.authServ.getUser()}createOrGetChatroom(e){var o=this;return(0,h.Z)(function*(){try{const i=o.user?.uid;if(!i)throw new Error("Current user ID is not available");const r=yield o.firestore.collection("chatrooms",d=>d.where("participants","array-contains",e)).get().toPromise();let l=null;return console.log("chatrooms",r),r?.docs.forEach(d=>{const u=d.data()?.participants;console.log("participants",u),u.includes(e)&&u.includes(i)&&(l=d.id)}),l||(l=(yield o.firestore.collection("chatrooms").add({participants:[e,i],readStatus:{[e]:!1,[i]:!1},lastMessage:null})).id),l}catch(i){throw console.error("Error creating or getting chatroom:",i),i}})()}getMessages(e){return this.firestore.collection(`chatrooms/${e}/messages`,o=>o.orderBy("timestamp")).valueChanges()}sendMessage(e,o){if(Date.now(),this.user){const r={message:o,createdAt:(new Date).toString(),senderId:this.user.uid};return this.firestore.collection(`chatrooms/${e}/messages`).add(r)}return Promise.reject("No user logged in")}static#t=this.\u0275fac=function(o){return new(o||n)(t.LFG(v.ST),t.LFG(C.zQ),t.LFG(_.e))};static#e=this.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const M=["componentRef"];function O(n,s){if(1&n&&(t.TgZ(0,"div"),t._UZ(1,"img",60)(2,"span",61),t.qZA()),2&n){const e=t.oxw().$implicit;t.Gre("user-img ",e.status," align-self-center me-3"),t.xp6(1),t.s9C("src",e.image,t.LSH)}}function Z(n,s){if(1&n&&(t.TgZ(0,"div",62)(1,"div",63)(2,"span",64),t._uU(3),t.qZA()(),t._UZ(4,"span",61),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(3),t.hij(" ",e.name.charAt(0)," ")}}function w(n,s){if(1&n&&(t.TgZ(0,"div",65)(1,"span",66),t._uU(2),t.qZA()()),2&n){const e=t.oxw().$implicit;t.xp6(2),t.Oqu(e.unread)}}const P=function(n,s){return{unread:n,active:s}};function T(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"li",48)(1,"a",49),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.chatUsername())}),t.TgZ(2,"div",50)(3,"div",51),t.YNc(4,O,3,4,"div",52),t.YNc(5,Z,5,1,"div",53),t.qZA(),t.TgZ(6,"div",54)(7,"h5",55),t._uU(8),t.qZA(),t.TgZ(9,"p",56),t._uU(10),t.qZA()(),t.TgZ(11,"div",57)(12,"div",58),t._uU(13),t.qZA(),t.YNc(14,w,3,1,"div",59),t.qZA()()()()}if(2&n){const e=s.$implicit,o=t.oxw();t.Q6J("ngClass",t.WLB(7,P,e.unread,e.name==o.username)),t.xp6(4),t.Q6J("ngIf",e.image),t.xp6(1),t.Q6J("ngIf",!e.image),t.xp6(3),t.Oqu(e.name),t.xp6(2),t.Oqu(e.message),t.xp6(3),t.Oqu(e.time),t.xp6(1),t.Q6J("ngIf",e.unread)}}function y(n,s){if(1&n&&(t.TgZ(0,"li",79)(1,"a",80),t._UZ(2,"img",81),t.qZA()()),2&n){const e=s.$implicit;t.xp6(2),t.s9C("src",e.src,t.LSH)}}function A(n,s){if(1&n&&(t.TgZ(0,"ul",77),t.YNc(1,y,3,1,"li",78),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngForOf",e.files)}}const U=function(n){return{right:n}};function q(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"li",48)(1,"div",67)(2,"div",68)(3,"div",69)(4,"h5",70)(5,"a",71),t._uU(6),t.qZA(),t.TgZ(7,"span",72),t._uU(8),t.qZA()(),t.TgZ(9,"p",73),t._uU(10),t.qZA(),t.YNc(11,A,2,1,"ul",74),t.qZA(),t.TgZ(12,"div",24)(13,"a",75),t._UZ(14,"i",76),t.qZA(),t.TgZ(15,"div",31)(16,"a",33),t.NdJ("click",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.copyMessage(i))}),t._uU(17,"Copy"),t.qZA(),t.TgZ(18,"a",32),t._uU(19,"Save"),t.qZA(),t.TgZ(20,"a",32),t._uU(21,"Forward"),t.qZA(),t.TgZ(22,"a",33),t.NdJ("click",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.deleteMessage(i))}),t._uU(23,"Delete"),t.qZA()()()()()()}if(2&n){const e=s.$implicit;t.Q6J("ngClass",t.VKq(5,U,"right"===e.align)),t.xp6(6),t.Oqu(e.name),t.xp6(2),t.Oqu(e.time),t.xp6(2),t.Oqu(e.message),t.xp6(1),t.Q6J("ngIf",e.files)}}const S=function(n){return{"text-warning":n}},k=function(n){return{"is-invalid":n}};let x=(()=>{class n{constructor(e,o,i,r){this.formBuilder=e,this.chatServ=o,this.route=i,this.authServ=r,this.username="John Howard",this.status="Online",this.formData=this.formBuilder.group({message:["",[c.kI.required]]})}ngOnInit(){var o,e=this;this.route.paramMap.subscribe({next:(o=(0,h.Z)(function*(i){e.targetUserId=i.get("id"),e.targetUserId&&(e.authServ.getUserProfile(e.targetUserId).then(r=>{r&&(e.targetUser=r)}),console.log("targetUserId",e.targetUserId),e.chatroomId=yield e.chatServ.createOrGetChatroom(e.targetUserId),console.log("chatroomId",e.chatroomId))}),function(r){return o.apply(this,arguments)})})}ngAfterViewInit(){this.onListScroll()}get form(){return this.formData.controls}onListScroll(){void 0!==this.scrollRef&&setTimeout(()=>{this.scrollRef.SimpleBar.getScrollElement().scrollTop=this.scrollRef.SimpleBar.getScrollElement().scrollHeight+1500},500)}messageSave(){const e=this.formData.get("message")?.value;this.formData.valid&&e&&(setTimeout(()=>{this.onListScroll()}),this.formData=this.formBuilder.group({message:null})),this.chatSubmit=!0}deleteMessage(e){e.target.closest("li").remove()}copyMessage(e){navigator.clipboard.writeText(e.target.closest("li").querySelector("p").innerHTML)}deleteAllMessage(e){var o=document.querySelector(".chat-conversation")?.querySelectorAll("li");o.forEach(i=>{i.remove()})}chatUsername(){}static#t=this.\u0275fac=function(o){return new(o||n)(t.Y36(c.QS),t.Y36(b),t.Y36(p.gz),t.Y36(_.e))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat"]],viewQuery:function(o,i){if(1&o&&t.Gf(M,5),2&o){let r;t.iGM(r=t.CRH())&&(i.scrollRef=r.first)}},decls:66,vars:11,consts:[[1,"container-fluid","mt-5","pt-5"],[1,"d-lg-flex","mb-4"],[1,"chat-leftsidebar","card"],[1,"pb-3"],[1,"p-4","border-top"],[1,"float-end"],["href","javascript:void(0);",1,"text-primary"],[1,"mdi","mdi-plus"],[1,"font-size-16","mb-3"],[1,"uil","uil-user","me-1"],[1,"list-unstyled","chat-list"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"w-100","user-chat","mt-4","mt-sm-0","ms-lg-1"],[1,"card"],[1,"p-3","px-lg-4","border-bottom"],[1,"row"],[1,"col-md-4","col-6"],[1,"font-size-16","mb-1","text-truncate"],["href","javascript:void(0);",1,"text-reset"],[1,"text-muted","text-truncate","mb-0"],[1,"mdi","mdi-circle","text-success","align-middle","font-size-10","ms-1",3,"ngClass"],[1,"col-md-8","col-6"],[1,"list-inline","user-chat-nav","text-end","mb-0"],[1,"list-inline-item"],["ngbDropdown","",1,"dropdown"],["type","button","data-toggle","dropdown","aria-haspopup","true","aria-expanded","false","ngbDropdownToggle","",1,"btn","nav-btn","dropdown-toggle"],[1,"uil","uil-search"],["ngbDropdownMenu","",1,"dropdown-menu","dropdown-menu-end","dropdown-menu-md"],[1,"p-2"],["type","text","placeholder","Search...",1,"form-control","rounded"],[1,"uil","uil-ellipsis-h"],["ngbDropdownMenu","",1,"dropdown-menu","dropdown-menu-end"],["href","javascript: void(0);",1,"dropdown-item"],["href","javascript: void(0);",1,"dropdown-item",3,"click"],[1,"px-lg-2"],[1,"chat-conversation","p-3"],[1,"list-unstyled","mb-0"],[1,"chat-day-title"],[1,"title"],[1,"p-3","chat-input-section"],[1,"row",3,"formGroup","ngSubmit"],[1,"col"],[1,"position-relative"],["type","text","placeholder","Enter Message...","formControlName","message",1,"form-control","chat-input","rounded",3,"ngClass"],[1,"col-auto"],["type","submit",1,"btn","btn-primary","chat-send","w-md","waves-effect","waves-light"],[1,"d-none","d-sm-inline-block","me-2"],[1,"mdi","mdi-send","float-end"],[3,"ngClass"],["href","javascript: void(0);",3,"click"],[1,"d-flex","align-items-start"],[1,"flex-shrink-0","align-self-center"],[3,"class",4,"ngIf"],["class","user-img online align-self-center me-3",4,"ngIf"],[1,"flex-grow-1","overflow-hidden"],[1,"text-truncate","font-size-14","mb-1"],[1,"text-truncate","text-body","mb-0"],[1,"flex-shrink-0"],[1,"font-size-11"],["class","unread-message",4,"ngIf"],["alt","",1,"rounded-circle","avatar-xs",3,"src"],[1,"user-status"],[1,"user-img","online","align-self-center","me-3"],[1,"avatar-xs","align-self-center"],[1,"avatar-title","rounded-circle","bg-primary-subtle","text-primary"],[1,"unread-message"],[1,"badge","bg-danger","rounded-pill"],[1,"conversation-list"],[1,"ctext-wrap"],[1,"ctext-wrap-content"],[1,"font-size-14","conversation-name"],["href","javascript: void(0);",1,"text-reset"],[1,"d-inline-block","font-size-12","text-muted","ms-2"],[1,"mb-0"],["class","list-inline message-img mt-3 mb-0",4,"ngIf"],["href","javascript: void(0);","role","button","ngbDropdownToggle","",1,"dropdown-toggle"],[1,"bx","bx-dots-vertical-rounded"],[1,"list-inline","message-img","mt-3","mb-0"],["class","list-inline-item message-img-list",4,"ngFor","ngForOf"],[1,"list-inline-item","message-img-list"],["href","javascript:void(0);",1,"d-inline-block","m-1"],["alt","",1,"rounded","img-thumbnail",3,"src"]],template:function(o,i){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div")(6,"div",5)(7,"a",6),t._UZ(8,"i",7),t._uU(9," New Contact"),t.qZA()(),t.TgZ(10,"h5",8),t._UZ(11,"i",9),t._uU(12," Contacts"),t.qZA(),t.TgZ(13,"ul",10),t.YNc(14,T,15,10,"li",11),t.qZA()()()()(),t.TgZ(15,"div",12)(16,"div",13)(17,"div",14)(18,"div",15)(19,"div",16)(20,"h5",17)(21,"a",18),t._uU(22),t.qZA()(),t.TgZ(23,"p",19),t._UZ(24,"i",20),t._uU(25),t.qZA()(),t.TgZ(26,"div",21)(27,"ul",22)(28,"li",23)(29,"div",24)(30,"button",25),t._UZ(31,"i",26),t.qZA(),t.TgZ(32,"div",27)(33,"form",28)(34,"div"),t._UZ(35,"input",29),t.qZA()()()()(),t.TgZ(36,"li",23)(37,"div",24)(38,"button",25),t._UZ(39,"i",30),t.qZA(),t.TgZ(40,"div",31)(41,"a",32),t._uU(42,"Profile"),t.qZA(),t.TgZ(43,"a",32),t._uU(44,"Archive"),t.qZA(),t.TgZ(45,"a",32),t._uU(46,"Muted"),t.qZA(),t.TgZ(47,"a",33),t.NdJ("click",function(l){return i.deleteAllMessage(l)}),t._uU(48,"Delete"),t.qZA()()()()()()()(),t.TgZ(49,"div",34)(50,"div",35)(51,"ul",36)(52,"li",37)(53,"div",38),t._uU(54,"Today"),t.qZA()(),t.YNc(55,q,24,7,"li",11),t.qZA()()(),t.TgZ(56,"div",39)(57,"form",40),t.NdJ("ngSubmit",function(){return i.messageSave()}),t.TgZ(58,"div",41)(59,"div",42),t._UZ(60,"input",43),t.qZA()(),t.TgZ(61,"div",44)(62,"button",45)(63,"span",46),t._uU(64,"Send"),t.qZA(),t._UZ(65,"i",47),t.qZA()()()()()()()()),2&o&&(t.xp6(14),t.Q6J("ngForOf",i.chatData),t.xp6(8),t.Oqu(i.username),t.xp6(2),t.Q6J("ngClass",t.VKq(7,S,"away"===i.status)),t.xp6(1),t.hij(" ",i.status,""),t.xp6(30),t.Q6J("ngForOf",i.chatMessagesData),t.xp6(2),t.Q6J("formGroup",i.formData),t.xp6(3),t.Q6J("ngClass",t.VKq(9,k,i.chatSubmit)))},dependencies:[g.mk,g.sg,g.O5,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u],styles:["body[_ngcontent-%COMP%]{font-family:Arial,sans-serif;background-color:#f4f6f9;margin:0;padding:0}.container-fluid[_ngcontent-%COMP%]{width:100%;padding:0 15px;margin:0 auto}.d-lg-flex[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap}.chat-leftsidebar[_ngcontent-%COMP%]{width:30%;border-right:1px solid #e3e6ea;background-color:#fff;padding:15px;overflow-y:auto;max-height:510px}.user-chat[_ngcontent-%COMP%]{width:70%}.card[_ngcontent-%COMP%]{border:1px solid #e3e6ea;border-radius:8px;background-color:#fff}.border-bottom[_ngcontent-%COMP%]{border-bottom:1px solid #e3e6ea}.border-top[_ngcontent-%COMP%]{border-top:1px solid #e3e6ea}.p-3[_ngcontent-%COMP%]{padding:16px}.px-lg-4[_ngcontent-%COMP%]{padding-left:24px;padding-right:24px}.mb-4[_ngcontent-%COMP%]{margin-bottom:24px}.mb-3[_ngcontent-%COMP%]{margin-bottom:16px}.mb-0[_ngcontent-%COMP%]{margin-bottom:0}.mt-4[_ngcontent-%COMP%]{margin-top:24px}.mt-sm-0[_ngcontent-%COMP%]{margin-top:0}.ms-lg-1[_ngcontent-%COMP%]{margin-left:8px}.list-unstyled[_ngcontent-%COMP%]{padding-left:0;list-style:none}.chat-list[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;padding:12px 16px;color:#333;text-decoration:none;transition:background-color .3s}.chat-list[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .chat-list[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{background-color:#f4f6f9;color:#007bff}.chat-list[_ngcontent-%COMP%]   .avatar-title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:32px;width:32px;border-radius:50%;font-size:16px;font-weight:700}.chat-input-section[_ngcontent-%COMP%]{padding:16px;border-top:1px solid #e3e6ea}.chat-input[_ngcontent-%COMP%]{width:100%;border:1px solid #e3e6ea;border-radius:24px;padding:12px 16px}.chat-send[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;border-radius:24px;padding:10px 16px;cursor:pointer;transition:background-color .3s}.chat-send[_ngcontent-%COMP%]:hover{background-color:#0056b3}.user-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;height:32px;width:32px}.user-status[_ngcontent-%COMP%]{position:absolute;height:10px;width:10px;border-radius:50%;background-color:#0f0;bottom:4px;right:4px;border:2px solid #ffffff}.unread-message[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background-color:#ff5b5b;color:#fff}.font-size-16[_ngcontent-%COMP%]{font-size:16px}.font-size-14[_ngcontent-%COMP%]{font-size:14px}.font-size-12[_ngcontent-%COMP%]{font-size:12px}.font-size-11[_ngcontent-%COMP%]{font-size:11px}.text-primary[_ngcontent-%COMP%]{color:#007bff!important}.text-reset[_ngcontent-%COMP%]{color:inherit;text-decoration:none}.text-muted[_ngcontent-%COMP%]{color:#6c757d}.text-truncate[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.dropdown-menu[_ngcontent-%COMP%]{border:1px solid #e3e6ea;border-radius:8px;padding:0;margin:0;box-shadow:0 5px 10px #0000001a}.dropdown-item[_ngcontent-%COMP%]{padding:10px 16px;color:#333;text-decoration:none;display:block;transition:background-color .3s}.dropdown-item[_ngcontent-%COMP%]:hover{background-color:#f4f6f9}.dropdown-menu-end[_ngcontent-%COMP%]{right:0;left:auto}.chat-day-title[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{background-color:#f4f6f9;color:#333;padding:6px 12px;border-radius:4px;display:inline-block;margin-bottom:10px}.conversation-list[_ngcontent-%COMP%]   .ctext-wrap[_ngcontent-%COMP%]{background-color:#f4f6f9;padding:10px;border-radius:8px;position:relative}.conversation-list[_ngcontent-%COMP%]   .ctext-wrap[_ngcontent-%COMP%]   .dropdown[_ngcontent-%COMP%]{position:absolute;right:10px;top:10px}.conversation-list[_ngcontent-%COMP%]   .ctext-wrap[_ngcontent-%COMP%]   .message-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:8px;object-fit:cover}.message-img-list[_ngcontent-%COMP%]{display:inline-block;margin-right:10px}.user-chat-nav[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{color:#6c757d;font-size:16px;background-color:transparent;border:none}.user-chat-nav[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{color:#007bff}.align-middle[_ngcontent-%COMP%]{vertical-align:middle}.align-self-center[_ngcontent-%COMP%]{align-self:center}.me-1[_ngcontent-%COMP%]{margin-right:8px}.me-3[_ngcontent-%COMP%]{margin-right:16px}.ms-1[_ngcontent-%COMP%]{margin-left:8px}.chat-conversation[_ngcontent-%COMP%]{overflow-y:auto;height:510px;padding:16px}"]})}return n})();const z=[{path:"",component:x,canActivate:[f.p]},{path:":id",component:x,canActivate:[f.p]}];let J=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({imports:[p.Bz.forChild(z),p.Bz]})}return n})(),I=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({imports:[g.ez,J,c.UX]})}return n})()}}]);