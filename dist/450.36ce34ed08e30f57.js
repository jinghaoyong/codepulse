"use strict";(self.webpackChunkcodepulse=self.webpackChunkcodepulse||[]).push([[450],{1333:(zi,vt,x)=>{x.d(vt,{p:()=>$e});var we=x(5879),Y=x(8145),v=x(459),Ne=x(5257);const $e=(qt,wt)=>{const re=(0,we.f3M)(v.N),dt=(0,we.f3M)(Ne.e),Z=(0,we.f3M)(Y.F0),me=dt.getUser();return re.get("Authorization"),!!me||(dt.googleLogout(),Z.createUrlTree(["/login"],{queryParams:{returnUrl:wt.url}}))}},4223:(zi,vt,x)=>{x.d(vt,{u:()=>wt});var we=x(5861),Y=x(553),v=x(5879),Ne=x(9862),$e=x(5835),qt=x(4186);let wt=(()=>{class re{constructor(Z,me,z){this.http=Z,this.firestore=me,this.storage=z}createBlogPost(Z){return this.http.post(`${Y.N.apiBaseUrl}/api/blogposts?addAuth=true`,Z)}getAllBlogPosts(){return this.http.get(`${Y.N.apiBaseUrl}/api/blogposts`)}getBlogPostById(Z){return this.http.get(`${Y.N.apiBaseUrl}/api/blogposts/${Z}`)}getBlogPostByUrlHandle(Z){return this.http.get(`${Y.N.apiBaseUrl}/api/blogposts/${Z}`)}updateBlogPost(Z,me){return this.http.put(`${Y.N.apiBaseUrl}/api/blogposts/${Z}?addAuth=true`,me)}deleteBlogPost(Z){return this.http.delete(`${Y.N.apiBaseUrl}/api/blogposts/${Z}?addAuth=true`)}getAllBlogPostsFromFirebase(){var Z=this;return(0,we.Z)(function*(){return Z.firestore.collection("posts").snapshotChanges()})()}uploadImageToFireStore(Z,me){var z=this;return(0,we.Z)(function*(){const ue=Z.target.files[0],rt=z.storage.ref(`zenImageFolder/${me}_${ue.name}`);try{yield rt.put(ue);const Gt=yield rt.getDownloadURL().toPromise();return console.log("Image uploaded:",Gt),Gt.toString()}catch(Gt){return console.error("Error uploading image:",Gt),""}})()}createPostToFirebase(Z,me){var z=this;return(0,we.Z)(function*(){try{const Ye=(yield z.firestore.collection("posts").add(Z)).id;if(console.log("Post created successfully! > postId",Ye),me){const rt=yield z.uploadImageToFireStore(me,Ye);Z.imageUrl=rt,console.log("postData.url",Z.url)}return yield z.updatePostToFirebase(Ye,Z),Ye}catch(ue){throw console.error("Error creating post:",ue),ue}})()}updatePostToFirebase(Z,me){const z=this.firestore.collection("posts").doc(Z).update(me);return console.log("updatePostToFirebase > postPromise",z),z}deletePostFromFirebase(Z){return this.firestore.collection("posts").doc(Z).delete()}getPostByIdFromFirebase(Z){var me=this;return(0,we.Z)(function*(){return me.firestore.collection("posts").doc(Z).get().toPromise().then(z=>z.exists?z.data():(console.log("No such document!"),null)).catch(z=>{throw console.error("Error getting document:",z),z})})()}static#e=this.\u0275fac=function(me){return new(me||re)(v.LFG(Ne.eN),v.LFG($e.ST),v.LFG(qt.Q1))};static#t=this.\u0275prov=v.Yz7({token:re,factory:re.\u0275fac,providedIn:"root"})}return re})()},900:(zi,vt,x)=>{x.d(vt,{H:()=>dt});var we=x(5861),Y=x(7398),v=x(553),Ne=x(5879),$e=x(9862),qt=x(459),wt=x(5835),re=x(4186);let dt=(()=>{class Z{constructor(z,ue,Ye,rt){this.http=z,this.cookieServ=ue,this.firestore=Ye,this.storage=rt}getAllCategories(){return this.http.get(`${v.N.apiBaseUrl}/api/Categories`)}getCategoryById(z){return this.http.get(`${v.N.apiBaseUrl}/api/Categories/${z}`)}addCategory(z){return this.http.post(`${v.N.apiBaseUrl}/api/Categories?addAuth=true`,z)}updateCategory(z,ue){return this.http.put(`${v.N.apiBaseUrl}/api/Categories/${z}?addAuth=true`,ue)}deleteCategory(z){return this.http.delete(`${v.N.apiBaseUrl}/api/Categories/${z}?addAuth=true`)}getAllCategoriesFromFirebase(){var z=this;return(0,we.Z)(function*(){return z.firestore.collection("categories").snapshotChanges()})()}getCategoryByIdFromFirebase(z){return this.firestore.collection("categories").doc(z).snapshotChanges().pipe((0,Y.U)(ue=>{const Ye=ue.payload.data();return{id:ue.payload.id,...Ye}}))}static#e=this.\u0275fac=function(ue){return new(ue||Z)(Ne.LFG($e.eN),Ne.LFG(qt.N),Ne.LFG(wt.ST),Ne.LFG(re.Q1))};static#t=this.\u0275prov=Ne.Yz7({token:Z,factory:Z.\u0275fac,providedIn:"root"})}return Z})()},4450:(zi,vt,x)=>{x.r(vt),x.d(vt,{FeaturesModule:()=>w});var we=x(6814),Y=x(8145),v=x(5879),Ne=x(4223),$e=x(6080),qt=x(900);function wt($,se){if(1&$){const k=v.EpF();v.TgZ(0,"li")(1,"a",14),v.NdJ("click",function(){const at=v.CHM(k).$implicit,D=v.oxw();return v.KtG(D.selectCategory(at.payload.doc.id))}),v._uU(2),v.qZA()()}if(2&$){const k=se.$implicit;v.xp6(2),v.Oqu(k.payload.doc.data().categoryName)}}function re($,se){if(1&$&&(v.TgZ(0,"div")(1,"h3"),v._uU(2),v.qZA(),v.TgZ(3,"h5"),v._uU(4),v.qZA()()),2&$){const k=v.oxw();v.xp6(2),v.Oqu(k.selectedCategoryName),v.xp6(2),v.Oqu(k.selectedCategoryDescription)}}function dt($,se){if(1&$&&(v.TgZ(0,"div"),v._UZ(1,"img",15),v.qZA()),2&$){const k=v.oxw();v.xp6(1),v.MGl("alt","",k.selectedCategoryDescription," Image"),v.Q6J("src",k.selectedCategoryImage,v.LSH)}}const Z=function($){return["/blog",$]};function me($,se){if(1&$&&(v.TgZ(0,"div",17)(1,"div",18),v._UZ(2,"img",19),v.TgZ(3,"div",20)(4,"h5",21),v._uU(5),v.qZA(),v.TgZ(6,"p",22),v._uU(7),v.qZA(),v.TgZ(8,"span",23)(9,"a",3),v._uU(10,"Read More"),v.qZA()()()()()),2&$){const k=se.$implicit;v.xp6(2),v.Q6J("src",k.payload.doc.data().imageUrl,v.LSH)("alt",k.payload.doc.data().title),v.xp6(3),v.hij(" ",k.payload.doc.data().title," "),v.xp6(2),v.hij(" ",k.payload.doc.data().desc," "),v.xp6(2),v.Q6J("routerLink",v.VKq(5,Z,k.payload.doc.id))}}function z($,se){if(1&$&&(v.ynx(0),v.YNc(1,me,11,7,"div",16),v.ALo(2,"async"),v.BQk()),2&$){const k=v.oxw();v.xp6(1),v.Q6J("ngForOf",v.lcZ(2,1,k.blogsFromFirebase))}}const ue=function(){return["/admin/blogposts/add"]};let Ye=(()=>{class ${constructor(k,G,_t){this.blogPostServ=k,this.spinServ=G,this.categoryServ=_t}ngOnInit(){this.spinServ.requestStarted(),this.categoryServ.getAllCategoriesFromFirebase().then(k=>{console.log("data",k),this.categories=k}),this.blogPostServ.getAllBlogPostsFromFirebase().then(k=>{this.blogsFromFirebase=k,this.spinServ.requestEnded()}).catch(k=>{this.spinServ.requestEnded()}),console.log("this.blogsFromFirebase",this.blogsFromFirebase)}uploadImage(k,G){this.blogPostServ.uploadImageToFireStore(k,G)}selectCategory(k){this.categoryServ.getCategoryByIdFromFirebase(k).subscribe(G=>{console.log("category",G),this.selectedCategoryId=G?.id,this.selectedCategoryName=G?.categoryName,this.selectedCategoryDescription=G?.categoryDescription,this.selectedCategoryImage=G?.categoryImage})}static#e=this.\u0275fac=function(G){return new(G||$)(v.Y36(Ne.u),v.Y36($e.V),v.Y36(qt.H))};static#t=this.\u0275cmp=v.Xpm({type:$,selectors:[["app-home"]],decls:19,vars:8,consts:[[1,"container"],[1,"my-5"],[1,"d-flex","justify-content-end","mt-3","mb-3"],[1,"btn","btn-primary",3,"routerLink"],[1,"row"],[1,"col-md-2"],[1,"dropdown"],["type","button","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","btn-secondary","dropdown-toggle"],[1,"dropdown-menu"],[4,"ngFor","ngForOf"],[1,"col-md-3"],[4,"ngIf"],[1,"col"],[1,"row","align-items-stretch"],["href","#",1,"dropdown-item",3,"click"],["width","50px","height","50px",3,"src","alt"],["class","col-12 col-md-4 mb-3",4,"ngFor","ngForOf"],[1,"col-12","col-md-4","mb-3"],[1,"card","h-100"],[1,"card-img-top",3,"src","alt"],[1,"card-body","d-flex","flex-column"],[1,"card-title"],[1,"card-text"],[1,"d-flex","align-items-end",2,"flex","1"]],template:function(G,_t){1&G&&(v.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),v._uU(4,"Add BlogPost"),v.qZA()(),v.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"button",7),v._uU(9," Categories "),v.qZA(),v.TgZ(10,"ul",8),v.YNc(11,wt,3,1,"li",9),v.ALo(12,"async"),v.qZA()()(),v.TgZ(13,"div",10),v.YNc(14,re,5,2,"div",11),v.qZA(),v.TgZ(15,"div",12),v.YNc(16,dt,2,2,"div",11),v.qZA()(),v.TgZ(17,"div",13),v.YNc(18,z,3,3,"ng-container",11),v.qZA()()()),2&G&&(v.xp6(3),v.Q6J("routerLink",v.DdM(7,ue)),v.xp6(8),v.Q6J("ngForOf",v.lcZ(12,5,_t.categories)),v.xp6(3),v.Q6J("ngIf",_t.selectedCategoryId),v.xp6(2),v.Q6J("ngIf",_t.selectedCategoryId),v.xp6(2),v.Q6J("ngIf",_t.blogsFromFirebase))},dependencies:[Y.rH,we.sg,we.O5,we.Ov]})}return $})();var rt=x(1333);const Gt=[{path:"",component:Ye},{path:"blog",loadChildren:()=>x.e(805).then(x.bind(x,6805)).then($=>$.PublicModule)},{path:"admin/categories",loadChildren:()=>x.e(466).then(x.bind(x,4466)).then($=>$.CategoryListModule),canActivate:[rt.p]},{path:"login",loadChildren:()=>x.e(960).then(x.bind(x,2960)).then($=>$.AuthModule)},{path:"admin/blogposts",loadChildren:()=>x.e(745).then(x.bind(x,1745)).then($=>$.BlogPostModule),canActivate:[rt.p]}];let ji=(()=>{class ${static#e=this.\u0275fac=function(G){return new(G||$)};static#t=this.\u0275mod=v.oAB({type:$});static#n=this.\u0275inj=v.cJS({imports:[Y.Bz.forChild(Gt),Y.Bz]})}return $})(),w=(()=>{class ${static#e=this.\u0275fac=function(G){return new(G||$)};static#t=this.\u0275mod=v.oAB({type:$});static#n=this.\u0275inj=v.cJS({imports:[ji,Y.Bz,we.ez]})}return $})()},5835:(zi,vt,x)=>{x.d(vt,{ST:()=>qT});var D,we=x(6814),Y=x(5879),v=x(1920),Ne=x(7217),$e=x(981),qt=x(6321),wt=x(5592),re=x(2459),dt=x(2096),Z=x(7921),me=x(9384),z=x(7398),ue=x(6699),Ye=x(3997),rt=x(2181),ji=(x(6365),x(3106)),w=x(5861),$=x(4303),se=x(4537),k=x(7879),G=x(9058),_t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},at={},$i=$i||{},j=_t||self;function kr(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function _n(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Ki="closure_uid_"+(1e9*Math.random()>>>0),$a=0;function Ka(n,e,t){return n.call.apply(n.bind,arguments)}function go(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Ke(n,e,t){return(Ke=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ka:go).apply(null,arguments)}function Fr(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Le(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function ut(){this.s=this.s,this.o=this.o}ut.prototype.s=!1,ut.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function mo(n){Object.prototype.hasOwnProperty.call(n,Ki)&&n[Ki]||(n[Ki]=++$a)}(this)},ut.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Qi=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Jt(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function yn(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(kr(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function oe(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}oe.prototype.h=function(){this.defaultPrevented=!0};var Qa=function(){if(!j.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const t=()=>{};j.addEventListener("test",t,e),j.removeEventListener("test",t,e)}catch{}return n}();function Hn(n){return/^[\s\xa0]*$/.test(n)}function Mr(){var n=j.navigator;return n&&(n=n.userAgent)?n:""}function At(n){return-1!=Mr().indexOf(n)}function Wi(n){return Wi[" "](n),n}Wi[" "]=function(){};var Ur,n,Or=At("Opera"),en=At("Trident")||At("MSIE"),Lr=At("Edge"),Zn=Lr||en,Rt=At("Gecko")&&!(-1!=Mr().toLowerCase().indexOf("webkit")&&!At("Edge"))&&!(At("Trident")||At("MSIE"))&&!At("Edge"),_o=-1!=Mr().toLowerCase().indexOf("webkit")&&!At("Edge");function tn(){var n=j.document;return n?n.documentMode:void 0}e:{var Hi="",Tn=(n=Mr(),Rt?/rv:([^\);]+)(\)|;)/.exec(n):Lr?/Edge\/([\d\.]+)/.exec(n):en?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):_o?/WebKit\/(\S+)/.exec(n):Or?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Tn&&(Hi=Tn?Tn[1]:""),en){var Zi=tn();if(null!=Zi&&Zi>parseFloat(Hi)){Ur=String(Zi);break e}}Ur=Hi}var Ha=j.document&&en&&(tn()||parseInt(Ur,10))||void 0;function Yn(n,e){if(oe.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Rt){e:{try{Wi(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Za[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Yn.$.h.call(this)}}Le(Yn,oe);var Za={2:"touch",3:"pen",4:"mouse"};Yn.prototype.h=function(){Yn.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Xn="closure_listenable_"+(1e6*Math.random()|0),Ya=0;function Xa(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++Ya,this.fa=this.ia=!1}function Qe(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Jn(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function Ji(n){const e={};for(const t in n)e[t]=n[t];return e}const To="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function es(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<To.length;s++)t=To[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function er(n){this.src=n,this.g={},this.h=0}function ts(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=Qi(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Qe(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function ns(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}er.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=ns(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new Xa(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var rs="closure_lm_"+(1e6*Math.random()|0),ft={};function Br(n,e,t,r,i){if(r&&r.once)return is(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Br(n,e[s],t,r,i);return null}return t=os(t),n&&n[Xn]?n.O(e,t,_n(r)?!!r.capture:!!r,i):Io(n,e,t,!1,r,i)}function Io(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=_n(i)?!!i.capture:!!i,a=nn(n);if(a||(n[rs]=a=new er(n)),(t=a.add(e,t,r,o,s)).proxy)return t;if(r=function Ja(){const e=eu;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)Qa||(i=o),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(tr(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function is(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)is(n,e[s],t,r,i);return null}return t=os(t),n&&n[Xn]?n.P(e,t,_n(r)?!!r.capture:!!r,i):Io(n,e,t,!0,r,i)}function Eo(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Eo(n,e[s],t,r,i);else r=_n(r)?!!r.capture:!!r,t=os(t),n&&n[Xn]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=ns(s=n.g[e],t,r,i))&&(Qe(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=nn(n))&&(e=n.g[e.toString()],n=-1,e&&(n=ns(e,t,r,i)),(t=-1<n?e[n]:null)&&qe(t))}function qe(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[Xn])ts(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(tr(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=nn(e))?(ts(t,n),0==t.h&&(t.src=null,e[rs]=null)):Qe(n)}}}function tr(n){return n in ft?ft[n]:ft[n]="on"+n}function eu(n,e){if(n.fa)n=!0;else{e=new Yn(e,this);var t=n.listener,r=n.la||n.src;n.ia&&qe(n),n=t.call(r,e)}return n}function nn(n){return(n=n[rs])instanceof er?n:null}var ss="__closure_events_fn_"+(1e9*Math.random()>>>0);function os(n){return"function"==typeof n?n:(n[ss]||(n[ss]=function(e){return n.handleEvent(e)}),n[ss])}function ke(){ut.call(this),this.i=new er(this),this.S=this,this.J=null}function Ge(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new oe(e,n);else if(e instanceof oe)e.target=e.target||n;else{var i=e;es(e=new oe(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=In(o,r,!0,e)&&i}if(i=In(o=e.g=n,r,!0,e)&&i,i=In(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=In(o=e.g=t[s],r,!1,e)&&i}function In(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&ts(n.i,o),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}Le(ke,ut),ke.prototype[Xn]=!0,ke.prototype.removeEventListener=function(n,e,t,r){Eo(this,n,e,t,r)},ke.prototype.N=function(){if(ke.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Qe(t[r]);delete n.g[e],n.h--}}this.J=null},ke.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},ke.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var qr=j.JSON.stringify;function tu(){var n=rn;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var yt=new class vo{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Pt,n=>n.reset());class Pt{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Gr(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function ru(n){j.setTimeout(()=>{throw n},0)}let nr,St=!1,rn=new class nu{constructor(){this.h=this.g=null}add(e,t){const r=yt.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},as=()=>{const n=j.Promise.resolve(void 0);nr=()=>{n.then(iu)}};var iu=()=>{for(var n;n=tu();){try{n.h.call(n.g)}catch(t){ru(t)}var e=yt;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}St=!1};function rr(n,e){ke.call(this),this.h=n||1,this.g=e||j,this.j=Ke(this.qb,this),this.l=Date.now()}function us(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function cs(n,e,t){if("function"==typeof n)t&&(n=Ke(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=Ke(n.handleEvent,n)}return 2147483647<Number(e)?-1:j.setTimeout(n,e||0)}function wo(n){n.g=cs(()=>{n.g=null,n.i&&(n.i=!1,wo(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}Le(rr,ke),(D=rr.prototype).ga=!1,D.T=null,D.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ge(this,"tick"),this.ga&&(us(this),this.start()))}},D.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},D.N=function(){rr.$.N.call(this),us(this),delete this.g};class su extends ut{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:wo(this)}N(){super.N(),this.g&&(j.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function En(n){ut.call(this),this.h=n,this.g={}}Le(En,ut);var ls=[];function ir(n,e,t,r){Array.isArray(t)||(t&&(ls[0]=t.toString()),t=ls);for(var i=0;i<t.length;i++){var s=Br(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function zr(n){Jn(n.g,function(e,t){this.g.hasOwnProperty(t)&&qe(e)},n),n.g={}}function jr(){this.g=!0}function vn(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Xe(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return qr(t)}catch{return e}}(n,t)+(r?" "+r:"")})}En.prototype.N=function(){En.$.N.call(this),zr(this)},En.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},jr.prototype.Ea=function(){this.g=!1},jr.prototype.info=function(){};var kt={},Ro=null;function Ft(){return Ro=Ro||new ke}function hs(n){oe.call(this,kt.Ta,n)}function sr(n){const e=Ft();Ge(e,new hs(e))}function Po(n,e){oe.call(this,kt.STAT_EVENT,n),this.stat=e}function ge(n){const e=Ft();Ge(e,new Po(e,n))}function So(n,e){oe.call(this,kt.Ua,n),this.size=e}function or(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return j.setTimeout(function(){n()},e)}kt.Ta="serverreachability",Le(hs,oe),kt.STAT_EVENT="statevent",Le(Po,oe),kt.Ua="timingevent",Le(So,oe);var $r={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},xo={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Kr(){}function Co(){}Kr.prototype.h=null;var fs,ar={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Qr(){oe.call(this,"d")}function ds(){oe.call(this,"c")}function Wr(){}function wn(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new En(this),this.P=Vo,this.V=new rr(n=Zn?125:void 0),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Hr}function Hr(){this.i=null,this.g="",this.h=!1}Le(Qr,oe),Le(ds,oe),Le(Wr,Kr),Wr.prototype.g=function(){return new XMLHttpRequest},Wr.prototype.i=function(){return{}},fs=new Wr;var Vo=45e3,bo={},ms={};function gs(n,e,t){n.L=1,n.A=Jr(Ot(e)),n.u=t,n.S=!0,Do(n,null)}function Do(n,e){n.G=Date.now(),An(n),n.B=Ot(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Ts(t.i,"t",r),n.o=0,t=n.l.J,n.h=new Hr,n.g=lh(n.l,t?e:null,!n.u),0<n.O&&(n.M=new su(Ke(n.Pa,n,n.g),n.O)),ir(n.U,n.g,"readystatechange",n.nb),e=n.I?Ji(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),sr(),function ou(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var d=c[0];c=c[1];var m=d.split("_");o=2<=m.length&&"type"==m[1]?o+(d+"=")+c+"&":o+(d+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.v,n.B,n.m,n.W,n.u)}function ps(n){return!!n.g&&"GET"==n.v&&2!=n.L&&n.l.Ha}function No(n,e,t){let i,r=!0;for(;!n.J&&n.o<t.length;){if(i=uu(n,t),i==ms){4==e&&(n.s=4,ge(14),r=!1),vn(n.j,n.m,null,"[Incomplete Response]");break}if(i==bo){n.s=4,ge(15),vn(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}vn(n.j,n.m,i,null),Zr(n,i)}ps(n)&&0!=n.o&&(n.h.g=n.h.g.slice(n.o),n.o=0),4!=e||0!=t.length||n.h.h||(n.s=1,ge(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),vu(e),e.M=!0,ge(11))):(vn(n.j,n.m,t,"[Invalid Chunked Response]"),Mt(n),cr(n))}function uu(n,e){var t=n.o,r=e.indexOf("\n",t);return-1==r?ms:(t=Number(e.substring(t,r)),isNaN(t)?bo:(r+=1)+t>e.length?ms:(e=e.slice(r,r+t),n.o=r+t,e))}function An(n){n.Y=Date.now()+n.P,ko(n,n.P)}function ko(n,e){if(null!=n.C)throw Error("WatchDog timer not null");n.C=or(Ke(n.lb,n),e)}function ur(n){n.C&&(j.clearTimeout(n.C),n.C=null)}function cr(n){0==n.l.H||n.J||oh(n.l,n)}function Mt(n){ur(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,us(n.V),zr(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Zr(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||Is(t.i,n)))if(!n.K&&Is(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;qo(t),Pn(t)}Eu(t),ge(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=or(Ke(t.ib,t),6e3));if(1>=pu(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else dr(t,11)}else if((n.K||t.g==n)&&qo(t),!Hn(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],2==t.H)if("c"==c[0]){t.K=c[1],t.pa=c[2];const d=c[3];null!=d&&(t.ra=d,t.l.info("VER="+t.ra));const m=c[4];null!=m&&(t.Ga=m,t.l.info("SVER="+t.Ga));const p=c[5];null!=p&&"number"==typeof p&&0<p&&(t.L=r=1.5*p,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const T=n.g;if(T){const S=T.g?T.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(S){var s=r.i;s.g||-1==S.indexOf("spdy")&&-1==S.indexOf("quic")&&-1==S.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(ei(s,s.h),s.h=null))}if(r.F){const V=T.g?T.g.getResponseHeader("X-HTTP-Session-Id"):null;V&&(r.Da=V,pe(r.I,r.F,V))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((r=t).wa=ch(r,r.J?r.pa:null,r.Y),o.K){hr(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(ur(a),An(a)),r.g=o}else ih(r);0<t.j.length&&xn(t)}else"stop"!=c[0]&&"close"!=c[0]||dr(t,7);else 3==t.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?dr(t,7):$t(t):"noop"!=c[0]&&t.h&&t.h.Aa(c),t.A=0)}sr()}catch{}}function cu(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(kr(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function Mo(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(kr(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function Fo(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(kr(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(D=wn.prototype).setTimeout=function(n){this.P=n},D.nb=function(n){n=n.target;const e=this.M;e&&3==xe(n)?e.l():this.Pa(n)},D.Pa=function(n){try{if(n==this.g)e:{const d=xe(this.g);var e=this.g.Ia();if(this.g.da(),!(3>d)&&(3!=d||Zn||this.g&&(this.h.h||this.g.ja()||Ce(this.g)))){this.J||4!=d||7==e||sr(),ur(this);var t=this.g.da();this.ca=t;t:if(ps(this)){var r=Ce(this.g);n="";var i=r.length,s=4==xe(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Mt(this),cr(this);var o="";break t}this.h.i=new j.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function Ao(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+o})}(this.j,this.v,this.B,this.m,this.W,d,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Hn(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.s=3,ge(12),Mt(this),cr(this);break e}vn(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Zr(this,t)}this.S?(No(this,d,o),Zn&&this.i&&3==d&&(ir(this.U,this.V,"tick",this.mb),this.V.start())):(vn(this.j,this.m,o,null),Zr(this,o)),4==d&&Mt(this),this.i&&!this.J&&(4==d?oh(this.l,this):(this.i=!1,An(this)))}else(function Ut(n){const e={};n=(n.g&&2<=xe(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(Hn(n[r]))continue;var t=Gr(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function Xi(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.s=3,ge(12)):(this.s=0,ge(13)),Mt(this),cr(this)}}}catch{}},D.mb=function(){if(this.g){var n=xe(this.g),e=this.g.ja();this.o<e.length&&(ur(this),No(this,n,e),this.i&&4!=n&&An(this))}},D.cancel=function(){this.J=!0,Mt(this)},D.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(function au(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.B),2!=this.L&&(sr(),ge(17)),Mt(this),this.s=2,cr(this)):ko(this,this.Y-n)};var lu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function sn(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof sn){this.h=n.h,Yr(this,n.j),this.s=n.s,this.g=n.g,Xr(this,n.m),this.l=n.l;var e=n.i,t=new jt;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Oo(this,t),this.o=n.o}else n&&(e=String(n).match(lu))?(this.h=!1,Yr(this,e[1]||"",!0),this.s=Rn(e[2]||""),this.g=Rn(e[3]||"",!0),Xr(this,e[4]),this.l=Rn(e[5]||"",!0),Oo(this,e[6]||"",!0),this.o=Rn(e[7]||"")):(this.h=!1,this.i=new jt(null,this.h))}function Ot(n){return new sn(n)}function Yr(n,e,t){n.j=t?Rn(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Xr(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Oo(n,e,t){e instanceof jt?(n.i=e,function fu(n,e){e&&!n.j&&(Lt(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(ys(this,r),Ts(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=lr(e,hu)),n.i=new jt(e,n.h))}function pe(n,e,t){n.i.set(e,t)}function Jr(n){return pe(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Rn(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function lr(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Jl),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Jl(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}sn.prototype.toString=function(){var n=[],e=this.j;e&&n.push(lr(e,_s,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(lr(e,_s,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(lr(t,"/"==t.charAt(0)?th:eh,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",lr(t,du)),n.join("")};var _s=/[#\/\?@]/g,eh=/[#\?:]/g,th=/[#\?]/g,hu=/[#\?@]/g,du=/#/g;function jt(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Lt(n){n.g||(n.g=new Map,n.h=0,n.i&&function Xl(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function ys(n,e){Lt(n),e=on(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function xt(n,e){return Lt(n),e=on(n,e),n.g.has(e)}function Ts(n,e,t){ys(n,e),0<t.length&&(n.i=null,n.g.set(on(n,e),Jt(t)),n.h+=t.length)}function on(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Lo(n){this.l=n||gu,n=j.PerformanceNavigationTiming?0<(n=j.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(j.g&&j.g.Ka&&j.g.Ka()&&j.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(D=jt.prototype).add=function(n,e){Lt(this),this.i=null,n=on(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},D.forEach=function(n,e){Lt(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},D.ta=function(){Lt(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},D.Z=function(n){Lt(this);let e=[];if("string"==typeof n)xt(this,n)&&(e=e.concat(this.g.get(on(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},D.set=function(n,e){return Lt(this),this.i=null,xt(this,n=on(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},D.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},D.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};var gu=10;function Uo(n){return!!n.h||!!n.g&&n.g.size>=n.j}function pu(n){return n.h?1:n.g?n.g.size:0}function Is(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function ei(n,e){n.g?n.g.add(e):n.h=e}function hr(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Bo(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return Jt(n.i)}Lo.prototype.cancel=function(){if(this.i=Bo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var _u=class{stringify(n){return j.JSON.stringify(n,void 0)}parse(n){return j.JSON.parse(n,void 0)}};function yu(){this.g=new _u}function Tu(n,e,t){const r=t||"";try{cu(n,function(i,s){let o=i;_n(i)&&(o=qr(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Es(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function ti(n){this.l=n.ec||null,this.j=n.ob||!1}function vs(n,e){ke.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=h,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Le(ti,Kr),ti.prototype.g=function(){return new vs(this.l,this.j)},ti.prototype.i=function(n){return function(){return n}}({}),Le(vs,ke);var h=0;function l(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function f(n){n.readyState=4,n.l=null,n.j=null,n.A=null,g(n)}function g(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(D=vs.prototype).open=function(n,e){if(this.readyState!=h)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,g(this)},D.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||j).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},D.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,f(this)),this.readyState=h},D.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,g(this)),this.g&&(this.readyState=3,g(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof j.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;l(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},D.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?f(this):g(this),3==this.readyState&&l(this)}},D.Za=function(n){this.g&&(this.response=this.responseText=n,f(this))},D.Ya=function(n){this.g&&(this.response=n,f(this))},D.ka=function(){this.g&&f(this)},D.setRequestHeader=function(n,e){this.v.append(n,e)},D.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},D.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(vs.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var _=j.JSON.parse;function I(n){ke.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=P,this.L=this.M=!1}Le(I,ke);var P="",O=/^https?$/i,M=["POST","PUT"];function J(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Ae(n),de(n)}function Ae(n){n.F||(n.F=!0,Ge(n,"complete"),Ge(n,"error"))}function _e(n){if(n.h&&typeof $i<"u"&&(!n.C[1]||4!=xe(n)||2!=n.da()))if(n.v&&4==xe(n))cs(n.La,0,n);else if(Ge(n,"readystatechange"),4==xe(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===o){var i=String(n.I).match(lu)[1]||null;!i&&j.self&&j.self.location&&(i=j.self.location.protocol.slice(0,-1)),r=!O.test(i?i.toLowerCase():"")}t=r}if(t)Ge(n,"complete"),Ge(n,"success");else{n.m=6;try{var s=2<xe(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Ae(n)}}finally{de(n)}}}function de(n,e){if(n.g){Re(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Ge(n,"ready");try{t.onreadystatechange=r}catch{}}}function Re(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(j.clearTimeout(n.A),n.A=null)}function xe(n){return n.g?n.g.readyState:0}function Ce(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case P:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Ct(n){let e="";return Jn(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function Ue(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Ct(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):pe(n,e,t))}function Ve(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function an(n){this.Ga=0,this.j=[],this.l=new jr,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Ve("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Ve("baseRetryDelayMs",5e3,n),this.hb=Ve("retryDelaySeedMs",1e4,n),this.eb=Ve("forwardChannelMaxRetries",2,n),this.xa=Ve("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Lo(n&&n.concurrentRequestLimit),this.Ja=new yu,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function $t(n){if(Sn(n),3==n.H){var e=n.W++,t=Ot(n.I);if(pe(t,"SID",n.K),pe(t,"RID",e),pe(t,"TYPE","terminate"),ws(n,t),(e=new wn(n,n.l,e)).L=2,e.A=Jr(Ot(t)),t=!1,j.navigator&&j.navigator.sendBeacon)try{t=j.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&j.Image&&((new Image).src=e.A,t=!0),t||(e.g=lh(e.l,null),e.g.ha(e.A)),e.G=Date.now(),An(e)}uh(n)}function Pn(n){n.g&&(vu(n),n.g.cancel(),n.g=null)}function Sn(n){Pn(n),n.u&&(j.clearTimeout(n.u),n.u=null),qo(n),n.i.cancel(),n.m&&("number"==typeof n.m&&j.clearTimeout(n.m),n.m=null)}function xn(n){if(!Uo(n.i)&&!n.m){n.m=!0;var e=n.Na;nr||as(),St||(nr(),St=!0),rn.add(e,n),n.C=0}}function nh(n,e){var t;t=e?e.m:n.W++;const r=Ot(n.I);pe(r,"SID",n.K),pe(r,"RID",t),pe(r,"AID",n.V),ws(n,r),n.o&&n.s&&Ue(r,n.o,n.s),t=new wn(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=rh(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),ei(n.i,t),gs(t,r,e)}function ws(n,e){n.na&&Jn(n.na,function(t,r){pe(e,r,t)}),n.h&&cu({},function(t,r){pe(e,r,t)})}function rh(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Ke(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const o=["count="+t];-1==s?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let c=i[u].g;const d=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{Tu(d,o,"req"+c+"_")}catch{r&&r(d)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function ih(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;nr||as(),St||(nr(),St=!0),rn.add(e,n),n.A=0}}function Eu(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=or(Ke(n.Ma,n),ah(n,n.A)),n.A++,0))}function vu(n){null!=n.B&&(j.clearTimeout(n.B),n.B=null)}function sh(n){n.g=new wn(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=Ot(n.wa);pe(e,"RID","rpc"),pe(e,"SID",n.K),pe(e,"AID",n.V),pe(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&pe(e,"TO",n.qa),pe(e,"TYPE","xmlhttp"),ws(n,e),n.o&&n.s&&Ue(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=Jr(Ot(e)),t.u=null,t.S=!0,Do(t,n)}function qo(n){null!=n.v&&(j.clearTimeout(n.v),n.v=null)}function oh(n,e){var t=null;if(n.g==e){qo(n),vu(n),n.g=null;var r=2}else{if(!Is(n.i,e))return;t=e.F,hr(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;Ge(r=Ft(),new So(r,t)),xn(n)}else ih(n);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==r&&function og(n,e){return!(pu(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=or(Ke(n.Na,n,e),ah(n,n.C)),n.C++,0)))}(n,e)||2==r&&Eu(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:dr(n,5);break;case 4:dr(n,10);break;case 3:dr(n,6);break;default:dr(n,2)}}function ah(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function dr(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=Ke(n.pb,n);t||(t=new sn("//www.google.com/images/cleardot.gif"),j.location&&"http"==j.location.protocol||Yr(t,"https"),Jr(t)),function Iu(n,e){const t=new jr;if(j.Image){const r=new Image;r.onload=Fr(Es,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Fr(Es,t,r,"TestLoadImage: error",!1,e),r.onabort=Fr(Es,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Fr(Es,t,r,"TestLoadImage: timeout",!1,e),j.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else ge(2);n.H=0,n.h&&n.h.za(e),uh(n),Sn(n)}function uh(n){if(n.H=0,n.ma=[],n.h){const e=Bo(n.i);(0!=e.length||0!=n.j.length)&&(yn(n.ma,e),yn(n.ma,n.j),n.i.i.length=0,Jt(n.j),n.j.length=0),n.h.ya()}}function ch(n,e,t){var r=t instanceof sn?Ot(t):new sn(t);if(""!=r.g)e&&(r.g=e+"."+r.g),Xr(r,r.m);else{var i=j.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new sn(null);r&&Yr(s,r),e&&(s.g=e),i&&Xr(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&pe(r,t,e),pe(r,"VER",n.ra),ws(n,r),r}function lh(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new I(n.Ha&&!n.va?new ti({ob:t}):n.va)).Oa(n.J),e}function hh(){}function Go(){if(en&&!(10<=Number(Ha)))throw Error("Environmental error: no available transport.")}function Tt(n,e){ke.call(this),this.g=new an(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Hn(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Hn(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new ni(this)}function dh(n){Qr.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function fh(){ds.call(this),this.status=1}function ni(n){this.g=n}function Bt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function wu(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],o=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;o=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=t+((o=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function le(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(D=I.prototype).Oa=function(n){this.M=n},D.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():fs.g(),this.C=function zt(n){return n.h||(n.h=n.i())}(this.u?this.u:fs),this.g.onreadystatechange=Ke(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void J(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=j.FormData&&n instanceof j.FormData,!(0<=Qi(M,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Re(this),0<this.B&&((this.L=function K(n){return en&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ke(this.ua,this)):this.A=cs(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){J(this,s)}},D.ua=function(){typeof $i<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ge(this,"timeout"),this.abort(8))},D.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Ge(this,"complete"),Ge(this,"abort"),de(this))},D.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),de(this,!0)),I.$.N.call(this)},D.La=function(){this.s||(this.G||this.v||this.l?_e(this):this.kb())},D.kb=function(){_e(this)},D.isActive=function(){return!!this.g},D.da=function(){try{return 2<xe(this)?this.g.status:-1}catch{return-1}},D.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},D.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),_(e)}},D.Ia=function(){return this.m},D.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(D=an.prototype).ra=8,D.H=1,D.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new wn(this,this.l,n);let s=this.s;if(this.U&&(s?(s=Ji(s),es(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=rh(this,i,e),pe(t=Ot(this.I),"RID",n),pe(t,"CVER",22),this.F&&pe(t,"X-HTTP-Session-Id",this.F),ws(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Ct(s)))+"&"+e:this.o&&Ue(t,this.o,s)),ei(this.i,i),this.bb&&pe(t,"TYPE","init"),this.P?(pe(t,"$req",e),pe(t,"SID","null"),i.aa=!0,gs(i,t,null)):gs(i,t,e),this.H=2}}else 3==this.H&&(n?nh(this,n):0==this.j.length||Uo(this.i)||nh(this))},D.Ma=function(){if(this.u=null,sh(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=or(Ke(this.jb,this),n)}},D.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ge(10),Pn(this),sh(this))},D.ib=function(){null!=this.v&&(this.v=null,Pn(this),Eu(this),ge(19))},D.pb=function(n){n?(this.l.info("Successfully pinged google.com"),ge(2)):(this.l.info("Failed to ping google.com"),ge(1))},D.isActive=function(){return!!this.h&&this.h.isActive(this)},(D=hh.prototype).Ba=function(){},D.Aa=function(){},D.za=function(){},D.ya=function(){},D.isActive=function(){return!0},D.Va=function(){},Go.prototype.g=function(n,e){return new Tt(n,e)},Le(Tt,ke),Tt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;ge(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=ch(n,null,n.Y),xn(n)},Tt.prototype.close=function(){$t(this.g)},Tt.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=qr(n),n=t);e.j.push(new class{constructor(n,e){this.g=n,this.map=e}}(e.fb++,n)),3==e.H&&xn(e)},Tt.prototype.N=function(){this.g.h=null,delete this.j,$t(this.g),delete this.g,Tt.$.N.call(this)},Le(dh,Qr),Le(fh,ds),Le(ni,hh),ni.prototype.Ba=function(){Ge(this.g,"a")},ni.prototype.Aa=function(n){Ge(this.g,new dh(n))},ni.prototype.za=function(n){Ge(this.g,new fh)},ni.prototype.ya=function(){Ge(this.g,"b")},Le(Bt,function ag(){this.blockSize=-1}),Bt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Bt.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)wu(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){wu(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){wu(this,r),i=0;break}}this.h=i,this.i+=e},Bt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var ug={};function Au(n){return-128<=n&&128>n?function Wa(n,e){var t=ug;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new le([0|e],0>e?-1:0)}):new le([0|n],0>n?-1:0)}function Kt(n){if(isNaN(n)||!isFinite(n))return ri;if(0>n)return Je(Kt(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Ru;return new le(e,0)}var Ru=4294967296,ri=Au(0),Pu=Au(1),gh=Au(16777216);function un(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function Vt(n){return-1==n.h}function Je(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new le(t,~n.h).add(Pu)}function zo(n,e){return n.add(Je(e))}function jo(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function As(n,e){this.g=n,this.h=e}function $o(n,e){if(un(e))throw Error("division by zero");if(un(n))return new As(ri,ri);if(Vt(n))return e=$o(Je(n),e),new As(Je(e.g),Je(e.h));if(Vt(e))return e=$o(n,Je(e)),new As(Je(e.g),e.h);if(30<n.g.length){if(Vt(n)||Vt(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Pu,r=e;0>=r.X(n);)t=ph(t),r=ph(r);var i=ii(t,1),s=ii(r,1);for(r=ii(r,2),t=ii(t,2);!un(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=ii(r,1),t=ii(t,1)}return e=zo(n,i.R(e)),new As(i,e)}for(i=ri;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),o=(s=Kt(t)).R(e);Vt(o)||0<o.X(n);)o=(s=Kt(t-=r)).R(e);un(s)&&(s=Pu),i=i.add(s),n=zo(n,o)}return new As(i,n)}function ph(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new le(t,n.h)}function ii(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new le(i,n.h)}(D=le.prototype).ea=function(){if(Vt(this))return-Je(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Ru+r)*e,e*=Ru}return n},D.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(un(this))return"0";if(Vt(this))return"-"+Je(this).toString(n);for(var e=Kt(Math.pow(n,6)),t=this,r="";;){var i=$o(t,e).g,s=((0<(t=zo(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(un(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},D.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},D.X=function(n){return Vt(n=zo(this,n))?-1:un(n)?0:1},D.abs=function(){return Vt(this)?Je(this):this},D.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,t[i]=(o&=65535)<<16|(s&=65535)}return new le(t,-2147483648&t[t.length-1]?-1:0)},D.R=function(n){if(un(this)||un(n))return ri;if(Vt(this))return Vt(n)?Je(this).R(Je(n)):Je(Je(this).R(n));if(Vt(n))return Je(this.R(Je(n)));if(0>this.X(gh)&&0>n.X(gh))return Kt(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=n.D(i)>>>16,u=65535&n.D(i);t[2*r+2*i]+=o*u,jo(t,2*r+2*i),t[2*r+2*i+1]+=s*u,jo(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,jo(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,jo(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new le(t,0)},D.gb=function(n){return $o(this,n).h},D.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new le(t,this.h&n.h)},D.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new le(t,this.h|n.h)},D.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new le(t,this.h^n.h)},Go.prototype.createWebChannel=Go.prototype.g,Tt.prototype.send=Tt.prototype.u,Tt.prototype.open=Tt.prototype.m,Tt.prototype.close=Tt.prototype.close,$r.NO_ERROR=0,$r.TIMEOUT=8,$r.HTTP_ERROR=6,xo.COMPLETE="complete",Co.EventType=ar,ar.OPEN="a",ar.CLOSE="b",ar.ERROR="c",ar.MESSAGE="d",ke.prototype.listen=ke.prototype.O,I.prototype.listenOnce=I.prototype.P,I.prototype.getLastError=I.prototype.Sa,I.prototype.getLastErrorCode=I.prototype.Ia,I.prototype.getStatus=I.prototype.da,I.prototype.getResponseJson=I.prototype.Wa,I.prototype.getResponseText=I.prototype.ja,I.prototype.send=I.prototype.ha,I.prototype.setWithCredentials=I.prototype.Oa,Bt.prototype.digest=Bt.prototype.l,Bt.prototype.reset=Bt.prototype.reset,Bt.prototype.update=Bt.prototype.j,le.prototype.add=le.prototype.add,le.prototype.multiply=le.prototype.R,le.prototype.modulo=le.prototype.gb,le.prototype.compare=le.prototype.X,le.prototype.toNumber=le.prototype.ea,le.prototype.toString=le.prototype.toString,le.prototype.getBits=le.prototype.D,le.fromNumber=Kt,le.fromString=function mh(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return Je(mh(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Kt(Math.pow(e,8)),r=ri,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Kt(Math.pow(e,s)),r=r.R(s).add(Kt(o))):r=(r=r.R(t)).add(Kt(o))}return r};var cg=at.createWebChannelTransport=function(){return new Go},lg=at.getStatEventTarget=function(){return Ft()},Su=at.ErrorCode=$r,hg=at.EventType=xo,dg=at.Event=kt,_h=at.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Ko=(at.FetchXmlHttpFactory=ti,at.WebChannel=Co),fg=at.XhrIo=I,mg=at.Md5=Bt,si=at.Integer=le;const yh="@firebase/firestore";class We{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}We.UNAUTHENTICATED=new We(null),We.GOOGLE_CREDENTIALS=new We("google-credentials-uid"),We.FIRST_PARTY=new We("first-party-uid"),We.MOCK_USER=new We("mock-user");let oi="10.10.0";const Cn=new k.Yd("@firebase/firestore");function ai(){return Cn.logLevel}function R(n,...e){if(Cn.logLevel<=k.in.DEBUG){const t=e.map(xu);Cn.debug(`Firestore (${oi}): ${n}`,...t)}}function Fe(n,...e){if(Cn.logLevel<=k.in.ERROR){const t=e.map(xu);Cn.error(`Firestore (${oi}): ${n}`,...t)}}function mt(n,...e){if(Cn.logLevel<=k.in.WARN){const t=e.map(xu);Cn.warn(`Firestore (${oi}): ${n}`,...t)}}function xu(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function F(n="Unexpected state"){const e=`FIRESTORE (${oi}) INTERNAL ASSERTION FAILED: `+n;throw Fe(e),new Error(e)}function L(n,e){n||F()}function b(n,e){return n}const E={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class A extends G.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ze{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Th{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class _g{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(We.UNAUTHENTICATED))}shutdown(){}}class yg{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Tg{constructor(e){this.t=e,this.currentUser=We.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let o=new ze;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ze,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,w.Z)(function*(){yield c.promise,yield s(r.currentUser)}))},u=c=>{R("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(R("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ze)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(R("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(L("string"==typeof r.accessToken),new Th(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return L(null===e||"string"==typeof e),new We(e)}}class Ig{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=We.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Eg{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Ig(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(We.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ih{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class vg{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&R("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,R("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{R("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):R("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(L("string"==typeof t.token),this.R=t.token,new Ih(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function wg(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Eh{static newId(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=wg(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function Q(n,e){return n<e?-1:n>e?1:0}function ui(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function vh(n){return n+"\0"}class Pe{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new A(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new A(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new A(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new A(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Pe.fromMillis(Date.now())}static fromDate(e){return Pe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Pe(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class B{constructor(e){this.timestamp=e}static fromTimestamp(e){return new B(e)}static min(){return new B(new Pe(0,0))}static max(){return new B(new Pe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Rs{constructor(e,t,r){void 0===t?t=0:t>e.length&&F(),void 0===r?r=e.length-t:r>e.length-t&&F(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Rs.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Rs?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class te extends Rs{construct(e,t,r){return new te(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new A(E.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new te(t)}static emptyPath(){return new te([])}}const Ag=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ie extends Rs{construct(e,t,r){return new Ie(e,t,r)}static isValidIdentifier(e){return Ag.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ie.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Ie(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new A(E.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if("\\"===a){if(i+1===e.length)throw new A(E.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new A(E.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else"`"===a?(o=!o,i++):"."!==a||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new A(E.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ie(t)}static emptyPath(){return new Ie([])}}class N{constructor(e){this.path=e}static fromPath(e){return new N(te.fromString(e))}static fromName(e){return new N(te.fromString(e).popFirst(5))}static empty(){return new N(te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===te.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new N(new te(e.slice()))}}class ci{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function Cu(n){return n.fields.find(e=>2===e.kind)}function fr(n){return n.fields.filter(e=>2!==e.kind)}ci.UNKNOWN_ID=-1;class mr{constructor(e,t){this.fieldPath=e,this.kind=t}}class li{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new li(0,It.min())}}function wh(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=B.fromTimestamp(1e9===r?new Pe(t+1,0):new Pe(t,r));return new It(i,N.empty(),e)}function Ah(n){return new It(n.readTime,n.key,-1)}class It{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new It(B.min(),N.empty(),-1)}static max(){return new It(B.max(),N.empty(),-1)}}function Vu(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=N.comparator(n.documentKey,e.documentKey),0!==t?t:Q(n.largestBatchId,e.largestBatchId))}const Rh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ph{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Vn(n){return bu.apply(this,arguments)}function bu(){return bu=(0,w.Z)(function*(n){if(n.code!==E.FAILED_PRECONDITION||n.message!==Rh)throw n;R("LocalStore","Unexpectedly lost primary lease")}),bu.apply(this,arguments)}class y{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&F(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new y((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof y?t:y.resolve(t)}catch(t){return y.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):y.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):y.reject(t)}static resolve(e){return new y((t,r)=>{t(e)})}static reject(e){return new y((t,r)=>{r(e)})}static waitFor(e){return new y((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=y.resolve(!1);for(const r of e)t=t.next(i=>i?y.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new y((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let u=0;u<s;u++){const c=u;t(e[c]).next(d=>{o[c]=d,++a,a===s&&r(o)},d=>i(d))}})}static doWhile(e,t){return new y((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class Qo{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new ze,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ps(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=Du(r.target.error);this.V.reject(new Ps(e,i))}}static open(e,t,r,i){try{return new Qo(t,e.transaction(i,r))}catch(s){throw new Ps(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(R("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new xg(t)}}class bt{constructor(e,t,r){this.name=e,this.version=t,this.p=r,12.2===bt.S((0,G.z$)())&&Fe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return R("SimpleDb","Removing database:",e),gr(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,G.hl)())return!1;if(bt.C())return!0;const e=(0,G.z$)(),t=bt.S(e),r=0<t&&t<10,i=bt.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){var t=this;return(0,w.Z)(function*(){return t.db||(R("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=o=>{r(o.target.result)},s.onblocked=()=>{i(new Ps(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const a=o.target.error;i("VersionError"===a.name?new A(E.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new A(E.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new Ps(e,a))},s.onupgradeneeded=o=>{R("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.p.N(o.target.result,s.transaction,o.oldVersion,t.version).next(()=>{R("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.L&&(t.db.onversionchange=r=>t.L(r)),t.db})()}B(e){this.L=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,w.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{s.db=yield s.O(e);const u=Qo.open(s.db,e,o?"readonly":"readwrite",r),c=i(u).next(d=>(u.g(),d)).catch(d=>(u.abort(d),y.reject(d))).toPromise();return c.catch(()=>{}),yield u.m,c}catch(u){const c=u,d="FirebaseError"!==c.name&&a<3;if(R("SimpleDb","Transaction failed with error:",c.message,"Retrying:",d),s.close(),!d)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Sg{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return gr(this.k.delete())}}class Ps extends A{constructor(e,t){super(E.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function bn(n){return"IndexedDbTransactionError"===n.name}class xg{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(R("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(R("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),gr(r)}add(e){return R("SimpleDb","ADD",this.store.name,e,e),gr(this.store.add(e))}get(e){return gr(this.store.get(e)).next(t=>(void 0===t&&(t=null),R("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return R("SimpleDb","DELETE",this.store.name,e),gr(this.store.delete(e))}count(){return R("SimpleDb","COUNT",this.store.name),gr(this.store.count())}W(e,t){const r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(r.range);return new y((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{const s=this.cursor(r),o=[];return this.G(s,(a,u)=>{o.push(u)}).next(()=>o)}}j(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new y((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(e,t){R("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.J=!1;const i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.G(i,t)}Z(e){const t=this.cursor({});return new y((r,i)=>{t.onerror=s=>{const o=Du(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(e,t){const r=[];return new y((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const u=new Sg(a),c=t(a.primaryKey,a.value,u);if(c instanceof y){const d=c.catch(m=>(u.done(),y.reject(m)));r.push(d)}u.isDone?i():null===u.$?a.continue():a.continue(u.$)}}).next(()=>y.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function gr(n){return new y((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=Du(r.target.error);t(i)}})}let Sh=!1;function Du(n){const e=bt.S((0,G.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new A("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Sh||(Sh=!0,setTimeout(()=>{throw r},0)),r}}return n}class Cg{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(e){var t=this;R("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,w.Z)(function*(){t.task=null;try{R("IndexBackfiller",`Documents written: ${yield t.X.te()}`)}catch(r){bn(r)?R("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",r):yield Vn(r)}yield t.ee(6e4)}))}}class Vg{constructor(e,t){this.localStore=e,this.persistence=t}te(e=50){var t=this;return(0,w.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.ne(r,e))})()}ne(e,t){const r=new Set;let i=t,s=!0;return y.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return R("IndexBackfiller",`Processing collection: ${o}`),this.re(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}re(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ie(i,s)).next(a=>(R("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ie(e,t){let r=e;return t.changes.forEach((i,s)=>{const o=Ah(s);Vu(o,r)>0&&(r=o)}),new It(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Et=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}return n._e=-1,n})();function Ss(n){return null==n}function xs(n){return 0===n&&1/n==-1/0}function xh(n){return"number"==typeof n&&Number.isInteger(n)&&!xs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function it(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Ch(e)),e=bg(n.get(t),e);return Ch(e)}function bg(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Ch(n){return n+"\x01\x01"}function Qt(n){const e=n.length;if(L(e>=2),2===e)return L("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),te.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const o=n.indexOf("\x01",s);switch((o<0||o>t)&&F(),n.charAt(o+1)){case"\x01":const a=n.substring(s,o);let u;0===i.length?u=a:(i+=a,u=i,i=""),r.push(u);break;case"\x10":i+=n.substring(s,o),i+="\0";break;case"\x11":i+=n.substring(s,o+1);break;default:F()}s=o+2}return new te(r)}const Vh=["userId","batchId"];function Wo(n,e){return[n,it(e)]}function bh(n,e,t){return[n,it(e),t]}const Dg={},Ng=["prefixPath","collectionGroup","readTime","documentId"],kg=["prefixPath","collectionGroup","documentId"],Fg=["collectionGroup","readTime","prefixPath","documentId"],Mg=["canonicalId","targetId"],Og=["targetId","path"],Lg=["path","targetId"],Ug=["collectionId","parent"],Bg=["indexId","uid"],qg=["uid","sequenceNumber"],Gg=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],zg=["indexId","uid","orderedDocumentKey"],jg=["userId","collectionPath","documentId"],$g=["userId","collectionPath","largestBatchId"],Kg=["userId","collectionGroup","largestBatchId"],Dh=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Qg=[...Dh,"documentOverlays"],Nh=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],kh=Nh,Wg=[...kh,"indexConfiguration","indexState","indexEntries"];class Nu extends Ph{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function He(n,e){const t=b(n);return bt.M(t.ae,e)}function Fh(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Dn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Mh(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class ye{constructor(e,t){this.comparator=e,this.root=t||et.EMPTY}insert(e,t){return new ye(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,et.BLACK,null,null))}remove(e){return new ye(this.comparator,this.root.remove(e,this.comparator).copy(null,null,et.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ho(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ho(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ho(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ho(this.root,e,this.comparator,!0)}}class Ho{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class et{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??et.RED,this.left=i??et.EMPTY,this.right=s??et.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new et(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return et.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return et.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,et.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,et.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw F();const e=this.left.check();if(e!==this.right.check())throw F();return e+(this.isRed()?0:1)}}et.EMPTY=null,et.RED=!0,et.BLACK=!1,et.EMPTY=new class{constructor(){this.size=0}get key(){throw F()}get value(){throw F()}get color(){throw F()}get left(){throw F()}get right(){throw F()}copy(e,t,r,i,s){return this}insert(e,t,r){return new et(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class fe{constructor(e){this.comparator=e,this.data=new ye(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Oh(this.data.getIterator())}getIteratorFrom(e){return new Oh(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof fe)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new fe(this.comparator);return t.data=e,t}}class Oh{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function hi(n){return n.hasNext()?n.getNext():void 0}class gt{constructor(e){this.fields=e,e.sort(Ie.comparator)}static empty(){return new gt([])}unionWith(e){let t=new fe(Ie.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new gt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ui(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class Lh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class je{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Lh("Invalid base64 string: "+s):s}}(e);return new je(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new je(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}je.EMPTY_BYTE_STRING=new je("");const Zg=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Nn(n){if(L(!!n),"string"==typeof n){let e=0;const t=Zg.exec(n);if(L(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:be(n.seconds),nanos:be(n.nanos)}}function be(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function cn(n){return"string"==typeof n?je.fromBase64String(n):je.fromUint8Array(n)}function Zo(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Yo(n){const e=n.mapValue.fields.__previous_value__;return Zo(e)?Yo(e):e}function Cs(n){const e=Nn(n.mapValue.fields.__local_write_time__.timestampValue);return new Pe(e.seconds,e.nanos)}class Yg{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}}class kn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new kn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof kn&&e.projectId===this.projectId&&e.database===this.database}}const Fn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Xo={nullValue:"NULL_VALUE"};function Mn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Zo(n)?4:Gh(n)?9007199254740991:10:F()}function Wt(n,e){if(n===e)return!0;const t=Mn(n);if(t!==Mn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Cs(n).isEqual(Cs(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=Nn(i.timestampValue),a=Nn(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,cn(n.bytesValue).isEqual(cn(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return be(i.geoPointValue.latitude)===be(s.geoPointValue.latitude)&&be(i.geoPointValue.longitude)===be(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return be(i.integerValue)===be(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=be(i.doubleValue),a=be(s.doubleValue);return o===a?xs(o)===xs(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return ui(n.arrayValue.values||[],e.arrayValue.values||[],Wt);case 10:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(Fh(o)!==Fh(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(void 0===a[u]||!Wt(o[u],a[u])))return!1;return!0}(n,e);default:return F()}var s}function Vs(n,e){return void 0!==(n.values||[]).find(t=>Wt(t,e))}function On(n,e){if(n===e)return 0;const t=Mn(n),r=Mn(e);if(t!==r)return Q(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Q(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=be(s.integerValue||s.doubleValue),u=be(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return Uh(n.timestampValue,e.timestampValue);case 4:return Uh(Cs(n),Cs(e));case 5:return Q(n.stringValue,e.stringValue);case 6:return function(s,o){const a=cn(s),u=cn(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){const d=Q(a[c],u[c]);if(0!==d)return d}return Q(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=Q(be(s.latitude),be(o.latitude));return 0!==a?a:Q(be(s.longitude),be(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){const a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){const d=On(a[c],u[c]);if(d)return d}return Q(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===Fn.mapValue&&o===Fn.mapValue)return 0;if(s===Fn.mapValue)return 1;if(o===Fn.mapValue)return-1;const a=s.fields||{},u=Object.keys(a),c=o.fields||{},d=Object.keys(c);u.sort(),d.sort();for(let m=0;m<u.length&&m<d.length;++m){const p=Q(u[m],d[m]);if(0!==p)return p;const T=On(a[u[m]],c[d[m]]);if(0!==T)return T}return Q(u.length,d.length)}(n.mapValue,e.mapValue);default:throw F()}}function Uh(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return Q(n,e);const t=Nn(n),r=Nn(e),i=Q(t.seconds,r.seconds);return 0!==i?i:Q(t.nanos,r.nanos)}function di(n){return ku(n)}function ku(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Nn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?cn(n.bytesValue).toBase64():"referenceValue"in n?N.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=ku(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${ku(t.fields[o])}`;return i+"}"}(n.mapValue):F()}function pr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Fu(n){return!!n&&"integerValue"in n}function bs(n){return!!n&&"arrayValue"in n}function Bh(n){return!!n&&"nullValue"in n}function qh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ea(n){return!!n&&"mapValue"in n}function Ds(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Dn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ds(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ds(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Gh(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function Xg(n){return"nullValue"in n?Xo:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?pr(kn.empty(),N.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:F()}function Jg(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?pr(kn.empty(),N.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Fn:F()}function zh(n,e){const t=On(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function jh(n,e){const t=On(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class tt{constructor(e){this.value=e}static empty(){return new tt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ea(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ds(t)}setAll(e){let t=Ie.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Ds(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());ea(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Wt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];ea(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Dn(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new tt(Ds(this.value))}}function $h(n){const e=[];return Dn(n.fields,(t,r)=>{const i=new Ie([t]);if(ea(r)){const s=$h(r.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new gt(e)}class Ee{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Ee(e,0,B.min(),B.min(),B.min(),tt.empty(),0)}static newFoundDocument(e,t,r,i){return new Ee(e,1,t,B.min(),r,i,0)}static newNoDocument(e,t){return new Ee(e,2,t,B.min(),B.min(),tt.empty(),0)}static newUnknownDocument(e,t){return new Ee(e,3,t,B.min(),B.min(),tt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(B.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=tt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=tt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ee&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ee(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ln{constructor(e,t){this.position=e,this.inclusive=t}}function Kh(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(r=s.field.isKeyField()?N.comparator(N.fromName(o.referenceValue),t.key):On(o,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Qh(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Wt(n.position[t],e.position[t]))return!1;return!0}class Ns{constructor(e,t="asc"){this.field=e,this.dir=t}}function ep(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Wh{}class ne extends Wh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new tp(e,t,r):"array-contains"===t?new ip(e,r):"in"===t?new ed(e,r):"not-in"===t?new sp(e,r):"array-contains-any"===t?new op(e,r):new ne(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new np(e,r):new rp(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(On(t,this.value)):null!==t&&Mn(this.value)===Mn(t)&&this.matchesComparison(On(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return F()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class he extends Wh{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new he(e,t)}matches(e){return fi(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function fi(n){return"and"===n.op}function Mu(n){return"or"===n.op}function Ou(n){return Hh(n)&&fi(n)}function Hh(n){for(const e of n.filters)if(e instanceof he)return!1;return!0}function Lu(n){if(n instanceof ne)return n.field.canonicalString()+n.op.toString()+di(n.value);if(Ou(n))return n.filters.map(e=>Lu(e)).join(",");{const e=n.filters.map(t=>Lu(t)).join(",");return`${n.op}(${e})`}}function Zh(n,e){return n instanceof ne?(r=n,(i=e)instanceof ne&&r.op===i.op&&r.field.isEqual(i.field)&&Wt(r.value,i.value)):n instanceof he?function(r,i){return i instanceof he&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,o,a)=>s&&Zh(o,i.filters[a]),!0)}(n,e):void F();var r,i}function Yh(n,e){const t=n.filters.concat(e);return he.create(t,n.op)}function Xh(n){return n instanceof ne?`${(t=n).field.canonicalString()} ${t.op} ${di(t.value)}`:n instanceof he?function(t){return t.op.toString()+" {"+t.getFilters().map(Xh).join(" ,")+"}"}(n):"Filter";var t}class tp extends ne{constructor(e,t,r){super(e,t,r),this.key=N.fromName(r.referenceValue)}matches(e){const t=N.comparator(e.key,this.key);return this.matchesComparison(t)}}class np extends ne{constructor(e,t){super(e,"in",t),this.keys=Jh(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class rp extends ne{constructor(e,t){super(e,"not-in",t),this.keys=Jh(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Jh(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>N.fromName(r.referenceValue))}class ip extends ne{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return bs(t)&&Vs(t.arrayValue,this.value)}}class ed extends ne{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Vs(this.value.arrayValue,t)}}class sp extends ne{constructor(e,t){super(e,"not-in",t)}matches(e){if(Vs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Vs(this.value.arrayValue,t)}}class op extends ne{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!bs(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Vs(this.value.arrayValue,r))}}class ap{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}}function Uu(n,e=null,t=[],r=[],i=null,s=null,o=null){return new ap(n,e,t,r,i,s,o)}function _r(n){const e=b(n);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Lu(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Ss(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>di(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>di(r)).join(",")),e.ce=t}return e.ce}function ks(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!ep(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Zh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Qh(n.startAt,e.startAt)&&Qh(n.endAt,e.endAt)}function ta(n){return N.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function na(n,e){return n.filters.filter(t=>t instanceof ne&&t.field.isEqual(e))}function td(n,e,t){let r=Xo,i=!0;for(const s of na(n,e)){let o=Xo,a=!0;switch(s.op){case"<":case"<=":o=Xg(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Xo}zh({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];zh({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}function nd(n,e,t){let r=Fn,i=!0;for(const s of na(n,e)){let o=Fn,a=!0;switch(s.op){case">=":case">":o=Jg(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Fn}jh({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];jh({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}class ln{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.le=null,this.he=null,this.Pe=null}}function rd(n,e,t,r,i,s,o,a){return new ln(n,e,t,r,i,s,o,a)}function mi(n){return new ln(n)}function id(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function Bu(n){return null!==n.collectionGroup}function gi(n){const e=b(n);if(null===e.le){e.le=[];const t=new Set;for(const s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new fe(Ie.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new Ns(s,r))}),t.has(Ie.keyField().canonicalString())||e.le.push(new Ns(Ie.keyField(),r))}return e.le}function ct(n){const e=b(n);return e.he||(e.he=function sd(n,e){if("F"===n.limitType)return Uu(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>new Ns(i.field,"desc"===i.dir?"asc":"desc"));const t=n.endAt?new Ln(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ln(n.startAt.position,n.startAt.inclusive):null;return Uu(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}(e,gi(n))),e.he}function qu(n,e){const t=n.filters.concat([e]);return new ln(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function ra(n,e,t){return new ln(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Fs(n,e){return ks(ct(n),ct(e))&&n.limitType===e.limitType}function od(n){return`${_r(ct(n))}|lt:${n.limitType}`}function pi(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Xh(i)).join(", ")}]`),Ss(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>di(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>di(i)).join(",")),`Target(${r})`}(ct(n))}; limitType=${n.limitType})`}function Ms(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):N.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of gi(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(o,a,u){const c=Kh(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,gi(r),i)||r.endAt&&!function(o,a,u){const c=Kh(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,gi(r),i)));var r,i}function ad(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ud(n){return(e,t)=>{let r=!1;for(const i of gi(n)){const s=up(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function up(n,e,t){const r=n.field.isKeyField()?N.comparator(e.key,t.key):function(s,o,a){const u=o.data.field(s),c=a.data.field(s);return null!==u&&null!==c?On(u,c):F()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return F()}}class hn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Dn(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Mh(this.inner)}size(){return this.innerSize}}const cp=new ye(N.comparator);function pt(){return cp}const cd=new ye(N.comparator);function Os(...n){let e=cd;for(const t of n)e=e.insert(t.key,t);return e}function ld(n){let e=cd;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ht(){return Ls()}function hd(){return Ls()}function Ls(){return new hn(n=>n.toString(),(n,e)=>n.isEqual(e))}const lp=new ye(N.comparator),hp=new fe(N.comparator);function X(...n){let e=hp;for(const t of n)e=e.add(t);return e}const dp=new fe(Q);function Gu(){return dp}function dd(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xs(e)?"-0":e}}function fd(n){return{integerValue:""+n}}function md(n,e){return xh(e)?fd(e):dd(n,e)}class ia{constructor(){this._=void 0}}function fp(n,e,t){return n instanceof _i?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Zo(s)&&(s=Yo(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof yr?pd(n,e):n instanceof Tr?_d(n,e):function(i,s){const o=gd(i,s),a=yd(o)+yd(i.Ie);return Fu(o)&&Fu(i.Ie)?fd(a):dd(i.serializer,a)}(n,e)}function mp(n,e,t){return n instanceof yr?pd(n,e):n instanceof Tr?_d(n,e):t}function gd(n,e){return n instanceof yi?Fu(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class _i extends ia{}class yr extends ia{constructor(e){super(),this.elements=e}}function pd(n,e){const t=Td(e);for(const r of n.elements)t.some(i=>Wt(i,r))||t.push(r);return{arrayValue:{values:t}}}class Tr extends ia{constructor(e){super(),this.elements=e}}function _d(n,e){let t=Td(e);for(const r of n.elements)t=t.filter(i=>!Wt(i,r));return{arrayValue:{values:t}}}class yi extends ia{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function yd(n){return be(n.integerValue||n.doubleValue)}function Td(n){return bs(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Us{constructor(e,t){this.field=e,this.transform=t}}class pp{constructor(e,t){this.version=e,this.transformResults=t}}class Se{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Se}static exists(e){return new Se(void 0,e)}static updateTime(e){return new Se(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function sa(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class oa{}function Id(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Ii(n.key,Se.none()):new Ti(n.key,n.data,Se.none());{const t=n.data,r=tt.empty();let i=new fe(Ie.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new dn(n.key,r,new gt(i.toArray()),Se.none())}}function _p(n,e,t){n instanceof Ti?function(i,s,o){const a=i.value.clone(),u=wd(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof dn?function(i,s,o){if(!sa(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=wd(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(vd(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Bs(n,e,t,r){return n instanceof Ti?function(s,o,a,u){if(!sa(s.precondition,o))return a;const c=s.value.clone(),d=Ad(s.fieldTransforms,u,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof dn?function(s,o,a,u){if(!sa(s.precondition,o))return a;const c=Ad(s.fieldTransforms,u,o),d=o.data;return d.setAll(vd(s)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null===a?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(n,e,t,r):(a=t,sa(n.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a);var o,a}function yp(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=gd(r.transform,i||null);null!=s&&(null===t&&(t=tt.empty()),t.set(r.field,s))}return t||null}function Ed(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&ui(r,i,(s,o)=>function gp(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof yr&&i instanceof yr||r instanceof Tr&&i instanceof Tr?ui(r.elements,i.elements,Wt):r instanceof yi&&i instanceof yi?Wt(r.Ie,i.Ie):r instanceof _i&&i instanceof _i);var r,i}(s,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class Ti extends oa{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class dn extends oa{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function vd(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function wd(n,e,t){const r=new Map;L(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,mp(o,a,t[i]))}return r}function Ad(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,fp(s,o,e))}return r}class Ii extends oa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class zu extends oa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ju{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&_p(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Bs(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Bs(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=hd();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const u=Id(o,a);null!==u&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(B.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),X())}isEqual(e){return this.batchId===e.batchId&&ui(this.mutations,e.mutations,(t,r)=>Ed(t,r))&&ui(this.baseMutations,e.baseMutations,(t,r)=>Ed(t,r))}}class $u{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){L(e.mutations.length===r.length);let i=lp;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new $u(e,t,r,i)}}class Ku{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ip{constructor(e,t){this.count=e,this.unchangedNames=t}}var Be,ie;function Rd(n){switch(n){default:return F();case E.CANCELLED:case E.UNKNOWN:case E.DEADLINE_EXCEEDED:case E.RESOURCE_EXHAUSTED:case E.INTERNAL:case E.UNAVAILABLE:case E.UNAUTHENTICATED:return!1;case E.INVALID_ARGUMENT:case E.NOT_FOUND:case E.ALREADY_EXISTS:case E.PERMISSION_DENIED:case E.FAILED_PRECONDITION:case E.ABORTED:case E.OUT_OF_RANGE:case E.UNIMPLEMENTED:case E.DATA_LOSS:return!0}}function Pd(n){if(void 0===n)return Fe("GRPC error has no .code"),E.UNKNOWN;switch(n){case Be.OK:return E.OK;case Be.CANCELLED:return E.CANCELLED;case Be.UNKNOWN:return E.UNKNOWN;case Be.DEADLINE_EXCEEDED:return E.DEADLINE_EXCEEDED;case Be.RESOURCE_EXHAUSTED:return E.RESOURCE_EXHAUSTED;case Be.INTERNAL:return E.INTERNAL;case Be.UNAVAILABLE:return E.UNAVAILABLE;case Be.UNAUTHENTICATED:return E.UNAUTHENTICATED;case Be.INVALID_ARGUMENT:return E.INVALID_ARGUMENT;case Be.NOT_FOUND:return E.NOT_FOUND;case Be.ALREADY_EXISTS:return E.ALREADY_EXISTS;case Be.PERMISSION_DENIED:return E.PERMISSION_DENIED;case Be.FAILED_PRECONDITION:return E.FAILED_PRECONDITION;case Be.ABORTED:return E.ABORTED;case Be.OUT_OF_RANGE:return E.OUT_OF_RANGE;case Be.UNIMPLEMENTED:return E.UNIMPLEMENTED;case Be.DATA_LOSS:return E.DATA_LOSS;default:return F()}}(ie=Be||(Be={}))[ie.OK=0]="OK",ie[ie.CANCELLED=1]="CANCELLED",ie[ie.UNKNOWN=2]="UNKNOWN",ie[ie.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ie[ie.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ie[ie.NOT_FOUND=5]="NOT_FOUND",ie[ie.ALREADY_EXISTS=6]="ALREADY_EXISTS",ie[ie.PERMISSION_DENIED=7]="PERMISSION_DENIED",ie[ie.UNAUTHENTICATED=16]="UNAUTHENTICATED",ie[ie.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ie[ie.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ie[ie.ABORTED=10]="ABORTED",ie[ie.OUT_OF_RANGE=11]="OUT_OF_RANGE",ie[ie.UNIMPLEMENTED=12]="UNIMPLEMENTED",ie[ie.INTERNAL=13]="INTERNAL",ie[ie.UNAVAILABLE=14]="UNAVAILABLE",ie[ie.DATA_LOSS=15]="DATA_LOSS";function Sd(){return new TextEncoder}const Ep=new si([4294967295,4294967295],0);function xd(n){const e=Sd().encode(n),t=new mg;return t.update(e),new Uint8Array(t.digest())}function Cd(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new si([t,r],0),new si([i,s],0)]}class Qu{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new qs(`Invalid padding: ${t}`);if(r<0)throw new qs(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new qs(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new qs(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=si.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(si.fromNumber(r)));return 1===i.compare(Ep)&&(i=new si([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=xd(e),[r,i]=Cd(t);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new Qu(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(0===this.Te)return;const t=xd(e),[r,i]=Cd(t);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);this.Re(o)}}Re(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class qs extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Gs{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,zs.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Gs(B.min(),i,new ye(Q),pt(),X())}}class zs{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new zs(r,t,X(),X(),X())}}class ua{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}}class Vd{constructor(e,t){this.targetId=e,this.fe=t}}class bd{constructor(e,t,r=je.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Dd{constructor(){this.ge=0,this.pe=kd(),this.ye=je.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=X(),t=X(),r=X();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:F()}}),new zs(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=kd()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,L(this.ge>=0)}Le(){this.Se=!0,this.we=!0}}class vp{constructor(e){this.Be=e,this.ke=new Map,this.qe=pt(),this.Qe=Nd(),this.Ke=new ye(Q)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{const r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Le(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:F()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){const t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){const s=i.target;if(ta(s))if(0===r){const o=new N(s.path);this.We(t,o,Ee.newNoDocument(o,B.min()))}else L(1===r);else{const o=this.Ze(t);if(o!==r){const a=this.Xe(e),u=a?this.et(a,e,o):1;0!==u&&(this.He(t),this.Ke=this.Ke.insert(t,2===u?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,a;try{o=cn(r).toUint8Array()}catch(u){if(u instanceof Lh)return mt("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Qu(o,i,s)}catch(u){return mt(u instanceof qs?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return 0===a.Te?null:a}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){const r=this.Be.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const o=this.Be.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(t,s,null),i++)}),i}it(e){const t=new Map;this.ke.forEach((s,o)=>{const a=this.Ye(o);if(a){if(s.current&&ta(a.target)){const u=new N(a.target.path);null!==this.qe.get(u)||this.st(o,u)||this.We(o,u,Ee.newNoDocument(u,e))}s.De&&(t.set(o,s.ve()),s.Fe())}});let r=X();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Ye(u);return!c||"TargetPurposeLimboResolution"===c.purpose||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));const i=new Gs(e,t,this.Ke,this.qe,r);return this.qe=pt(),this.Qe=Nd(),this.Ke=new ye(Q),i}Ue(e,t){if(!this.je(e))return;const r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;const i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new Dd,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new fe(Q),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||R("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Be._t(e)}He(e){this.ke.set(e,new Dd),this.Be.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Be.getRemoteKeysForTarget(e).has(t)}}function Nd(){return new ye(N.comparator)}function kd(){return new ye(N.comparator)}const wp={asc:"ASCENDING",desc:"DESCENDING"},Ap={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Rp={and:"AND",or:"OR"};class Pp{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Wu(n,e){return n.useProto3Json||Ss(e)?e:{value:e}}function Ei(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Fd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Sp(n,e){return Ei(n,e.toTimestamp())}function Me(n){return L(!!n),B.fromTimestamp(function(t){const r=Nn(t);return new Pe(r.seconds,r.nanos)}(n))}function Hu(n,e){return Zu(n,e).canonicalString()}function Zu(n,e){const t=(i=n,new te(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function Md(n){const e=te.fromString(n);return L(Kd(e)),e}function js(n,e){return Hu(n.databaseId,e.path)}function Zt(n,e){const t=Md(e);if(t.get(1)!==n.databaseId.projectId)throw new A(E.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new A(E.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new N(Ud(t))}function Od(n,e){return Hu(n.databaseId,e)}function Ld(n){const e=Md(n);return 4===e.length?te.emptyPath():Ud(e)}function Yu(n){return new te(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ud(n){return L(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Bd(n,e,t){return{name:js(n,e),fields:t.value.mapValue.fields}}function qd(n,e,t){const r=Zt(n,e.name),i=Me(e.updateTime),s=e.createTime?Me(e.createTime):B.min(),o=new tt({mapValue:{fields:e.fields}}),a=Ee.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function $s(n,e){let t;if(e instanceof Ti)t={update:Bd(n,e.key,e.value)};else if(e instanceof Ii)t={delete:js(n,e.key)};else if(e instanceof dn)t={update:Bd(n,e.key,e.data),updateMask:Fp(e.fieldMask)};else{if(!(e instanceof zu))return F();t={verify:js(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof _i)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof yr)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Tr)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof yi)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw F()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:Sp(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:F()),t;var s}function Xu(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?Se.updateTime(Me(s.updateTime)):void 0!==s.exists?Se.exists(s.exists):Se.none():Se.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;"setToServerValue"in a?(L("REQUEST_TIME"===a.setToServerValue),u=new _i):"appendMissingElements"in a?u=new yr(a.appendMissingElements.values||[]):"removeAllFromArray"in a?u=new Tr(a.removeAllFromArray.values||[]):"increment"in a?u=new yi(o,a.increment):F();const c=Ie.fromServerFormat(a.fieldPath);return new Us(c,u)}(n,i)):[];var s;if(e.update){const i=Zt(n,e.update.name),s=new tt({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new gt((e.updateMask.fieldPaths||[]).map(d=>Ie.fromServerFormat(d)));return new dn(i,s,o,t,r)}return new Ti(i,s,t,r)}if(e.delete){const i=Zt(n,e.delete);return new Ii(i,t)}if(e.verify){const i=Zt(n,e.verify);return new zu(i,t)}return F()}function Gd(n,e){return{documents:[Od(n,e.path)]}}function Ju(n,e){const t={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Od(n,i);const s=function(c){if(0!==c.length)return $d(he.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const o=function(c){if(0!==c.length)return c.map(d=>{return{field:Un((p=d).field),direction:Dp(p.dir)};var p})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Wu(n,e.limit);return null!==a&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt={before:(c=e.startAt).inclusive,values:c.position}),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ut:t,parent:i};var c}function zd(n){let e=Ld(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){L(1===r);const d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(m){const p=jd(m);return p instanceof he&&Ou(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(p=>{return new Ns(vi((S=p).field),function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(S.direction));var S}));let a=null;t.limit&&(a=function(m){let p;return p="object"==typeof m?m.value:m,Ss(p)?null:p}(t.limit));let u=null;var m;t.startAt&&(u=new Ln((m=t.startAt).values||[],!!m.before));let c=null;return t.endAt&&(c=function(m){return new Ln(m.values||[],!m.before)}(t.endAt)),rd(e,i,o,s,a,"F",u,c)}function jd(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=vi(t.unaryFilter.field);return ne.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=vi(t.unaryFilter.field);return ne.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=vi(t.unaryFilter.field);return ne.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=vi(t.unaryFilter.field);return ne.create(o,"!=",{nullValue:"NULL_VALUE"});default:return F()}}(n):void 0!==n.fieldFilter?ne.create(vi((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return F()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return he.create(t.compositeFilter.filters.map(r=>jd(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return F()}}(t.compositeFilter.op))}(n):F();var t}function Dp(n){return wp[n]}function Np(n){return Ap[n]}function kp(n){return Rp[n]}function Un(n){return{fieldPath:n.canonicalString()}}function vi(n){return Ie.fromServerFormat(n.fieldPath)}function $d(n){return n instanceof ne?function(t){if("=="===t.op){if(qh(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NAN"}};if(Bh(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(qh(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NOT_NAN"}};if(Bh(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Un(t.field),op:Np(t.op),value:t.value}}}(n):n instanceof he?function(t){const r=t.getFilters().map(i=>$d(i));return 1===r.length?r[0]:{compositeFilter:{op:kp(t.op),filters:r}}}(n):F()}function Fp(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Kd(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class fn{constructor(e,t,r,i,s=B.min(),o=B.min(),a=je.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new fn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new fn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new fn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new fn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Qd{constructor(e){this.ct=e}}function Wd(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:ca(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:js(s=n.ct,(o=e).key),fields:o.data.value.mapValue.fields,updateTime:Ei(s,o.version.toTimestamp()),createTime:Ei(s,o.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ir(e.version)};else{if(!e.isUnknownDocument())return F();r.unknownDocument={path:t.path.toArray(),version:Ir(e.version)}}var s,o;return r}function ca(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ir(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Er(n){const e=new Pe(n.seconds,n.nanoseconds);return B.fromTimestamp(e)}function vr(n,e){const t=(e.baseMutations||[]).map(s=>Xu(n.ct,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>Xu(n.ct,s)),i=Pe.fromMillis(e.localWriteTimeMs);return new ju(e.batchId,i,t,r)}function Ks(n){const e=Er(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Er(n.lastLimboFreeSnapshotVersion):B.min();let r;return r=void 0!==n.query.documents?(L(1===(s=n.query).documents.length),ct(mi(Ld(s.documents[0])))):function(s){return ct(zd(s))}(n.query),new fn(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,je.fromBase64String(n.resumeToken));var s}function Hd(n,e){const t=Ir(e.snapshotVersion),r=Ir(e.lastLimboFreeSnapshotVersion);let i;i=ta(e.target)?Gd(n.ct,e.target):Ju(n.ct,e.target).ut;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:_r(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function ec(n){const e=zd({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?ra(e,e.limit,"L"):e}function tc(n,e){return new Ku(e.largestBatchId,Xu(n.ct,e.overlayMutation))}function Zd(n,e){const t=e.path.lastSegment();return[n,it(e.path.popLast()),t]}function Yd(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ir(r.readTime),documentKey:it(r.documentKey.path),largestBatchId:r.largestBatchId}}class Op{getBundleMetadata(e,t){return Xd(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:Er(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Xd(e).put({bundleId:(i=t).id,createTime:Ir(Me(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return Jd(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:ec(s.bundledQuery),readTime:Er(s.readTime)};var s})}saveNamedQuery(e,t){return Jd(e).put({name:(i=t).name,readTime:Ir(Me(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Xd(n){return He(n,"bundles")}function Jd(n){return He(n,"namedQueries")}class la{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new la(e,t.uid||"")}getOverlay(e,t){return Qs(e).get(Zd(this.userId,t)).next(r=>r?tc(this.serializer,r):null)}getOverlays(e,t){const r=Ht();return y.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,o)=>{const a=new Ku(t,o);i.push(this.ht(e,a))}),y.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(o=>i.add(it(o.getCollectionPath())));const s=[];return i.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Qs(e).H("collectionPathOverlayIndex",a))}),y.waitFor(s)}getOverlaysForCollection(e,t,r){const i=Ht(),s=it(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Qs(e).W("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const c=tc(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=Ht();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Qs(e).Y({index:"collectionGroupOverlayIndex",range:a},(u,c,d)=>{const m=tc(this.serializer,c);s.size()<i||m.largestBatchId===o?(s.set(m.getKey(),m),o=m.largestBatchId):d.done()}).next(()=>s)}ht(e,t){return Qs(e).put(function(i,s,o){const[a,u,c]=Zd(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:$s(i.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Qs(n){return He(n,"documentOverlays")}class wr{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(be(e.integerValue));else if("doubleValue"in e){const r=be(e.doubleValue);isNaN(r)?this.Et(t,13):(this.Et(t,15),xs(r)?t.dt(0):t.dt(r))}else if("timestampValue"in e){const r=e.timestampValue;this.Et(t,20),"string"==typeof r?t.At(r):(t.At(`${r.seconds||""}`),t.dt(r.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(cn(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Et(t,45),t.dt(r.latitude||0),t.dt(r.longitude||0)}else"mapValue"in e?Gh(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):F()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const r=e.fields||{};this.Et(t,55);for(const i of Object.keys(r))this.Rt(i,t),this.It(r[i],t)}wt(e,t){const r=e.values||[];this.Et(t,50);for(const i of r)this.It(i,t)}gt(e,t){this.Et(t,37),N.fromName(e).path.forEach(r=>{this.Et(t,60),this.St(r,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function Lp(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function ef(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const o=Lp(255&r[s]);if(i+=o,8!==o)break}return i}(n);return Math.ceil(e/8)}wr.bt=new wr;class Up{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ct(r.value),r=t.next();this.vt()}Ft(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Mt(r.value),r=t.next();this.xt()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ct(r);else if(r<2048)this.Ct(960|r>>>6),this.Ct(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ct(480|r>>>12),this.Ct(128|63&r>>>6),this.Ct(128|63&r);else{const i=t.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{const i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(e){const t=this.Bt(e),r=ef(t);this.kt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){const t=this.Bt(e),r=ef(t);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ct(e){const t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class Bp{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}}class qp{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class Ws{constructor(){this.Gt=new Up,this.zt=new Bp(this.Gt),this.jt=new qp(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class Ar{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Jt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Ar(this.indexId,this.documentKey,this.arrayValue,r)}}function Bn(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=tf(n.arrayValue,e.arrayValue),0!==t?t:(t=tf(n.directionalValue,e.directionalValue),0!==t?t:N.comparator(n.documentKey,e.documentKey)))}function tf(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class nf{constructor(e){this.Yt=new fe((t,r)=>Ie.comparator(t.field,r.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Yt=this.Yt.add(r):this.Xt.push(r)}}get en(){return this.Yt.size>1}tn(e){if(L(e.collectionGroup===this.collectionId),this.en)return!1;const t=Cu(e);if(void 0!==t&&!this.nn(t))return!1;const r=fr(e);let i=new Set,s=0,o=0;for(;s<r.length&&this.nn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Yt.size>0){const a=this.Yt.getIterator().getNext();if(!i.has(a.field.canonicalString())){const u=r[s];if(!this.rn(a,u)||!this.sn(this.Zt[o++],u))return!1}++s}for(;s<r.length;++s)if(o>=this.Zt.length||!this.sn(this.Zt[o++],r[s]))return!1;return!0}on(){if(this.en)return null;let e=new fe(Ie.comparator);const t=[];for(const r of this.Xt)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new mr(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new mr(r.field,0))}for(const r of this.Zt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new mr(r.field,"asc"===r.dir?0:1)));return new ci(ci.UNKNOWN_ID,this.collectionId,t,li.empty())}nn(e){for(const t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function rf(n){var e,t;if(L(n instanceof ne||n instanceof he),n instanceof ne){if(n instanceof ed){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>ne.create(n.field,"==",s)))||[];return he.create(i,"or")}return n}const r=n.filters.map(i=>rf(i));return he.create(r,n.op)}function Gp(n){if(0===n.getFilters().length)return[];const e=ic(rf(n));return L(sf(e)),nc(e)||rc(e)?[e]:e.getFilters()}function nc(n){return n instanceof ne}function rc(n){return n instanceof he&&Ou(n)}function sf(n){return nc(n)||rc(n)||function(t){if(t instanceof he&&Mu(t)){for(const r of t.getFilters())if(!nc(r)&&!rc(r))return!1;return!0}return!1}(n)}function ic(n){if(L(n instanceof ne||n instanceof he),n instanceof ne)return n;if(1===n.filters.length)return ic(n.filters[0]);const e=n.filters.map(r=>ic(r));let t=he.create(e,n.op);return t=ha(t),sf(t)?t:(L(t instanceof he),L(fi(t)),L(t.filters.length>1),t.filters.reduce((r,i)=>sc(r,i)))}function sc(n,e){let t;return L(n instanceof ne||n instanceof he),L(e instanceof ne||e instanceof he),t=n instanceof ne?e instanceof ne?he.create([n,e],"and"):af(n,e):e instanceof ne?af(e,n):function(i,s){if(L(i.filters.length>0&&s.filters.length>0),fi(i)&&fi(s))return Yh(i,s.getFilters());const o=Mu(i)?i:s,a=Mu(i)?s:i,u=o.filters.map(c=>sc(c,a));return he.create(u,"or")}(n,e),ha(t)}function af(n,e){if(fi(e))return Yh(e,n.getFilters());{const t=e.filters.map(r=>sc(n,r));return he.create(t,"or")}}function ha(n){if(L(n instanceof ne||n instanceof he),n instanceof ne)return n;const e=n.getFilters();if(1===e.length)return ha(e[0]);if(Hh(n))return n;const t=e.map(i=>ha(i)),r=[];return t.forEach(i=>{i instanceof ne?r.push(i):i instanceof he&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:he.create(r,n.op)}class zp{constructor(){this._n=new oc}addToCollectionParentIndex(e,t){return this._n.add(t),y.resolve()}getCollectionParents(e,t){return y.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return y.resolve()}deleteFieldIndex(e,t){return y.resolve()}deleteAllFieldIndexes(e){return y.resolve()}createTargetIndexes(e,t){return y.resolve()}getDocumentsMatchingTarget(e,t){return y.resolve(null)}getIndexType(e,t){return y.resolve(0)}getFieldIndexes(e,t){return y.resolve([])}getNextCollectionGroupToUpdate(e){return y.resolve(null)}getMinOffset(e,t){return y.resolve(It.min())}getMinOffsetFromCollectionGroup(e,t){return y.resolve(It.min())}updateCollectionGroup(e,t,r){return y.resolve()}updateIndexEntries(e,t){return y.resolve()}}class oc{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new fe(te.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new fe(te.comparator)).toArray()}}const da=new Uint8Array(0);class jp{constructor(e,t){this.databaseId=t,this.an=new oc,this.un=new hn(r=>_r(r),(r,i)=>ks(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});const s={collectionId:r,parent:it(i)};return uf(e).put(s)}return y.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[vh(t),""],!1,!0);return uf(e).W(i).next(s=>{for(const o of s){if(o.collectionId!==t)break;r.push(Qt(o.parent))}return r})}addFieldIndex(e,t){const r=Hs(e),i={indexId:(a=t).indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])};var a;delete i.indexId;const s=r.add(i);if(t.indexState){const o=Ai(e);return s.next(a=>{o.put(Yd(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=Hs(e),i=Ai(e),s=wi(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Hs(e),r=wi(e),i=Ai(e);return t.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(e,t){return y.forEach(this.cn(t),r=>this.getIndexType(e,r).next(i=>{if(0===i||1===i){const s=new nf(r).on();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const r=wi(e);let i=!0;const s=new Map;return y.forEach(this.cn(t),o=>this.ln(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=X();const a=[];return y.forEach(s,(u,c)=>{var U;R("IndexedDbIndexManager",`Using index ${U=u,`id=${U.indexId}|cg=${U.collectionGroup}|f=${U.fields.map(H=>`${H.fieldPath}:${H.kind}`).join(",")}`} to execute ${_r(t)}`);const d=function(U,H){const ae=Cu(H);if(void 0===ae)return null;for(const ce of na(U,ae.fieldPath))switch(ce.op){case"array-contains-any":return ce.value.arrayValue.values||[];case"array-contains":return[ce.value]}return null}(c,u),m=function(U,H){const ae=new Map;for(const ce of fr(H))for(const Oe of na(U,ce.fieldPath))switch(Oe.op){case"==":case"in":ae.set(ce.fieldPath.canonicalString(),Oe.value);break;case"not-in":case"!=":return ae.set(ce.fieldPath.canonicalString(),Oe.value),Array.from(ae.values())}return null}(c,u),p=function(U,H){const ae=[];let ce=!0;for(const Oe of fr(H)){const Nt=0===Oe.kind?td(U,Oe.fieldPath,U.startAt):nd(U,Oe.fieldPath,U.startAt);ae.push(Nt.value),ce&&(ce=Nt.inclusive)}return new Ln(ae,ce)}(c,u),T=function(U,H){const ae=[];let ce=!0;for(const Oe of fr(H)){const Nt=0===Oe.kind?nd(U,Oe.fieldPath,U.endAt):td(U,Oe.fieldPath,U.endAt);ae.push(Nt.value),ce&&(ce=Nt.inclusive)}return new Ln(ae,ce)}(c,u),S=this.hn(u,c,p),V=this.hn(u,c,T),C=this.Pn(u,c,m),q=this.In(u.indexId,d,S,p.inclusive,V,T.inclusive,C);return y.forEach(q,W=>r.j(W,t.limit).next(U=>{U.forEach(H=>{const ae=N.fromSegments(H.documentKey);o.has(ae)||(o=o.add(ae),a.push(ae))})}))}).next(()=>a)}return y.resolve(null)})}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:Gp(he.create(e.filters,"and")).map(r=>Uu(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,r,i,s,o,a){const u=(null!=t?t.length:1)*Math.max(r.length,s.length),c=u/(null!=t?t.length:1),d=[];for(let m=0;m<u;++m){const p=t?this.Tn(t[m/c]):da,T=this.En(e,p,r[m%c],i),S=this.dn(e,p,s[m%c],o),V=a.map(C=>this.En(e,p,C,!0));d.push(...this.createRange(T,S,V))}return d}En(e,t,r,i){const s=new Ar(e,N.empty(),t,r);return i?s:s.Jt()}dn(e,t,r,i){const s=new Ar(e,N.empty(),t,r);return i?s.Jt():s}ln(e,t){const r=new nf(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const a of s)r.tn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const i=this.cn(t);return y.forEach(i,s=>this.ln(e,s).next(o=>{o?0!==r&&o.fields.length<function(u){let c=new fe(Ie.comparator),d=!1;for(const m of u.filters)for(const p of m.getFlattenedFilters())p.field.isKeyField()||("array-contains"===p.op||"array-contains-any"===p.op?d=!0:c=c.add(p.field));for(const m of u.orderBy)m.field.isKeyField()||(c=c.add(m.field));return c.size+(d?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}An(e,t){const r=new Ws;for(const i of fr(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const o=r.Ht(i.kind);wr.bt.Pt(s,o)}return r.Wt()}Tn(e){const t=new Ws;return wr.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){const r=new Ws;return wr.bt.Pt(pr(this.databaseId,t),r.Ht(function(s){const o=fr(s);return 0===o.length?0:o[o.length-1].kind}(e))),r.Wt()}Pn(e,t,r){if(null===r)return[];let i=[];i.push(new Ws);let s=0;for(const o of fr(e)){const a=r[s++];for(const u of i)if(this.Vn(t,o.fieldPath)&&bs(a))i=this.mn(i,o,a);else{const c=u.Ht(o.kind);wr.bt.Pt(a,c)}}return this.fn(i)}hn(e,t,r){return this.Pn(e,t,r.position)}fn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Wt();return t}mn(e,t,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const a of i){const u=new Ws;u.seed(a.Wt()),wr.bt.Pt(o,u.Ht(t.kind)),s.push(u)}return s}Vn(e,t){return!!e.filters.find(r=>r instanceof ne&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=Hs(e),i=Ai(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{const o=[];return y.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(d,m){const p=m?new li(m.sequenceNumber,new It(Er(m.readTime),new N(Qt(m.documentKey)),m.largestBatchId)):li.empty(),T=d.fields.map(([S,V])=>new mr(Ie.fromServerFormat(S),V));return new ci(d.indexId,d.collectionGroup,T,p)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:Q(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=Hs(e),s=Ai(e);return this.gn(e).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>y.forEach(a,u=>s.put(Yd(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return y.forEach(t,(i,s)=>{const o=r.get(i.collectionGroup);return(o?y.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),y.forEach(a,u=>this.pn(e,i,u).next(c=>{const d=this.yn(s,u);return c.isEqual(d)?y.resolve():this.wn(e,s,u,c,d)}))))})}Sn(e,t,r,i){return wi(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(r,t.key),documentKey:t.key.path.toArray()})}bn(e,t,r,i){return wi(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(r,t.key),t.key.path.toArray()])}pn(e,t,r){const i=wi(e);let s=new fe(Bn);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.Rn(r,t)])},(o,a)=>{s=s.add(new Ar(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}yn(e,t){let r=new fe(Bn);const i=this.An(t,e);if(null==i)return r;const s=Cu(t);if(null!=s){const o=e.data.field(s.fieldPath);if(bs(o))for(const a of o.arrayValue.values||[])r=r.add(new Ar(t.indexId,e.key,this.Tn(a),i))}else r=r.add(new Ar(t.indexId,e.key,da,i));return r}wn(e,t,r,i,s){R("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(u,c,d,m,p){const T=u.getIterator(),S=c.getIterator();let V=hi(T),C=hi(S);for(;V||C;){let q=!1,W=!1;if(V&&C){const U=d(V,C);U<0?W=!0:U>0&&(q=!0)}else null!=V?W=!0:q=!0;q?(m(C),C=hi(S)):W?(p(V),V=hi(T)):(V=hi(T),C=hi(S))}}(i,s,Bn,a=>{o.push(this.Sn(e,t,r,a))},a=>{o.push(this.bn(e,t,r,a))}),y.waitFor(o)}gn(e){let t=1;return Ai(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Bn(o,a)).filter((o,a,u)=>!a||0!==Bn(o,u[a-1]));const i=[];i.push(e);for(const o of r){const a=Bn(o,e),u=Bn(o,t);if(0===a)i[0]=e.Jt();else if(a>0&&u<0)i.push(o),i.push(o.Jt());else if(u>0)break}i.push(t);const s=[];for(let o=0;o<i.length;o+=2){if(this.Dn(i[o],i[o+1]))return[];s.push(IDBKeyRange.bound([i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,da,[]],[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,da,[]]))}return s}Dn(e,t){return Bn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(cf)}getMinOffset(e,t){return y.mapArray(this.cn(t),r=>this.ln(e,r).next(i=>i||F())).next(cf)}}function uf(n){return He(n,"collectionParents")}function wi(n){return He(n,"indexEntries")}function Hs(n){return He(n,"indexConfiguration")}function Ai(n){return He(n,"indexState")}function cf(n){L(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;Vu(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new It(e.readTime,e.documentKey,t)}const lf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class st{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new st(e,st.DEFAULT_COLLECTION_PERCENTILE,st.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function hf(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.Y({range:o},(d,m,p)=>(a++,p.delete()));s.push(u.next(()=>{L(1===a)}));const c=[];for(const d of t.mutations){const m=bh(e,d.key.path,t.batchId);s.push(i.delete(m)),c.push(d.key)}return y.waitFor(s).next(()=>c)}function fa(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw F();e=n.noDocument}return JSON.stringify(e).length}st.DEFAULT_COLLECTION_PERCENTILE=10,st.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,st.DEFAULT=new st(41943040,st.DEFAULT_COLLECTION_PERCENTILE,st.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),st.DISABLED=new st(-1,0,0);class ma{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Cn={}}static lt(e,t,r,i){L(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new ma(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return qn(e).Y({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=Ri(e),o=qn(e);return o.add({}).next(a=>{L("number"==typeof a);const u=new ju(a,t,r,i),c=function(T,S,V){const C=V.baseMutations.map(W=>$s(T.ct,W)),q=V.mutations.map(W=>$s(T.ct,W));return{userId:S,batchId:V.batchId,localWriteTimeMs:V.localWriteTime.toMillis(),baseMutations:C,mutations:q}}(this.serializer,this.userId,u),d=[];let m=new fe((p,T)=>Q(p.canonicalString(),T.canonicalString()));for(const p of i){const T=bh(this.userId,p.key.path,a);m=m.add(p.key.path.popLast()),d.push(o.put(c)),d.push(s.put(T,Dg))}return m.forEach(p=>{d.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Cn[a]=u.keys()}),y.waitFor(d).next(()=>u)})}lookupMutationBatch(e,t){return qn(e).get(t).next(r=>r?(L(r.userId===this.userId),vr(this.serializer,r)):null)}vn(e,t){return this.Cn[t]?y.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Cn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return qn(e).Y({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(L(a.batchId>=r),s=vr(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return qn(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return qn(e).W("userMutationsIndex",t).next(r=>r.map(i=>vr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Wo(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Ri(e).Y({range:i},(o,a,u)=>{const[c,d,m]=o,p=Qt(d);if(c===this.userId&&t.path.isEqual(p))return qn(e).get(m).next(T=>{if(!T)throw F();L(T.userId===this.userId),s.push(vr(this.serializer,T))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fe(Q);const i=[];return t.forEach(s=>{const o=Wo(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=Ri(e).Y({range:a},(c,d,m)=>{const[p,T,S]=c,V=Qt(T);p===this.userId&&s.path.isEqual(V)?r=r.add(S):m.done()});i.push(u)}),y.waitFor(i).next(()=>this.Fn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=Wo(this.userId,r),o=IDBKeyRange.lowerBound(s);let a=new fe(Q);return Ri(e).Y({range:o},(u,c,d)=>{const[m,p,T]=u,S=Qt(p);m===this.userId&&r.isPrefixOf(S)?S.length===i&&(a=a.add(T)):d.done()}).next(()=>this.Fn(e,a))}Fn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(qn(e).get(s).next(o=>{if(null===o)throw F();L(o.userId===this.userId),r.push(vr(this.serializer,o))}))}),y.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return hf(e.ae,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),y.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return y.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return Ri(e).Y({range:r},(s,o,a)=>{if(s[0]===this.userId){const u=Qt(s[1]);i.push(u)}else a.done()}).next(()=>{L(0===i.length)})})}containsKey(e,t){return df(e,this.userId,t)}xn(e){return ff(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function df(n,e,t){const r=Wo(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Ri(n).Y({range:s,J:!0},(a,u,c)=>{const[d,m,p]=a;d===e&&m===i&&(o=!0),c.done()}).next(()=>o)}function qn(n){return He(n,"mutations")}function Ri(n){return He(n,"documentMutations")}function ff(n){return He(n,"mutationQueues")}class Rr{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new Rr(0)}static Ln(){return new Rr(-1)}}class $p{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{const r=new Rr(t.highestTargetId);return t.highestTargetId=r.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>B.fromTimestamp(new Pe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.kn(e,i)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.Qn(t,r),this.kn(e,r))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Pi(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(L(r.targetCount>0),r.targetCount-=1,this.kn(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return Pi(e).Y((o,a)=>{const u=Ks(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>y.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Pi(e).Y((r,i)=>{const s=Ks(i);t(s)})}Bn(e){return mf(e).get("targetGlobalKey").next(t=>(L(null!==t),t))}kn(e,t){return mf(e).put("targetGlobalKey",t)}qn(e,t){return Pi(e).put(Hd(this.serializer,t))}Qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=_r(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return Pi(e).Y({range:i,index:"queryTargetsIndex"},(o,a,u)=>{const c=Ks(a);ks(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=Gn(e);return t.forEach(o=>{const a=it(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),y.waitFor(i)}removeMatchingKeys(e,t,r){const i=Gn(e);return y.forEach(t,s=>{const o=it(s.path);return y.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=Gn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Gn(e);let s=X();return i.Y({range:r,J:!0},(o,a,u)=>{const c=Qt(o[1]),d=new N(c);s=s.add(d)}).next(()=>s)}containsKey(e,t){const r=it(t.path),i=IDBKeyRange.bound([r],[vh(r)],!1,!0);let s=0;return Gn(e).Y({index:"documentTargetsIndex",J:!0,range:i},([o,a],u,c)=>{0!==o&&(s++,c.done())}).next(()=>s>0)}_t(e,t){return Pi(e).get(t).next(r=>r?Ks(r):null)}}function Pi(n){return He(n,"targets")}function mf(n){return He(n,"targetGlobal")}function Gn(n){return He(n,"targetDocuments")}function gf([n,e],[t,r]){const i=Q(n,t);return 0===i?Q(e,r):i}class Kp{constructor(e){this.Kn=e,this.buffer=new fe(gf),this.$n=0}Un(){return++this.$n}Wn(e){const t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();gf(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class pf{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){var t=this;R("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,w.Z)(function*(){t.Gn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){bn(r)?R("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield Vn(r)}yield t.zn(3e5)}))}}class Qp{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return y.resolve(Et._e);const r=new Kp(t);return this.jn.forEachTarget(e,i=>r.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>r.Wn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector","Garbage collection skipped; disabled"),y.resolve(lf)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),lf):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let r,i,s,o,a,u,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(R("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,o=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(r=m,a=Date.now(),this.removeTargets(e,r,t))).next(m=>(s=m,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>(c=Date.now(),ai()<=k.in.DEBUG&&R("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-d}ms\n\tDetermined least recently used ${i} in `+(a-o)+`ms\n\tRemoved ${s} targets in `+(u-a)+`ms\n\tRemoved ${m} documents in `+(c-u)+`ms\nTotal Duration: ${c-d}ms`),y.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}}class Wp{constructor(e,t){this.db=e,this.garbageCollector=function _f(n,e){return new Qp(n,e)}(this,t)}Hn(e){const t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Zn(e){let t=0;return this.Jn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(r,i)=>t(i))}addReference(e,t,r){return ga(e,r)}removeReference(e,t,r){return ga(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ga(e,t)}er(e,t){return function(i,s){let o=!1;return ff(i).Z(a=>df(i,a,s).next(u=>(u&&(o=!0),y.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Xn(e,(o,a)=>{if(a<=t){const u=this.er(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,B.min()),Gn(e).delete([0,it(o.path)])))});i.push(u)}}).next(()=>y.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ga(e,t)}Xn(e,t){const r=Gn(e);let i,s=Et._e;return r.Y({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{0===o?(s!==Et._e&&t(new N(Qt(i)),s),s=c,i=u):s=Et._e}).next(()=>{s!==Et._e&&t(new N(Qt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ga(n,e){return Gn(n).put((i=n.currentSequenceNumber,{targetId:0,path:it(e.path),sequenceNumber:i}));var i}class yf{constructor(){this.changes=new hn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ee.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?y.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Hp{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Pr(e).put(r)}removeEntry(e,t,r){return Pr(e).delete(function(s,o){const a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],ca(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.tr(e,r)))}getEntry(e,t){let r=Ee.newInvalidDocument(t);return Pr(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Zs(t))},(i,s)=>{r=this.nr(t,s)}).next(()=>r)}rr(e,t){let r={size:0,document:Ee.newInvalidDocument(t)};return Pr(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Zs(t))},(i,s)=>{r={document:this.nr(t,s),size:fa(s)}}).next(()=>r)}getEntries(e,t){let r=pt();return this.ir(e,t,(i,s)=>{const o=this.nr(i,s);r=r.insert(i,o)}).next(()=>r)}sr(e,t){let r=pt(),i=new ye(N.comparator);return this.ir(e,t,(s,o)=>{const a=this.nr(s,o);r=r.insert(s,a),i=i.insert(s,fa(o))}).next(()=>({documents:r,_r:i}))}ir(e,t,r){if(t.isEmpty())return y.resolve();let i=new fe(vf);t.forEach(u=>i=i.add(u));const s=IDBKeyRange.bound(Zs(i.first()),Zs(i.last())),o=i.getIterator();let a=o.getNext();return Pr(e).Y({index:"documentKeyIndex",range:s},(u,c,d)=>{const m=N.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&vf(a,m)<0;)r(a,null),a=o.getNext();a&&a.isEqual(m)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?d.U(Zs(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),ca(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Pr(e).W(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let d=pt();for(const m of c){const p=this.nr(N.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);p.isFoundDocument()&&(Ms(t,p)||i.has(p.key))&&(d=d.insert(p.key,p))}return d})}getAllFromCollectionGroup(e,t,r,i){let s=pt();const o=Ef(t,r),a=Ef(t,It.max());return Pr(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,d)=>{const m=this.nr(N.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(m.key,m),s.size===i&&d.done()}).next(()=>s)}newChangeBuffer(e){return new Zp(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return If(e).get("remoteDocumentGlobalKey").next(t=>(L(!!t),t))}tr(e,t){return If(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){const r=function Mp(n,e){let t;if(e.document)t=qd(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=N.fromSegments(e.noDocument.path),i=Er(e.noDocument.readTime);t=Ee.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return F();{const r=N.fromSegments(e.unknownDocument.path),i=Er(e.unknownDocument.version);t=Ee.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new Pe(i[0],i[1]);return B.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(B.min()))return r}return Ee.newInvalidDocument(e)}}function Tf(n){return new Hp(n)}class Zp extends yf{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new hn(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new fe((s,o)=>Q(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,a.readTime)),o.isValidDocument()){const u=Wd(this.ar.serializer,o);i=i.add(s.path.popLast());const c=fa(u);r+=c-a.size,t.push(this.ar.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){const u=Wd(this.ar.serializer,o.convertToNoDocument(B.min()));t.push(this.ar.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ar.updateMetadata(e,r)),y.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(r=>(this.ur.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:r,_r:i})=>(i.forEach((s,o)=>{this.ur.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function If(n){return He(n,"remoteDocumentGlobal")}function Pr(n){return He(n,"remoteDocumentsV14")}function Zs(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Ef(n,e){const t=e.documentKey.path.toArray();return[n,ca(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function vf(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=Q(t[s],r[s]),i)return i;return i=Q(t.length,r.length),i||(i=Q(t[t.length-2],r[r.length-2]),i||Q(t[t.length-1],r[r.length-1]))}class Yp{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class wf{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&Bs(r.mutation,i,gt.empty(),Pe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,X()).next(()=>r))}getLocalViewOfDocuments(e,t,r=X()){const i=Ht();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Os();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Ht();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,X()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=pt();const o=Ls(),a=Ls();return t.forEach((u,c)=>{const d=r.get(c.key);i.has(c.key)&&(void 0===d||d.mutation instanceof dn)?s=s.insert(c.key,c):void 0!==d?(o.set(c.key,d.mutation.getFieldMask()),Bs(d.mutation,c,d.mutation.getFieldMask(),Pe.now())):o.set(c.key,gt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var m;return a.set(c,new Yp(d,null!==(m=o.get(c))&&void 0!==m?m:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Ls();let i=new ye((o,a)=>o-a),s=X();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(null===c)return;let d=r.get(u)||gt.empty();d=a.applyToLocalView(c,d),r.set(u,d);const m=(i.get(a.batchId)||X()).add(u);i=i.insert(a.batchId,m)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,d=u.value,m=hd();d.forEach(p=>{if(!s.has(p)){const T=Id(t.get(p),r.get(p));null!==T&&m.set(p,T),s=s.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,m))}return y.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return N.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Bu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i);var o}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):y.resolve(Ht());let a=-1,u=s;return o.next(c=>y.forEach(c,(d,m)=>(a<m.largestBatchId&&(a=m.largestBatchId),s.get(d)?y.resolve():this.remoteDocumentCache.getEntry(e,d).next(p=>{u=u.insert(d,p)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,X())).next(d=>({batchId:a,changes:ld(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new N(t)).next(r=>{let i=Os();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=Os();return this.indexManager.getCollectionParents(e,s).next(a=>y.forEach(a,u=>{const c=(m=t,p=u.child(s),new ln(p,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt));var m,p;return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(d=>{d.forEach((m,p)=>{o=o.insert(m,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{const d=c.getKey();null===o.get(d)&&(o=o.insert(d,Ee.newInvalidDocument(d)))});let a=Os();return o.forEach((u,c)=>{const d=s.get(u);void 0!==d&&Bs(d.mutation,c,gt.empty(),Pe.now()),Ms(t,c)&&(a=a.insert(u,c))}),a})}}class Xp{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return y.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,{id:(i=t).id,version:i.version,createTime:Me(i.createTime)}),y.resolve();var i}getNamedQuery(e,t){return y.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,{name:(i=t).name,query:ec(i.bundledQuery),readTime:Me(i.readTime)}),y.resolve();var i}}class Jp{constructor(){this.overlays=new ye(N.comparator),this.hr=new Map}getOverlay(e,t){return y.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ht();return y.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),y.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.hr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),y.resolve()}getOverlaysForCollection(e,t,r){const i=Ht(),s=t.length+1,o=new N(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return y.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ye((c,d)=>c-d);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=s.get(c.largestBatchId);null===d&&(d=Ht(),s=s.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const a=Ht(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=i)););return y.resolve(a)}ht(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Ku(t,r));let s=this.hr.get(t);void 0===s&&(s=X(),this.hr.set(t,s)),this.hr.set(t,s.add(r.key))}}class ac{constructor(){this.Pr=new fe(Ze.Ir),this.Tr=new fe(Ze.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const r=new Ze(e,t);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Ar(new Ze(e,t))}Rr(e,t){e.forEach(r=>this.removeReference(r,t))}Vr(e){const t=new N(new te([])),r=new Ze(t,e),i=new Ze(t,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new N(new te([])),r=new Ze(t,e),i=new Ze(t,e+1);let s=X();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new Ze(e,0),r=this.Pr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class Ze{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return N.comparator(e.key,t.key)||Q(e.pr,t.pr)}static Er(e,t){return Q(e.pr,t.pr)||N.comparator(e.key,t.key)}}class e_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new fe(Ze.Ir)}checkEmpty(e){return y.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.yr;this.yr++;const o=new ju(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.wr=this.wr.add(new Ze(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return y.resolve(o)}lookupMutationBatch(e,t){return y.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.br(t+1),s=i<0?0:i;return y.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return y.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return y.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Ze(t,0),i=new Ze(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{const a=this.Sr(o.pr);s.push(a)}),y.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fe(Q);return t.forEach(i=>{const s=new Ze(i,0),o=new Ze(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),y.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;N.isDocumentKey(s)||(s=s.child(""));const o=new Ze(new N(s),0);let a=new fe(Q);return this.wr.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.pr)),!0)},o),y.resolve(this.Dr(a))}Dr(e){const t=[];return e.forEach(r=>{const i=this.Sr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){L(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let r=this.wr;return y.forEach(t.mutations,i=>{const s=new Ze(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,t){const r=new Ze(t,0),i=this.wr.firstAfterOrEqual(r);return y.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return y.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class t_{constructor(e){this.vr=e,this.docs=new ye(N.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return y.resolve(r?r.document.mutableCopy():Ee.newInvalidDocument(t))}getEntries(e,t){let r=pt();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ee.newInvalidDocument(i))}),y.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=pt();const o=t.path,a=new N(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:c,value:{document:d}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Vu(Ah(d),r)<=0||(i.has(d.key)||Ms(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return y.resolve(s)}getAllFromCollectionGroup(e,t,r,i){F()}Fr(e,t){return y.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new n_(this)}getSize(e){return y.resolve(this.size)}}class n_ extends yf{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),y.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class r_{constructor(e){this.persistence=e,this.Mr=new hn(t=>_r(t),ks),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.Or=0,this.Nr=new ac,this.targetCount=0,this.Lr=Rr.Nn()}forEachTarget(e,t){return this.Mr.forEach((r,i)=>t(i)),y.resolve()}getLastRemoteSnapshotVersion(e){return y.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return y.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),y.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Or&&(this.Or=t),y.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new Rr(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,y.resolve()}updateTargetData(e,t){return this.qn(t),y.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,y.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),y.waitFor(s).next(()=>i)}getTargetCount(e){return y.resolve(this.targetCount)}getTargetData(e,t){const r=this.Mr.get(t)||null;return y.resolve(r)}addMatchingKeys(e,t,r){return this.Nr.dr(t,r),y.resolve()}removeMatchingKeys(e,t,r){this.Nr.Rr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),y.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),y.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Nr.gr(t);return y.resolve(r)}containsKey(e,t){return y.resolve(this.Nr.containsKey(t))}}class uc{constructor(e,t){this.Br={},this.overlays={},this.kr=new Et(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new r_(this),this.indexManager=new zp,this.remoteDocumentCache=new t_(r=>this.referenceDelegate.Kr(r)),this.serializer=new Qd(t),this.$r=new Xp(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Jp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new e_(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,r){R("MemoryPersistence","Starting transaction:",e);const i=new i_(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return y.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}}class i_ extends Ph{constructor(e){super(),this.currentSequenceNumber=e}}class pa{constructor(e){this.persistence=e,this.zr=new ac,this.jr=null}static Hr(e){return new pa(e)}get Jr(){if(this.jr)return this.jr;throw F()}addReference(e,t,r){return this.zr.addReference(r,t),this.Jr.delete(r.toString()),y.resolve()}removeReference(e,t,r){return this.zr.removeReference(r,t),this.Jr.add(r.toString()),y.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),y.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return y.forEach(this.Jr,r=>{const i=N.fromPath(r);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,B.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(r=>{r?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return y.or([()=>y.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class s_{constructor(e){this.serializer=e}N(e,t,r,i){const s=new Qo("createOrUpgrade",t);var u;r<1&&i>=1&&(e.createObjectStore("owner"),(u=e).createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Vh,{unique:!0}),u.createObjectStore("documentMutations"),Af(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=y.resolve();return r<3&&i>=3&&(0!==r&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),Af(e)),o=o.next(()=>function(u){const c=u.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:B.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(s))),r<4&&i>=4&&(0!==r&&(o=o.next(()=>function(u,c){return c.store("mutations").W().next(d=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Vh,{unique:!0});const m=c.store("mutations"),p=d.map(T=>m.put(T));return y.waitFor(p)})}(e,s))),o=o.next(()=>{!function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(o=o.next(()=>this.Xr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),r<7&&i>=7&&(o=o.next(()=>this.ti(s))),r<8&&i>=8&&(o=o.next(()=>this.ni(e,s))),r<9&&i>=9&&(o=o.next(()=>{!function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(o=o.next(()=>this.ri(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{!function(u){const c=u.createObjectStore("documentOverlays",{keyPath:jg});c.createIndex("collectionPathOverlayIndex",$g,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",Kg,{unique:!1})}(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){const c=u.createObjectStore("remoteDocumentsV14",{keyPath:Ng});c.createIndex("documentKeyIndex",kg),c.createIndex("collectionGroupIndex",Fg)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.si(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:Bg}).createIndex("sequenceNumberIndex",qg,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:Gg}).createIndex("documentKeyIndex",zg,{unique:!1})}(e))),o}ei(e){let t=0;return e.store("remoteDocuments").Y((r,i)=>{t+=fa(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Xr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>y.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>y.forEach(a,u=>{L(u.userId===s.userId);const c=vr(this.serializer,u);return hf(e,s.userId,c).next(()=>{})}))}))}ti(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Y((o,a)=>{const u=new te(o),c=[0,it(u)];s.push(t.get(c).next(d=>d?y.resolve():t.put({targetId:0,path:it(u),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>y.waitFor(s))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:Ug});const r=t.store("collectionParents"),i=new oc,s=o=>{if(i.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:it(u)})}};return t.store("remoteDocuments").Y({J:!0},(o,a)=>{const u=new te(o);return s(u.popLast())}).next(()=>t.store("documentMutations").Y({J:!0},([o,a,u],c)=>{const d=Qt(a);return s(d.popLast())}))}ri(e){const t=e.store("targets");return t.Y((r,i)=>{const s=Ks(i),o=Hd(this.serializer,s);return t.put(o)})}ii(e,t){const r=t.store("remoteDocuments"),i=[];return r.Y((s,o)=>{const a=t.store("remoteDocumentsV14"),u=(m=o,m.document?new N(te.fromString(m.document.name).popFirst(5)):m.noDocument?N.fromSegments(m.noDocument.path):m.unknownDocument?N.fromSegments(m.unknownDocument.path):F()).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};var m;i.push(a.put(c))}).next(()=>y.waitFor(i))}si(e,t){const r=t.store("mutations"),i=Tf(this.serializer),s=new uc(pa.Hr,this.serializer.ct);return r.W().next(o=>{const a=new Map;return o.forEach(u=>{var c;let d=null!==(c=a.get(u.userId))&&void 0!==c?c:X();vr(this.serializer,u).keys().forEach(m=>d=d.add(m)),a.set(u.userId,d)}),y.forEach(a,(u,c)=>{const d=new We(c),m=la.lt(this.serializer,d),p=s.getIndexManager(d),T=ma.lt(d,this.serializer,p,s.referenceDelegate);return new wf(i,T,m,p).recalculateAndSaveOverlaysForDocumentKeys(new Nu(t,Et._e),u).next()})})}}function Af(n){n.createObjectStore("targetDocuments",{keyPath:Og}).createIndex("documentTargetsIndex",Lg,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Mg,{unique:!0}),n.createObjectStore("targetGlobal")}const cc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class lc{constructor(e,t,r,i,s,o,a,u,c,d,m=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.oi=s,this.window=o,this.document=a,this._i=c,this.ai=d,this.ui=m,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=p=>Promise.resolve(),!lc.D())throw new A(E.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Wp(this,i),this.Ti=t+"main",this.serializer=new Qd(u),this.Ei=new bt(this.Ti,this.ui,new s_(this.serializer)),this.Qr=new $p(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Tf(this.serializer),this.$r=new Op,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===d&&Fe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new A(E.FAILED_PRECONDITION,cc);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new Et(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){var t=this;return this.Ii=function(){var r=(0,w.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.B(function(){var t=(0,w.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget((0,w.Z)(function*(){t.started&&(yield t.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ya(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(t=>{t||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(bn(e))return R("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return R("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return Ys(e).get("owner").next(t=>y.resolve(this.Si(t)))}bi(e){return ya(e).delete(this.clientId)}Di(){var e=this;return(0,w.Z)(function*(){if(e.isPrimary&&!e.Ci(e.Pi,18e5)){e.Pi=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=He(r,"clientMetadata");return i.W().next(s=>{const o=e.vi(s,18e5),a=s.filter(u=>-1===o.indexOf(u));return y.forEach(a,u=>i.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.di)for(const r of t)e.di.removeItem(e.Fi(r.clientId))}})()}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?y.resolve(!0):Ys(e).get("owner").next(t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new A(E.FAILED_PRECONDITION,cc);return!1}}return!(!this.networkEnabled||!this.inForeground)||ya(e).W().next(r=>void 0===this.vi(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&R("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,w.Z)(function*(){e.qr=!1,e.xi(),e.hi&&(e.hi.cancel(),e.hi=null),e.Oi(),e.Ni(),yield e.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Nu(t,Et._e);return e.yi(r).next(()=>e.bi(r))}),e.Ei.close(),e.Li()})()}vi(e,t){return e.filter(r=>this.Ci(r.updateTimeMs,t)&&!this.Mi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>ya(e).W().next(t=>this.vi(t,18e5).map(r=>r.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return ma.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new jp(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return la.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,r){R("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(u=this.ui)?Wg:14===u?kh:13===u?Nh:12===u?Qg:11===u?Dh:void F();var u;let o;return this.Ei.runTransaction(e,i,s,a=>(o=new Nu(a,this.kr?this.kr.next():Et._e),"readwrite-primary"===t?this.gi(o).next(u=>!!u||this.pi(o)).next(u=>{if(!u)throw Fe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new A(E.FAILED_PRECONDITION,Rh);return r(o)}).next(u=>this.wi(o).next(()=>u)):this.ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}ki(e){return Ys(e).get("owner").next(t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)&&!this.Si(t)&&!(this.ai||this.allowTabSynchronization&&t.allowTabSynchronization))throw new A(E.FAILED_PRECONDITION,cc)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ys(e).put("owner",t)}static D(){return bt.D()}yi(e){const t=Ys(e);return t.get("owner").next(r=>this.Si(r)?(R("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):y.resolve())}Ci(e,t){const r=Date.now();return!(e<r-t||e>r&&(Fe(`Detected an update time that is in the future: ${e} > ${r}`),1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const t=/(?:Version|Mobile)\/1[456]/;(0,G.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{const r=null!==(null===(t=this.di)||void 0===t?void 0:t.getItem(this.Fi(e)));return R("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Fe("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){Fe("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ys(n){return He(n,"owner")}function ya(n){return He(n,"clientMetadata")}function hc(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class dc{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.qi=r,this.Qi=i}static Ki(e,t){let r=X(),i=X();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new dc(e,t.fromCache,r,i)}}class o_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Rf{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=(0,G.G6)()?8:bt.v((0,G.z$)())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.ji(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new o_;return this.Ji(e,t,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(e,t,o,a.size)})}).next(()=>s.result)}Yi(e,t,r,i){return r.documentReadCount<this.Wi?(ai()<=k.in.DEBUG&&R("QueryEngine","SDK will not create cache indexes for query:",pi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),y.resolve()):(ai()<=k.in.DEBUG&&R("QueryEngine","Query:",pi(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(ai()<=k.in.DEBUG&&R("QueryEngine","The SDK decides to create cache indexes for query:",pi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ct(t))):y.resolve())}ji(e,t){if(id(t))return y.resolve(null);let r=ct(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=ra(t,null,"F"),r=ct(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=X(...s);return this.zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const c=this.Zi(t,a);return this.Xi(t,c,o,u.readTime)?this.ji(e,ra(t,null,"F")):this.es(e,c,t,u)}))})))}Hi(e,t,r,i){return id(t)||i.isEqual(B.min())?y.resolve(null):this.zi.getDocuments(e,r).next(s=>{const o=this.Zi(t,s);return this.Xi(t,o,r,i)?y.resolve(null):(ai()<=k.in.DEBUG&&R("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),pi(t)),this.es(e,o,t,wh(i,-1)).next(a=>a))})}Zi(e,t){let r=new fe(ud(e));return t.forEach((i,s)=>{Ms(e,s)&&(r=r.add(s))}),r}Xi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,r){return ai()<=k.in.DEBUG&&R("QueryEngine","Using full collection scan to execute query:",pi(t)),this.zi.getDocumentsMatchingQuery(e,t,It.min(),r)}es(e,t,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class a_{constructor(e,t,r,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new ye(Q),this.rs=new hn(s=>_r(s),ks),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new wf(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}}function Pf(n,e,t,r){return new a_(n,e,t,r)}function Sf(n,e){return fc.apply(this,arguments)}function fc(){return fc=(0,w.Z)(function*(n,e){const t=b(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let u=X();for(const c of i){o.push(c.batchId);for(const d of c.mutations)u=u.add(d.key)}for(const c of s){a.push(c.batchId);for(const d of c.mutations)u=u.add(d.key)}return t.localDocuments.getDocuments(r,u).next(c=>({us:c,removedBatchIds:o,addedBatchIds:a}))})})}),fc.apply(this,arguments)}function xf(n){const e=b(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function Cf(n,e,t){let r=X(),i=X();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=pt();return t.forEach((a,u)=>{const c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(B.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):R("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{cs:o,ls:i}})}function l_(n,e){const t=b(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Si(n,e){const t=b(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Qr.getTargetData(r,e).next(s=>s?(i=s,y.resolve(i)):t.Qr.allocateTargetId(r).next(o=>(i=new fn(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ns.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(r.targetId,r),t.rs.set(e,r.targetId)),r})}function xi(n,e,t){return mc.apply(this,arguments)}function mc(){return mc=(0,w.Z)(function*(n,e,t){const r=b(n),i=r.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!bn(o))throw o;R("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)}),mc.apply(this,arguments)}function Ta(n,e,t){const r=b(n);let i=B.min(),s=X();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,d){const m=b(u),p=m.rs.get(d);return void 0!==p?y.resolve(m.ns.get(p)):m.Qr.getTargetData(c,d)}(r,o,ct(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.ts.getDocumentsMatchingQuery(o,e,t?i:B.min(),t?s:X())).next(a=>(Df(r,ad(e),a),{documents:a,hs:s})))}function Vf(n,e){const t=b(n),r=b(t.Qr),i=t.ns.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r._t(s,e).next(o=>o?o.target:null))}function bf(n,e){const t=b(n),r=t.ss.get(e)||B.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.os.getAllFromCollectionGroup(i,e,wh(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Df(t,e,i),i))}function Df(n,e,t){let r=n.ss.get(e)||B.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.ss.set(e,r)}function gc(){return gc=(0,w.Z)(function*(n,e,t,r){const i=b(n);let s=X(),o=pt();for(const c of t){const d=e.Ps(c.metadata.name);c.document&&(s=s.add(d));const m=e.Is(c);m.setReadTime(e.Ts(c.metadata.readTime)),o=o.insert(d,m)}const a=i.os.newChangeBuffer({trackRemovals:!0}),u=yield Si(i,(d=r,ct(mi(te.fromString(`__bundle__/docs/${d}`)))));var d;return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>Cf(c,a,o).next(d=>(a.apply(c),d)).next(d=>i.Qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.Qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,d.cs,d.ls)).next(()=>d.cs)))}),gc.apply(this,arguments)}function d_(n,e){return pc.apply(this,arguments)}function pc(){return pc=(0,w.Z)(function*(n,e,t=X()){const r=yield Si(n,ct(ec(e.bundledQuery))),i=b(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const o=Me(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.$r.saveNamedQuery(s,e);const a=r.withResumeToken(je.EMPTY_BYTE_STRING,o);return i.ns=i.ns.insert(a.targetId,a),i.Qr.updateTargetData(s,a).next(()=>i.Qr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.Qr.addMatchingKeys(s,t,r.targetId)).next(()=>i.$r.saveNamedQuery(s,e))})}),pc.apply(this,arguments)}function Nf(n,e){return`firestore_clients_${n}_${e}`}function kf(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function _c(n,e){return`firestore_targets_${n}_${e}`}class Ia{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Es(e,t,r){const i=JSON.parse(r);let s,o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code,o&&(s=new A(i.error.code,i.error.message))),o?new Ia(e,t,i.state,s):(Fe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Xs{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Es(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new A(r.error.code,r.error.message))),s?new Xs(e,r.state,i):(Fe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ea{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=Gu();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=xh(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new Ea(e,s):(Fe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class yc{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new yc(t.clientId,t.onlineState):(Fe("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Tc{constructor(){this.activeTargetIds=Gu()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ic{constructor(e,t,r,i,s){this.window=e,this.oi=t,this.persistenceKey=r,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new ye(Q),this.started=!1,this.ys=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=Nf(this.persistenceKey,this.Vs),this.Ss=`firestore_sequence_number_${this.persistenceKey}`,this.ps=this.ps.insert(this.Vs,new Tc),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=`firestore_online_state_${this.persistenceKey}`,this.Fs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,w.Z)(function*(){const t=yield e.syncEngine.Bi();for(const i of t){if(i===e.Vs)continue;const s=e.getItem(Nf(e.persistenceKey,i));if(s){const o=Ea.Es(i,s);o&&(e.ps=e.ps.insert(o.clientId,o))}}e.Ms();const r=e.storage.getItem(e.vs);if(r){const i=e.xs(r);i&&e.Os(i)}for(const i of e.ys)e.gs(i);e.ys=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,r){this.Ls(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(_c(this.persistenceKey,e));if(r){const i=Xs.Es(e,r);i&&(t=i.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(_c(this.persistenceKey,e))}updateQueryState(e,t,r){this.qs(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return R("SharedClientState","READ",e,t),t}setItem(e,t){R("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){R("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){var t=this;const r=e;if(r.storageArea===this.storage){if(R("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ws)return void Fe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable((0,w.Z)(function*(){if(t.started){if(null!==r.key)if(t.bs.test(r.key)){if(null==r.newValue){const i=t.$s(r.key);return t.Us(i,null)}{const i=t.Ws(r.key,r.newValue);if(i)return t.Us(i.clientId,i)}}else if(t.Ds.test(r.key)){if(null!==r.newValue){const i=t.Gs(r.key,r.newValue);if(i)return t.zs(i)}}else if(t.Cs.test(r.key)){if(null!==r.newValue){const i=t.js(r.key,r.newValue);if(i)return t.Hs(i)}}else if(r.key===t.vs){if(null!==r.newValue){const i=t.xs(r.newValue);if(i)return t.Os(i)}}else if(r.key===t.Ss){const i=function(o){let a=Et._e;if(null!=o)try{const u=JSON.parse(o);L("number"==typeof u),a=u}catch(u){Fe("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(r.newValue);i!==Et._e&&t.sequenceNumberHandler(i)}else if(r.key===t.Fs){const i=t.Js(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Ys(s)))}}else t.ys.push(r)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,r){const i=new Ia(this.currentUser,e,t,r),s=kf(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Bs(e){const t=kf(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){this.storage.setItem(this.vs,JSON.stringify({clientId:this.Vs,onlineState:e}))}qs(e,t,r){const i=_c(this.persistenceKey,e),s=new Xs(e,t,r);this.setItem(i,s.ds())}Ks(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){const t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){const r=this.$s(e);return Ea.Es(r,t)}Gs(e,t){const r=this.Ds.exec(e),i=Number(r[1]);return Ia.Es(new We(void 0!==r[2]?r[2]:null),i,t)}js(e,t){const r=this.Cs.exec(e),i=Number(r[1]);return Xs.Es(i,t)}xs(e){return yc.Es(e)}Js(e){return JSON.parse(e)}zs(e){var t=this;return(0,w.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Zs(e.batchId,e.state,e.error);R("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){const r=t?this.ps.insert(e,t):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.eo(o,a).then(()=>{this.ps=r})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=Gu();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class Ff{constructor(){this.no=new Tc,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,r){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Tc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class f_{io(e){}shutdown(){}}class Mf{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){R("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){R("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let va=null;function Ec(){return null===va?va=268435456+Math.round(2147483648*Math.random()):va++,"0x"+va.toString(16)}const m_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class g_{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}const ot="WebChannelConnection";class p_ extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+t.host,this.po=`projects/${i}/databases/${s}`,this.yo="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(t,r,i,s,o){const a=Ec(),u=this.bo(t,r.toUriEncodedString());R("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);const c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,s,o),this.Co(t,u,c,i).then(d=>(R("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw mt("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",u,"request:",i),d})}vo(t,r,i,s,o,a){return this.So(t,r,i,s,o)}Do(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+oi,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}bo(t,r){return`${this.fo}/v1/${r}:${m_[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,r,i){const s=Ec();return new Promise((o,a)=>{const u=new fg;u.setWithCredentials(!0),u.listenOnce(hg.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Su.NO_ERROR:const d=u.getResponseJson();R(ot,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(d)),o(d);break;case Su.TIMEOUT:R(ot,`RPC '${e}' ${s} timed out`),a(new A(E.DEADLINE_EXCEEDED,"Request time out"));break;case Su.HTTP_ERROR:const m=u.getStatus();if(R(ot,`RPC '${e}' ${s} failed with status:`,m,"response text:",u.getResponseText()),m>0){let p=u.getResponseJson();Array.isArray(p)&&(p=p[0]);const T=p?.error;if(T&&T.status&&T.message){const S=function(C){const q=C.toLowerCase().replace(/_/g,"-");return Object.values(E).indexOf(q)>=0?q:E.UNKNOWN}(T.status);a(new A(S,T.message))}else a(new A(E.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new A(E.UNAVAILABLE,"Connection failed."));break;default:F()}}finally{R(ot,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(i);R(ot,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}Fo(e,t,r){const i=Ec(),s=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=cg(),a=lg(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const d=s.join("");R(ot,`Creating RPC '${e}' stream ${i}: ${d}`,u);const m=o.createWebChannel(d,u);let p=!1,T=!1;const S=new g_({lo:C=>{T?R(ot,`Not sending because RPC '${e}' stream ${i} is closed:`,C):(p||(R(ot,`Opening RPC '${e}' stream ${i} transport.`),m.open(),p=!0),R(ot,`RPC '${e}' stream ${i} sending:`,C),m.send(C))},ho:()=>m.close()}),V=(C,q,W)=>{C.listen(q,U=>{try{W(U)}catch(H){setTimeout(()=>{throw H},0)}})};return V(m,Ko.EventType.OPEN,()=>{T||R(ot,`RPC '${e}' stream ${i} transport opened.`)}),V(m,Ko.EventType.CLOSE,()=>{T||(T=!0,R(ot,`RPC '${e}' stream ${i} transport closed`),S.Vo())}),V(m,Ko.EventType.ERROR,C=>{T||(T=!0,mt(ot,`RPC '${e}' stream ${i} transport errored:`,C),S.Vo(new A(E.UNAVAILABLE,"The operation could not be completed")))}),V(m,Ko.EventType.MESSAGE,C=>{var q;if(!T){const W=C.data[0];L(!!W);const H=W.error||(null===(q=W[0])||void 0===q?void 0:q.error);if(H){R(ot,`RPC '${e}' stream ${i} received error:`,H);const ae=H.status;let ce=function(GT){const sg=Be[GT];if(void 0!==sg)return Pd(sg)}(ae),Oe=H.message;void 0===ce&&(ce=E.INTERNAL,Oe="Unknown error status: "+ae+" with message "+H.message),T=!0,S.Vo(new A(ce,Oe)),m.close()}else R(ot,`RPC '${e}' stream ${i} received:`,W),S.mo(W)}}),V(a,dg.STAT_EVENT,C=>{C.stat===_h.PROXY?R(ot,`RPC '${e}' stream ${i} detected buffering proxy`):C.stat===_h.NOPROXY&&R(ot,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{S.Ro()},0),S}}function Of(){return typeof window<"u"?window:null}function wa(){return typeof document<"u"?document:null}function Js(n){return new Pp(n,!0)}class vc{constructor(e,t,r=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const t=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,t-r);i>0&&R("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Lo&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){null!==this.Lo&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}}class Lf{constructor(e,t,r,i,s,o,a,u){this.oi=e,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new vc(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}stop(){var e=this;return(0,w.Z)(function*(){e.Ho()&&(yield e.close(0))})()}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}e_(){var e=this;return(0,w.Z)(function*(){if(e.Jo())return e.close(0)})()}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(e,t){var r=this;return(0,w.Z)(function*(){r.n_(),r.r_(),r.jo.cancel(),r.Wo++,4!==e?r.jo.reset():t&&t.code===E.RESOURCE_EXHAUSTED?(Fe(t.toString()),Fe("Using maximum backoff delay to prevent overloading the backend."),r.jo.ko()):t&&t.code===E.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.i_(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.To(t)})()}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===t&&this.o_(r,i)},r=>{e(()=>{const i=new A(E.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(e,t){const r=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){var e=this;this.state=5,this.jo.qo((0,w.Z)(function*(){e.state=0,e.start()}))}__(e){return R("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget(()=>this.Wo===e?t():(R("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class __ extends Lf{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();const t=function Cp(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(c=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===c?1:"REMOVE"===c?2:"CURRENT"===c?3:"RESET"===c?4:F(),i=e.targetChange.targetIds||[],s=function(c,d){return c.useProto3Json?(L(void 0===d||"string"==typeof d),je.fromBase64String(d||"")):(L(void 0===d||d instanceof Uint8Array),je.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const d=void 0===c.code?E.UNKNOWN:Pd(c.code);return new A(d,c.message||"")}(o);t=new bd(r,i,s,a||null)}else if("documentChange"in e){const r=e.documentChange,i=Zt(n,r.document.name),s=Me(r.document.updateTime),o=r.document.createTime?Me(r.document.createTime):B.min(),a=new tt({mapValue:{fields:r.document.fields}}),u=Ee.newFoundDocument(i,s,o,a);t=new ua(r.targetIds||[],r.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const r=e.documentDelete,i=Zt(n,r.document),s=r.readTime?Me(r.readTime):B.min(),o=Ee.newNoDocument(i,s);t=new ua([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,i=Zt(n,r.document);t=new ua([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return F();{const r=e.filter,{count:i=0,unchangedNames:s}=r,o=new Ip(i,s);t=new Vd(r.targetId,o)}}var c;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return B.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?B.min():o.readTime?Me(o.readTime):B.min()}(e);return this.listener.u_(t,r)}c_(e){const t={};t.database=Yu(this.serializer),t.addTarget=function(s,o){let a;const u=o.target;if(a=ta(u)?{documents:Gd(s,u)}:{query:Ju(s,u).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Fd(s,o.resumeToken);const c=Wu(s,o.expectedCount);null!==c&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(B.min())>0){a.readTime=Ei(s,o.snapshotVersion.toTimestamp());const c=Wu(s,o.expectedCount);null!==c&&(a.expectedCount=c)}return a}(this.serializer,e);const r=function bp(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.t_(t)}l_(e){const t={};t.database=Yu(this.serializer),t.removeTarget=e,this.t_(t)}}class y_ extends Lf{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(L(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const t=function Vp(n,e){return n&&n.length>0?(L(void 0!==e),n.map(t=>function(i,s){let o=Me(i.updateTime?i.updateTime:s);return o.isEqual(B.min())&&(o=Me(s)),new pp(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=Me(e.commitTime);return this.listener.T_(r,t)}return L(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=Yu(this.serializer),this.t_(e)}I_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>$s(this.serializer,r))};this.t_(t)}}class T_ extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new A(E.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(e,Zu(t,r),i,s,o)).catch(s=>{throw"FirebaseError"===s.name?(s.code===E.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new A(E.UNKNOWN,s.toString())})}vo(e,t,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(e,Zu(t,r),i,o,a,s)).catch(o=>{throw"FirebaseError"===o.name?(o.code===E.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new A(E.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}}class E_{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(Fe(t),this.g_=!1):R("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class v_{constructor(e,t,r,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(a=>{r.enqueueAndForget((0,w.Z)(function*(){var u;zn(o)&&(R("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,w.Z)(function*(d){const m=b(d);m.v_.add(4),yield Ci(m),m.x_.set("Unknown"),m.v_.delete(4),yield eo(m)}),function c(d){return u.apply(this,arguments)})(o))}))}),this.x_=new E_(r,i)}}function eo(n){return Ac.apply(this,arguments)}function Ac(){return Ac=(0,w.Z)(function*(n){if(zn(n))for(const e of n.F_)yield e(!0)}),Ac.apply(this,arguments)}function Ci(n){return Rc.apply(this,arguments)}function Rc(){return Rc=(0,w.Z)(function*(n){for(const e of n.F_)yield e(!1)}),Rc.apply(this,arguments)}function Aa(n,e){const t=b(n);t.C_.has(e.targetId)||(t.C_.set(e.targetId,e),xc(t)?Sc(t):Di(t).Jo()&&Pc(t,e))}function Vi(n,e){const t=b(n),r=Di(t);t.C_.delete(e),r.Jo()&&Uf(t,e),0===t.C_.size&&(r.Jo()?r.Xo():zn(t)&&t.x_.set("Unknown"))}function Pc(n,e){if(n.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(B.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Di(n).c_(e)}function Uf(n,e){n.O_.Oe(e),Di(n).l_(e)}function Sc(n){n.O_=new vp({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.C_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),Di(n).start(),n.x_.p_()}function xc(n){return zn(n)&&!Di(n).Ho()&&n.C_.size>0}function zn(n){return 0===b(n).v_.size}function Bf(n){n.O_=void 0}function w_(n){return Cc.apply(this,arguments)}function Cc(){return Cc=(0,w.Z)(function*(n){n.C_.forEach((e,t)=>{Pc(n,e)})}),Cc.apply(this,arguments)}function A_(n,e){return Vc.apply(this,arguments)}function Vc(){return Vc=(0,w.Z)(function*(n,e){Bf(n),xc(n)?(n.x_.S_(e),Sc(n)):n.x_.set("Unknown")}),Vc.apply(this,arguments)}function R_(n,e,t){return bc.apply(this,arguments)}function bc(){return bc=(0,w.Z)(function*(n,e,t){if(n.x_.set("Online"),e instanceof bd&&2===e.state&&e.cause)try{yield(r=(0,w.Z)(function*(s,o){const a=o.cause;for(const u of o.targetIds)s.C_.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.C_.delete(u),s.O_.removeTarget(u))}),function i(s,o){return r.apply(this,arguments)})(n,e)}catch(r){R("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ra(n,r)}else if(e instanceof ua?n.O_.$e(e):e instanceof Vd?n.O_.Je(e):n.O_.Ge(e),!t.isEqual(B.min()))try{const r=yield xf(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){const a=s.O_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){const d=s.C_.get(c);d&&s.C_.set(c,d.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{const d=s.C_.get(u);if(!d)return;s.C_.set(u,d.withResumeToken(je.EMPTY_BYTE_STRING,d.snapshotVersion)),Uf(s,u);const m=new fn(d.target,u,c,d.sequenceNumber);Pc(s,m)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){R("RemoteStore","Failed to raise snapshot:",r),yield Ra(n,r)}var r}),bc.apply(this,arguments)}function Ra(n,e,t){return Dc.apply(this,arguments)}function Dc(){return Dc=(0,w.Z)(function*(n,e,t){if(!bn(e))throw e;n.v_.add(1),yield Ci(n),n.x_.set("Offline"),t||(t=()=>xf(n.localStore)),n.asyncQueue.enqueueRetryable((0,w.Z)(function*(){R("RemoteStore","Retrying IndexedDB access"),yield t(),n.v_.delete(1),yield eo(n)}))}),Dc.apply(this,arguments)}function qf(n,e){return e().catch(t=>Ra(n,t,e))}function bi(n){return Nc.apply(this,arguments)}function Nc(){return Nc=(0,w.Z)(function*(n){const e=b(n),t=jn(e);let r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;P_(e);)try{const i=yield l_(e.localStore,r);if(null===i){0===e.D_.length&&t.Xo();break}r=i.batchId,S_(e,i)}catch(i){yield Ra(e,i)}Gf(e)&&zf(e)}),Nc.apply(this,arguments)}function P_(n){return zn(n)&&n.D_.length<10}function S_(n,e){n.D_.push(e);const t=jn(n);t.Jo()&&t.P_&&t.I_(e.mutations)}function Gf(n){return zn(n)&&!jn(n).Ho()&&n.D_.length>0}function zf(n){jn(n).start()}function x_(n){return kc.apply(this,arguments)}function kc(){return kc=(0,w.Z)(function*(n){jn(n).d_()}),kc.apply(this,arguments)}function C_(n){return Fc.apply(this,arguments)}function Fc(){return Fc=(0,w.Z)(function*(n){const e=jn(n);for(const t of n.D_)e.I_(t.mutations)}),Fc.apply(this,arguments)}function V_(n,e,t){return Mc.apply(this,arguments)}function Mc(){return Mc=(0,w.Z)(function*(n,e,t){const r=n.D_.shift(),i=$u.from(r,e,t);yield qf(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield bi(n)}),Mc.apply(this,arguments)}function b_(n,e){return Oc.apply(this,arguments)}function Oc(){return Oc=(0,w.Z)(function*(n,e){var t;e&&jn(n).P_&&(yield(t=(0,w.Z)(function*(i,s){if(Rd(a=s.code)&&a!==E.ABORTED){const o=i.D_.shift();jn(i).Zo(),yield qf(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield bi(i)}var a}),function r(i,s){return t.apply(this,arguments)})(n,e)),Gf(n)&&zf(n)}),Oc.apply(this,arguments)}function jf(n,e){return Lc.apply(this,arguments)}function Lc(){return Lc=(0,w.Z)(function*(n,e){const t=b(n);t.asyncQueue.verifyOperationInProgress(),R("RemoteStore","RemoteStore received new credentials");const r=zn(t);t.v_.add(3),yield Ci(t),r&&t.x_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.v_.delete(3),yield eo(t)}),Lc.apply(this,arguments)}function Uc(n,e){return Bc.apply(this,arguments)}function Bc(){return Bc=(0,w.Z)(function*(n,e){const t=b(n);e?(t.v_.delete(2),yield eo(t)):e||(t.v_.add(2),yield Ci(t),t.x_.set("Unknown"))}),Bc.apply(this,arguments)}function Di(n){return n.N_||(n.N_=function(t,r,i){const s=b(t);return s.R_(),new __(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:w_.bind(null,n),To:A_.bind(null,n),u_:R_.bind(null,n)}),n.F_.push(function(){var e=(0,w.Z)(function*(t){t?(n.N_.Zo(),xc(n)?Sc(n):n.x_.set("Unknown")):(yield n.N_.stop(),Bf(n))});return function(t){return e.apply(this,arguments)}}())),n.N_}function jn(n){return n.L_||(n.L_=function(t,r,i){const s=b(t);return s.R_(),new y_(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:x_.bind(null,n),To:b_.bind(null,n),E_:C_.bind(null,n),T_:V_.bind(null,n)}),n.F_.push(function(){var e=(0,w.Z)(function*(t){t?(n.L_.Zo(),yield bi(n)):(yield n.L_.stop(),n.D_.length>0&&(R("RemoteStore",`Stopping write stream with ${n.D_.length} pending writes`),n.D_=[]))});return function(t){return e.apply(this,arguments)}}())),n.L_}class qc{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ze,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new qc(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new A(E.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ni(n,e){if(Fe("AsyncQueue",`${e}: ${n}`),bn(n))return new A(E.UNAVAILABLE,`${e}: ${n}`);throw n}class ki{constructor(e){this.comparator=e?(t,r)=>e(t,r)||N.comparator(t.key,r.key):(t,r)=>N.comparator(t.key,r.key),this.keyedMap=Os(),this.sortedSet=new ye(this.comparator)}static emptySet(e){return new ki(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ki)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new ki;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class $f{constructor(){this.B_=new ye(N.comparator)}track(e){const t=e.doc.key,r=this.B_.get(t);r?0!==e.type&&3===r.type?this.B_=this.B_.insert(t,e):3===e.type&&1!==r.type?this.B_=this.B_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.B_=this.B_.remove(t):1===e.type&&2===r.type?this.B_=this.B_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):F():this.B_=this.B_.insert(t,e)}k_(){const e=[];return this.B_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Fi{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Fi(e,t,ki.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Fs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class D_{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some(e=>e.U_())}}class N_{constructor(){this.queries=new hn(e=>od(e),Fs),this.onlineState="Unknown",this.W_=new Set}}function Gc(n,e){return zc.apply(this,arguments)}function zc(){return zc=(0,w.Z)(function*(n,e){const t=b(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.K_()&&e.U_()&&(r=2):(s=new D_,r=e.U_()?0:1);try{switch(r){case 0:s.q_=yield t.onListen(i,!0);break;case 1:s.q_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){const a=Ni(o,`Initialization of query '${pi(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.Q_.push(e),e.G_(t.onlineState),s.q_&&e.z_(s.q_)&&Kc(t)}),zc.apply(this,arguments)}function jc(n,e){return $c.apply(this,arguments)}function $c(){return $c=(0,w.Z)(function*(n,e){const t=b(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const o=s.Q_.indexOf(e);o>=0&&(s.Q_.splice(o,1),0===s.Q_.length?i=e.U_()?0:1:!s.K_()&&e.U_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}),$c.apply(this,arguments)}function k_(n,e){const t=b(n);let r=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const a of o.Q_)a.z_(i)&&(r=!0);o.q_=i}}r&&Kc(t)}function F_(n,e,t){const r=b(n),i=r.queries.get(e);if(i)for(const s of i.Q_)s.onError(t);r.queries.delete(e)}function Kc(n){n.W_.forEach(e=>{e.next()})}var Qc,Kf;(Kf=Qc||(Qc={})).j_="default",Kf.Cache="cache";class Wc{constructor(e,t,r){this.query=e,this.H_=t,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=r||{}}z_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new Fi(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.J_?this.Z_(e)&&(this.H_.next(e),t=!0):this.X_(e,this.onlineState)&&(this.ea(e),t=!0),this.Y_=e,t}onError(e){this.H_.error(e)}G_(e){this.onlineState=e;let t=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,e)&&(this.ea(this.Y_),t=!0),t}X_(e,t){return!e.fromCache||!this.U_()||(!this.options.ta||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Z_(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Y_&&this.Y_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}ea(e){e=Fi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.J_=!0,this.H_.next(e)}U_(){return this.options.source!==Qc.Cache}}class M_{constructor(e,t){this.na=e,this.byteLength=t}ra(){return"metadata"in this.na}}class Qf{constructor(e){this.serializer=e}Ps(e){return Zt(this.serializer,e)}Is(e){return e.metadata.exists?qd(this.serializer,e.document,!1):Ee.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return Me(e)}}class O_{constructor(e,t,r){this.ia=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Wf(e)}sa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.na.namedQuery)this.queries.push(e.na.namedQuery);else if(e.na.documentMetadata){this.documents.push({metadata:e.na.documentMetadata}),e.na.documentMetadata.exists||++t;const r=te.fromString(e.na.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.na.document&&(this.documents[this.documents.length-1].document=e.na.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}oa(e){const t=new Map,r=new Qf(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.Ps(i.metadata.name);for(const o of i.metadata.queries){const a=(t.get(o)||X()).add(s);t.set(o,a)}}return t}complete(){var e=this;return(0,w.Z)(function*(){const t=yield function h_(n,e,t,r){return gc.apply(this,arguments)}(e.localStore,new Qf(e.serializer),e.documents,e.ia.id),r=e.oa(e.documents);for(const i of e.queries)yield d_(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,_a:e.collectionGroups,aa:t}})()}}function Wf(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class Hf{constructor(e){this.key=e}}class Zf{constructor(e){this.key=e}}class Yf{constructor(e,t){this.query=e,this.ua=t,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=X(),this.mutatedKeys=X(),this.ha=ud(e),this.Pa=new ki(this.ha)}get Ia(){return this.ua}Ta(e,t){const r=t?t.Ea:new $f,i=t?t.Pa:this.Pa;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const u="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,m)=>{const p=i.get(d),T=Ms(this.query,m)?m:null,S=!!p&&this.mutatedKeys.has(p.key),V=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations);let C=!1;p&&T?p.data.isEqual(T.data)?S!==V&&(r.track({type:3,doc:T}),C=!0):this.da(p,T)||(r.track({type:2,doc:T}),C=!0,(u&&this.ha(T,u)>0||c&&this.ha(T,c)<0)&&(a=!0)):!p&&T?(r.track({type:0,doc:T}),C=!0):p&&!T&&(r.track({type:1,doc:p}),C=!0,(u||c)&&(a=!0)),C&&(T?(o=o.add(T),s=V?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const d="F"===this.query.limitType?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),r.track({type:1,doc:d})}return{Pa:o,Ea:r,Xi:a,mutatedKeys:s}}da(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.Pa;this.Pa=e.Pa,this.mutatedKeys=e.mutatedKeys;const o=e.Ea.k_();o.sort((d,m)=>function(T,S){const V=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F()}};return V(T)-V(S)}(d.type,m.type)||this.ha(d.doc,m.doc)),this.Aa(r),i=null!=i&&i;const a=t&&!i?this.Ra():[],u=0===this.la.size&&this.current&&!i?1:0,c=u!==this.ca;return this.ca=u,0!==o.length||c?{snapshot:new Fi(this.query,e.Pa,s,o,e.mutatedKeys,0===u,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),Va:a}:{Va:a}}G_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new $f,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(e){return!this.ua.has(e)&&!!this.Pa.has(e)&&!this.Pa.get(e).hasLocalMutations}Aa(e){e&&(e.addedDocuments.forEach(t=>this.ua=this.ua.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.ua=this.ua.delete(t)),this.current=e.current)}Ra(){if(!this.current)return[];const e=this.la;this.la=X(),this.Pa.forEach(r=>{this.ma(r.key)&&(this.la=this.la.add(r.key))});const t=[];return e.forEach(r=>{this.la.has(r)||t.push(new Zf(r))}),this.la.forEach(r=>{e.has(r)||t.push(new Hf(r))}),t}fa(e){this.ua=e.hs,this.la=X();const t=this.Ta(e.documents);return this.applyChanges(t,!0)}ga(){return Fi.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,0===this.ca,this.hasCachedResults)}}class L_{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class U_{constructor(e){this.key=e,this.pa=!1}}class B_{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.ya={},this.wa=new hn(a=>od(a),Fs),this.Sa=new Map,this.ba=new Set,this.Da=new ye(N.comparator),this.Ca=new Map,this.va=new ac,this.Fa={},this.Ma=new Map,this.xa=Rr.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return!0===this.Oa}}function q_(n,e){return Hc.apply(this,arguments)}function Hc(){return Hc=(0,w.Z)(function*(n,e,t=!0){const r=Pa(n);let i;const s=r.wa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ga()):i=yield Xf(r,e,t,!0),i}),Hc.apply(this,arguments)}function G_(n,e){return Zc.apply(this,arguments)}function Zc(){return Zc=(0,w.Z)(function*(n,e){const t=Pa(n);yield Xf(t,e,!0,!1)}),Zc.apply(this,arguments)}function Xf(n,e,t,r){return Yc.apply(this,arguments)}function Yc(){return Yc=(0,w.Z)(function*(n,e,t,r){const i=yield Si(n.localStore,ct(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current";let a;return r&&(a=yield Xc(n,e,s,"current"===o,i.resumeToken)),n.isPrimaryClient&&t&&Aa(n.remoteStore,i),a}),Yc.apply(this,arguments)}function Xc(n,e,t,r,i){return Jc.apply(this,arguments)}function Jc(){return Jc=(0,w.Z)(function*(n,e,t,r,i){n.Na=(m,p,T)=>{return(S=(0,w.Z)(function*(C,q,W,U){let H=q.view.Ta(W);H.Xi&&(H=yield Ta(C.localStore,q.query,!1).then(({documents:Nt})=>q.view.Ta(Nt,H)));const ae=U&&U.targetChanges.get(q.targetId),ce=U&&null!=U.targetMismatches.get(q.targetId),Oe=q.view.applyChanges(H,C.isPrimaryClient,ae,ce);return ll(C,q.targetId,Oe.Va),Oe.snapshot}),function V(C,q,W,U){return S.apply(this,arguments)})(n,m,p,T);var S};const s=yield Ta(n.localStore,e,!0),o=new Yf(e,s.hs),a=o.Ta(s.documents),u=zs.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),c=o.applyChanges(a,n.isPrimaryClient,u);ll(n,t,c.Va);const d=new L_(e,t,o);return n.wa.set(e,d),n.Sa.has(t)?n.Sa.get(t).push(e):n.Sa.set(t,[e]),c.snapshot}),Jc.apply(this,arguments)}function z_(n,e,t){return el.apply(this,arguments)}function el(){return el=(0,w.Z)(function*(n,e,t){const r=b(n),i=r.wa.get(e),s=r.Sa.get(i.targetId);if(s.length>1)return r.Sa.set(i.targetId,s.filter(o=>!Fs(o,e))),void r.wa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield xi(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Vi(r.remoteStore,i.targetId),Mi(r,i.targetId)}).catch(Vn))):(Mi(r,i.targetId),yield xi(r.localStore,i.targetId,!0))}),el.apply(this,arguments)}function j_(n,e){return tl.apply(this,arguments)}function tl(){return tl=(0,w.Z)(function*(n,e){const t=b(n),r=t.wa.get(e),i=t.Sa.get(r.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Vi(t.remoteStore,r.targetId))}),tl.apply(this,arguments)}function nl(){return nl=(0,w.Z)(function*(n,e,t){const r=El(n);try{const i=yield function(o,a){const u=b(o),c=Pe.now(),d=a.reduce((T,S)=>T.add(S.key),X());let m,p;return u.persistence.runTransaction("Locally write mutations","readwrite",T=>{let S=pt(),V=X();return u.os.getEntries(T,d).next(C=>{S=C,S.forEach((q,W)=>{W.isValidDocument()||(V=V.add(q))})}).next(()=>u.localDocuments.getOverlayedDocuments(T,S)).next(C=>{m=C;const q=[];for(const W of a){const U=yp(W,m.get(W.key).overlayedDocument);null!=U&&q.push(new dn(W.key,U,$h(U.value.mapValue),Se.exists(!0)))}return u.mutationQueue.addMutationBatch(T,c,q,a)}).next(C=>{p=C;const q=C.applyToLocalDocumentSet(m,V);return u.documentOverlayCache.saveOverlays(T,C.batchId,q)})}).then(()=>({batchId:p.batchId,changes:ld(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Fa[o.currentUser.toKey()];c||(c=new ye(Q)),c=c.insert(a,u),o.Fa[o.currentUser.toKey()]=c}(r,i.batchId,t),yield mn(r,i.changes),yield bi(r.remoteStore)}catch(i){const s=Ni(i,"Failed to persist write");t.reject(s)}}),nl.apply(this,arguments)}function Jf(n,e){return rl.apply(this,arguments)}function rl(){return rl=(0,w.Z)(function*(n,e){const t=b(n);try{const r=yield function c_(n,e){const t=b(n),r=e.snapshotVersion;let i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;const a=[];e.targetChanges.forEach((d,m)=>{const p=i.get(m);if(!p)return;a.push(t.Qr.removeMatchingKeys(s,d.removedDocuments,m).next(()=>t.Qr.addMatchingKeys(s,d.addedDocuments,m)));let T=p.withSequenceNumber(s.currentSequenceNumber);var V,C,q;null!==e.targetMismatches.get(m)?T=T.withResumeToken(je.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):d.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(d.resumeToken,r)),i=i.insert(m,T),C=T,q=d,(0===(V=p).resumeToken.approximateByteSize()||C.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=3e8||q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0)&&a.push(t.Qr.updateTargetData(s,T))});let u=pt(),c=X();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(Cf(s,o,e.documentUpdates).next(d=>{u=d.cs,c=d.ls})),!r.isEqual(B.min())){const d=t.Qr.getLastRemoteSnapshotVersion(s).next(m=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(d)}return y.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.ns=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Ca.get(s);o&&(L(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.pa=!0:i.modifiedDocuments.size>0?L(o.pa):i.removedDocuments.size>0&&(L(o.pa),o.pa=!1))}),yield mn(t,r,e)}catch(r){yield Vn(r)}}),rl.apply(this,arguments)}function em(n,e,t){const r=b(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.wa.forEach((s,o)=>{const a=o.view.G_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const u=b(o);u.onlineState=a;let c=!1;u.queries.forEach((d,m)=>{for(const p of m.Q_)p.G_(a)&&(c=!0)}),c&&Kc(u)}(r.eventManager,e),i.length&&r.ya.u_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function K_(n,e,t){return il.apply(this,arguments)}function il(){return il=(0,w.Z)(function*(n,e,t){const r=b(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Ca.get(e),s=i&&i.key;if(s){let o=new ye(N.comparator);o=o.insert(s,Ee.newNoDocument(s,B.min()));const a=X().add(s),u=new Gs(B.min(),new Map,new ye(Q),o,a);yield Jf(r,u),r.Da=r.Da.remove(s),r.Ca.delete(e),hl(r)}else yield xi(r.localStore,e,!1).then(()=>Mi(r,e,t)).catch(Vn)}),il.apply(this,arguments)}function Q_(n,e){return sl.apply(this,arguments)}function sl(){return sl=(0,w.Z)(function*(n,e){const t=b(n),r=e.batch.batchId;try{const i=yield function u_(n,e){const t=b(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(a,u,c,d){const m=c.batch,p=m.keys();let T=y.resolve();return p.forEach(S=>{T=T.next(()=>d.getEntry(u,S)).next(V=>{const C=c.docVersions.get(S);L(null!==C),V.version.compareTo(C)<0&&(m.applyToRemoteDocument(V,c),V.isValidDocument()&&(V.setReadTime(c.commitVersion),d.addEntry(V)))})}),T.next(()=>a.mutationQueue.removeMutationBatch(u,m))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=X();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);cl(t,r,null),ul(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield mn(t,i)}catch(i){yield Vn(i)}}),sl.apply(this,arguments)}function W_(n,e,t){return ol.apply(this,arguments)}function ol(){return ol=(0,w.Z)(function*(n,e,t){const r=b(n);try{const i=yield function(o,a){const u=b(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return u.mutationQueue.lookupMutationBatch(c,a).next(m=>(L(null!==m),d=m.keys(),u.mutationQueue.removeMutationBatch(c,m))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>u.localDocuments.getDocuments(c,d))})}(r.localStore,e);cl(r,e,t),ul(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield mn(r,i)}catch(i){yield Vn(i)}}),ol.apply(this,arguments)}function al(){return al=(0,w.Z)(function*(n,e){const t=b(n);zn(t.remoteStore)||R("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(o){const a=b(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(-1===r)return void e.resolve();const i=t.Ma.get(r)||[];i.push(e),t.Ma.set(r,i)}catch(r){const i=Ni(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),al.apply(this,arguments)}function ul(n,e){(n.Ma.get(e)||[]).forEach(t=>{t.resolve()}),n.Ma.delete(e)}function cl(n,e,t){const r=b(n);let i=r.Fa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Fa[r.currentUser.toKey()]=i}}function Mi(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Sa.get(e))n.wa.delete(r),t&&n.ya.La(r,t);n.Sa.delete(e),n.isPrimaryClient&&n.va.Vr(e).forEach(r=>{n.va.containsKey(r)||tm(n,r)})}function tm(n,e){n.ba.delete(e.path.canonicalString());const t=n.Da.get(e);null!==t&&(Vi(n.remoteStore,t),n.Da=n.Da.remove(e),n.Ca.delete(t),hl(n))}function ll(n,e,t){for(const r of t)r instanceof Hf?(n.va.addReference(r.key,e),Z_(n,r)):r instanceof Zf?(R("SyncEngine","Document no longer in limbo: "+r.key),n.va.removeReference(r.key,e),n.va.containsKey(r.key)||tm(n,r.key)):F()}function Z_(n,e){const t=e.key,r=t.path.canonicalString();n.Da.get(t)||n.ba.has(r)||(R("SyncEngine","New document in limbo: "+t),n.ba.add(r),hl(n))}function hl(n){for(;n.ba.size>0&&n.Da.size<n.maxConcurrentLimboResolutions;){const e=n.ba.values().next().value;n.ba.delete(e);const t=new N(te.fromString(e)),r=n.xa.next();n.Ca.set(r,new U_(t)),n.Da=n.Da.insert(t,r),Aa(n.remoteStore,new fn(ct(mi(t.path)),r,"TargetPurposeLimboResolution",Et._e))}}function mn(n,e,t){return dl.apply(this,arguments)}function dl(){return dl=(0,w.Z)(function*(n,e,t){const r=b(n),i=[],s=[],o=[];var a;r.wa.isEmpty()||(r.wa.forEach((a,u)=>{o.push(r.Na(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);const d=dc.Ki(u.targetId,c);s.push(d)}}))}),yield Promise.all(o),r.ya.u_(i),yield(a=(0,w.Z)(function*(c,d){const m=b(c);try{yield m.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>y.forEach(d,T=>y.forEach(T.qi,S=>m.persistence.referenceDelegate.addReference(p,T.targetId,S)).next(()=>y.forEach(T.Qi,S=>m.persistence.referenceDelegate.removeReference(p,T.targetId,S)))))}catch(p){if(!bn(p))throw p;R("LocalStore","Failed to update sequence numbers: "+p)}for(const p of d){const T=p.targetId;if(!p.fromCache){const S=m.ns.get(T),C=S.withLastLimboFreeSnapshotVersion(S.snapshotVersion);m.ns=m.ns.insert(T,C)}}}),function u(c,d){return a.apply(this,arguments)})(r.localStore,s))}),dl.apply(this,arguments)}function Y_(n,e){return fl.apply(this,arguments)}function fl(){return fl=(0,w.Z)(function*(n,e){const t=b(n);if(!t.currentUser.isEqual(e)){R("SyncEngine","User change. New user:",e.toKey());const r=yield Sf(t.localStore,e);t.currentUser=e,(s=t).Ma.forEach(a=>{a.forEach(u=>{u.reject(new A(E.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Ma.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield mn(t,r.us)}var s}),fl.apply(this,arguments)}function X_(n,e){const t=b(n),r=t.Ca.get(e);if(r&&r.pa)return X().add(r.key);{let i=X();const s=t.Sa.get(e);if(!s)return i;for(const o of s){const a=t.wa.get(o);i=i.unionWith(a.view.Ia)}return i}}function J_(n,e){return ml.apply(this,arguments)}function ml(){return ml=(0,w.Z)(function*(n,e){const t=b(n),r=yield Ta(t.localStore,e.query,!0),i=e.view.fa(r);return t.isPrimaryClient&&ll(t,e.targetId,i.Va),i}),ml.apply(this,arguments)}function ey(n,e){return gl.apply(this,arguments)}function gl(){return gl=(0,w.Z)(function*(n,e){const t=b(n);return bf(t.localStore,e).then(r=>mn(t,r))}),gl.apply(this,arguments)}function ty(n,e,t,r){return pl.apply(this,arguments)}function pl(){return pl=(0,w.Z)(function*(n,e,t,r){const i=b(n),s=yield function(a,u){const c=b(a),d=b(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",m=>d.vn(m,u).next(p=>p?c.localDocuments.getDocuments(m,p):y.resolve(null)))}(i.localStore,e);var u;null!==s?("pending"===t?yield bi(i.remoteStore):"acknowledged"===t||"rejected"===t?(cl(i,e,r||null),ul(i,e),u=e,b(b(i.localStore).mutationQueue).Mn(u)):F(),yield mn(i,s)):R("SyncEngine","Cannot apply mutation batch with id: "+e)}),pl.apply(this,arguments)}function _l(){return _l=(0,w.Z)(function*(n,e){const t=b(n);if(Pa(t),El(t),!0===e&&!0!==t.Oa){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield nm(t,r.toArray());t.Oa=!0,yield Uc(t.remoteStore,!0);for(const s of i)Aa(t.remoteStore,s)}else if(!1===e&&!1!==t.Oa){const r=[];let i=Promise.resolve();t.Sa.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Mi(t,o),xi(t.localStore,o,!0))),Vi(t.remoteStore,o)}),yield i,yield nm(t,r),function(o){const a=b(o);a.Ca.forEach((u,c)=>{Vi(a.remoteStore,c)}),a.va.mr(),a.Ca=new Map,a.Da=new ye(N.comparator)}(t),t.Oa=!1,yield Uc(t.remoteStore,!1)}}),_l.apply(this,arguments)}function nm(n,e,t){return yl.apply(this,arguments)}function yl(){return yl=(0,w.Z)(function*(n,e,t){const r=b(n),i=[],s=[];for(const o of e){let a;const u=r.Sa.get(o);if(u&&0!==u.length){a=yield Si(r.localStore,ct(u[0]));for(const c of u){const d=r.wa.get(c),m=yield J_(r,d);m.snapshot&&s.push(m.snapshot)}}else{const c=yield Vf(r.localStore,o);a=yield Si(r.localStore,c),yield Xc(r,rm(c),o,!1,a.resumeToken)}i.push(a)}return r.ya.u_(s),i}),yl.apply(this,arguments)}function rm(n){return rd(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function ry(n){return t=b(n).localStore,b(b(t).persistence).Bi();var t}function iy(n,e,t,r){return Tl.apply(this,arguments)}function Tl(){return Tl=(0,w.Z)(function*(n,e,t,r){const i=b(n);if(i.Oa)return void R("SyncEngine","Ignoring unexpected query state notification.");const s=i.Sa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const o=yield bf(i.localStore,ad(s[0])),a=Gs.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,je.EMPTY_BYTE_STRING);yield mn(i,o,a);break}case"rejected":yield xi(i.localStore,e,!0),Mi(i,e,r);break;default:F()}}),Tl.apply(this,arguments)}function sy(n,e,t){return Il.apply(this,arguments)}function Il(){return Il=(0,w.Z)(function*(n,e,t){const r=Pa(n);if(r.Oa){for(const i of e){if(r.Sa.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){R("SyncEngine","Adding an already active target "+i);continue}const s=yield Vf(r.localStore,i),o=yield Si(r.localStore,s);yield Xc(r,rm(s),o.targetId,!1,o.resumeToken),Aa(r.remoteStore,o)}for(const i of t)r.Sa.has(i)&&(yield xi(r.localStore,i,!1).then(()=>{Vi(r.remoteStore,i),Mi(r,i)}).catch(Vn))}}),Il.apply(this,arguments)}function Pa(n){const e=b(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Jf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=X_.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=K_.bind(null,e),e.ya.u_=k_.bind(null,e.eventManager),e.ya.La=F_.bind(null,e.eventManager),e}function El(n){const e=b(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Q_.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=W_.bind(null,e),e}class to{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,w.Z)(function*(){t.serializer=Js(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Pf(this.persistence,new Rf,e.initialUser,this.serializer)}createPersistence(e){return new uc(pa.Hr,this.serializer)}createSharedClientState(e){return new Ff}terminate(){var e=this;return(0,w.Z)(function*(){var t,r;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(r=e.indexBackfillerScheduler)||void 0===r||r.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class vl extends to{constructor(e,t,r){super(),this.ka=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,w.Z)(function*(){yield t().call(r,e),yield r.ka.initialize(r,e),yield El(r.ka.syncEngine),yield bi(r.ka.remoteStore),yield r.persistence.fi(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return Pf(this.persistence,new Rf,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new pf(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new Vg(t,this.persistence);return new Cg(e.asyncQueue,r)}createPersistence(e){const t=hc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?st.withCacheSize(this.cacheSizeBytes):st.DEFAULT;return new lc(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Of(),wa(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Ff}}class im extends vl{constructor(e,t){super(e,t,!1),this.ka=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,w.Z)(function*(){yield t().call(r,e);const i=r.ka.syncEngine;r.sharedClientState instanceof Ic&&(r.sharedClientState.syncEngine={Zs:ty.bind(null,i),Xs:iy.bind(null,i),eo:sy.bind(null,i),Bi:ry.bind(null,i),Ys:ey.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.fi(function(){var s=(0,w.Z)(function*(o){yield function ny(n,e){return _l.apply(this,arguments)}(r.ka.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=Of();if(!Ic.D(t))throw new A(E.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=hc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ic(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Oi{initialize(e,t){var r=this;return(0,w.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>em(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=Y_.bind(null,r.syncEngine),yield Uc(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new N_}createDatastore(e){const t=Js(e.databaseInfo.databaseId),r=new p_(e.databaseInfo);return new T_(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,o=t=>em(this.syncEngine,t,0),a=Mf.D()?new Mf:new f_,new v_(r,i,s,o,a);var r,i,s,o,a}createSyncEngine(e,t){return function(i,s,o,a,u,c,d){const m=new B_(i,s,o,a,u,c);return d&&(m.Oa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,w.Z)(function*(){var t,r;yield(r=(0,w.Z)(function*(s){const o=b(s);R("RemoteStore","RemoteStore shutting down."),o.v_.add(5),yield Ci(o),o.M_.shutdown(),o.x_.set("Unknown")}),function i(s){return r.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate()})()}}function sm(n,e=10240){let t=0;return{read:()=>(0,w.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,w.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Sa{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.qa(this.observer.next,e)}error(e){this.observer.error?this.qa(this.observer.error,e):Fe("Uncaught Error in snapshot listener:",e.toString())}Qa(){this.muted=!0}qa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class uy{constructor(e,t){this.Ka=e,this.serializer=t,this.metadata=new ze,this.buffer=new Uint8Array,this.$a=new TextDecoder("utf-8"),this.Ua().then(r=>{r&&r.ra()?this.metadata.resolve(r.na.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(r?.na)}`))},r=>this.metadata.reject(r))}close(){return this.Ka.cancel()}getMetadata(){var e=this;return(0,w.Z)(function*(){return e.metadata.promise})()}Ba(){var e=this;return(0,w.Z)(function*(){return yield e.getMetadata(),e.Ua()})()}Ua(){var e=this;return(0,w.Z)(function*(){const t=yield e.Wa();if(null===t)return null;const r=e.$a.decode(t),i=Number(r);isNaN(i)&&e.Ga(`length string (${r}) is not valid number`);const s=yield e.za(i);return new M_(JSON.parse(s),t.length+i)})()}ja(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Wa(){var e=this;return(0,w.Z)(function*(){for(;e.ja()<0&&!(yield e.Ha()););if(0===e.buffer.length)return null;const t=e.ja();t<0&&e.Ga("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}za(e){var t=this;return(0,w.Z)(function*(){for(;t.buffer.length<e;)(yield t.Ha())&&t.Ga("Reached the end of bundle when more is expected.");const r=t.$a.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Ga(e){throw this.Ka.cancel(),new Error(`Invalid bundle format: ${e}`)}Ha(){var e=this;return(0,w.Z)(function*(){const t=yield e.Ka.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class cy{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,w.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new A(E.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const r=yield(i=(0,w.Z)(function*(o,a){const u=b(o),c={documents:a.map(T=>js(u.serializer,T))},d=yield u.vo("BatchGetDocuments",u.serializer.databaseId,te.emptyPath(),c,a.length),m=new Map;d.forEach(T=>{const S=function xp(n,e){return"found"in e?function(r,i){L(!!i.found);const s=Zt(r,i.found.name),o=Me(i.found.updateTime),a=i.found.createTime?Me(i.found.createTime):B.min(),u=new tt({mapValue:{fields:i.found.fields}});return Ee.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){L(!!i.missing),L(!!i.readTime);const s=Zt(r,i.missing),o=Me(i.readTime);return Ee.newNoDocument(s,o)}(n,e):F()}(u.serializer,T);m.set(S.key.toString(),S)});const p=[];return a.forEach(T=>{const S=m.get(T.toString());L(!!S),p.push(S)}),p}),function s(o,a){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ii(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,w.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=N.fromPath(i);e.mutations.push(new zu(s,e.precondition(s)))}),yield(r=(0,w.Z)(function*(s,o){const a=b(s),u={writes:o.map(c=>$s(a.serializer,c))};yield a.So("Commit",a.serializer.databaseId,te.emptyPath(),u)}),function i(s,o){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw F();t=B.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new A(E.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(B.min())?Se.exists(!1):Se.updateTime(t):Se.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(B.min()))throw new A(E.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Se.updateTime(t)}return Se.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class ly{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Ja=r.maxAttempts,this.jo=new vc(this.asyncQueue,"transaction_retry")}Ya(){this.Ja-=1,this.Za()}Za(){var e=this;this.jo.qo((0,w.Z)(function*(){const t=new cy(e.datastore),r=e.Xa(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.eu(s)}))}).catch(i=>{e.eu(i)})}))}Xa(e){try{const t=this.updateFunction(e);return!Ss(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}eu(e){this.Ja>0&&this.tu(e)?(this.Ja-=1,this.asyncQueue.enqueueAndForget(()=>(this.Za(),Promise.resolve()))):this.deferred.reject(e)}tu(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Rd(t)}return!1}}class hy{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=We.UNAUTHENTICATED,this.clientId=Eh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,w.Z)(function*(a){R("FirestoreClient","Received user=",a.uid),yield s.authCredentialListener(a),s.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(R("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new A(E.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new ze;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,w.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Ni(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function xa(n,e){return wl.apply(this,arguments)}function wl(){return wl=(0,w.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),R("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,w.Z)(function*(s){r.isEqual(s)||(yield Sf(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),wl.apply(this,arguments)}function Al(n,e){return Rl.apply(this,arguments)}function Rl(){return Rl=(0,w.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Pl(n);R("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>jf(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>jf(e.remoteStore,i)),n._onlineComponents=e}),Rl.apply(this,arguments)}function om(n){return"FirebaseError"===n.name?n.code===E.FAILED_PRECONDITION||n.code===E.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function Pl(n){return Sl.apply(this,arguments)}function Sl(){return Sl=(0,w.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){R("FirestoreClient","Using user provided OfflineComponentProvider");try{yield xa(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!om(t))throw t;mt("Error using user provided cache. Falling back to memory cache: "+t),yield xa(n,new to)}}else R("FirestoreClient","Using default OfflineComponentProvider"),yield xa(n,new to);return n._offlineComponents}),Sl.apply(this,arguments)}function Ca(n){return xl.apply(this,arguments)}function xl(){return xl=(0,w.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(R("FirestoreClient","Using user provided OnlineComponentProvider"),yield Al(n,n._uninitializedComponentsProvider._online)):(R("FirestoreClient","Using default OnlineComponentProvider"),yield Al(n,new Oi))),n._onlineComponents}),xl.apply(this,arguments)}function am(n){return Pl(n).then(e=>e.persistence)}function Li(n){return Pl(n).then(e=>e.localStore)}function um(n){return Ca(n).then(e=>e.remoteStore)}function Cl(n){return Ca(n).then(e=>e.syncEngine)}function Ui(n){return Vl.apply(this,arguments)}function Vl(){return Vl=(0,w.Z)(function*(n){const e=yield Ca(n),t=e.eventManager;return t.onListen=q_.bind(null,e.syncEngine),t.onUnlisten=z_.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=G_.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=j_.bind(null,e.syncEngine),t}),Vl.apply(this,arguments)}function lm(n,e,t={}){const r=new ze;return n.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return function(s,o,a,u,c){const d=new Sa({next:p=>{o.enqueueAndForget(()=>jc(s,m));const T=p.docs.has(a);!T&&p.fromCache?c.reject(new A(E.UNAVAILABLE,"Failed to get document because the client is offline.")):T&&p.fromCache&&u&&"server"===u.source?c.reject(new A(E.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(p)},error:p=>c.reject(p)}),m=new Wc(mi(a.path),d,{includeMetadataChanges:!0,ta:!0});return Gc(s,m)}(yield Ui(n),n.asyncQueue,e,t,r)})),r.promise}function hm(n,e,t={}){const r=new ze;return n.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return function(s,o,a,u,c){const d=new Sa({next:p=>{o.enqueueAndForget(()=>jc(s,m)),p.fromCache&&"server"===u.source?c.reject(new A(E.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(p)},error:p=>c.reject(p)}),m=new Wc(a,d,{includeMetadataChanges:!0,ta:!0});return Gc(s,m)}(yield Ui(n),n.asyncQueue,e,t,r)})),r.promise}function dm(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const fm=new Map;function bl(n,e,t){if(!t)throw new A(E.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function mm(n,e,t,r){if(!0===e&&!0===r)throw new A(E.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function gm(n){if(!N.isDocumentKey(n))throw new A(E.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function pm(n){if(N.isDocumentKey(n))throw new A(E.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Va(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":F()}function ee(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new A(E.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Va(n);throw new A(E.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function _m(n,e){if(e<=0)throw new A(E.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class ym{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new A(E.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new A(E.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}mm("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=dm(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new A(E.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new A(E.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new A(E.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class no{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ym({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new A(E.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new A(E.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ym(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new _g;switch(r.type){case"firstParty":return new Eg(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new A(E.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=fm.get(t);r&&(R("ComponentProvider","Removing Datastore"),fm.delete(t),r.terminate())}(this),Promise.resolve()}}class nt{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new nt(this.firestore,e,this._query)}}class ve{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Yt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ve(this.firestore,e,this._key)}}class Yt extends nt{constructor(e,t,r){super(e,t,mi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ve(this.firestore,null,new N(e))}withConverter(e){return new Yt(this.firestore,e,this._path)}}function Im(n,e,...t){if(n=(0,G.m9)(n),bl("collection","path",e),n instanceof no){const r=te.fromString(e,...t);return pm(r),new Yt(n,null,r)}{if(!(n instanceof ve||n instanceof Yt))throw new A(E.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(te.fromString(e,...t));return pm(r),new Yt(n.firestore,null,r)}}function ba(n,e,...t){if(n=(0,G.m9)(n),1===arguments.length&&(e=Eh.newId()),bl("doc","path",e),n instanceof no){const r=te.fromString(e,...t);return gm(r),new ve(n,null,new N(r))}{if(!(n instanceof ve||n instanceof Yt))throw new A(E.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(te.fromString(e,...t));return gm(r),new ve(n.firestore,n instanceof Yt?n.converter:null,new N(r))}}function Em(n,e){return n=(0,G.m9)(n),e=(0,G.m9)(e),(n instanceof ve||n instanceof Yt)&&(e instanceof ve||e instanceof Yt)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Dl(n,e){return n=(0,G.m9)(n),e=(0,G.m9)(e),n instanceof nt&&e instanceof nt&&n.firestore===e.firestore&&Fs(n._query,e._query)&&n.converter===e.converter}class wy{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new vc(this,"async_queue_retry"),this.cu=()=>{const t=wa();t&&R("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};const e=wa();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.lu(),this.hu(e)}enterRestrictedMode(e){if(!this.iu){this.iu=!0,this.au=e||!1;const t=wa();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.cu)}}enqueue(e){if(this.lu(),this.iu)return new Promise(()=>{});const t=new ze;return this.hu(()=>this.iu&&this.au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.ru.push(e),this.Pu()))}Pu(){var e=this;return(0,w.Z)(function*(){if(0!==e.ru.length){try{yield e.ru[0](),e.ru.shift(),e.jo.reset()}catch(t){if(!bn(t))throw t;R("AsyncQueue","Operation failed with retryable error: "+t)}e.ru.length>0&&e.jo.qo(()=>e.Pu())}})()}hu(e){const t=this.nu.then(()=>(this._u=!0,e().catch(r=>{throw this.ou=r,this._u=!1,Fe("INTERNAL UNHANDLED ERROR: ",function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),a}(r)),r}).then(r=>(this._u=!1,r))));return this.nu=t,t}enqueueAfterDelay(e,t,r){this.lu(),this.uu.indexOf(e)>-1&&(t=0);const i=qc.createAndSchedule(this,e,t,r,s=>this.Iu(s));return this.su.push(i),i}lu(){this.ou&&F()}verifyOperationInProgress(){}Tu(){var e=this;return(0,w.Z)(function*(){let t;do{t=e.nu,yield t}while(t!==e.nu)})()}Eu(e){for(const t of this.su)if(t.timerId===e)return!0;return!1}du(e){return this.Tu().then(()=>{this.su.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.su)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tu()})}Au(e){this.uu.push(e)}Iu(e){const t=this.su.indexOf(e);this.su.splice(t,1)}}function Nl(n){return function(t,r){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class Ay{constructor(){this._progressObserver={},this._taskCompletionResolver=new ze,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Te extends no{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new wy,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||vm(this),this._firestoreClient.terminate()}}function De(n){return n._firestoreClient||vm(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function vm(n){var e,t,r;const i=n._freezeSettings(),s=(u=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Yg(n._databaseId,u,n._persistenceKey,(d=i).host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,dm(d.experimentalLongPollingOptions),d.useFetchStreams));var u,d;n._firestoreClient=new hy(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function wm(n,e,t){const r=new ze;return n.asyncQueue.enqueue((0,w.Z)(function*(){try{yield xa(n,t),yield Al(n,e),r.resolve()}catch(i){const s=i;if(!om(s))throw s;mt("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function Am(n){if(n._initialized||n._terminated)throw new A(E.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Xt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Xt(je.fromBase64String(e))}catch(t){throw new A(E.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Xt(je.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class gn{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new A(E.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ie(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Sr{constructor(e){this._methodName=e}}class Da{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new A(E.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new A(E.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}}const Fy=/^__.*__$/;class My{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new dn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ti(e,this.data,t,this.fieldTransforms)}}class Rm{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new dn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Pm(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F()}}class Na{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.Ru(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(e){return new Na(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.mu({path:r,gu:!1});return i.pu(e),i}yu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.mu({path:r,gu:!1});return i.Ru(),i}wu(e){return this.mu({path:void 0,gu:!0})}Su(e){return Ma(e,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Ru(){if(this.path)for(let e=0;e<this.path.length;e++)this.pu(this.path.get(e))}pu(e){if(0===e.length)throw this.Su("Document fields must not be empty");if(Pm(this.Vu)&&Fy.test(e))throw this.Su('Document fields cannot begin and end with "__"')}}class Oy{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Js(e)}Cu(e,t,r,i=!1){return new Na({Vu:e,methodName:t,Du:r,path:Ie.emptyPath(),gu:!1,bu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function xr(n){const e=n._freezeSettings(),t=Js(n._databaseId);return new Oy(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ka(n,e,t,r,i,s={}){const o=n.Cu(s.merge||s.mergeFields?2:0,e,t,i);Bl("Data must be an object, but it was:",o,r);const a=Cm(r,o);let u,c;if(s.merge)u=new gt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const d=[];for(const m of s.mergeFields){const p=so(e,m,t);if(!o.contains(p))throw new A(E.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);bm(d,p)||d.push(p)}u=new gt(d),c=o.fieldTransforms.filter(m=>u.covers(m.field))}else u=null,c=o.fieldTransforms;return new My(new tt(a),u,c)}class io extends Sr{_toFieldTransform(e){if(2!==e.Vu)throw e.Su(1===e.Vu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof io}}function Sm(n,e,t){return new Na({Vu:3,Du:e.settings.Du,methodName:n._methodName,gu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class kl extends Sr{_toFieldTransform(e){return new Us(e.path,new _i)}isEqual(e){return e instanceof kl}}class Fl extends Sr{constructor(e,t){super(e),this.vu=t}_toFieldTransform(e){const t=Sm(this,e,!0),r=this.vu.map(s=>Cr(s,t)),i=new yr(r);return new Us(e.path,i)}isEqual(e){return e instanceof Fl&&(0,G.vZ)(this.vu,e.vu)}}class Ml extends Sr{constructor(e,t){super(e),this.vu=t}_toFieldTransform(e){const t=Sm(this,e,!0),r=this.vu.map(s=>Cr(s,t)),i=new Tr(r);return new Us(e.path,i)}isEqual(e){return e instanceof Ml&&(0,G.vZ)(this.vu,e.vu)}}class Ol extends Sr{constructor(e,t){super(e),this.Fu=t}_toFieldTransform(e){const t=new yi(e.serializer,md(e.serializer,this.Fu));return new Us(e.path,t)}isEqual(e){return e instanceof Ol&&this.Fu===e.Fu}}function Ll(n,e,t,r){const i=n.Cu(1,e,t);Bl("Data must be an object, but it was:",i,r);const s=[],o=tt.empty();Dn(r,(u,c)=>{const d=Fa(e,u,t);c=(0,G.m9)(c);const m=i.yu(d);if(c instanceof io)s.push(d);else{const p=Cr(c,m);null!=p&&(s.push(d),o.set(d,p))}});const a=new gt(s);return new Rm(o,a,i.fieldTransforms)}function Ul(n,e,t,r,i,s){const o=n.Cu(1,e,t),a=[so(e,r,t)],u=[i];if(s.length%2!=0)throw new A(E.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)a.push(so(e,s[p])),u.push(s[p+1]);const c=[],d=tt.empty();for(let p=a.length-1;p>=0;--p)if(!bm(c,a[p])){const T=a[p];let S=u[p];S=(0,G.m9)(S);const V=o.yu(T);if(S instanceof io)c.push(T);else{const C=Cr(S,V);null!=C&&(c.push(T),d.set(T,C))}}const m=new gt(c);return new Rm(d,m,o.fieldTransforms)}function xm(n,e,t,r=!1){return Cr(t,n.Cu(r?4:3,e))}function Cr(n,e){if(Vm(n=(0,G.m9)(n)))return Bl("Unsupported field value:",e,n),Cm(n,e);if(n instanceof Sr)return function(r,i){if(!Pm(i.Vu))throw i.Su(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Su(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.gu&&4!==e.Vu)throw e.Su("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let u=Cr(a,i.wu(o));null==u&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=(0,G.m9)(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return md(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=Pe.fromDate(r);return{timestampValue:Ei(i.serializer,s)}}if(r instanceof Pe){const s=new Pe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ei(i.serializer,s)}}if(r instanceof Da)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Xt)return{bytesValue:Fd(i.serializer,r._byteString)};if(r instanceof ve){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Su(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Hu(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Su(`Unsupported field value: ${Va(r)}`)}(n,e)}function Cm(n,e){const t={};return Mh(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Dn(n,(r,i)=>{const s=Cr(i,e.fu(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function Vm(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof Pe||n instanceof Da||n instanceof Xt||n instanceof ve||n instanceof Sr)}function Bl(n,e,t){if(!Vm(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=Va(t);throw e.Su("an object"===r?n+" a custom object":n+" "+r)}var i}function so(n,e,t){if((e=(0,G.m9)(e))instanceof gn)return e._internalPath;if("string"==typeof e)return Fa(n,e);throw Ma("Field path arguments must be of type string or ",n,!1,void 0,t)}const Ly=new RegExp("[~\\*/\\[\\]]");function Fa(n,e,t){if(e.search(Ly)>=0)throw Ma(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new gn(...e.split("."))._internalPath}catch{throw Ma(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ma(n,e,t,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new A(E.INVALID_ARGUMENT,a+n+u)}function bm(n,e){return n.some(t=>t.isEqual(e))}class oo{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ve(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Uy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Oa("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Uy extends oo{data(){return super.data()}}function Oa(n,e){return"string"==typeof e?Fa(n,e):e instanceof gn?e._internalPath:e._delegate._internalPath}function Dm(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new A(E.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ql{}class ao extends ql{}function $n(n,e,...t){let r=[];e instanceof ql&&r.push(e),r=r.concat(t),function(s){const o=s.filter(u=>u instanceof Bi).length,a=s.filter(u=>u instanceof uo).length;if(o>1||o>0&&a>0)throw new A(E.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class uo extends ao{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new uo(e,t,r)}_apply(e){const t=this._parse(e);return Mm(e._query,t),new nt(e.firestore,e.converter,qu(e._query,t))}_parse(e){const t=xr(e.firestore);return function(s,o,a,u,c,d,m){let p;if(c.isKeyField()){if("array-contains"===d||"array-contains-any"===d)throw new A(E.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if("in"===d||"not-in"===d){Fm(m,d);const T=[];for(const S of m)T.push(km(u,s,S));p={arrayValue:{values:T}}}else p=km(u,s,m)}else"in"!==d&&"not-in"!==d&&"array-contains-any"!==d||Fm(m,d),p=xm(a,"where",m,"in"===d||"not-in"===d);return ne.create(c,d,p)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Bi extends ql{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Bi(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:he.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const u of a)Mm(o,u),o=qu(o,u)}(e._query,t),new nt(e.firestore,e.converter,qu(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Gl extends ao{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Gl(e,t)}_apply(e){const t=function(i,s,o){if(null!==i.startAt)throw new A(E.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new A(E.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ns(s,o)}(e._query,this._field,this._direction);return new nt(e.firestore,e.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new ln(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class La extends ao{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new La(e,t,r)}_apply(e){return new nt(e.firestore,e.converter,ra(e._query,this._limit,this._limitType))}}class Ua extends ao{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ua(e,t,r)}_apply(e){const t=Nm(e,this.type,this._docOrFields,this._inclusive);return new nt(e.firestore,e.converter,(s=t,new ln((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class Ba extends ao{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ba(e,t,r)}_apply(e){const t=Nm(e,this.type,this._docOrFields,this._inclusive);return new nt(e.firestore,e.converter,(s=t,new ln((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function Nm(n,e,t,r){if(t[0]=(0,G.m9)(t[0]),t[0]instanceof oo)return function(s,o,a,u,c){if(!u)throw new A(E.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const d=[];for(const m of gi(s))if(m.field.isKeyField())d.push(pr(o,u.key));else{const p=u.data.field(m.field);if(Zo(p))throw new A(E.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===p){const T=m.field.canonicalString();throw new A(E.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${T}' (used as the orderBy) does not exist.`)}d.push(p)}return new Ln(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=xr(n.firestore);return function(o,a,u,c,d,m){const p=o.explicitOrderBy;if(d.length>p.length)throw new A(E.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const T=[];for(let S=0;S<d.length;S++){const V=d[S];if(p[S].field.isKeyField()){if("string"!=typeof V)throw new A(E.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof V}`);if(!Bu(o)&&-1!==V.indexOf("/"))throw new A(E.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${V}' contains a slash.`);const C=o.path.child(te.fromString(V));if(!N.isDocumentKey(C))throw new A(E.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${C}' is not because it contains an odd number of segments.`);const q=new N(C);T.push(pr(a,q))}else{const C=xm(u,c,V);T.push(C)}}return new Ln(T,m)}(n._query,n.firestore._databaseId,i,e,t,r)}}function km(n,e,t){if("string"==typeof(t=(0,G.m9)(t))){if(""===t)throw new A(E.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Bu(e)&&-1!==t.indexOf("/"))throw new A(E.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(te.fromString(t));if(!N.isDocumentKey(r))throw new A(E.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return pr(n,new N(r))}if(t instanceof ve)return pr(n,t._key);throw new A(E.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Va(t)}.`)}function Fm(n,e){if(!Array.isArray(n)||0===n.length)throw new A(E.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Mm(n,e){const t=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new A(E.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class zl{convertValue(e,t="none"){switch(Mn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return be(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(cn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw F()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Dn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Da(be(e.latitude),be(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Yo(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Cs(e));default:return null}}convertTimestamp(e){const t=Nn(e);return new Pe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=te.fromString(e);L(Kd(r));const i=new kn(r.get(1),r.get(3)),s=new N(r.popFirst(5));return i.isEqual(t)||Fe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function qa(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Wy extends zl{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ve(this.firestore,null,t)}}class Vr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class pn extends oo{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new co(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Oa("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class co extends pn{data(e={}){return super.data(e)}}class Kn{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Vr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new co(this._firestore,this._userDataWriter,r.key,r,new Vr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new A(E.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>({type:"added",doc:new co(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Vr(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||3!==a.type).map(a=>{const u=new co(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Vr(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,d=-1;return 0!==a.type&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),1!==a.type&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:Zy(a.type),doc:u,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Zy(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F()}}function Lm(n,e){return n instanceof pn&&e instanceof pn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Kn&&e instanceof Kn&&n._firestore===e._firestore&&Dl(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class Qn extends zl{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ve(this.firestore,null,t)}}function Um(n,e,t){n=ee(n,ve);const r=ee(n.firestore,Te),i=qa(n.converter,e,t);return qi(r,[ka(xr(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,Se.none())])}function Bm(n,e,t,...r){n=ee(n,ve);const i=ee(n.firestore,Te),s=xr(i);let o;return o="string"==typeof(e=(0,G.m9)(e))||e instanceof gn?Ul(s,"updateDoc",n._key,e,t,r):Ll(s,"updateDoc",n._key,e),qi(i,[o.toMutation(n._key,Se.exists(!0))])}function qm(n,...e){var t,r,i;n=(0,G.m9)(n);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||Nl(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Nl(e[o])){const m=e[o];e[o]=null===(t=m.next)||void 0===t?void 0:t.bind(m),e[o+1]=null===(r=m.error)||void 0===r?void 0:r.bind(m),e[o+2]=null===(i=m.complete)||void 0===i?void 0:i.bind(m)}let u,c,d;if(n instanceof ve)c=ee(n.firestore,Te),d=mi(n._key.path),u={next:m=>{e[o]&&e[o](jl(c,n,m))},error:e[o+1],complete:e[o+2]};else{const m=ee(n,nt);c=ee(m.firestore,Te),d=m._query;const p=new Qn(c);u={next:T=>{e[o]&&e[o](new Kn(c,p,m,T))},error:e[o+1],complete:e[o+2]},Dm(n._query)}return function(p,T,S,V){const C=new Sa(V),q=new Wc(T,C,S);return p.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return Gc(yield Ui(p),q)})),()=>{C.Qa(),p.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return jc(yield Ui(p),q)}))}}(De(c),d,a,u)}function qi(n,e){return function(r,i){const s=new ze;return r.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return function $_(n,e,t){return nl.apply(this,arguments)}(yield Cl(r),i,s)})),s.promise}(De(n),e)}function jl(n,e,t){const r=t.docs.get(e._key),i=new Qn(n);return new pn(n,i,e._key,r,new Vr(t.hasPendingWrites,t.fromCache),e.converter)}const mT={maxAttempts:5};class Gm{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=xr(e)}set(e,t,r){this._verifyNotCommitted();const i=Wn(e,this._firestore),s=qa(i.converter,t,r),o=ka(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(o.toMutation(i._key,Se.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=Wn(e,this._firestore);let o;return o="string"==typeof(t=(0,G.m9)(t))||t instanceof gn?Ul(this._dataReader,"WriteBatch.update",s._key,t,r,i):Ll(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Se.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Wn(e,this._firestore);return this._mutations=this._mutations.concat(new Ii(t._key,Se.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new A(E.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Wn(n,e){if((n=(0,G.m9)(n)).firestore!==e)throw new A(E.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class gT extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=xr(t)}get(t){const r=Wn(t,this._firestore),i=new Wy(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||1!==s.length)return F();const o=s[0];if(o.isFoundDocument())return new oo(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new oo(this._firestore,i,r._key,null,r.converter);throw F()})}set(t,r,i){const s=Wn(t,this._firestore),o=qa(s.converter,r,i),a=ka(this._dataReader,"Transaction.set",s._key,o,null!==s.converter,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){const o=Wn(t,this._firestore);let a;return a="string"==typeof(r=(0,G.m9)(r))||r instanceof gn?Ul(this._dataReader,"Transaction.update",o._key,r,i,s):Ll(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Wn(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Wn(e,this._firestore),r=new Qn(this._firestore);return super.get(e).then(i=>new pn(this._firestore,r,t._key,i._document,new Vr(!1,!1),t.converter))}}function Kl(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new A("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Km(){if(typeof Uint8Array>"u")throw new A("unimplemented","Uint8Arrays are not available in this environment.")}function Qm(){if(!function Hg(){return typeof atob<"u"}())throw new A("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){oi=$.SDK_VERSION,(0,$._registerComponent)(new se.wA("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new Te(new Tg(r.getProvider("auth-internal")),new vg(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new A(E.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new kn(c.options.projectId,d)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),(0,$.registerVersion)(yh,"4.5.1",e),(0,$.registerVersion)(yh,"4.5.1","esm2017")}();class lo{constructor(e){this._delegate=e}static fromBase64String(e){return Qm(),new lo(Xt.fromBase64String(e))}static fromUint8Array(e){return Km(),new lo(Xt.fromUint8Array(e))}toBase64(){return Qm(),this._delegate.toBase64()}toUint8Array(){return Km(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Ql(n){return function RT(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class PT{enableIndexedDbPersistence(e,t){return function Py(n,e){Am(n=ee(n,Te));const t=De(n);if(t._uninitializedComponentsProvider)throw new A(E.FAILED_PRECONDITION,"SDK cache is already specified.");mt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new Oi;return wm(t,i,new vl(i,r.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function Sy(n){Am(n=ee(n,Te));const e=De(n);if(e._uninitializedComponentsProvider)throw new A(E.FAILED_PRECONDITION,"SDK cache is already specified.");mt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new Oi;return wm(e,r,new im(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function xy(n){if(n._initialized&&!n._terminated)throw new A(E.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new ze;return n._queue.enqueueAndForgetEvenWhileRestricted((0,w.Z)(function*(){try{yield(t=(0,w.Z)(function*(i){if(!bt.D())return Promise.resolve();const s=i+"main";yield bt.delete(s)}),function r(i){return t.apply(this,arguments)})(hc(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Wm{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof kn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&mt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function Tm(n,e,t,r={}){var i;const s=(n=ee(n,no))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&mt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if("string"==typeof r.mockUserToken)a=r.mockUserToken,u=We.MOCK_USER;else{a=(0,G.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new A(E.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new We(c)}n._authCredentials=new yg(new Th(a,u))}}(this._delegate,e,t,r)}enableNetwork(){return function Vy(n){return function dy(n){return n.asyncQueue.enqueue((0,w.Z)(function*(){const e=yield am(n),t=yield um(n);return e.setNetworkEnabled(!0),function(i){const s=b(i);return s.v_.delete(0),eo(s)}(t)}))}(De(n=ee(n,Te)))}(this._delegate)}disableNetwork(){return function by(n){return function fy(n){return n.asyncQueue.enqueue((0,w.Z)(function*(){const e=yield am(n),t=yield um(n);return e.setNetworkEnabled(!1),(r=(0,w.Z)(function*(s){const o=b(s);o.v_.add(0),yield Ci(o),o.x_.set("Offline")}),function i(s){return r.apply(this,arguments)})(t);var r}))}(De(n=ee(n,Te)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,mm("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function Cy(n){return function(t){const r=new ze;return t.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return function H_(n,e){return al.apply(this,arguments)}(yield Cl(t),r)})),r.promise}(De(n=ee(n,Te)))}(this._delegate)}onSnapshotsInSync(e){return function sT(n,e){return function py(n,e){const t=new Sa(e);return n.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return i=yield Ui(n),s=t,b(i).W_.add(s),void s.next();var i,s})),()=>{t.Qa(),n.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return i=yield Ui(n),s=t,void b(i).W_.delete(s);var i,s}))}}(De(n=ee(n,Te)),Nl(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new A("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Gi(this,Im(this._delegate,e))}catch(t){throw lt(t,"collection()","Firestore.collection()")}}doc(e){try{return new Dt(this,ba(this._delegate,e))}catch(t){throw lt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ht(this,function vy(n,e){if(n=ee(n,no),bl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new A(E.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new nt(n,null,(r=e,new ln(te.emptyPath(),r)));var r}(this._delegate,e))}catch(t){throw lt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function pT(n,e,t){n=ee(n,Te);const r=Object.assign(Object.assign({},mT),t);return function(s){if(s.maxAttempts<1)throw new A(E.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){const u=new ze;return s.asyncQueue.enqueueAndForget((0,w.Z)(function*(){const c=yield function cm(n){return Ca(n).then(e=>e.datastore)}(s);new ly(s.asyncQueue,c,a,o,u).Ya()})),u.promise}(De(n),i=>e(new gT(n,i)),r)}(this._delegate,t=>e(new Hm(this,t)))}batch(){return De(this._delegate),new Zm(new Gm(this._delegate,e=>qi(this._delegate,e)))}loadBundle(e){return function Dy(n,e){const t=De(n=ee(n,Te)),r=new Ay;return function _y(n,e,t,r){const i=function(o,a){let u;return u="string"==typeof o?Sd().encode(o):o,d=function(d,m){if(d instanceof Uint8Array)return sm(d,m);if(d instanceof ArrayBuffer)return sm(new Uint8Array(d),m);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),new uy(d,a);var d}(t,Js(e));n.asyncQueue.enqueueAndForget((0,w.Z)(function*(){!function oy(n,e,t){const r=b(n);var i;(i=(0,w.Z)(function*(o,a,u){try{const c=yield a.getMetadata();if(yield function(S,V){const C=b(S),q=Me(V.createTime);return C.persistence.runTransaction("hasNewerBundle","readonly",W=>C.$r.getBundleMetadata(W,V.id)).then(W=>!!W&&W.createTime.compareTo(q)>=0)}(o.localStore,c))return yield a.close(),u._completeWith({taskState:"Success",documentsLoaded:(S=c).totalDocuments,bytesLoaded:S.totalBytes,totalDocuments:S.totalDocuments,totalBytes:S.totalBytes}),Promise.resolve(new Set);u._updateProgress(Wf(c));const d=new O_(c,o.localStore,a.serializer);let m=yield a.Ba();for(;m;){const T=yield d.sa(m);T&&u._updateProgress(T),m=yield a.Ba()}const p=yield d.complete();return yield mn(o,p.aa,void 0),yield function(S,V){const C=b(S);return C.persistence.runTransaction("Save bundle","readwrite",q=>C.$r.saveBundleMetadata(q,V))}(o.localStore,c),u._completeWith(p.progress),Promise.resolve(p._a)}catch(c){return mt("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}var S}),function s(o,a,u){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield Cl(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function Ny(n,e){return function yy(n,e){return n.asyncQueue.enqueue((0,w.Z)(function*(){return function(r,i){const s=b(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.$r.getNamedQuery(o,i))}(yield Li(n),e)}))}(De(n=ee(n,Te)),e).then(t=>t?new nt(n,null,t.query):null)}(this._delegate,e).then(t=>t?new ht(this,t):null)}}class za extends zl{constructor(e){super(),this.firestore=e}convertBytes(e){return new lo(new Xt(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Dt.forKey(t,this.firestore,null)}}class Hm{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new za(e)}get(e){const t=Dr(e);return this._delegate.get(t).then(r=>new ho(this._firestore,new pn(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=Dr(e);return r?(Kl("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=Dr(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=Dr(e);return this._delegate.delete(t),this}}class Zm{constructor(e){this._delegate=e}set(e,t,r){const i=Dr(e);return r?(Kl("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=Dr(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=Dr(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class br{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new co(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new fo(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=br.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new br(e,new za(e),t),i.set(t,s)),s}}br.INSTANCES=new WeakMap;class Dt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new za(e)}static forPath(e,t,r){if(e.length%2!=0)throw new A("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Dt(t,new ve(t._delegate,r,new N(e)))}static forKey(e,t,r){return new Dt(t,new ve(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Gi(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Gi(this.firestore,Im(this._delegate,e))}catch(t){throw lt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,G.m9)(e))instanceof ve&&Em(this._delegate,e)}set(e,t){t=Kl("DocumentReference.set",t);try{return t?Um(this._delegate,e,t):Um(this._delegate,e)}catch(r){throw lt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Bm(this._delegate,e):Bm(this._delegate,e,t,...r)}catch(i){throw lt(i,"updateDoc()","DocumentReference.update()")}}delete(){return function rT(n){return qi(ee(n.firestore,Te),[new Ii(n._key,Se.none())])}(this._delegate)}onSnapshot(...e){const t=Ym(e),r=Xm(e,i=>new ho(this.firestore,new pn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return qm(this._delegate,t,r)}get(e){let t;return t="cache"===e?.source?function Xy(n){n=ee(n,ve);const e=ee(n.firestore,Te),t=De(e),r=new Qn(e);return function my(n,e){const t=new ze;return n.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return(r=(0,w.Z)(function*(s,o,a){try{const u=yield function(d,m){const p=b(d);return p.persistence.runTransaction("read document","readonly",T=>p.localDocuments.getDocument(T,m))}(s,o);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new A(E.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){const c=Ni(u,`Failed to get document '${o} from cache`);a.reject(c)}}),function i(s,o,a){return r.apply(this,arguments)})(yield Li(n),e,t);var r})),t.promise}(t,n._key).then(i=>new pn(e,r,n._key,i,new Vr(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===e?.source?function Jy(n){n=ee(n,ve);const e=ee(n.firestore,Te);return lm(De(e),n._key,{source:"server"}).then(t=>jl(e,n,t))}(this._delegate):function Yy(n){n=ee(n,ve);const e=ee(n.firestore,Te);return lm(De(e),n._key).then(t=>jl(e,n,t))}(this._delegate),t.then(r=>new ho(this.firestore,new pn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Dt(this.firestore,this._delegate.withConverter(e?br.getInstance(this.firestore,e):null))}}function lt(n,e,t){return n.message=n.message.replace(e,t),n}function Ym(n){for(const e of n)if("object"==typeof e&&!Ql(e))return e;return{}}function Xm(n,e){var t,r;let i;return i=Ql(n[0])?n[0]:Ql(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class ho{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Dt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Lm(this._delegate,e._delegate)}}class fo extends ho{data(e){const t=this._delegate.data(e);return this._delegate._converter||function pg(n,e){n||F()}(void 0!==t),t}}class ht{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new za(e)}where(e,t,r){try{return new ht(this.firestore,$n(this._delegate,function By(n,e,t){const r=e,i=Oa("where",n);return uo._create(i,r,t)}(e,t,r)))}catch(i){throw lt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new ht(this.firestore,$n(this._delegate,function qy(n,e="asc"){const t=e,r=Oa("orderBy",n);return Gl._create(r,t)}(e,t)))}catch(r){throw lt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new ht(this.firestore,$n(this._delegate,function Gy(n){return _m("limit",n),La._create("limit",n,"F")}(e)))}catch(t){throw lt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new ht(this.firestore,$n(this._delegate,function zy(n){return _m("limitToLast",n),La._create("limitToLast",n,"L")}(e)))}catch(t){throw lt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new ht(this.firestore,$n(this._delegate,function jy(...n){return Ua._create("startAt",n,!0)}(...e)))}catch(t){throw lt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new ht(this.firestore,$n(this._delegate,function $y(...n){return Ua._create("startAfter",n,!1)}(...e)))}catch(t){throw lt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new ht(this.firestore,$n(this._delegate,function Ky(...n){return Ba._create("endBefore",n,!1)}(...e)))}catch(t){throw lt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new ht(this.firestore,$n(this._delegate,function Qy(...n){return Ba._create("endAt",n,!0)}(...e)))}catch(t){throw lt(t,"endAt()","Query.endAt()")}}isEqual(e){return Dl(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function tT(n){n=ee(n,nt);const e=ee(n.firestore,Te),t=De(e),r=new Qn(e);return function gy(n,e){const t=new ze;return n.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return(r=(0,w.Z)(function*(s,o,a){try{const u=yield Ta(s,o,!0),c=new Yf(o,u.hs),d=c.Ta(u.documents),m=c.applyChanges(d,!1);a.resolve(m.snapshot)}catch(u){const c=Ni(u,`Failed to execute query '${o} against cache`);a.reject(c)}}),function i(s,o,a){return r.apply(this,arguments)})(yield Li(n),e,t);var r})),t.promise}(t,n._query).then(i=>new Kn(e,r,n,i))}(this._delegate):"server"===e?.source?function nT(n){n=ee(n,nt);const e=ee(n.firestore,Te),t=De(e),r=new Qn(e);return hm(t,n._query,{source:"server"}).then(i=>new Kn(e,r,n,i))}(this._delegate):function eT(n){n=ee(n,nt);const e=ee(n.firestore,Te),t=De(e),r=new Qn(e);return Dm(n._query),hm(t,n._query).then(i=>new Kn(e,r,n,i))}(this._delegate),t.then(r=>new Wl(this.firestore,new Kn(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=Ym(e),r=Xm(e,i=>new Wl(this.firestore,new Kn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return qm(this._delegate,t,r)}withConverter(e){return new ht(this.firestore,this._delegate.withConverter(e?br.getInstance(this.firestore,e):null))}}class xT{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new fo(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Wl{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ht(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new fo(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new xT(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new fo(this._firestore,r))})}isEqual(e){return Lm(this._delegate,e._delegate)}}class Gi extends ht{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Dt(this.firestore,e):null}doc(e){try{return new Dt(this.firestore,void 0===e?ba(this._delegate):ba(this._delegate,e))}catch(t){throw lt(t,"doc()","CollectionReference.doc()")}}add(e){return function iT(n,e){const t=ee(n.firestore,Te),r=ba(n),i=qa(n.converter,e);return qi(t,[ka(xr(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,Se.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Dt(this.firestore,t))}isEqual(e){return Em(this._delegate,e._delegate)}withConverter(e){return new Gi(this.firestore,this._delegate.withConverter(e?br.getInstance(this.firestore,e):null))}}function Dr(n){return ee(n,ve)}class Hl{constructor(...e){this._delegate=new gn(...e)}static documentId(){return new Hl(Ie.keyField().canonicalString())}isEqual(e){return(e=(0,G.m9)(e))instanceof gn&&this._delegate._internalPath.isEqual(e._internalPath)}}class Nr{constructor(e){this._delegate=e}static serverTimestamp(){const e=function yT(){return new kl("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new Nr(e)}static delete(){const e=function _T(){return new io("deleteField")}();return e._methodName="FieldValue.delete",new Nr(e)}static arrayUnion(...e){const t=function TT(...n){return new Fl("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new Nr(t)}static arrayRemove(...e){const t=function IT(...n){return new Ml("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new Nr(t)}static increment(e){const t=function ET(n){return new Ol("increment",n)}(e);return t._methodName="FieldValue.increment",new Nr(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const CT={Firestore:Wm,GeoPoint:Da,Timestamp:Pe,Blob:lo,Transaction:Hm,WriteBatch:Zm,DocumentReference:Dt,DocumentSnapshot:ho,Query:ht,QueryDocumentSnapshot:fo,QuerySnapshot:Wl,CollectionReference:Gi,FieldPath:Hl,FieldValue:Nr,setLogLevel:function ST(n){!function gg(n){Cn.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};function Jm(n,e){return function DT(n,e=qt.z){return new wt.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}(n,e)}function Zl(n,e){return Jm(n,e).pipe((0,z.U)(t=>({payload:t,type:"query"})))}!function bT(n){(function VT(n,e){n.INTERNAL.registerComponent(new se.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},CT)))})(n,(e,t)=>new Wm(e,t,new PT)),n.registerVersion("@firebase/firestore-compat","0.3.28")}(ji.Z),x(7142);class eg{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:s}=ig(r,t);return new rg(i,s,this.afs)}snapshotChanges(){return function NT(n,e){return Jm(n,e).pipe((0,Z.O)(void 0),(0,me.G)(),(0,z.U)(t=>{const[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(v.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,z.U)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,re.D)(this.ref.get(e)).pipe(v.iC)}}function ja(n,e){return Zl(n,e).pipe((0,Z.O)(void 0),(0,me.G)(),(0,z.U)(t=>{const[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{const c=s.find(m=>m.doc.ref.isEqual(a.ref)),d=r?.payload.docs.find(m=>m.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function tg(n,e,t){return ja(n,t).pipe((0,ue.R)((r,i)=>function kT(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function FT(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return Yl(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return Yl(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Yl(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(s=>s.payload),e),[]),(0,Ye.x)(),(0,z.U)(r=>r.map(i=>({type:i.type,payload:i}))))}function Yl(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function ng(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class rg{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=ja(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,z.U)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,Z.O)(void 0),(0,me.G)(),(0,rt.h)(([r,i])=>i.length>0||!r),(0,z.U)(([,r])=>r),v.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,ue.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=ng(e);return tg(this.query,t,this.afs.schedulers.outsideAngular).pipe(v.iC)}valueChanges(e={}){return Zl(this.query,this.afs.schedulers.outsideAngular).pipe((0,z.U)(t=>t.payload.docs.map(r=>e.idField?{...r.data(),[e.idField]:r.id}:r.data())),v.iC)}get(e){return(0,re.D)(this.query.get(e)).pipe(v.iC)}add(e){return this.ref.add(e)}doc(e){return new eg(this.ref.doc(e),this.afs)}}class MT{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?ja(this.query,this.afs.schedulers.outsideAngular).pipe((0,z.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,rt.h)(t=>t.length>0),v.iC):ja(this.query,this.afs.schedulers.outsideAngular).pipe(v.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,ue.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=ng(e);return tg(this.query,t,this.afs.schedulers.outsideAngular).pipe(v.iC)}valueChanges(e={}){return Zl(this.query,this.afs.schedulers.outsideAngular).pipe((0,z.U)(r=>r.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),v.iC)}get(e){return(0,re.D)(this.query.get(e)).pipe(v.iC)}}const OT=new Y.OlP("angularfire2.enableFirestorePersistence"),LT=new Y.OlP("angularfire2.firestore.persistenceSettings"),UT=new Y.OlP("angularfire2.firestore.settings"),BT=new Y.OlP("angularfire2.firestore.use-emulator");function ig(n,e=(t=>t)){return{query:e(n),ref:n}}let qT=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,u,c,d,m,p,T,S,V,C,q,W){this.schedulers=u;const U=(0,Ne.on)(t,a,r),H=d;m&&(0,$e.nw)(U,a,p,S,V,C,T,q),[this.firestore,this.persistenceEnabled$]=(0,Ne.cc)(`${U.name}.firestore`,"AngularFirestore",U.name,()=>{const ae=a.runOutsideAngular(()=>U.firestore());if(s&&ae.settings(s),H&&ae.useEmulator(...H),i&&!(0,we.PM)(o)){const ce=()=>{try{return(0,re.D)(ae.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(Oe){return typeof console<"u"&&console.warn(Oe),(0,dt.of)(!1)}};return[ae,a.runOutsideAngular(ce)]}return[ae,(0,dt.of)(!1)]},[s,H,i])}collection(t,r){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:o}=ig(i,r),a=this.schedulers.ngZone.run(()=>s);return new rg(a,o,this)}collectionGroup(t,r){const i=r||(o=>o),s=this.firestore.collectionGroup(t);return new MT(i(s),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const i=this.schedulers.ngZone.run(()=>r);return new eg(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(Y.LFG(Ne.Dh),Y.LFG(Ne.xv,8),Y.LFG(OT,8),Y.LFG(UT,8),Y.LFG(Y.Lbi),Y.LFG(Y.R0b),Y.LFG(v.HU),Y.LFG(LT,8),Y.LFG(BT,8),Y.LFG($e.zQ,8),Y.LFG($e.Qv,8),Y.LFG($e.L6,8),Y.LFG($e._Q,8),Y.LFG($e.rT,8),Y.LFG($e.lh,8),Y.LFG($e.f7,8),Y.LFG(v.Rf,8))};static \u0275prov=Y.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})()},4186:(zi,vt,x)=>{x.d(vt,{Q1:()=>Iu});var we=x(1920),Y=x(5592),v=x(2096),Ne=x(2459),$e=x(3620),qt=x(7398),wt=x(4664),re=x(5879),dt=x(7217),Z=x(3106),me=x(5861),z=x(4303),ue=x(9058),Ye=x(4537);const rt="firebasestorage.googleapis.com",Gt="storageBucket";class se extends ue.ZR{constructor(l,f,g=0){super(G(l),`Firebase Storage: ${f} (${G(l)})`),this.status_=g,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,se.prototype)}get status(){return this.status_}set status(l){this.status_=l}_codeEquals(l){return G(l)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(l){this.customData.serverResponse=l,this.message=this.customData.serverResponse?`${this._baseMessage}\n${this.customData.serverResponse}`:this._baseMessage}}var k=function(h){return h.UNKNOWN="unknown",h.OBJECT_NOT_FOUND="object-not-found",h.BUCKET_NOT_FOUND="bucket-not-found",h.PROJECT_NOT_FOUND="project-not-found",h.QUOTA_EXCEEDED="quota-exceeded",h.UNAUTHENTICATED="unauthenticated",h.UNAUTHORIZED="unauthorized",h.UNAUTHORIZED_APP="unauthorized-app",h.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",h.INVALID_CHECKSUM="invalid-checksum",h.CANCELED="canceled",h.INVALID_EVENT_NAME="invalid-event-name",h.INVALID_URL="invalid-url",h.INVALID_DEFAULT_BUCKET="invalid-default-bucket",h.NO_DEFAULT_BUCKET="no-default-bucket",h.CANNOT_SLICE_BLOB="cannot-slice-blob",h.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",h.NO_DOWNLOAD_URL="no-download-url",h.INVALID_ARGUMENT="invalid-argument",h.INVALID_ARGUMENT_COUNT="invalid-argument-count",h.APP_DELETED="app-deleted",h.INVALID_ROOT_OPERATION="invalid-root-operation",h.INVALID_FORMAT="invalid-format",h.INTERNAL_ERROR="internal-error",h.UNSUPPORTED_ENVIRONMENT="unsupported-environment",h}(k||{});function G(h){return"storage/"+h}function _t(){return new se(k.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function _n(){return new se(k.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function mo(){return new se(k.CANCELED,"User canceled the upload/download.")}function go(){return new se(k.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function ut(h){return new se(k.INVALID_ARGUMENT,h)}function po(){return new se(k.APP_DELETED,"The Firebase app was deleted.")}function Qi(h){return new se(k.INVALID_ROOT_OPERATION,"The operation '"+h+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Jt(h,l){return new se(k.INVALID_FORMAT,"String does not match format '"+h+"': "+l)}function yn(h){throw new se(k.INTERNAL_ERROR,"Internal error: "+h)}class oe{constructor(l,f){this.bucket=l,this.path_=f}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const l=encodeURIComponent;return"/b/"+l(this.bucket)+"/o/"+l(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(l,f){let g;try{g=oe.makeFromUrl(l,f)}catch{return new oe(l,"")}if(""===g.path)return g;throw function $a(h){return new se(k.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+h+"'.")}(l)}static makeFromUrl(l,f){let g=null;const _="([A-Za-z0-9.\\-_]+)",O=new RegExp("^gs://"+_+"(/(.*))?$","i");function K(Ve){Ve.path_=decodeURIComponent(Ve.path)}const Ae=f.replace(/[.]/g,"\\."),Ue=[{regex:O,indices:{bucket:1,path:3},postModify:function I(Ve){"/"===Ve.path.charAt(Ve.path.length-1)&&(Ve.path_=Ve.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${Ae}/v[A-Za-z0-9_]+/b/${_}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:K},{regex:new RegExp(`^https?://${f===rt?"(?:storage.googleapis.com|storage.cloud.google.com)":f}/${_}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:K}];for(let Ve=0;Ve<Ue.length;Ve++){const an=Ue[Ve],$t=an.regex.exec(l);if($t){let Sn=$t[an.indices.path];Sn||(Sn=""),g=new oe($t[an.indices.bucket],Sn),an.postModify(g);break}}if(null==g)throw function Ki(h){return new se(k.INVALID_URL,"Invalid URL '"+h+"'.")}(l);return g}}class Qa{constructor(l){this.promise_=Promise.reject(l)}getPromise(){return this.promise_}cancel(l=!1){}}function Or(h){return"string"==typeof h||h instanceof String}function en(h){return Lr()&&h instanceof Blob}function Lr(){return typeof Blob<"u"}function Zn(h,l,f,g){if(g<l)throw ut(`Invalid value for '${h}'. Expected ${l} or greater.`);if(g>f)throw ut(`Invalid value for '${h}'. Expected ${f} or less.`)}function Rt(h,l,f){let g=l;return null==f&&(g=`https://${l}`),`${f}://${g}/v0${h}`}function _o(h){const l=encodeURIComponent;let f="?";for(const g in h)h.hasOwnProperty(g)&&(f=f+(l(g)+"=")+l(h[g])+"&");return f=f.slice(0,-1),f}var tn=function(h){return h[h.NO_ERROR=0]="NO_ERROR",h[h.NETWORK_ERROR=1]="NETWORK_ERROR",h[h.ABORT=2]="ABORT",h}(tn||{});function Ur(h,l){const f=h>=500&&h<600,_=-1!==[408,429].indexOf(h),I=-1!==l.indexOf(h);return f||_||I}class Hi{constructor(l,f,g,_,I,P,O,M,K,J,Ae,_e=!0){this.url_=l,this.method_=f,this.headers_=g,this.body_=_,this.successCodes_=I,this.additionalRetryCodes_=P,this.callback_=O,this.errorCallback_=M,this.timeout_=K,this.progressCallback_=J,this.connectionFactory_=Ae,this.retry=_e,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((de,Re)=>{this.resolve_=de,this.reject_=Re,this.start_()})}start_(){const f=(g,_)=>{const I=this.resolve_,P=this.reject_,O=_.connection;if(_.wasSuccessCode)try{const M=this.callback_(O,O.getResponse());!function At(h){return void 0!==h}(M)?I():I(M)}catch(M){P(M)}else if(null!==O){const M=_t();M.serverResponse=O.getErrorText(),P(this.errorCallback_?this.errorCallback_(O,M):M)}else P(_.canceled?this.appDelete_?po():mo():_n())};this.canceled_?f(0,new Tn(!1,null,!0)):this.backoffId_=function Hn(h,l,f){let g=1,_=null,I=null,P=!1,O=0;function M(){return 2===O}let K=!1;function J(...Ce){K||(K=!0,l.apply(null,Ce))}function Ae(Ce){_=setTimeout(()=>{_=null,h(de,M())},Ce)}function _e(){I&&clearTimeout(I)}function de(Ce,...Ut){if(K)return void _e();if(Ce)return _e(),void J.call(null,Ce,...Ut);if(M()||P)return _e(),void J.call(null,Ce,...Ut);let Ue;g<64&&(g*=2),1===O?(O=2,Ue=0):Ue=1e3*(g+Math.random()),Ae(Ue)}let Re=!1;function xe(Ce){Re||(Re=!0,_e(),!K&&(null!==_?(Ce||(O=2),clearTimeout(_),Ae(0)):Ce||(O=1)))}return Ae(0),I=setTimeout(()=>{P=!0,xe(!0)},f),xe}((g,_)=>{if(_)return void g(!1,new Tn(!1,null,!0));const I=this.connectionFactory_();this.pendingConnection_=I;const P=O=>{null!==this.progressCallback_&&this.progressCallback_(O.loaded,O.lengthComputable?O.total:-1)};null!==this.progressCallback_&&I.addUploadProgressListener(P),I.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&I.removeUploadProgressListener(P),this.pendingConnection_=null;const O=I.getErrorCode()===tn.NO_ERROR,M=I.getStatus();if(!O||Ur(M,this.additionalRetryCodes_)&&this.retry){const J=I.getErrorCode()===tn.ABORT;return void g(!1,new Tn(!1,null,J))}const K=-1!==this.successCodes_.indexOf(M);g(!0,new Tn(K,I))})},f,this.timeout_)}getPromise(){return this.promise_}cancel(l){this.canceled_=!0,this.appDelete_=l||!1,null!==this.backoffId_&&function Mr(h){h(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Tn{constructor(l,f,g){this.wasSuccessCode=l,this.connection=f,this.canceled=!!g}}function Xn(...h){const l=function Za(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}();if(void 0!==l){const f=new l;for(let g=0;g<h.length;g++)f.append(h[g]);return f.getBlob()}if(Lr())return new Blob(h);throw new se(k.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const Qe={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Jn{constructor(l,f){this.data=l,this.contentType=f||null}}function Xi(h,l){switch(h){case Qe.RAW:return new Jn(Ji(l));case Qe.BASE64:case Qe.BASE64URL:return new Jn(es(h,l));case Qe.DATA_URL:return new Jn(function ts(h){const l=new er(h);return l.base64?es(Qe.BASE64,l.rest):function To(h){let l;try{l=decodeURIComponent(h)}catch{throw Jt(Qe.DATA_URL,"Malformed data URL.")}return Ji(l)}(l.rest)}(l),function ns(h){return new er(h).contentType}(l))}throw _t()}function Ji(h){const l=[];for(let f=0;f<h.length;f++){let g=h.charCodeAt(f);g<=127?l.push(g):g<=2047?l.push(192|g>>6,128|63&g):55296==(64512&g)?f<h.length-1&&56320==(64512&h.charCodeAt(f+1))?(g=65536|(1023&g)<<10|1023&h.charCodeAt(++f),l.push(240|g>>18,128|g>>12&63,128|g>>6&63,128|63&g)):l.push(239,191,189):56320==(64512&g)?l.push(239,191,189):l.push(224|g>>12,128|g>>6&63,128|63&g)}return new Uint8Array(l)}function es(h,l){switch(h){case Qe.BASE64:{const _=-1!==l.indexOf("-"),I=-1!==l.indexOf("_");if(_||I)throw Jt(h,"Invalid character '"+(_?"-":"_")+"' found: is it base64url encoded?");break}case Qe.BASE64URL:{const _=-1!==l.indexOf("+"),I=-1!==l.indexOf("/");if(_||I)throw Jt(h,"Invalid character '"+(_?"+":"/")+"' found: is it base64 encoded?");l=l.replace(/-/g,"+").replace(/_/g,"/");break}}let f;try{f=function Xa(h){if(typeof atob>"u")throw function Le(h){return new se(k.UNSUPPORTED_ENVIRONMENT,`${h} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}("base-64");return atob(h)}(l)}catch(_){throw _.message.includes("polyfill")?_:Jt(h,"Invalid character found")}const g=new Uint8Array(f.length);for(let _=0;_<f.length;_++)g[_]=f.charCodeAt(_);return g}class er{constructor(l){this.base64=!1,this.contentType=null;const f=l.match(/^data:([^,]+)?,/);if(null===f)throw Jt(Qe.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const g=f[1]||null;null!=g&&(this.base64=function rs(h,l){return h.length>=l.length&&h.substring(h.length-l.length)===l}(g,";base64"),this.contentType=this.base64?g.substring(0,g.length-7):g),this.rest=l.substring(l.indexOf(",")+1)}}class ft{constructor(l,f){let g=0,_="";en(l)?(this.data_=l,g=l.size,_=l.type):l instanceof ArrayBuffer?(f?this.data_=new Uint8Array(l):(this.data_=new Uint8Array(l.byteLength),this.data_.set(new Uint8Array(l))),g=this.data_.length):l instanceof Uint8Array&&(f?this.data_=l:(this.data_=new Uint8Array(l.length),this.data_.set(l)),g=l.length),this.size_=g,this.type_=_}size(){return this.size_}type(){return this.type_}slice(l,f){if(en(this.data_)){const _=function Ya(h,l,f){return h.webkitSlice?h.webkitSlice(l,f):h.mozSlice?h.mozSlice(l,f):h.slice?h.slice(l,f):null}(this.data_,l,f);return null===_?null:new ft(_)}{const g=new Uint8Array(this.data_.buffer,l,f-l);return new ft(g,!0)}}static getBlob(...l){if(Lr()){const f=l.map(g=>g instanceof ft?g.data_:g);return new ft(Xn.apply(null,f))}{const f=l.map(P=>Or(P)?Xi(Qe.RAW,P).data:P.data_);let g=0;f.forEach(P=>{g+=P.byteLength});const _=new Uint8Array(g);let I=0;return f.forEach(P=>{for(let O=0;O<P.length;O++)_[I++]=P[O]}),new ft(_,!0)}}uploadData(){return this.data_}}function Br(h){let l;try{l=JSON.parse(h)}catch{return null}return function Wa(h){return"object"==typeof h&&!Array.isArray(h)}(l)?l:null}function is(h){const l=h.lastIndexOf("/",h.length-2);return-1===l?h:h.slice(l+1)}function Eo(h,l){return l}class qe{constructor(l,f,g,_){this.server=l,this.local=f||l,this.writable=!!g,this.xform=_||Eo}}let tr=null;function nn(){if(tr)return tr;const h=[];h.push(new qe("bucket")),h.push(new qe("generation")),h.push(new qe("metageneration")),h.push(new qe("name","fullPath",!0));const f=new qe("name");f.xform=function l(I,P){return function eu(h){return!Or(h)||h.length<2?h:is(h)}(P)},h.push(f);const _=new qe("size");return _.xform=function g(I,P){return void 0!==P?Number(P):P},h.push(_),h.push(new qe("timeCreated")),h.push(new qe("updated")),h.push(new qe("md5Hash",null,!0)),h.push(new qe("cacheControl",null,!0)),h.push(new qe("contentDisposition",null,!0)),h.push(new qe("contentEncoding",null,!0)),h.push(new qe("contentLanguage",null,!0)),h.push(new qe("contentType",null,!0)),h.push(new qe("metadata","customMetadata",!0)),tr=h,tr}function ke(h,l,f){const g=Br(l);return null===g?null:function os(h,l,f){const g={type:"file"},_=f.length;for(let I=0;I<_;I++){const P=f[I];g[P.local]=P.xform(g,l[P.server])}return function ss(h,l){Object.defineProperty(h,"ref",{get:function f(){const I=new oe(h.bucket,h.fullPath);return l._makeStorageReference(I)}})}(g,h),g}(h,g,f)}function In(h,l){const f={},g=l.length;for(let _=0;_<g;_++){const I=l[_];I.writable&&(f[I.server]=h[I.local])}return JSON.stringify(f)}const qr="prefixes",vo="items";class yt{constructor(l,f,g,_){this.url=l,this.method=f,this.handler=g,this.timeout=_,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Pt(h){if(!h)throw _t()}function Gr(h,l){return function f(g,_){const I=ke(h,_,l);return Pt(null!==I),I}}function St(h){return function l(f,g){let _;return _=401===f.getStatus()?f.getErrorText().includes("Firebase App Check token is invalid")?function j(){return new se(k.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}():function $i(){return new se(k.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again.")}():402===f.getStatus()?function D(h){return new se(k.QUOTA_EXCEEDED,"Quota for bucket '"+h+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(h.bucket):403===f.getStatus()?function kr(h){return new se(k.UNAUTHORIZED,"User does not have permission to access '"+h+"'.")}(h.path):g,_.status=f.getStatus(),_.serverResponse=g.serverResponse,_}}function rn(h){const l=St(h);return function f(g,_){let I=l(g,_);return 404===g.getStatus()&&(I=function at(h){return new se(k.OBJECT_NOT_FOUND,"Object '"+h+"' does not exist.")}(h.path)),I.serverResponse=_.serverResponse,I}}function as(h,l,f){const _=Rt(l.fullServerUrl(),h.host,h._protocol),P=h.maxOperationRetryTime,O=new yt(_,"GET",Gr(h,f),P);return O.errorHandler=rn(l),O}function iu(h,l,f,g,_){const I={};I.prefix=l.isRoot?"":l.path+"/",f&&f.length>0&&(I.delimiter=f),g&&(I.pageToken=g),_&&(I.maxResults=_);const O=Rt(l.bucketOnlyServerUrl(),h.host,h._protocol),K=h.maxOperationRetryTime,J=new yt(O,"GET",function ru(h,l){return function f(g,_){const I=function nu(h,l,f){const g=Br(f);return null===g?null:function tu(h,l,f){const g={prefixes:[],items:[],nextPageToken:f.nextPageToken};if(f[qr])for(const _ of f[qr]){const I=_.replace(/\/$/,""),P=h._makeStorageReference(new oe(l,I));g.prefixes.push(P)}if(f[vo])for(const _ of f[vo]){const I=h._makeStorageReference(new oe(l,_.name));g.items.push(I)}return g}(h,l,g)}(h,l,_);return Pt(null!==I),I}}(h,l.bucket),K);return J.urlParams=I,J.errorHandler=St(l),J}function En(h,l,f){const g=Object.assign({},f);return g.fullPath=h.path,g.size=l.size(),g.contentType||(g.contentType=function su(h,l){return h&&h.contentType||l&&l.type()||"application/octet-stream"}(null,l)),g}class ir{constructor(l,f,g,_){this.current=l,this.total=f,this.finalized=!!g,this.metadata=_||null}}function zr(h,l){let f=null;try{f=h.getResponseHeader("X-Goog-Upload-Status")}catch{Pt(!1)}return Pt(!!f&&-1!==(l||["active"]).indexOf(f)),f}const au={STATE_CHANGED:"state_changed"},Xe={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function kt(h){switch(h){case"running":case"pausing":case"canceling":return Xe.RUNNING;case"paused":return Xe.PAUSED;case"success":return Xe.SUCCESS;case"canceled":return Xe.CANCELED;default:return Xe.ERROR}}class Ro{constructor(l,f,g){if(function Wi(h){return"function"==typeof h}(l)||null!=f||null!=g)this.next=l,this.error=f??void 0,this.complete=g??void 0;else{const I=l;this.next=I.next,this.error=I.error,this.complete=I.complete}}}function Ft(h){return(...l)=>{Promise.resolve().then(()=>h(...l))}}let hs=null;class sr{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=tn.NO_ERROR,this.sendPromise_=new Promise(l=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=tn.ABORT,l()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=tn.NETWORK_ERROR,l()}),this.xhr_.addEventListener("load",()=>{l()})})}send(l,f,g,_){if(this.sent_)throw yn("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(f,l,!0),void 0!==_)for(const I in _)_.hasOwnProperty(I)&&this.xhr_.setRequestHeader(I,_[I].toString());return void 0!==g?this.xhr_.send(g):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw yn("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw yn("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw yn("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw yn("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(l){return this.xhr_.getResponseHeader(l)}addUploadProgressListener(l){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",l)}removeUploadProgressListener(l){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",l)}}class Po extends sr{initXhr(){this.xhr_.responseType="text"}}function ge(){return hs?hs():new Po}class Kr{constructor(l,f,g=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=l,this._blob=f,this._metadata=g,this._mappings=nn(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=_=>{if(this._request=void 0,this._chunkMultiplier=1,_._codeEquals(k.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const I=this.isExponentialBackoffExpired();if(Ur(_.status,[])){if(!I)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();_=_n()}this._error=_,this._transition("error")}},this._metadataErrorHandler=_=>{this._request=void 0,_._codeEquals(k.CANCELED)?this.completeTransitions_():(this._error=_,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((_,I)=>{this._resolve=_,this._reject=I,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const l=this._transferred;return f=>this._updateProgress(l+f)}_shouldDoResumable(l){return l.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(l){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([f,g])=>{switch(this._state){case"running":l(f,g);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((l,f)=>{const g=function jr(h,l,f,g,_){const I=l.bucketOnlyServerUrl(),P=En(l,g,_),O={name:P.fullPath},M=Rt(I,h.host,h._protocol),J={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${g.size()}`,"X-Goog-Upload-Header-Content-Type":P.contentType,"Content-Type":"application/json; charset=utf-8"},Ae=In(P,f),Re=new yt(M,"POST",function de(xe){let Ce;zr(xe);try{Ce=xe.getResponseHeader("X-Goog-Upload-URL")}catch{Pt(!1)}return Pt(Or(Ce)),Ce},h.maxUploadRetryTime);return Re.urlParams=O,Re.headers=J,Re.body=Ae,Re.errorHandler=St(l),Re}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),_=this._ref.storage._makeRequest(g,ge,l,f);this._request=_,_.getPromise().then(I=>{this._request=void 0,this._uploadUrl=I,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const l=this._uploadUrl;this._resolveToken((f,g)=>{const _=function ou(h,l,f,g){const M=new yt(f,"POST",function I(K){const J=zr(K,["active","final"]);let Ae=null;try{Ae=K.getResponseHeader("X-Goog-Upload-Size-Received")}catch{Pt(!1)}Ae||Pt(!1);const _e=Number(Ae);return Pt(!isNaN(_e)),new ir(_e,g.size(),"final"===J)},h.maxUploadRetryTime);return M.headers={"X-Goog-Upload-Command":"query"},M.errorHandler=St(l),M}(this._ref.storage,this._ref._location,l,this._blob),I=this._ref.storage._makeRequest(_,ge,f,g);this._request=I,I.getPromise().then(P=>{this._request=void 0,this._updateProgress(P.current),this._needToFetchStatus=!1,P.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const l=262144*this._chunkMultiplier,f=new ir(this._transferred,this._blob.size()),g=this._uploadUrl;this._resolveToken((_,I)=>{let P;try{P=function vn(h,l,f,g,_,I,P,O){const M=new ir(0,0);if(P?(M.current=P.current,M.total=P.total):(M.current=0,M.total=g.size()),g.size()!==M.total)throw function Ke(){return new se(k.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}();const K=M.total-M.current;let J=K;_>0&&(J=Math.min(J,_));const Ae=M.current;let de="";de=0===J?"finalize":K===J?"upload, finalize":"upload";const Re={"X-Goog-Upload-Command":de,"X-Goog-Upload-Offset":`${M.current}`},xe=g.slice(Ae,Ae+J);if(null===xe)throw go();const Ue=new yt(f,"POST",function Ce(Ve,an){const $t=zr(Ve,["active","final"]),Pn=M.current+J,Sn=g.size();let xn;return xn="final"===$t?Gr(l,I)(Ve,an):null,new ir(Pn,Sn,"final"===$t,xn)},l.maxUploadRetryTime);return Ue.headers=Re,Ue.body=xe.uploadData(),Ue.progressCallback=O||null,Ue.errorHandler=St(h),Ue}(this._ref._location,this._ref.storage,g,this._blob,l,this._mappings,f,this._makeProgressCallback())}catch(M){return this._error=M,void this._transition("error")}const O=this._ref.storage._makeRequest(P,ge,_,I,!1);this._request=O,O.getPromise().then(M=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(M.current),M.finalized?(this._metadata=M.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){262144*this._chunkMultiplier*2<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((l,f)=>{const g=as(this._ref.storage,this._ref._location,this._mappings),_=this._ref.storage._makeRequest(g,ge,l,f);this._request=_,_.getPromise().then(I=>{this._request=void 0,this._metadata=I,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((l,f)=>{const g=function ls(h,l,f,g,_){const I=l.bucketOnlyServerUrl(),P={"X-Goog-Upload-Protocol":"multipart"},M=function O(){let Ue="";for(let Ve=0;Ve<2;Ve++)Ue+=Math.random().toString().slice(2);return Ue}();P["Content-Type"]="multipart/related; boundary="+M;const K=En(l,g,_),J=In(K,f),de=ft.getBlob("--"+M+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+J+"\r\n--"+M+"\r\nContent-Type: "+K.contentType+"\r\n\r\n",g,"\r\n--"+M+"--");if(null===de)throw go();const Re={name:K.fullPath},xe=Rt(I,h.host,h._protocol),Ut=h.maxUploadRetryTime,Ct=new yt(xe,"POST",Gr(h,f),Ut);return Ct.urlParams=Re,Ct.headers=P,Ct.body=de.uploadData(),Ct.errorHandler=St(l),Ct}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),_=this._ref.storage._makeRequest(g,ge,l,f);this._request=_,_.getPromise().then(I=>{this._request=void 0,this._metadata=I,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(l){const f=this._transferred;this._transferred=l,this._transferred!==f&&this._notifyObservers()}_transition(l){if(this._state!==l)switch(l){case"canceling":case"pausing":this._state=l,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const f="paused"===this._state;this._state=l,f&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=l,this._notifyObservers();break;case"canceled":this._error=mo(),this._state=l,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const l=kt(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:l,metadata:this._metadata,task:this,ref:this._ref}}on(l,f,g,_){const I=new Ro(f||void 0,g||void 0,_||void 0);return this._addObserver(I),()=>{this._removeObserver(I)}}then(l,f){return this._promise.then(l,f)}catch(l){return this.then(null,l)}_addObserver(l){this._observers.push(l),this._notifyObserver(l)}_removeObserver(l){const f=this._observers.indexOf(l);-1!==f&&this._observers.splice(f,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(f=>{this._notifyObserver(f)})}_finishPromise(){if(void 0!==this._resolve){let l=!0;switch(kt(this._state)){case Xe.SUCCESS:Ft(this._resolve.bind(null,this.snapshot))();break;case Xe.CANCELED:case Xe.ERROR:Ft(this._reject.bind(null,this._error))();break;default:l=!1}l&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(l){switch(kt(this._state)){case Xe.RUNNING:case Xe.PAUSED:l.next&&Ft(l.next.bind(l,this.snapshot))();break;case Xe.SUCCESS:l.complete&&Ft(l.complete.bind(l))();break;default:l.error&&Ft(l.error.bind(l,this._error))()}}resume(){const l="paused"===this._state||"pausing"===this._state;return l&&this._transition("running"),l}pause(){const l="running"===this._state;return l&&this._transition("pausing"),l}cancel(){const l="running"===this._state||"pausing"===this._state;return l&&this._transition("canceling"),l}}class zt{constructor(l,f){this._service=l,this._location=f instanceof oe?f:oe.makeFromUrl(f,l.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(l,f){return new zt(l,f)}get root(){const l=new oe(this._location.bucket,"");return this._newRef(this._service,l)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return is(this._location.path)}get storage(){return this._service}get parent(){const l=function Io(h){if(0===h.length)return null;const l=h.lastIndexOf("/");return-1===l?"":h.slice(0,l)}(this._location.path);if(null===l)return null;const f=new oe(this._location.bucket,l);return new zt(this._service,f)}_throwIfRoot(l){if(""===this._location.path)throw Qi(l)}}function wn(h,l,f){return Hr.apply(this,arguments)}function Hr(){return(Hr=(0,me.Z)(function*(h,l,f){const _=yield Vo(h,{pageToken:f});l.prefixes.push(..._.prefixes),l.items.push(..._.items),null!=_.nextPageToken&&(yield wn(h,l,_.nextPageToken))})).apply(this,arguments)}function Vo(h,l){null!=l&&"number"==typeof l.maxResults&&Zn("options.maxResults",1,1e3,l.maxResults);const f=l||{},g=iu(h.storage,h._location,"/",f.pageToken,f.maxResults);return h.storage.makeRequestWithTokens(g,ge)}function gs(h){h._throwIfRoot("getDownloadURL");const l=function us(h,l,f){const _=Rt(l.fullServerUrl(),h.host,h._protocol),P=h.maxOperationRetryTime,O=new yt(_,"GET",function nr(h,l){return function f(g,_){const I=ke(h,_,l);return Pt(null!==I),function Ge(h,l,f,g){const _=Br(l);if(null===_||!Or(_.downloadTokens))return null;const I=_.downloadTokens;if(0===I.length)return null;const P=encodeURIComponent;return I.split(",").map(K=>{const Ae=h.fullPath;return Rt("/b/"+P(h.bucket)+"/o/"+P(Ae),f,g)+_o({alt:"media",token:K})})[0]}(I,_,h.host,h._protocol)}}(h,f),P);return O.errorHandler=rn(l),O}(h.storage,h._location,nn());return h.storage.makeRequestWithTokens(l,ge).then(f=>{if(null===f)throw function Fr(){return new se(k.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}();return f})}function ps(h,l){const f=function Ja(h,l){const f=l.split("/").filter(g=>g.length>0).join("/");return 0===h.length?f:h+"/"+f}(h._location.path,l),g=new oe(h._location.bucket,f);return new zt(h.storage,g)}function An(h,l){if(h instanceof Mt){const f=h;if(null==f._bucket)throw function Ka(){return new se(k.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Gt+"' property when initializing the app?")}();const g=new zt(f,f._bucket);return null!=l?An(g,l):g}return void 0!==l?ps(h,l):h}function ko(h,l){if(l&&function No(h){return/^[A-Za-z]+:\/\//.test(h)}(l)){if(h instanceof Mt)return function uu(h,l){return new zt(h,l)}(h,l);throw ut("To use ref(service, url), the first argument must be a Storage instance.")}return An(h,l)}function ur(h,l){const f=l?.[Gt];return null==f?null:oe.makeFromBucketSpec(f,h)}class Mt{constructor(l,f,g,_,I){this.app=l,this._authProvider=f,this._appCheckProvider=g,this._url=_,this._firebaseVersion=I,this._bucket=null,this._host=rt,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=_?oe.makeFromBucketSpec(_,this._host):ur(this._host,this.app.options)}get host(){return this._host}set host(l){this._host=l,this._bucket=null!=this._url?oe.makeFromBucketSpec(this._url,l):ur(l,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(l){Zn("time",0,Number.POSITIVE_INFINITY,l),this._maxUploadRetryTime=l}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(l){Zn("time",0,Number.POSITIVE_INFINITY,l),this._maxOperationRetryTime=l}_getAuthToken(){var l=this;return(0,me.Z)(function*(){if(l._overrideAuthToken)return l._overrideAuthToken;const f=l._authProvider.getImmediate({optional:!0});if(f){const g=yield f.getToken();if(null!==g)return g.accessToken}return null})()}_getAppCheckToken(){var l=this;return(0,me.Z)(function*(){const f=l._appCheckProvider.getImmediate({optional:!0});return f?(yield f.getToken()).token:null})()}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(l=>l.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(l){return new zt(this,l)}_makeRequest(l,f,g,_,I=!0){if(this._deleted)return new Qa(po());{const P=function Yn(h,l,f,g,_,I,P=!0){const O=_o(h.urlParams),M=h.url+O,K=Object.assign({},h.headers);return function yo(h,l){l&&(h["X-Firebase-GMPID"]=l)}(K,l),function Zi(h,l){null!==l&&l.length>0&&(h.Authorization="Firebase "+l)}(K,f),function Yi(h,l){h["X-Firebase-Storage-Version"]="webjs/"+(l??"AppManager")}(K,I),function Ha(h,l){null!==l&&(h["X-Firebase-AppCheck"]=l)}(K,g),new Hi(M,h.method,K,h.body,h.successCodes,h.additionalRetryCodes,h.handler,h.errorHandler,h.timeout,h.progressCallback,_,P)}(l,this._appId,g,_,f,this._firebaseVersion,I);return this._requests.add(P),P.getPromise().then(()=>this._requests.delete(P),()=>this._requests.delete(P)),P}}makeRequestWithTokens(l,f){var g=this;return(0,me.Z)(function*(){const[_,I]=yield Promise.all([g._getAuthToken(),g._getAppCheckToken()]);return g._makeRequest(l,f,_,I).getPromise()})()}}const Zr="@firebase/storage";function Rn(h,l){return ko(h=(0,ue.m9)(h),l)}function hu(h,{instanceIdentifier:l}){const f=h.getProvider("app").getImmediate(),g=h.getProvider("auth-internal"),_=h.getProvider("app-check-internal");return new Mt(f,g,_,l,z.SDK_VERSION)}!function du(){(0,z._registerComponent)(new Ye.wA("storage",hu,"PUBLIC").setMultipleInstances(!0)),(0,z.registerVersion)(Zr,"0.12.3",""),(0,z.registerVersion)(Zr,"0.12.3","esm2017")}();class jt{constructor(l,f,g){this._delegate=l,this.task=f,this.ref=g}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class Lt{constructor(l,f){this._delegate=l,this._ref=f,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new jt(this._delegate.snapshot,this,this._ref)}then(l,f){return this._delegate.then(g=>{if(l)return l(new jt(g,this,this._ref))},f)}on(l,f,g,_){let I;return f&&(I="function"==typeof f?P=>f(new jt(P,this,this._ref)):{next:f.next?P=>f.next(new jt(P,this,this._ref)):void 0,complete:f.complete||void 0,error:f.error||void 0}),this._delegate.on(l,I,g||void 0,_||void 0)}}class ys{constructor(l,f){this._delegate=l,this._service=f}get prefixes(){return this._delegate.prefixes.map(l=>new xt(l,this._service))}get items(){return this._delegate.items.map(l=>new xt(l,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class xt{constructor(l,f){this._delegate=l,this.storage=f}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(l){const f=function lr(h,l){return ps(h,l)}(this._delegate,l);return new xt(f,this.storage)}get root(){return new xt(this._delegate.root,this.storage)}get parent(){const l=this._delegate.parent;return null==l?null:new xt(l,this.storage)}put(l,f){return this._throwIfRoot("put"),new Lt(function sn(h,l,f){return function ds(h,l,f){return h._throwIfRoot("uploadBytesResumable"),new Kr(h,new ft(l),f)}(h=(0,ue.m9)(h),l,f)}(this._delegate,l,f),this)}putString(l,f=Qe.RAW,g){this._throwIfRoot("putString");const _=Xi(f,l),I=Object.assign({},g);return null==I.contentType&&null!=_.contentType&&(I.contentType=_.contentType),new Lt(new Kr(this._delegate,new ft(_.data,!0),I),this)}listAll(){return function Oo(h){return function Wr(h){const l={prefixes:[],items:[]};return wn(h,l).then(()=>l)}(h=(0,ue.m9)(h))}(this._delegate).then(l=>new ys(l,this.storage))}list(l){return function Xr(h,l){return Vo(h=(0,ue.m9)(h),l)}(this._delegate,l||void 0).then(f=>new ys(f,this.storage))}getMetadata(){return function Ot(h){return function bo(h){h._throwIfRoot("getMetadata");const l=as(h.storage,h._location,nn());return h.storage.makeRequestWithTokens(l,ge)}(h=(0,ue.m9)(h))}(this._delegate)}updateMetadata(l){return function Yr(h,l){return function ms(h,l){h._throwIfRoot("updateMetadata");const f=function cs(h,l,f,g){const I=Rt(l.fullServerUrl(),h.host,h._protocol),O=In(f,g),K=h.maxOperationRetryTime,J=new yt(I,"PATCH",Gr(h,g),K);return J.headers={"Content-Type":"application/json; charset=utf-8"},J.body=O,J.errorHandler=rn(l),J}(h.storage,h._location,l,nn());return h.storage.makeRequestWithTokens(f,ge)}(h=(0,ue.m9)(h),l)}(this._delegate,l)}getDownloadURL(){return function pe(h){return gs(h=(0,ue.m9)(h))}(this._delegate)}delete(){return this._throwIfRoot("delete"),function Jr(h){return function Do(h){h._throwIfRoot("deleteObject");const l=function wo(h,l){const g=Rt(l.fullServerUrl(),h.host,h._protocol),O=new yt(g,"DELETE",function P(M,K){},h.maxOperationRetryTime);return O.successCodes=[200,204],O.errorHandler=rn(l),O}(h.storage,h._location);return h.storage.makeRequestWithTokens(l,ge)}(h=(0,ue.m9)(h))}(this._delegate)}_throwIfRoot(l){if(""===this._delegate._location.path)throw Qi(l)}}class Ts{constructor(l,f){this.app=l,this._delegate=f}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(l){if(on(l))throw ut("ref() expected a child path but got a URL, use refFromURL instead.");return new xt(Rn(this._delegate,l),this)}refFromURL(l){if(!on(l))throw ut("refFromURL() expected a full URL but got a child path, use ref() instead.");try{oe.makeFromUrl(l,this._delegate.host)}catch{throw ut("refFromUrl() expected a valid full URL but got an invalid one.")}return new xt(Rn(this._delegate,l),this)}setMaxUploadRetryTime(l){this._delegate.maxUploadRetryTime=l}setMaxOperationRetryTime(l){this._delegate.maxOperationRetryTime=l}useEmulator(l,f,g={}){!function _s(h,l,f,g={}){!function cr(h,l,f,g={}){h.host=`${l}:${f}`,h._protocol="http";const{mockUserToken:_}=g;_&&(h._overrideAuthToken="string"==typeof _?_:(0,ue.Sg)(_,h.app.options.projectId))}(h,l,f,g)}(this._delegate,l,f,g)}}function on(h){return/^[A-Za-z]+:\/\//.test(h)}function gu(h,{instanceIdentifier:l}){const f=h.getProvider("app-compat").getImmediate(),g=h.getProvider("storage").getImmediate({identifier:l});return new Ts(f,g)}function ei(h){const l=function Is(h){return new Y.y(l=>{const f=P=>l.next(P);f(h.snapshot);const I=h.on("state_changed",f);return h.then(P=>{f(P),l.complete()},P=>{f(h.snapshot),(P=>{l.error(P)})(P)}),function(){I()}}).pipe((0,$e.b)(0))}(h);return{task:h,then:h.then.bind(h),catch:h.catch.bind(h),pause:h.pause.bind(h),cancel:h.cancel.bind(h),resume:h.resume.bind(h),snapshotChanges:()=>l,percentageChanges:()=>l.pipe((0,qt.U)(f=>f.bytesTransferred/f.totalBytes*100))}}function hr(h){return{getDownloadURL:()=>(0,v.of)(void 0).pipe(we.fc,(0,wt.w)(()=>h.getDownloadURL()),we.iC),getMetadata:()=>(0,v.of)(void 0).pipe(we.fc,(0,wt.w)(()=>h.getMetadata()),we.iC),delete:()=>(0,Ne.D)(h.delete()),child:l=>hr(h.child(l)),updateMetadata:l=>(0,Ne.D)(h.updateMetadata(l)),put:(l,f)=>ei(h.put(l,f)),putString:(l,f,g)=>ei(h.putString(l,f,g)),list:l=>(0,Ne.D)(h.list(l)),listAll:()=>(0,Ne.D)(h.listAll())}}!function Uo(h){const l={TaskState:Xe,TaskEvent:au,StringFormat:Qe,Storage:Ts,Reference:xt};h.INTERNAL.registerComponent(new Ye.wA("storage-compat",gu,"PUBLIC").setServiceProps(l).setMultipleInstances(!0)),h.registerVersion("@firebase/storage-compat","0.3.6")}(Z.Z),x(7142);const Bo=new re.OlP("angularfire2.storageBucket"),_u=new re.OlP("angularfire2.storage.maxUploadRetryTime"),yu=new re.OlP("angularfire2.storage.maxOperationRetryTime"),Tu=new re.OlP("angularfire2.storage.use-emulator");let Iu=(()=>{class h{storage;constructor(f,g,_,I,P,O,M,K,J,Ae){const _e=(0,dt.on)(f,P,g);this.storage=(0,dt.cc)(`${_e.name}.storage.${_}`,"AngularFireStorage",_e.name,()=>{const de=P.runOutsideAngular(()=>_e.storage(_||void 0)),Re=J;return Re&&de.useEmulator(...Re),M&&de.setMaxUploadRetryTime(M),K&&de.setMaxOperationRetryTime(K),de},[M,K])}ref(f){return hr(this.storage.ref(f))}refFromURL(f){return hr(this.storage.refFromURL(f))}upload(f,g,_){return hr(this.storage.ref(f)).put(g,_)}static \u0275fac=function(g){return new(g||h)(re.LFG(dt.Dh),re.LFG(dt.xv,8),re.LFG(Bo,8),re.LFG(re.Lbi),re.LFG(re.R0b),re.LFG(we.HU),re.LFG(_u,8),re.LFG(yu,8),re.LFG(Tu,8),re.LFG(we.Rf,8))};static \u0275prov=re.Yz7({token:h,factory:h.\u0275fac,providedIn:"any"})}return h})()}}]);