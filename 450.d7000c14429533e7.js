"use strict";(self.webpackChunkcodepulse=self.webpackChunkcodepulse||[]).push([[450],{1333:(jc,An,D)=>{D.d(An,{p:()=>wr});var p=D(5879),Ge=D(8145),E=D(459),vr=D(5257);const wr=(se,We)=>{const He=(0,p.f3M)(E.N),Rn=(0,p.f3M)(vr.e),Pn=(0,p.f3M)(Ge.F0),ze=Rn.getUser();return He.get("Authorization"),!!ze||(Rn.googleLogout(),Pn.createUrlTree(["/login"],{queryParams:{returnUrl:We.url}}))}},8101:(jc,An,D)=>{D.d(An,{u:()=>ow});var P,p=D(5861),Ge=D(553),E=D(5879),vr=D(9862),wr=D(6814),se=D(1920),We=D(7217),He=D(981),Rn=D(6321),Pn=D(5592),ze=D(2459),Zt=D(2096),Ar=D(7921),Rr=D(9384),M=D(7398),Sn=D(6699),he=D(3997),De=D(2181),Kc=(D(6365),D(3106)),St=D(4303),qi=D(4537),nt=D(7879),L=D(9058),Ug=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Je={},Io=Io||{},F=Ug||self;function Gi(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Pr(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Eo="closure_uid_"+(1e9*Math.random()>>>0),qg=0;function Gg(n,e,t){return n.call.apply(n.bind,arguments)}function zg(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Pe(n,e,t){return(Pe=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Gg:zg).apply(null,arguments)}function zi(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function ge(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function xt(){this.s=this.s,this.o=this.o}xt.prototype.s=!1,xt.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function Bg(n){Object.prototype.hasOwnProperty.call(n,Eo)&&n[Eo]||(n[Eo]=++qg)}(this)},xt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Qc=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function vo(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Wc(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(Gi(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function Se(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Se.prototype.h=function(){this.defaultPrevented=!0};var $g=function(){if(!F.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const t=()=>{};F.addEventListener("test",t,e),F.removeEventListener("test",t,e)}catch{}return n}();function Sr(n){return/^[\s\xa0]*$/.test(n)}function ji(){var n=F.navigator;return n&&(n=n.userAgent)?n:""}function rt(n){return-1!=ji().indexOf(n)}function wo(n){return wo[" "](n),n}wo[" "]=function(){};var Ro,n,Qg=rt("Opera"),xn=rt("Trident")||rt("MSIE"),Hc=rt("Edge"),Ao=Hc||xn,Zc=rt("Gecko")&&!(-1!=ji().toLowerCase().indexOf("webkit")&&!rt("Edge"))&&!(rt("Trident")||rt("MSIE"))&&!rt("Edge"),Wg=-1!=ji().toLowerCase().indexOf("webkit")&&!rt("Edge");function Yc(){var n=F.document;return n?n.documentMode:void 0}e:{var Po="",So=(n=ji(),Zc?/rv:([^\);]+)(\)|;)/.exec(n):Hc?/Edge\/([\d\.]+)/.exec(n):xn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):Wg?/WebKit\/(\S+)/.exec(n):Qg?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(So&&(Po=So?So[1]:""),xn){var xo=Yc();if(null!=xo&&xo>parseFloat(Po)){Ro=String(xo);break e}}Ro=Po}var Hg=F.document&&xn&&(Yc()||parseInt(Ro,10))||void 0;function xr(n,e){if(Se.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Zc){e:{try{wo(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Zg[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&xr.$.h.call(this)}}ge(xr,Se);var Zg={2:"touch",3:"pen",4:"mouse"};xr.prototype.h=function(){xr.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Vr="closure_listenable_"+(1e6*Math.random()|0),Yg=0;function Xg(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++Yg,this.fa=this.ia=!1}function $i(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Co(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function Jc(n){const e={};for(const t in n)e[t]=n[t];return e}const el="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function tl(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<el.length;s++)t=el[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Ki(n){this.src=n,this.g={},this.h=0}function bo(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=Qc(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&($i(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function Do(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}Ki.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=Do(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new Xg(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var No="closure_lm_"+(1e6*Math.random()|0),ko={};function nl(n,e,t,r,i){if(r&&r.once)return il(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)nl(n,e[s],t,r,i);return null}return t=Lo(t),n&&n[Vr]?n.O(e,t,Pr(r)?!!r.capture:!!r,i):rl(n,e,t,!1,r,i)}function rl(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=Pr(i)?!!i.capture:!!i,a=Mo(n);if(a||(n[No]=a=new Ki(n)),(t=a.add(e,t,r,o,s)).proxy)return t;if(r=function ep(){const e=tp;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)$g||(i=o),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(ol(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function il(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)il(n,e[s],t,r,i);return null}return t=Lo(t),n&&n[Vr]?n.P(e,t,Pr(r)?!!r.capture:!!r,i):rl(n,e,t,!0,r,i)}function sl(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)sl(n,e[s],t,r,i);else r=Pr(r)?!!r.capture:!!r,t=Lo(t),n&&n[Vr]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=Do(s=n.g[e],t,r,i))&&($i(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=Mo(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Do(e,t,r,i)),(t=-1<n?e[n]:null)&&Fo(t))}function Fo(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[Vr])bo(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(ol(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Mo(e))?(bo(t,n),0==t.h&&(t.src=null,e[No]=null)):$i(n)}}}function ol(n){return n in ko?ko[n]:ko[n]="on"+n}function tp(n,e){if(n.fa)n=!0;else{e=new xr(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Fo(n),n=t.call(r,e)}return n}function Mo(n){return(n=n[No])instanceof Ki?n:null}var Oo="__closure_events_fn_"+(1e9*Math.random()>>>0);function Lo(n){return"function"==typeof n?n:(n[Oo]||(n[Oo]=function(e){return n.handleEvent(e)}),n[Oo])}function pe(){xt.call(this),this.i=new Ki(this),this.S=this,this.J=null}function Ee(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new Se(e,n);else if(e instanceof Se)e.target=e.target||n;else{var i=e;tl(e=new Se(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=Qi(o,r,!0,e)&&i}if(i=Qi(o=e.g=n,r,!0,e)&&i,i=Qi(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=Qi(o=e.g=t[s],r,!1,e)&&i}function Qi(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&bo(n.i,o),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}ge(pe,xt),pe.prototype[Vr]=!0,pe.prototype.removeEventListener=function(n,e,t,r){sl(this,n,e,t,r)},pe.prototype.N=function(){if(pe.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)$i(t[r]);delete n.g[e],n.h--}}this.J=null},pe.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},pe.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var Uo=F.JSON.stringify;function rp(){var n=Bo;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var al=new class np{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new sp,n=>n.reset());class sp{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function op(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function ap(n){F.setTimeout(()=>{throw n},0)}let Cr,br=!1,Bo=new class ip{constructor(){this.h=this.g=null}add(e,t){const r=al.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},ul=()=>{const n=F.Promise.resolve(void 0);Cr=()=>{n.then(up)}};var up=()=>{for(var n;n=rp();){try{n.h.call(n.g)}catch(t){ap(t)}var e=al;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}br=!1};function Wi(n,e){pe.call(this),this.h=n||1,this.g=e||F,this.j=Pe(this.qb,this),this.l=Date.now()}function qo(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function Go(n,e,t){if("function"==typeof n)t&&(n=Pe(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=Pe(n.handleEvent,n)}return 2147483647<Number(e)?-1:F.setTimeout(n,e||0)}function cl(n){n.g=Go(()=>{n.g=null,n.i&&(n.i=!1,cl(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}ge(Wi,pe),(P=Wi.prototype).ga=!1,P.T=null,P.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ee(this,"tick"),this.ga&&(qo(this),this.start()))}},P.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},P.N=function(){Wi.$.N.call(this),qo(this),delete this.g};class cp extends xt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:cl(this)}N(){super.N(),this.g&&(F.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Dr(n){xt.call(this),this.h=n,this.g={}}ge(Dr,xt);var ll=[];function hl(n,e,t,r){Array.isArray(t)||(t&&(ll[0]=t.toString()),t=ll);for(var i=0;i<t.length;i++){var s=nl(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function dl(n){Co(n.g,function(e,t){this.g.hasOwnProperty(t)&&Fo(e)},n),n.g={}}function Hi(){this.g=!0}function Vn(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function fp(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Uo(t)}catch{return e}}(n,t)+(r?" "+r:"")})}Dr.prototype.N=function(){Dr.$.N.call(this),dl(this)},Dr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Hi.prototype.Ea=function(){this.g=!1},Hi.prototype.info=function(){};var Yt={},fl=null;function Zi(){return fl=fl||new pe}function ml(n){Se.call(this,Yt.Ta,n)}function Nr(n){const e=Zi();Ee(e,new ml(e))}function gl(n,e){Se.call(this,Yt.STAT_EVENT,n),this.stat=e}function Ne(n){const e=Zi();Ee(e,new gl(e,n))}function pl(n,e){Se.call(this,Yt.Ua,n),this.size=e}function kr(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return F.setTimeout(function(){n()},e)}Yt.Ta="serverreachability",ge(ml,Se),Yt.STAT_EVENT="statevent",ge(gl,Se),Yt.Ua="timingevent",ge(pl,Se);var Yi={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},_l={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function zo(){}function Tl(){}zo.prototype.h=null;var Ko,Fr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function jo(){Se.call(this,"d")}function $o(){Se.call(this,"c")}function Xi(){}function Mr(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Dr(this),this.P=mp,this.V=new Wi(n=Ao?125:void 0),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Il}function Il(){this.i=null,this.g="",this.h=!1}ge(jo,Se),ge($o,Se),ge(Xi,zo),Xi.prototype.g=function(){return new XMLHttpRequest},Xi.prototype.i=function(){return{}},Ko=new Xi;var mp=45e3,El={},Qo={};function Wo(n,e,t){n.L=1,n.A=ns(gt(e)),n.u=t,n.S=!0,vl(n,null)}function vl(n,e){n.G=Date.now(),Or(n),n.B=gt(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Dl(t.i,"t",r),n.o=0,t=n.l.J,n.h=new Il,n.g=nh(n.l,t?e:null,!n.u),0<n.O&&(n.M=new cp(Pe(n.Pa,n,n.g),n.O)),hl(n.U,n.g,"readystatechange",n.nb),e=n.I?Jc(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),Nr(),function lp(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.v,n.B,n.m,n.W,n.u)}function wl(n){return!!n.g&&"GET"==n.v&&2!=n.L&&n.l.Ha}function Al(n,e,t){let i,r=!0;for(;!n.J&&n.o<t.length;){if(i=gp(n,t),i==Qo){4==e&&(n.s=4,Ne(14),r=!1),Vn(n.j,n.m,null,"[Incomplete Response]");break}if(i==El){n.s=4,Ne(15),Vn(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Vn(n.j,n.m,i,null),Ho(n,i)}wl(n)&&0!=n.o&&(n.h.g=n.h.g.slice(n.o),n.o=0),4!=e||0!=t.length||n.h.h||(n.s=1,Ne(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),na(e),e.M=!0,Ne(11))):(Vn(n.j,n.m,t,"[Invalid Chunked Response]"),Xt(n),Lr(n))}function gp(n,e){var t=n.o,r=e.indexOf("\n",t);return-1==r?Qo:(t=Number(e.substring(t,r)),isNaN(t)?El:(r+=1)+t>e.length?Qo:(e=e.slice(r,r+t),n.o=r+t,e))}function Or(n){n.Y=Date.now()+n.P,Rl(n,n.P)}function Rl(n,e){if(null!=n.C)throw Error("WatchDog timer not null");n.C=kr(Pe(n.lb,n),e)}function Ji(n){n.C&&(F.clearTimeout(n.C),n.C=null)}function Lr(n){0==n.l.H||n.J||Xl(n.l,n)}function Xt(n){Ji(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,qo(n.V),dl(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Ho(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||Zo(t.i,n)))if(!n.K&&Zo(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;us(t),os(t)}ta(t),Ne(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=kr(Pe(t.ib,t),6e3));if(1>=Fl(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else en(t,11)}else if((n.K||t.g==n)&&us(t),!Sr(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],2==t.H)if("c"==c[0]){t.K=c[1],t.pa=c[2];const l=c[3];null!=l&&(t.ra=l,t.l.info("VER="+t.ra));const h=c[4];null!=h&&(t.Ga=h,t.l.info("SVER="+t.Ga));const d=c[5];null!=d&&"number"==typeof d&&0<d&&(t.L=r=1.5*d,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const f=n.g;if(f){const _=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(_){var s=r.i;s.g||-1==_.indexOf("spdy")&&-1==_.indexOf("quic")&&-1==_.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Yo(s,s.h),s.h=null))}if(r.F){const v=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;v&&(r.Da=v,Z(r.I,r.F,v))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((r=t).wa=th(r,r.J?r.pa:null,r.Y),o.K){Ml(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(Ji(a),Or(a)),r.g=o}else Zl(r);0<t.j.length&&as(t)}else"stop"!=c[0]&&"close"!=c[0]||en(t,7);else 3==t.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?en(t,7):ea(t):"noop"!=c[0]&&t.h&&t.h.Aa(c),t.A=0)}Nr()}catch{}}function Pl(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(Gi(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function _p(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Gi(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function pp(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(Gi(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(P=Mr.prototype).setTimeout=function(n){this.P=n},P.nb=function(n){n=n.target;const e=this.M;e&&3==it(n)?e.l():this.Pa(n)},P.Pa=function(n){try{if(n==this.g)e:{const l=it(this.g);var e=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||Ao||this.g&&(this.h.h||this.g.ja()||jl(this.g)))){this.J||4!=l||7==e||Nr(),Ji(this);var t=this.g.da();this.ca=t;t:if(wl(this)){var r=jl(this.g);n="";var i=r.length,s=4==it(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Xt(this),Lr(this);var o="";break t}this.h.i=new F.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function hp(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+o})}(this.j,this.v,this.B,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Sr(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.s=3,Ne(12),Xt(this),Lr(this);break e}Vn(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ho(this,t)}this.S?(Al(this,l,o),Ao&&this.i&&3==l&&(hl(this.U,this.V,"tick",this.mb),this.V.start())):(Vn(this.j,this.m,o,null),Ho(this,o)),4==l&&Xt(this),this.i&&!this.J&&(4==l?Xl(this.l,this):(this.i=!1,Or(this)))}else(function Fp(n){const e={};n=(n.g&&2<=it(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(Sr(n[r]))continue;var t=op(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function Jg(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.s=3,Ne(12)):(this.s=0,Ne(13)),Xt(this),Lr(this)}}}catch{}},P.mb=function(){if(this.g){var n=it(this.g),e=this.g.ja();this.o<e.length&&(Ji(this),Al(this,n,e),this.i&&4!=n&&Or(this))}},P.cancel=function(){this.J=!0,Xt(this)},P.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(function dp(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.B),2!=this.L&&(Nr(),Ne(17)),Xt(this),this.s=2,Lr(this)):Rl(this,this.Y-n)};var Sl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Jt(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Jt){this.h=n.h,es(this,n.j),this.s=n.s,this.g=n.g,ts(this,n.m),this.l=n.l;var e=n.i,t=new qr;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),xl(this,t),this.o=n.o}else n&&(e=String(n).match(Sl))?(this.h=!1,es(this,e[1]||"",!0),this.s=Ur(e[2]||""),this.g=Ur(e[3]||"",!0),ts(this,e[4]),this.l=Ur(e[5]||"",!0),xl(this,e[6]||"",!0),this.o=Ur(e[7]||"")):(this.h=!1,this.i=new qr(null,this.h))}function gt(n){return new Jt(n)}function es(n,e,t){n.j=t?Ur(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function ts(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function xl(n,e,t){e instanceof qr?(n.i=e,function Ap(n,e){e&&!n.j&&(Vt(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Cl(this,r),Dl(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Br(e,vp)),n.i=new qr(e,n.h))}function Z(n,e,t){n.i.set(e,t)}function ns(n){return Z(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Ur(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Br(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Tp),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Tp(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Jt.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Br(e,Vl,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Br(e,Vl,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Br(t,"/"==t.charAt(0)?Ep:Ip,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Br(t,wp)),n.join("")};var Vl=/[#\/\?@]/g,Ip=/[#\?:]/g,Ep=/[#\?]/g,vp=/[#\?@]/g,wp=/#/g;function qr(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Vt(n){n.g||(n.g=new Map,n.h=0,n.i&&function yp(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Cl(n,e){Vt(n),e=Cn(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function bl(n,e){return Vt(n),e=Cn(n,e),n.g.has(e)}function Dl(n,e,t){Cl(n,e),0<t.length&&(n.i=null,n.g.set(Cn(n,e),vo(t)),n.h+=t.length)}function Cn(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Nl(n){this.l=n||Pp,n=F.PerformanceNavigationTiming?0<(n=F.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(F.g&&F.g.Ka&&F.g.Ka()&&F.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(P=qr.prototype).add=function(n,e){Vt(this),this.i=null,n=Cn(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},P.forEach=function(n,e){Vt(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},P.ta=function(){Vt(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},P.Z=function(n){Vt(this);let e=[];if("string"==typeof n)bl(this,n)&&(e=e.concat(this.g.get(Cn(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},P.set=function(n,e){return Vt(this),this.i=null,bl(this,n=Cn(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},P.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},P.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};var Pp=10;function kl(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Fl(n){return n.h?1:n.g?n.g.size:0}function Zo(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Yo(n,e){n.g?n.g.add(e):n.h=e}function Ml(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Ol(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return vo(n.i)}Nl.prototype.cancel=function(){if(this.i=Ol(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var Sp=class{stringify(n){return F.JSON.stringify(n,void 0)}parse(n){return F.JSON.parse(n,void 0)}};function xp(){this.g=new Sp}function Vp(n,e,t){const r=t||"";try{Pl(n,function(i,s){let o=i;Pr(i)&&(o=Uo(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function rs(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function Gr(n){this.l=n.ec||null,this.j=n.ob||!1}function is(n,e){pe.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Xo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ge(Gr,zo),Gr.prototype.g=function(){return new is(this.l,this.j)},Gr.prototype.i=function(n){return function(){return n}}({}),ge(is,pe);var Xo=0;function Ll(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function zr(n){n.readyState=4,n.l=null,n.j=null,n.A=null,jr(n)}function jr(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(P=is.prototype).open=function(n,e){if(this.readyState!=Xo)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,jr(this)},P.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||F).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},P.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,zr(this)),this.readyState=Xo},P.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,jr(this)),this.g&&(this.readyState=3,jr(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof F.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ll(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},P.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?zr(this):jr(this),3==this.readyState&&Ll(this)}},P.Za=function(n){this.g&&(this.response=this.responseText=n,zr(this))},P.Ya=function(n){this.g&&(this.response=n,zr(this))},P.ka=function(){this.g&&zr(this)},P.setRequestHeader=function(n,e){this.v.append(n,e)},P.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},P.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(is.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var bp=F.JSON.parse;function oe(n){pe.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Ul,this.L=this.M=!1}ge(oe,pe);var Ul="",Dp=/^https?$/i,Np=["POST","PUT"];function Bl(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,ql(n),ss(n)}function ql(n){n.F||(n.F=!0,Ee(n,"complete"),Ee(n,"error"))}function Gl(n){if(n.h&&typeof Io<"u"&&(!n.C[1]||4!=it(n)||2!=n.da()))if(n.v&&4==it(n))Go(n.La,0,n);else if(Ee(n,"readystatechange"),4==it(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===o){var i=String(n.I).match(Sl)[1]||null;!i&&F.self&&F.self.location&&(i=F.self.location.protocol.slice(0,-1)),r=!Dp.test(i?i.toLowerCase():"")}t=r}if(t)Ee(n,"complete"),Ee(n,"success");else{n.m=6;try{var s=2<it(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",ql(n)}}finally{ss(n)}}}function ss(n,e){if(n.g){zl(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Ee(n,"ready");try{t.onreadystatechange=r}catch{}}}function zl(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(F.clearTimeout(n.A),n.A=null)}function it(n){return n.g?n.g.readyState:0}function jl(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Ul:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function $l(n){let e="";return Co(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function Jo(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=$l(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):Z(n,e,t))}function $r(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Kl(n){this.Ga=0,this.j=[],this.l=new Hi,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=$r("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=$r("baseRetryDelayMs",5e3,n),this.hb=$r("retryDelaySeedMs",1e4,n),this.eb=$r("forwardChannelMaxRetries",2,n),this.xa=$r("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Nl(n&&n.concurrentRequestLimit),this.Ja=new xp,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function ea(n){if(Ql(n),3==n.H){var e=n.W++,t=gt(n.I);if(Z(t,"SID",n.K),Z(t,"RID",e),Z(t,"TYPE","terminate"),Kr(n,t),(e=new Mr(n,n.l,e)).L=2,e.A=ns(gt(t)),t=!1,F.navigator&&F.navigator.sendBeacon)try{t=F.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&F.Image&&((new Image).src=e.A,t=!0),t||(e.g=nh(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Or(e)}eh(n)}function os(n){n.g&&(na(n),n.g.cancel(),n.g=null)}function Ql(n){os(n),n.u&&(F.clearTimeout(n.u),n.u=null),us(n),n.i.cancel(),n.m&&("number"==typeof n.m&&F.clearTimeout(n.m),n.m=null)}function as(n){if(!kl(n.i)&&!n.m){n.m=!0;var e=n.Na;Cr||ul(),br||(Cr(),br=!0),Bo.add(e,n),n.C=0}}function Wl(n,e){var t;t=e?e.m:n.W++;const r=gt(n.I);Z(r,"SID",n.K),Z(r,"RID",t),Z(r,"AID",n.V),Kr(n,r),n.o&&n.s&&Jo(r,n.o,n.s),t=new Mr(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=Hl(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Yo(n.i,t),Wo(t,r,e)}function Kr(n,e){n.na&&Co(n.na,function(t,r){Z(e,r,t)}),n.h&&Pl({},function(t,r){Z(e,r,t)})}function Hl(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Pe(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const o=["count="+t];-1==s?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let c=i[u].g;const l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{Vp(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function Zl(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Cr||ul(),br||(Cr(),br=!0),Bo.add(e,n),n.A=0}}function ta(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=kr(Pe(n.Ma,n),Jl(n,n.A)),n.A++,0))}function na(n){null!=n.B&&(F.clearTimeout(n.B),n.B=null)}function Yl(n){n.g=new Mr(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=gt(n.wa);Z(e,"RID","rpc"),Z(e,"SID",n.K),Z(e,"AID",n.V),Z(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&Z(e,"TO",n.qa),Z(e,"TYPE","xmlhttp"),Kr(n,e),n.o&&n.s&&Jo(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=ns(gt(e)),t.u=null,t.S=!0,vl(t,n)}function us(n){null!=n.v&&(F.clearTimeout(n.v),n.v=null)}function Xl(n,e){var t=null;if(n.g==e){us(n),na(n),n.g=null;var r=2}else{if(!Zo(n.i,e))return;t=e.F,Ml(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;Ee(r=Zi(),new pl(r,t)),as(n)}else Zl(n);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==r&&function Mp(n,e){return!(Fl(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=kr(Pe(n.Na,n,e),Jl(n,n.C)),n.C++,0)))}(n,e)||2==r&&ta(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:en(n,5);break;case 4:en(n,10);break;case 3:en(n,6);break;default:en(n,2)}}function Jl(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function en(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=Pe(n.pb,n);t||(t=new Jt("//www.google.com/images/cleardot.gif"),F.location&&"http"==F.location.protocol||es(t,"https"),ns(t)),function Cp(n,e){const t=new Hi;if(F.Image){const r=new Image;r.onload=zi(rs,t,r,"TestLoadImage: loaded",!0,e),r.onerror=zi(rs,t,r,"TestLoadImage: error",!1,e),r.onabort=zi(rs,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=zi(rs,t,r,"TestLoadImage: timeout",!1,e),F.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Ne(2);n.H=0,n.h&&n.h.za(e),eh(n),Ql(n)}function eh(n){if(n.H=0,n.ma=[],n.h){const e=Ol(n.i);(0!=e.length||0!=n.j.length)&&(Wc(n.ma,e),Wc(n.ma,n.j),n.i.i.length=0,vo(n.j),n.j.length=0),n.h.ya()}}function th(n,e,t){var r=t instanceof Jt?gt(t):new Jt(t);if(""!=r.g)e&&(r.g=e+"."+r.g),ts(r,r.m);else{var i=F.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Jt(null);r&&es(s,r),e&&(s.g=e),i&&ts(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&Z(r,t,e),Z(r,"VER",n.ra),Kr(n,r),r}function nh(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new oe(n.Ha&&!n.va?new Gr({ob:t}):n.va)).Oa(n.J),e}function rh(){}function cs(){if(xn&&!(10<=Number(Hg)))throw Error("Environmental error: no available transport.")}function je(n,e){pe.call(this),this.g=new Kl(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Sr(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Sr(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new bn(this)}function ih(n){jo.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function sh(){$o.call(this),this.status=1}function bn(n){this.g=n}function et(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function ra(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],o=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;o=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=t+((o=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function $(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(P=oe.prototype).Oa=function(n){this.M=n},P.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Ko.g(),this.C=function yl(n){return n.h||(n.h=n.i())}(this.u?this.u:Ko),this.g.onreadystatechange=Pe(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void Bl(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=F.FormData&&n instanceof F.FormData,!(0<=Qc(Np,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{zl(this),0<this.B&&((this.L=function kp(n){return xn&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Pe(this.ua,this)):this.A=Go(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Bl(this,s)}},P.ua=function(){typeof Io<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ee(this,"timeout"),this.abort(8))},P.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Ee(this,"complete"),Ee(this,"abort"),ss(this))},P.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ss(this,!0)),oe.$.N.call(this)},P.La=function(){this.s||(this.G||this.v||this.l?Gl(this):this.kb())},P.kb=function(){Gl(this)},P.isActive=function(){return!!this.g},P.da=function(){try{return 2<it(this)?this.g.status:-1}catch{return-1}},P.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},P.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),bp(e)}},P.Ia=function(){return this.m},P.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(P=Kl.prototype).ra=8,P.H=1,P.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new Mr(this,this.l,n);let s=this.s;if(this.U&&(s?(s=Jc(s),tl(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Hl(this,i,e),Z(t=gt(this.I),"RID",n),Z(t,"CVER",22),this.F&&Z(t,"X-HTTP-Session-Id",this.F),Kr(this,t),s&&(this.O?e="headers="+encodeURIComponent(String($l(s)))+"&"+e:this.o&&Jo(t,this.o,s)),Yo(this.i,i),this.bb&&Z(t,"TYPE","init"),this.P?(Z(t,"$req",e),Z(t,"SID","null"),i.aa=!0,Wo(i,t,null)):Wo(i,t,e),this.H=2}}else 3==this.H&&(n?Wl(this,n):0==this.j.length||kl(this.i)||Wl(this))},P.Ma=function(){if(this.u=null,Yl(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=kr(Pe(this.jb,this),n)}},P.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ne(10),os(this),Yl(this))},P.ib=function(){null!=this.v&&(this.v=null,os(this),ta(this),Ne(19))},P.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Ne(2)):(this.l.info("Failed to ping google.com"),Ne(1))},P.isActive=function(){return!!this.h&&this.h.isActive(this)},(P=rh.prototype).Ba=function(){},P.Aa=function(){},P.za=function(){},P.ya=function(){},P.isActive=function(){return!0},P.Va=function(){},cs.prototype.g=function(n,e){return new je(n,e)},ge(je,pe),je.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Ne(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=th(n,null,n.Y),as(n)},je.prototype.close=function(){ea(this.g)},je.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Uo(n),n=t);e.j.push(new class{constructor(n,e){this.g=n,this.map=e}}(e.fb++,n)),3==e.H&&as(e)},je.prototype.N=function(){this.g.h=null,delete this.j,ea(this.g),delete this.g,je.$.N.call(this)},ge(ih,jo),ge(sh,$o),ge(bn,rh),bn.prototype.Ba=function(){Ee(this.g,"a")},bn.prototype.Aa=function(n){Ee(this.g,new ih(n))},bn.prototype.za=function(n){Ee(this.g,new sh)},bn.prototype.ya=function(){Ee(this.g,"b")},ge(et,function Op(){this.blockSize=-1}),et.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},et.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)ra(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){ra(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){ra(this,r),i=0;break}}this.h=i,this.i+=e},et.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var Lp={};function ia(n){return-128<=n&&128>n?function Kg(n,e){var t=Lp;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new $([0|e],0>e?-1:0)}):new $([0|n],0>n?-1:0)}function st(n){if(isNaN(n)||!isFinite(n))return Dn;if(0>n)return ve(st(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=sa;return new $(e,0)}var sa=4294967296,Dn=ia(0),oa=ia(1),ah=ia(16777216);function pt(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function Ze(n){return-1==n.h}function ve(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new $(t,~n.h).add(oa)}function ls(n,e){return n.add(ve(e))}function hs(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Qr(n,e){this.g=n,this.h=e}function ds(n,e){if(pt(e))throw Error("division by zero");if(pt(n))return new Qr(Dn,Dn);if(Ze(n))return e=ds(ve(n),e),new Qr(ve(e.g),ve(e.h));if(Ze(e))return e=ds(n,ve(e)),new Qr(ve(e.g),e.h);if(30<n.g.length){if(Ze(n)||Ze(e))throw Error("slowDivide_ only works with positive integers.");for(var t=oa,r=e;0>=r.X(n);)t=uh(t),r=uh(r);var i=Nn(t,1),s=Nn(r,1);for(r=Nn(r,2),t=Nn(t,2);!pt(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=Nn(r,1),t=Nn(t,1)}return e=ls(n,i.R(e)),new Qr(i,e)}for(i=Dn;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),o=(s=st(t)).R(e);Ze(o)||0<o.X(n);)o=(s=st(t-=r)).R(e);pt(s)&&(s=oa),i=i.add(s),n=ls(n,o)}return new Qr(i,n)}function uh(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new $(t,n.h)}function Nn(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new $(i,n.h)}(P=$.prototype).ea=function(){if(Ze(this))return-ve(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:sa+r)*e,e*=sa}return n},P.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(pt(this))return"0";if(Ze(this))return"-"+ve(this).toString(n);for(var e=st(Math.pow(n,6)),t=this,r="";;){var i=ds(t,e).g,s=((0<(t=ls(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(pt(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},P.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},P.X=function(n){return Ze(n=ls(this,n))?-1:pt(n)?0:1},P.abs=function(){return Ze(this)?ve(this):this},P.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,t[i]=(o&=65535)<<16|(s&=65535)}return new $(t,-2147483648&t[t.length-1]?-1:0)},P.R=function(n){if(pt(this)||pt(n))return Dn;if(Ze(this))return Ze(n)?ve(this).R(ve(n)):ve(ve(this).R(n));if(Ze(n))return ve(this.R(ve(n)));if(0>this.X(ah)&&0>n.X(ah))return st(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=n.D(i)>>>16,u=65535&n.D(i);t[2*r+2*i]+=o*u,hs(t,2*r+2*i),t[2*r+2*i+1]+=s*u,hs(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,hs(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,hs(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new $(t,0)},P.gb=function(n){return ds(this,n).h},P.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new $(t,this.h&n.h)},P.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new $(t,this.h|n.h)},P.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new $(t,this.h^n.h)},cs.prototype.createWebChannel=cs.prototype.g,je.prototype.send=je.prototype.u,je.prototype.open=je.prototype.m,je.prototype.close=je.prototype.close,Yi.NO_ERROR=0,Yi.TIMEOUT=8,Yi.HTTP_ERROR=6,_l.COMPLETE="complete",Tl.EventType=Fr,Fr.OPEN="a",Fr.CLOSE="b",Fr.ERROR="c",Fr.MESSAGE="d",pe.prototype.listen=pe.prototype.O,oe.prototype.listenOnce=oe.prototype.P,oe.prototype.getLastError=oe.prototype.Sa,oe.prototype.getLastErrorCode=oe.prototype.Ia,oe.prototype.getStatus=oe.prototype.da,oe.prototype.getResponseJson=oe.prototype.Wa,oe.prototype.getResponseText=oe.prototype.ja,oe.prototype.send=oe.prototype.ha,oe.prototype.setWithCredentials=oe.prototype.Oa,et.prototype.digest=et.prototype.l,et.prototype.reset=et.prototype.reset,et.prototype.update=et.prototype.j,$.prototype.add=$.prototype.add,$.prototype.multiply=$.prototype.R,$.prototype.modulo=$.prototype.gb,$.prototype.compare=$.prototype.X,$.prototype.toNumber=$.prototype.ea,$.prototype.toString=$.prototype.toString,$.prototype.getBits=$.prototype.D,$.fromNumber=st,$.fromString=function oh(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return ve(oh(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=st(Math.pow(e,8)),r=Dn,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=st(Math.pow(e,s)),r=r.R(s).add(st(o))):r=(r=r.R(t)).add(st(o))}return r};var Up=Je.createWebChannelTransport=function(){return new cs},Bp=Je.getStatEventTarget=function(){return Zi()},aa=Je.ErrorCode=Yi,qp=Je.EventType=_l,Gp=Je.Event=Yt,ch=Je.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},fs=(Je.FetchXmlHttpFactory=Gr,Je.WebChannel=Tl),zp=Je.XhrIo=oe,jp=Je.Md5=et,kn=Je.Integer=$;const lh="@firebase/firestore";class _e{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}_e.UNAUTHENTICATED=new _e(null),_e.GOOGLE_CREDENTIALS=new _e("google-credentials-uid"),_e.FIRST_PARTY=new _e("first-party-uid"),_e.MOCK_USER=new _e("mock-user");let Fn="10.10.0";const Ct=new nt.Yd("@firebase/firestore");function Mn(){return Ct.logLevel}function I(n,...e){if(Ct.logLevel<=nt.in.DEBUG){const t=e.map(ua);Ct.debug(`Firestore (${Fn}): ${n}`,...t)}}function ce(n,...e){if(Ct.logLevel<=nt.in.ERROR){const t=e.map(ua);Ct.error(`Firestore (${Fn}): ${n}`,...t)}}function Ue(n,...e){if(Ct.logLevel<=nt.in.WARN){const t=e.map(ua);Ct.warn(`Firestore (${Fn}): ${n}`,...t)}}function ua(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function S(n="Unexpected state"){const e=`FIRESTORE (${Fn}) INTERNAL ASSERTION FAILED: `+n;throw ce(e),new Error(e)}function C(n,e){n||S()}function w(n,e){return n}const g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class y extends L.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class fe{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class hh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Qp{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(_e.UNAUTHENTICATED))}shutdown(){}}class Wp{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Hp{constructor(e){this.t=e,this.currentUser=_e.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let o=new fe;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new fe,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,p.Z)(function*(){yield c.promise,yield s(r.currentUser)}))},u=c=>{I("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(I("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new fe)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(I("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(C("string"==typeof r.accessToken),new hh(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return C(null===e||"string"==typeof e),new _e(e)}}class Zp{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=_e.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Yp{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Zp(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(_e.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class dh{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Xp{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&I("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,I("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{I("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):I("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(C("string"==typeof t.token),this.R=t.token,new dh(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Jp(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class fh{static newId(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=Jp(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function k(n,e){return n<e?-1:n>e?1:0}function On(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function mh(n){return n+"\0"}class te{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new y(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new y(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new y(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new y(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return te.fromMillis(Date.now())}static fromDate(e){return te.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new te(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?k(this.nanoseconds,e.nanoseconds):k(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class b{constructor(e){this.timestamp=e}static fromTimestamp(e){return new b(e)}static min(){return new b(new te(0,0))}static max(){return new b(new te(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Wr{constructor(e,t,r){void 0===t?t=0:t>e.length&&S(),void 0===r?r=e.length-t:r>e.length-t&&S(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Wr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Wr?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class G extends Wr{construct(e,t,r){return new G(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new y(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new G(t)}static emptyPath(){return new G([])}}const e_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Y extends Wr{construct(e,t,r){return new Y(e,t,r)}static isValidIdentifier(e){return e_.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Y.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Y(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new y(g.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if("\\"===a){if(i+1===e.length)throw new y(g.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new y(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else"`"===a?(o=!o,i++):"."!==a||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new y(g.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Y(t)}static emptyPath(){return new Y([])}}class A{constructor(e){this.path=e}static fromPath(e){return new A(G.fromString(e))}static fromName(e){return new A(G.fromString(e).popFirst(5))}static empty(){return new A(G.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===G.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return G.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new A(new G(e.slice()))}}class Ln{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function ca(n){return n.fields.find(e=>2===e.kind)}function tn(n){return n.fields.filter(e=>2!==e.kind)}Ln.UNKNOWN_ID=-1;class nn{constructor(e,t){this.fieldPath=e,this.kind=t}}class Un{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Un(0,$e.min())}}function gh(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=b.fromTimestamp(1e9===r?new te(t+1,0):new te(t,r));return new $e(i,A.empty(),e)}function ph(n){return new $e(n.readTime,n.key,-1)}class $e{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new $e(b.min(),A.empty(),-1)}static max(){return new $e(b.max(),A.empty(),-1)}}function la(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=A.comparator(n.documentKey,e.documentKey),0!==t?t:k(n.largestBatchId,e.largestBatchId))}const _h="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class yh{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function bt(n){return ha.apply(this,arguments)}function ha(){return ha=(0,p.Z)(function*(n){if(n.code!==g.FAILED_PRECONDITION||n.message!==_h)throw n;I("LocalStore","Unexpectedly lost primary lease")}),ha.apply(this,arguments)}class m{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new m((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof m?t:m.resolve(t)}catch(t){return m.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):m.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):m.reject(t)}static resolve(e){return new m((t,r)=>{t(e)})}static reject(e){return new m((t,r)=>{r(e)})}static waitFor(e){return new m((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=m.resolve(!1);for(const r of e)t=t.next(i=>i?m.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new m((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let u=0;u<s;u++){const c=u;t(e[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new m((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class ms{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new fe,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Hr(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=da(r.target.error);this.V.reject(new Hr(e,i))}}static open(e,t,r,i){try{return new ms(t,e.transaction(i,r))}catch(s){throw new Hr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(I("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new i_(t)}}class Ye{constructor(e,t,r){this.name=e,this.version=t,this.p=r,12.2===Ye.S((0,L.z$)())&&ce("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return I("SimpleDb","Removing database:",e),rn(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,L.hl)())return!1;if(Ye.C())return!0;const e=(0,L.z$)(),t=Ye.S(e),r=0<t&&t<10,i=Ye.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){var t=this;return(0,p.Z)(function*(){return t.db||(I("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=o=>{r(o.target.result)},s.onblocked=()=>{i(new Hr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const a=o.target.error;i("VersionError"===a.name?new y(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new y(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new Hr(e,a))},s.onupgradeneeded=o=>{I("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.p.N(o.target.result,s.transaction,o.oldVersion,t.version).next(()=>{I("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.L&&(t.db.onversionchange=r=>t.L(r)),t.db})()}B(e){this.L=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,p.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{s.db=yield s.O(e);const u=ms.open(s.db,e,o?"readonly":"readwrite",r),c=i(u).next(l=>(u.g(),l)).catch(l=>(u.abort(l),m.reject(l))).toPromise();return c.catch(()=>{}),yield u.m,c}catch(u){const c=u,l="FirebaseError"!==c.name&&a<3;if(I("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),s.close(),!l)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class r_{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return rn(this.k.delete())}}class Hr extends y{constructor(e,t){super(g.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Dt(n){return"IndexedDbTransactionError"===n.name}class i_{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(I("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(I("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),rn(r)}add(e){return I("SimpleDb","ADD",this.store.name,e,e),rn(this.store.add(e))}get(e){return rn(this.store.get(e)).next(t=>(void 0===t&&(t=null),I("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return I("SimpleDb","DELETE",this.store.name,e),rn(this.store.delete(e))}count(){return I("SimpleDb","COUNT",this.store.name),rn(this.store.count())}W(e,t){const r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(r.range);return new m((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{const s=this.cursor(r),o=[];return this.G(s,(a,u)=>{o.push(u)}).next(()=>o)}}j(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new m((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(e,t){I("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.J=!1;const i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.G(i,t)}Z(e){const t=this.cursor({});return new m((r,i)=>{t.onerror=s=>{const o=da(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(e,t){const r=[];return new m((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const u=new r_(a),c=t(a.primaryKey,a.value,u);if(c instanceof m){const l=c.catch(h=>(u.done(),m.reject(h)));r.push(l)}u.isDone?i():null===u.$?a.continue():a.continue(u.$)}}).next(()=>m.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function rn(n){return new m((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=da(r.target.error);t(i)}})}let Th=!1;function da(n){const e=Ye.S((0,L.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Th||(Th=!0,setTimeout(()=>{throw r},0)),r}}return n}class s_{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(e){var t=this;I("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,p.Z)(function*(){t.task=null;try{I("IndexBackfiller",`Documents written: ${yield t.X.te()}`)}catch(r){Dt(r)?I("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",r):yield bt(r)}yield t.ee(6e4)}))}}class o_{constructor(e,t){this.localStore=e,this.persistence=t}te(e=50){var t=this;return(0,p.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.ne(r,e))})()}ne(e,t){const r=new Set;let i=t,s=!0;return m.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return I("IndexBackfiller",`Processing collection: ${o}`),this.re(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}re(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ie(i,s)).next(a=>(I("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ie(e,t){let r=e;return t.changes.forEach((i,s)=>{const o=ph(s);la(o,r)>0&&(r=o)}),new $e(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Ke=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}return n._e=-1,n})();function Zr(n){return null==n}function Yr(n){return 0===n&&1/n==-1/0}function Ih(n){return"number"==typeof n&&Number.isInteger(n)&&!Yr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function xe(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Eh(e)),e=a_(n.get(t),e);return Eh(e)}function a_(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Eh(n){return n+"\x01\x01"}function ot(n){const e=n.length;if(C(e>=2),2===e)return C("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),G.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const o=n.indexOf("\x01",s);switch((o<0||o>t)&&S(),n.charAt(o+1)){case"\x01":const a=n.substring(s,o);let u;0===i.length?u=a:(i+=a,u=i,i=""),r.push(u);break;case"\x10":i+=n.substring(s,o),i+="\0";break;case"\x11":i+=n.substring(s,o+1);break;default:S()}s=o+2}return new G(r)}const vh=["userId","batchId"];function gs(n,e){return[n,xe(e)]}function wh(n,e,t){return[n,xe(e),t]}const u_={},c_=["prefixPath","collectionGroup","readTime","documentId"],l_=["prefixPath","collectionGroup","documentId"],h_=["collectionGroup","readTime","prefixPath","documentId"],d_=["canonicalId","targetId"],f_=["targetId","path"],m_=["path","targetId"],g_=["collectionId","parent"],p_=["indexId","uid"],__=["uid","sequenceNumber"],y_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],T_=["indexId","uid","orderedDocumentKey"],I_=["userId","collectionPath","documentId"],E_=["userId","collectionPath","largestBatchId"],v_=["userId","collectionGroup","largestBatchId"],Ah=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],w_=[...Ah,"documentOverlays"],Rh=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ph=Rh,A_=[...Ph,"indexConfiguration","indexState","indexEntries"];class fa extends yh{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function ye(n,e){const t=w(n);return Ye.M(t.ae,e)}function Sh(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Nt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function xh(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class W{constructor(e,t){this.comparator=e,this.root=t||we.EMPTY}insert(e,t){return new W(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,we.BLACK,null,null))}remove(e){return new W(this.comparator,this.root.remove(e,this.comparator).copy(null,null,we.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ps(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ps(this.root,e,this.comparator,!1)}getReverseIterator(){return new ps(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ps(this.root,e,this.comparator,!0)}}class ps{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class we{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??we.RED,this.left=i??we.EMPTY,this.right=s??we.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new we(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return we.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return we.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,we.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,we.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw S();const e=this.left.check();if(e!==this.right.check())throw S();return e+(this.isRed()?0:1)}}we.EMPTY=null,we.RED=!0,we.BLACK=!1,we.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(e,t,r,i,s){return this}insert(e,t,r){return new we(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Q{constructor(e){this.comparator=e,this.data=new W(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Vh(this.data.getIterator())}getIteratorFrom(e){return new Vh(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Q)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Q(this.comparator);return t.data=e,t}}class Vh{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Bn(n){return n.hasNext()?n.getNext():void 0}class Be{constructor(e){this.fields=e,e.sort(Y.comparator)}static empty(){return new Be([])}unionWith(e){let t=new Q(Y.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Be(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return On(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class Ch extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class me{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ch("Invalid base64 string: "+s):s}}(e);return new me(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new me(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return k(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}me.EMPTY_BYTE_STRING=new me("");const P_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function kt(n){if(C(!!n),"string"==typeof n){let e=0;const t=P_.exec(n);if(C(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ae(n.seconds),nanos:ae(n.nanos)}}function ae(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function _t(n){return"string"==typeof n?me.fromBase64String(n):me.fromUint8Array(n)}function _s(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function ys(n){const e=n.mapValue.fields.__previous_value__;return _s(e)?ys(e):e}function Xr(n){const e=kt(n.mapValue.fields.__local_write_time__.timestampValue);return new te(e.seconds,e.nanos)}class S_{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}}class Ft{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Ft("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Ft&&e.projectId===this.projectId&&e.database===this.database}}const Mt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ts={nullValue:"NULL_VALUE"};function Ot(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?_s(n)?4:kh(n)?9007199254740991:10:S()}function at(n,e){if(n===e)return!0;const t=Ot(n);if(t!==Ot(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Xr(n).isEqual(Xr(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=kt(i.timestampValue),a=kt(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,_t(n.bytesValue).isEqual(_t(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ae(i.geoPointValue.latitude)===ae(s.geoPointValue.latitude)&&ae(i.geoPointValue.longitude)===ae(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ae(i.integerValue)===ae(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=ae(i.doubleValue),a=ae(s.doubleValue);return o===a?Yr(o)===Yr(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return On(n.arrayValue.values||[],e.arrayValue.values||[],at);case 10:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(Sh(o)!==Sh(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(void 0===a[u]||!at(o[u],a[u])))return!1;return!0}(n,e);default:return S()}var s}function Jr(n,e){return void 0!==(n.values||[]).find(t=>at(t,e))}function Lt(n,e){if(n===e)return 0;const t=Ot(n),r=Ot(e);if(t!==r)return k(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return k(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=ae(s.integerValue||s.doubleValue),u=ae(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return bh(n.timestampValue,e.timestampValue);case 4:return bh(Xr(n),Xr(e));case 5:return k(n.stringValue,e.stringValue);case 6:return function(s,o){const a=_t(s),u=_t(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){const l=k(a[c],u[c]);if(0!==l)return l}return k(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=k(ae(s.latitude),ae(o.latitude));return 0!==a?a:k(ae(s.longitude),ae(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){const a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){const l=Lt(a[c],u[c]);if(l)return l}return k(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===Mt.mapValue&&o===Mt.mapValue)return 0;if(s===Mt.mapValue)return 1;if(o===Mt.mapValue)return-1;const a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){const d=k(u[h],l[h]);if(0!==d)return d;const f=Lt(a[u[h]],c[l[h]]);if(0!==f)return f}return k(u.length,l.length)}(n.mapValue,e.mapValue);default:throw S()}}function bh(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return k(n,e);const t=kt(n),r=kt(e),i=k(t.seconds,r.seconds);return 0!==i?i:k(t.nanos,r.nanos)}function qn(n){return ma(n)}function ma(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=kt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?_t(n.bytesValue).toBase64():"referenceValue"in n?A.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=ma(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${ma(t.fields[o])}`;return i+"}"}(n.mapValue):S()}function sn(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ga(n){return!!n&&"integerValue"in n}function ei(n){return!!n&&"arrayValue"in n}function Dh(n){return!!n&&"nullValue"in n}function Nh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Es(n){return!!n&&"mapValue"in n}function ti(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Nt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ti(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ti(n.arrayValue.values[t]);return e}return Object.assign({},n)}function kh(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function x_(n){return"nullValue"in n?Ts:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?sn(Ft.empty(),A.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:S()}function V_(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?sn(Ft.empty(),A.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Mt:S()}function Fh(n,e){const t=Lt(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Mh(n,e){const t=Lt(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class Ae{constructor(e){this.value=e}static empty(){return new Ae({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Es(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ti(t)}setAll(e){let t=Y.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=ti(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Es(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return at(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Es(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Nt(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new Ae(ti(this.value))}}function Oh(n){const e=[];return Nt(n.fields,(t,r)=>{const i=new Y([t]);if(Es(r)){const s=Oh(r.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Be(e)}class X{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new X(e,0,b.min(),b.min(),b.min(),Ae.empty(),0)}static newFoundDocument(e,t,r,i){return new X(e,1,t,b.min(),r,i,0)}static newNoDocument(e,t){return new X(e,2,t,b.min(),b.min(),Ae.empty(),0)}static newUnknownDocument(e,t){return new X(e,3,t,b.min(),b.min(),Ae.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(b.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ae.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ae.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=b.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof X&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new X(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ut{constructor(e,t){this.position=e,this.inclusive=t}}function Lh(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(r=s.field.isKeyField()?A.comparator(A.fromName(o.referenceValue),t.key):Lt(o,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Uh(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!at(n.position[t],e.position[t]))return!1;return!0}class ni{constructor(e,t="asc"){this.field=e,this.dir=t}}function C_(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Bh{}class z extends Bh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new b_(e,t,r):"array-contains"===t?new k_(e,r):"in"===t?new Kh(e,r):"not-in"===t?new F_(e,r):"array-contains-any"===t?new M_(e,r):new z(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new D_(e,r):new N_(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Lt(t,this.value)):null!==t&&Ot(this.value)===Ot(t)&&this.matchesComparison(Lt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return S()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class K extends Bh{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new K(e,t)}matches(e){return Gn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Gn(n){return"and"===n.op}function pa(n){return"or"===n.op}function _a(n){return qh(n)&&Gn(n)}function qh(n){for(const e of n.filters)if(e instanceof K)return!1;return!0}function ya(n){if(n instanceof z)return n.field.canonicalString()+n.op.toString()+qn(n.value);if(_a(n))return n.filters.map(e=>ya(e)).join(",");{const e=n.filters.map(t=>ya(t)).join(",");return`${n.op}(${e})`}}function Gh(n,e){return n instanceof z?(r=n,(i=e)instanceof z&&r.op===i.op&&r.field.isEqual(i.field)&&at(r.value,i.value)):n instanceof K?function(r,i){return i instanceof K&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,o,a)=>s&&Gh(o,i.filters[a]),!0)}(n,e):void S();var r,i}function zh(n,e){const t=n.filters.concat(e);return K.create(t,n.op)}function jh(n){return n instanceof z?`${(t=n).field.canonicalString()} ${t.op} ${qn(t.value)}`:n instanceof K?function(t){return t.op.toString()+" {"+t.getFilters().map(jh).join(" ,")+"}"}(n):"Filter";var t}class b_ extends z{constructor(e,t,r){super(e,t,r),this.key=A.fromName(r.referenceValue)}matches(e){const t=A.comparator(e.key,this.key);return this.matchesComparison(t)}}class D_ extends z{constructor(e,t){super(e,"in",t),this.keys=$h(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class N_ extends z{constructor(e,t){super(e,"not-in",t),this.keys=$h(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function $h(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>A.fromName(r.referenceValue))}class k_ extends z{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ei(t)&&Jr(t.arrayValue,this.value)}}class Kh extends z{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Jr(this.value.arrayValue,t)}}class F_ extends z{constructor(e,t){super(e,"not-in",t)}matches(e){if(Jr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Jr(this.value.arrayValue,t)}}class M_ extends z{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ei(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Jr(this.value.arrayValue,r))}}class O_{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}}function Ta(n,e=null,t=[],r=[],i=null,s=null,o=null){return new O_(n,e,t,r,i,s,o)}function on(n){const e=w(n);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>ya(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Zr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>qn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>qn(r)).join(",")),e.ce=t}return e.ce}function ri(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!C_(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Gh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Uh(n.startAt,e.startAt)&&Uh(n.endAt,e.endAt)}function vs(n){return A.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function ws(n,e){return n.filters.filter(t=>t instanceof z&&t.field.isEqual(e))}function Qh(n,e,t){let r=Ts,i=!0;for(const s of ws(n,e)){let o=Ts,a=!0;switch(s.op){case"<":case"<=":o=x_(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Ts}Fh({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];Fh({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}function Wh(n,e,t){let r=Mt,i=!0;for(const s of ws(n,e)){let o=Mt,a=!0;switch(s.op){case">=":case">":o=V_(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Mt}Mh({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];Mh({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}class yt{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.le=null,this.he=null,this.Pe=null}}function Hh(n,e,t,r,i,s,o,a){return new yt(n,e,t,r,i,s,o,a)}function zn(n){return new yt(n)}function Zh(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function Ia(n){return null!==n.collectionGroup}function jn(n){const e=w(n);if(null===e.le){e.le=[];const t=new Set;for(const s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Q(Y.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new ni(s,r))}),t.has(Y.keyField().canonicalString())||e.le.push(new ni(Y.keyField(),r))}return e.le}function ke(n){const e=w(n);return e.he||(e.he=function Yh(n,e){if("F"===n.limitType)return Ta(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>new ni(i.field,"desc"===i.dir?"asc":"desc"));const t=n.endAt?new Ut(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ut(n.startAt.position,n.startAt.inclusive):null;return Ta(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}(e,jn(n))),e.he}function Ea(n,e){const t=n.filters.concat([e]);return new yt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function As(n,e,t){return new yt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ii(n,e){return ri(ke(n),ke(e))&&n.limitType===e.limitType}function Xh(n){return`${on(ke(n))}|lt:${n.limitType}`}function $n(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>jh(i)).join(", ")}]`),Zr(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>qn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>qn(i)).join(",")),`Target(${r})`}(ke(n))}; limitType=${n.limitType})`}function si(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):A.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of jn(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(o,a,u){const c=Lh(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,jn(r),i)||r.endAt&&!function(o,a,u){const c=Lh(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,jn(r),i)));var r,i}function Jh(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ed(n){return(e,t)=>{let r=!1;for(const i of jn(n)){const s=L_(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function L_(n,e,t){const r=n.field.isKeyField()?A.comparator(e.key,t.key):function(s,o,a){const u=o.data.field(s),c=a.data.field(s);return null!==u&&null!==c?Lt(u,c):S()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return S()}}class Tt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Nt(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return xh(this.inner)}size(){return this.innerSize}}const U_=new W(A.comparator);function qe(){return U_}const td=new W(A.comparator);function oi(...n){let e=td;for(const t of n)e=e.insert(t.key,t);return e}function nd(n){let e=td;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ut(){return ai()}function rd(){return ai()}function ai(){return new Tt(n=>n.toString(),(n,e)=>n.isEqual(e))}const B_=new W(A.comparator),q_=new Q(A.comparator);function O(...n){let e=q_;for(const t of n)e=e.add(t);return e}const G_=new Q(k);function va(){return G_}function id(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Yr(e)?"-0":e}}function sd(n){return{integerValue:""+n}}function od(n,e){return Ih(e)?sd(e):id(n,e)}class Rs{constructor(){this._=void 0}}function z_(n,e,t){return n instanceof Kn?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&_s(s)&&(s=ys(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof an?ud(n,e):n instanceof un?cd(n,e):function(i,s){const o=ad(i,s),a=ld(o)+ld(i.Ie);return ga(o)&&ga(i.Ie)?sd(a):id(i.serializer,a)}(n,e)}function j_(n,e,t){return n instanceof an?ud(n,e):n instanceof un?cd(n,e):t}function ad(n,e){return n instanceof Qn?ga(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class Kn extends Rs{}class an extends Rs{constructor(e){super(),this.elements=e}}function ud(n,e){const t=hd(e);for(const r of n.elements)t.some(i=>at(i,r))||t.push(r);return{arrayValue:{values:t}}}class un extends Rs{constructor(e){super(),this.elements=e}}function cd(n,e){let t=hd(e);for(const r of n.elements)t=t.filter(i=>!at(i,r));return{arrayValue:{values:t}}}class Qn extends Rs{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function ld(n){return ae(n.integerValue||n.doubleValue)}function hd(n){return ei(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class ui{constructor(e,t){this.field=e,this.transform=t}}class K_{constructor(e,t){this.version=e,this.transformResults=t}}class ne{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ne}static exists(e){return new ne(void 0,e)}static updateTime(e){return new ne(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ps(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class Ss{}function dd(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Hn(n.key,ne.none()):new Wn(n.key,n.data,ne.none());{const t=n.data,r=Ae.empty();let i=new Q(Y.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new It(n.key,r,new Be(i.toArray()),ne.none())}}function Q_(n,e,t){n instanceof Wn?function(i,s,o){const a=i.value.clone(),u=gd(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof It?function(i,s,o){if(!Ps(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=gd(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(md(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function ci(n,e,t,r){return n instanceof Wn?function(s,o,a,u){if(!Ps(s.precondition,o))return a;const c=s.value.clone(),l=pd(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof It?function(s,o,a,u){if(!Ps(s.precondition,o))return a;const c=pd(s.fieldTransforms,u,o),l=o.data;return l.setAll(md(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null===a?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):(a=t,Ps(n.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a);var o,a}function W_(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=ad(r.transform,i||null);null!=s&&(null===t&&(t=Ae.empty()),t.set(r.field,s))}return t||null}function fd(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&On(r,i,(s,o)=>function $_(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof an&&i instanceof an||r instanceof un&&i instanceof un?On(r.elements,i.elements,at):r instanceof Qn&&i instanceof Qn?at(r.Ie,i.Ie):r instanceof Kn&&i instanceof Kn);var r,i}(s,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class Wn extends Ss{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class It extends Ss{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function md(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function gd(n,e,t){const r=new Map;C(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,j_(o,a,t[i]))}return r}function pd(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,z_(s,o,e))}return r}class Hn extends Ss{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class wa extends Ss{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Aa{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Q_(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=ci(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=ci(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=rd();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const u=dd(o,a);null!==u&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(b.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),O())}isEqual(e){return this.batchId===e.batchId&&On(this.mutations,e.mutations,(t,r)=>fd(t,r))&&On(this.baseMutations,e.baseMutations,(t,r)=>fd(t,r))}}class Ra{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){C(e.mutations.length===r.length);let i=B_;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new Ra(e,t,r,i)}}class Pa{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Z_{constructor(e,t){this.count=e,this.unchangedNames=t}}var de,j;function _d(n){switch(n){default:return S();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function yd(n){if(void 0===n)return ce("GRPC error has no .code"),g.UNKNOWN;switch(n){case de.OK:return g.OK;case de.CANCELLED:return g.CANCELLED;case de.UNKNOWN:return g.UNKNOWN;case de.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case de.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case de.INTERNAL:return g.INTERNAL;case de.UNAVAILABLE:return g.UNAVAILABLE;case de.UNAUTHENTICATED:return g.UNAUTHENTICATED;case de.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case de.NOT_FOUND:return g.NOT_FOUND;case de.ALREADY_EXISTS:return g.ALREADY_EXISTS;case de.PERMISSION_DENIED:return g.PERMISSION_DENIED;case de.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case de.ABORTED:return g.ABORTED;case de.OUT_OF_RANGE:return g.OUT_OF_RANGE;case de.UNIMPLEMENTED:return g.UNIMPLEMENTED;case de.DATA_LOSS:return g.DATA_LOSS;default:return S()}}(j=de||(de={}))[j.OK=0]="OK",j[j.CANCELLED=1]="CANCELLED",j[j.UNKNOWN=2]="UNKNOWN",j[j.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",j[j.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",j[j.NOT_FOUND=5]="NOT_FOUND",j[j.ALREADY_EXISTS=6]="ALREADY_EXISTS",j[j.PERMISSION_DENIED=7]="PERMISSION_DENIED",j[j.UNAUTHENTICATED=16]="UNAUTHENTICATED",j[j.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",j[j.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",j[j.ABORTED=10]="ABORTED",j[j.OUT_OF_RANGE=11]="OUT_OF_RANGE",j[j.UNIMPLEMENTED=12]="UNIMPLEMENTED",j[j.INTERNAL=13]="INTERNAL",j[j.UNAVAILABLE=14]="UNAVAILABLE",j[j.DATA_LOSS=15]="DATA_LOSS";function Td(){return new TextEncoder}const Y_=new kn([4294967295,4294967295],0);function Id(n){const e=Td().encode(n),t=new jp;return t.update(e),new Uint8Array(t.digest())}function Ed(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new kn([t,r],0),new kn([i,s],0)]}class Sa{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new li(`Invalid padding: ${t}`);if(r<0)throw new li(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new li(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new li(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=kn.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(kn.fromNumber(r)));return 1===i.compare(Y_)&&(i=new kn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=Id(e),[r,i]=Ed(t);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new Sa(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(0===this.Te)return;const t=Id(e),[r,i]=Ed(t);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);this.Re(o)}}Re(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class li extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class hi{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,di.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new hi(b.min(),i,new W(k),qe(),O())}}class di{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new di(r,t,O(),O(),O())}}class Vs{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}}class vd{constructor(e,t){this.targetId=e,this.fe=t}}class wd{constructor(e,t,r=me.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Ad{constructor(){this.ge=0,this.pe=Pd(),this.ye=me.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=O(),t=O(),r=O();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:S()}}),new di(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=Pd()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,C(this.ge>=0)}Le(){this.Se=!0,this.we=!0}}class X_{constructor(e){this.Be=e,this.ke=new Map,this.qe=qe(),this.Qe=Rd(),this.Ke=new W(k)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{const r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Le(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:S()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){const t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){const s=i.target;if(vs(s))if(0===r){const o=new A(s.path);this.We(t,o,X.newNoDocument(o,b.min()))}else C(1===r);else{const o=this.Ze(t);if(o!==r){const a=this.Xe(e),u=a?this.et(a,e,o):1;0!==u&&(this.He(t),this.Ke=this.Ke.insert(t,2===u?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,a;try{o=_t(r).toUint8Array()}catch(u){if(u instanceof Ch)return Ue("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Sa(o,i,s)}catch(u){return Ue(u instanceof li?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return 0===a.Te?null:a}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){const r=this.Be.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const o=this.Be.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(t,s,null),i++)}),i}it(e){const t=new Map;this.ke.forEach((s,o)=>{const a=this.Ye(o);if(a){if(s.current&&vs(a.target)){const u=new A(a.target.path);null!==this.qe.get(u)||this.st(o,u)||this.We(o,u,X.newNoDocument(u,e))}s.De&&(t.set(o,s.ve()),s.Fe())}});let r=O();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Ye(u);return!c||"TargetPurposeLimboResolution"===c.purpose||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));const i=new hi(e,t,this.Ke,this.qe,r);return this.qe=qe(),this.Qe=Rd(),this.Ke=new W(k),i}Ue(e,t){if(!this.je(e))return;const r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;const i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new Ad,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new Q(k),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||I("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Be._t(e)}He(e){this.ke.set(e,new Ad),this.Be.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Be.getRemoteKeysForTarget(e).has(t)}}function Rd(){return new W(A.comparator)}function Pd(){return new W(A.comparator)}const J_={asc:"ASCENDING",desc:"DESCENDING"},ey={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ty={and:"AND",or:"OR"};class ny{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function xa(n,e){return n.useProto3Json||Zr(e)?e:{value:e}}function Zn(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Sd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function ry(n,e){return Zn(n,e.toTimestamp())}function le(n){return C(!!n),b.fromTimestamp(function(t){const r=kt(t);return new te(r.seconds,r.nanos)}(n))}function Va(n,e){return Ca(n,e).canonicalString()}function Ca(n,e){const t=(i=n,new G(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function xd(n){const e=G.fromString(n);return C(Ld(e)),e}function fi(n,e){return Va(n.databaseId,e.path)}function ct(n,e){const t=xd(e);if(t.get(1)!==n.databaseId.projectId)throw new y(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new y(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new A(bd(t))}function Vd(n,e){return Va(n.databaseId,e)}function Cd(n){const e=xd(n);return 4===e.length?G.emptyPath():bd(e)}function ba(n){return new G(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function bd(n){return C(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Dd(n,e,t){return{name:fi(n,e),fields:t.value.mapValue.fields}}function Nd(n,e,t){const r=ct(n,e.name),i=le(e.updateTime),s=e.createTime?le(e.createTime):b.min(),o=new Ae({mapValue:{fields:e.fields}}),a=X.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function mi(n,e){let t;if(e instanceof Wn)t={update:Dd(n,e.key,e.value)};else if(e instanceof Hn)t={delete:fi(n,e.key)};else if(e instanceof It)t={update:Dd(n,e.key,e.data),updateMask:hy(e.fieldMask)};else{if(!(e instanceof wa))return S();t={verify:fi(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof Kn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof an)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof un)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Qn)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw S()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:ry(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:S()),t;var s}function Da(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?ne.updateTime(le(s.updateTime)):void 0!==s.exists?ne.exists(s.exists):ne.none():ne.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;"setToServerValue"in a?(C("REQUEST_TIME"===a.setToServerValue),u=new Kn):"appendMissingElements"in a?u=new an(a.appendMissingElements.values||[]):"removeAllFromArray"in a?u=new un(a.removeAllFromArray.values||[]):"increment"in a?u=new Qn(o,a.increment):S();const c=Y.fromServerFormat(a.fieldPath);return new ui(c,u)}(n,i)):[];var s;if(e.update){const i=ct(n,e.update.name),s=new Ae({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Be((e.updateMask.fieldPaths||[]).map(l=>Y.fromServerFormat(l)));return new It(i,s,o,t,r)}return new Wn(i,s,t,r)}if(e.delete){const i=ct(n,e.delete);return new Hn(i,t)}if(e.verify){const i=ct(n,e.verify);return new wa(i,t)}return S()}function kd(n,e){return{documents:[Vd(n,e.path)]}}function Na(n,e){const t={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Vd(n,i);const s=function(c){if(0!==c.length)return Od(K.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const o=function(c){if(0!==c.length)return c.map(l=>{return{field:Bt((d=l).field),direction:uy(d.dir)};var d})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=xa(n,e.limit);return null!==a&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt={before:(c=e.startAt).inclusive,values:c.position}),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ut:t,parent:i};var c}function Fd(n){let e=Cd(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){C(1===r);const l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(h){const d=Md(h);return d instanceof K&&_a(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(d=>{return new ni(Yn((_=d).field),function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction));var _}));let a=null;t.limit&&(a=function(h){let d;return d="object"==typeof h?h.value:h,Zr(d)?null:d}(t.limit));let u=null;var h;t.startAt&&(u=new Ut((h=t.startAt).values||[],!!h.before));let c=null;return t.endAt&&(c=function(h){return new Ut(h.values||[],!h.before)}(t.endAt)),Hh(e,i,o,s,a,"F",u,c)}function Md(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Yn(t.unaryFilter.field);return z.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Yn(t.unaryFilter.field);return z.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Yn(t.unaryFilter.field);return z.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Yn(t.unaryFilter.field);return z.create(o,"!=",{nullValue:"NULL_VALUE"});default:return S()}}(n):void 0!==n.fieldFilter?z.create(Yn((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return K.create(t.compositeFilter.filters.map(r=>Md(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return S()}}(t.compositeFilter.op))}(n):S();var t}function uy(n){return J_[n]}function cy(n){return ey[n]}function ly(n){return ty[n]}function Bt(n){return{fieldPath:n.canonicalString()}}function Yn(n){return Y.fromServerFormat(n.fieldPath)}function Od(n){return n instanceof z?function(t){if("=="===t.op){if(Nh(t.value))return{unaryFilter:{field:Bt(t.field),op:"IS_NAN"}};if(Dh(t.value))return{unaryFilter:{field:Bt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Nh(t.value))return{unaryFilter:{field:Bt(t.field),op:"IS_NOT_NAN"}};if(Dh(t.value))return{unaryFilter:{field:Bt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Bt(t.field),op:cy(t.op),value:t.value}}}(n):n instanceof K?function(t){const r=t.getFilters().map(i=>Od(i));return 1===r.length?r[0]:{compositeFilter:{op:ly(t.op),filters:r}}}(n):S()}function hy(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Ld(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class Et{constructor(e,t,r,i,s=b.min(),o=b.min(),a=me.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new Et(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Et(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Et(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Et(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ud{constructor(e){this.ct=e}}function Bd(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Cs(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:fi(s=n.ct,(o=e).key),fields:o.data.value.mapValue.fields,updateTime:Zn(s,o.version.toTimestamp()),createTime:Zn(s,o.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:cn(e.version)};else{if(!e.isUnknownDocument())return S();r.unknownDocument={path:t.path.toArray(),version:cn(e.version)}}var s,o;return r}function Cs(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function cn(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ln(n){const e=new te(n.seconds,n.nanoseconds);return b.fromTimestamp(e)}function hn(n,e){const t=(e.baseMutations||[]).map(s=>Da(n.ct,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>Da(n.ct,s)),i=te.fromMillis(e.localWriteTimeMs);return new Aa(e.batchId,i,t,r)}function gi(n){const e=ln(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?ln(n.lastLimboFreeSnapshotVersion):b.min();let r;return r=void 0!==n.query.documents?(C(1===(s=n.query).documents.length),ke(zn(Cd(s.documents[0])))):function(s){return ke(Fd(s))}(n.query),new Et(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,me.fromBase64String(n.resumeToken));var s}function qd(n,e){const t=cn(e.snapshotVersion),r=cn(e.lastLimboFreeSnapshotVersion);let i;i=vs(e.target)?kd(n.ct,e.target):Na(n.ct,e.target).ut;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:on(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function ka(n){const e=Fd({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?As(e,e.limit,"L"):e}function Fa(n,e){return new Pa(e.largestBatchId,Da(n.ct,e.overlayMutation))}function Gd(n,e){const t=e.path.lastSegment();return[n,xe(e.path.popLast()),t]}function zd(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:cn(r.readTime),documentKey:xe(r.documentKey.path),largestBatchId:r.largestBatchId}}class fy{getBundleMetadata(e,t){return jd(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:ln(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return jd(e).put({bundleId:(i=t).id,createTime:cn(le(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return $d(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:ka(s.bundledQuery),readTime:ln(s.readTime)};var s})}saveNamedQuery(e,t){return $d(e).put({name:(i=t).name,readTime:cn(le(i.readTime)),bundledQuery:i.bundledQuery});var i}}function jd(n){return ye(n,"bundles")}function $d(n){return ye(n,"namedQueries")}class bs{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new bs(e,t.uid||"")}getOverlay(e,t){return pi(e).get(Gd(this.userId,t)).next(r=>r?Fa(this.serializer,r):null)}getOverlays(e,t){const r=ut();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,o)=>{const a=new Pa(t,o);i.push(this.ht(e,a))}),m.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(o=>i.add(xe(o.getCollectionPath())));const s=[];return i.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(pi(e).H("collectionPathOverlayIndex",a))}),m.waitFor(s)}getOverlaysForCollection(e,t,r){const i=ut(),s=xe(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return pi(e).W("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const c=Fa(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=ut();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return pi(e).Y({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{const h=Fa(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}ht(e,t){return pi(e).put(function(i,s,o){const[a,u,c]=Gd(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:mi(i.ct,o.mutation)}}(this.serializer,this.userId,t))}}function pi(n){return ye(n,"documentOverlays")}class dn{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(ae(e.integerValue));else if("doubleValue"in e){const r=ae(e.doubleValue);isNaN(r)?this.Et(t,13):(this.Et(t,15),Yr(r)?t.dt(0):t.dt(r))}else if("timestampValue"in e){const r=e.timestampValue;this.Et(t,20),"string"==typeof r?t.At(r):(t.At(`${r.seconds||""}`),t.dt(r.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(_t(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Et(t,45),t.dt(r.latitude||0),t.dt(r.longitude||0)}else"mapValue"in e?kh(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):S()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const r=e.fields||{};this.Et(t,55);for(const i of Object.keys(r))this.Rt(i,t),this.It(r[i],t)}wt(e,t){const r=e.values||[];this.Et(t,50);for(const i of r)this.It(i,t)}gt(e,t){this.Et(t,37),A.fromName(e).path.forEach(r=>{this.Et(t,60),this.St(r,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function my(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Kd(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const o=my(255&r[s]);if(i+=o,8!==o)break}return i}(n);return Math.ceil(e/8)}dn.bt=new dn;class gy{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ct(r.value),r=t.next();this.vt()}Ft(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Mt(r.value),r=t.next();this.xt()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ct(r);else if(r<2048)this.Ct(960|r>>>6),this.Ct(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ct(480|r>>>12),this.Ct(128|63&r>>>6),this.Ct(128|63&r);else{const i=t.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{const i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(e){const t=this.Bt(e),r=Kd(t);this.kt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){const t=this.Bt(e),r=Kd(t);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ct(e){const t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class py{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}}class _y{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class _i{constructor(){this.Gt=new gy,this.zt=new py(this.Gt),this.jt=new _y(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class fn{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Jt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new fn(this.indexId,this.documentKey,this.arrayValue,r)}}function qt(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=Qd(n.arrayValue,e.arrayValue),0!==t?t:(t=Qd(n.directionalValue,e.directionalValue),0!==t?t:A.comparator(n.documentKey,e.documentKey)))}function Qd(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class Wd{constructor(e){this.Yt=new Q((t,r)=>Y.comparator(t.field,r.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Yt=this.Yt.add(r):this.Xt.push(r)}}get en(){return this.Yt.size>1}tn(e){if(C(e.collectionGroup===this.collectionId),this.en)return!1;const t=ca(e);if(void 0!==t&&!this.nn(t))return!1;const r=tn(e);let i=new Set,s=0,o=0;for(;s<r.length&&this.nn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Yt.size>0){const a=this.Yt.getIterator().getNext();if(!i.has(a.field.canonicalString())){const u=r[s];if(!this.rn(a,u)||!this.sn(this.Zt[o++],u))return!1}++s}for(;s<r.length;++s)if(o>=this.Zt.length||!this.sn(this.Zt[o++],r[s]))return!1;return!0}on(){if(this.en)return null;let e=new Q(Y.comparator);const t=[];for(const r of this.Xt)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new nn(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new nn(r.field,0))}for(const r of this.Zt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new nn(r.field,"asc"===r.dir?0:1)));return new Ln(Ln.UNKNOWN_ID,this.collectionId,t,Un.empty())}nn(e){for(const t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Hd(n){var e,t;if(C(n instanceof z||n instanceof K),n instanceof z){if(n instanceof Kh){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>z.create(n.field,"==",s)))||[];return K.create(i,"or")}return n}const r=n.filters.map(i=>Hd(i));return K.create(r,n.op)}function yy(n){if(0===n.getFilters().length)return[];const e=La(Hd(n));return C(Zd(e)),Ma(e)||Oa(e)?[e]:e.getFilters()}function Ma(n){return n instanceof z}function Oa(n){return n instanceof K&&_a(n)}function Zd(n){return Ma(n)||Oa(n)||function(t){if(t instanceof K&&pa(t)){for(const r of t.getFilters())if(!Ma(r)&&!Oa(r))return!1;return!0}return!1}(n)}function La(n){if(C(n instanceof z||n instanceof K),n instanceof z)return n;if(1===n.filters.length)return La(n.filters[0]);const e=n.filters.map(r=>La(r));let t=K.create(e,n.op);return t=Ds(t),Zd(t)?t:(C(t instanceof K),C(Gn(t)),C(t.filters.length>1),t.filters.reduce((r,i)=>Ua(r,i)))}function Ua(n,e){let t;return C(n instanceof z||n instanceof K),C(e instanceof z||e instanceof K),t=n instanceof z?e instanceof z?K.create([n,e],"and"):Yd(n,e):e instanceof z?Yd(e,n):function(i,s){if(C(i.filters.length>0&&s.filters.length>0),Gn(i)&&Gn(s))return zh(i,s.getFilters());const o=pa(i)?i:s,a=pa(i)?s:i,u=o.filters.map(c=>Ua(c,a));return K.create(u,"or")}(n,e),Ds(t)}function Yd(n,e){if(Gn(e))return zh(e,n.getFilters());{const t=e.filters.map(r=>Ua(n,r));return K.create(t,"or")}}function Ds(n){if(C(n instanceof z||n instanceof K),n instanceof z)return n;const e=n.getFilters();if(1===e.length)return Ds(e[0]);if(qh(n))return n;const t=e.map(i=>Ds(i)),r=[];return t.forEach(i=>{i instanceof z?r.push(i):i instanceof K&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:K.create(r,n.op)}class Ty{constructor(){this._n=new Ba}addToCollectionParentIndex(e,t){return this._n.add(t),m.resolve()}getCollectionParents(e,t){return m.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return m.resolve()}deleteFieldIndex(e,t){return m.resolve()}deleteAllFieldIndexes(e){return m.resolve()}createTargetIndexes(e,t){return m.resolve()}getDocumentsMatchingTarget(e,t){return m.resolve(null)}getIndexType(e,t){return m.resolve(0)}getFieldIndexes(e,t){return m.resolve([])}getNextCollectionGroupToUpdate(e){return m.resolve(null)}getMinOffset(e,t){return m.resolve($e.min())}getMinOffsetFromCollectionGroup(e,t){return m.resolve($e.min())}updateCollectionGroup(e,t,r){return m.resolve()}updateIndexEntries(e,t){return m.resolve()}}class Ba{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Q(G.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Q(G.comparator)).toArray()}}const Ns=new Uint8Array(0);class Iy{constructor(e,t){this.databaseId=t,this.an=new Ba,this.un=new Tt(r=>on(r),(r,i)=>ri(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});const s={collectionId:r,parent:xe(i)};return Xd(e).put(s)}return m.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[mh(t),""],!1,!0);return Xd(e).W(i).next(s=>{for(const o of s){if(o.collectionId!==t)break;r.push(ot(o.parent))}return r})}addFieldIndex(e,t){const r=yi(e),i={indexId:(a=t).indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])};var a;delete i.indexId;const s=r.add(i);if(t.indexState){const o=Jn(e);return s.next(a=>{o.put(zd(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=yi(e),i=Jn(e),s=Xn(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=yi(e),r=Xn(e),i=Jn(e);return t.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(e,t){return m.forEach(this.cn(t),r=>this.getIndexType(e,r).next(i=>{if(0===i||1===i){const s=new Wd(r).on();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const r=Xn(e);let i=!0;const s=new Map;return m.forEach(this.cn(t),o=>this.ln(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=O();const a=[];return m.forEach(s,(u,c)=>{var R;I("IndexedDbIndexManager",`Using index ${R=u,`id=${R.indexId}|cg=${R.collectionGroup}|f=${R.fields.map(V=>`${V.fieldPath}:${V.kind}`).join(",")}`} to execute ${on(t)}`);const l=function(R,V){const U=ca(V);if(void 0===U)return null;for(const B of ws(R,U.fieldPath))switch(B.op){case"array-contains-any":return B.value.arrayValue.values||[];case"array-contains":return[B.value]}return null}(c,u),h=function(R,V){const U=new Map;for(const B of tn(V))for(const ee of ws(R,B.fieldPath))switch(ee.op){case"==":case"in":U.set(B.fieldPath.canonicalString(),ee.value);break;case"not-in":case"!=":return U.set(B.fieldPath.canonicalString(),ee.value),Array.from(U.values())}return null}(c,u),d=function(R,V){const U=[];let B=!0;for(const ee of tn(V)){const Ie=0===ee.kind?Qh(R,ee.fieldPath,R.startAt):Wh(R,ee.fieldPath,R.startAt);U.push(Ie.value),B&&(B=Ie.inclusive)}return new Ut(U,B)}(c,u),f=function(R,V){const U=[];let B=!0;for(const ee of tn(V)){const Ie=0===ee.kind?Wh(R,ee.fieldPath,R.endAt):Qh(R,ee.fieldPath,R.endAt);U.push(Ie.value),B&&(B=Ie.inclusive)}return new Ut(U,B)}(c,u),_=this.hn(u,c,d),v=this.hn(u,c,f),T=this.Pn(u,c,h),x=this.In(u.indexId,l,_,d.inclusive,v,f.inclusive,T);return m.forEach(x,N=>r.j(N,t.limit).next(R=>{R.forEach(V=>{const U=A.fromSegments(V.documentKey);o.has(U)||(o=o.add(U),a.push(U))})}))}).next(()=>a)}return m.resolve(null)})}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:yy(K.create(e.filters,"and")).map(r=>Ta(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,r,i,s,o,a){const u=(null!=t?t.length:1)*Math.max(r.length,s.length),c=u/(null!=t?t.length:1),l=[];for(let h=0;h<u;++h){const d=t?this.Tn(t[h/c]):Ns,f=this.En(e,d,r[h%c],i),_=this.dn(e,d,s[h%c],o),v=a.map(T=>this.En(e,d,T,!0));l.push(...this.createRange(f,_,v))}return l}En(e,t,r,i){const s=new fn(e,A.empty(),t,r);return i?s:s.Jt()}dn(e,t,r,i){const s=new fn(e,A.empty(),t,r);return i?s.Jt():s}ln(e,t){const r=new Wd(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const a of s)r.tn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const i=this.cn(t);return m.forEach(i,s=>this.ln(e,s).next(o=>{o?0!==r&&o.fields.length<function(u){let c=new Q(Y.comparator),l=!1;for(const h of u.filters)for(const d of h.getFlattenedFilters())d.field.isKeyField()||("array-contains"===d.op||"array-contains-any"===d.op?l=!0:c=c.add(d.field));for(const h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}An(e,t){const r=new _i;for(const i of tn(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const o=r.Ht(i.kind);dn.bt.Pt(s,o)}return r.Wt()}Tn(e){const t=new _i;return dn.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){const r=new _i;return dn.bt.Pt(sn(this.databaseId,t),r.Ht(function(s){const o=tn(s);return 0===o.length?0:o[o.length-1].kind}(e))),r.Wt()}Pn(e,t,r){if(null===r)return[];let i=[];i.push(new _i);let s=0;for(const o of tn(e)){const a=r[s++];for(const u of i)if(this.Vn(t,o.fieldPath)&&ei(a))i=this.mn(i,o,a);else{const c=u.Ht(o.kind);dn.bt.Pt(a,c)}}return this.fn(i)}hn(e,t,r){return this.Pn(e,t,r.position)}fn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Wt();return t}mn(e,t,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const a of i){const u=new _i;u.seed(a.Wt()),dn.bt.Pt(o,u.Ht(t.kind)),s.push(u)}return s}Vn(e,t){return!!e.filters.find(r=>r instanceof z&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=yi(e),i=Jn(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{const o=[];return m.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){const d=h?new Un(h.sequenceNumber,new $e(ln(h.readTime),new A(ot(h.documentKey)),h.largestBatchId)):Un.empty(),f=l.fields.map(([_,v])=>new nn(Y.fromServerFormat(_),v));return new Ln(l.indexId,l.collectionGroup,f,d)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:k(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=yi(e),s=Jn(e);return this.gn(e).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>m.forEach(a,u=>s.put(zd(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return m.forEach(t,(i,s)=>{const o=r.get(i.collectionGroup);return(o?m.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),m.forEach(a,u=>this.pn(e,i,u).next(c=>{const l=this.yn(s,u);return c.isEqual(l)?m.resolve():this.wn(e,s,u,c,l)}))))})}Sn(e,t,r,i){return Xn(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(r,t.key),documentKey:t.key.path.toArray()})}bn(e,t,r,i){return Xn(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(r,t.key),t.key.path.toArray()])}pn(e,t,r){const i=Xn(e);let s=new Q(qt);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.Rn(r,t)])},(o,a)=>{s=s.add(new fn(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}yn(e,t){let r=new Q(qt);const i=this.An(t,e);if(null==i)return r;const s=ca(t);if(null!=s){const o=e.data.field(s.fieldPath);if(ei(o))for(const a of o.arrayValue.values||[])r=r.add(new fn(t.indexId,e.key,this.Tn(a),i))}else r=r.add(new fn(t.indexId,e.key,Ns,i));return r}wn(e,t,r,i,s){I("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(u,c,l,h,d){const f=u.getIterator(),_=c.getIterator();let v=Bn(f),T=Bn(_);for(;v||T;){let x=!1,N=!1;if(v&&T){const R=l(v,T);R<0?N=!0:R>0&&(x=!0)}else null!=v?N=!0:x=!0;x?(h(T),T=Bn(_)):N?(d(v),v=Bn(f)):(v=Bn(f),T=Bn(_))}}(i,s,qt,a=>{o.push(this.Sn(e,t,r,a))},a=>{o.push(this.bn(e,t,r,a))}),m.waitFor(o)}gn(e){let t=1;return Jn(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>qt(o,a)).filter((o,a,u)=>!a||0!==qt(o,u[a-1]));const i=[];i.push(e);for(const o of r){const a=qt(o,e),u=qt(o,t);if(0===a)i[0]=e.Jt();else if(a>0&&u<0)i.push(o),i.push(o.Jt());else if(u>0)break}i.push(t);const s=[];for(let o=0;o<i.length;o+=2){if(this.Dn(i[o],i[o+1]))return[];s.push(IDBKeyRange.bound([i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Ns,[]],[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Ns,[]]))}return s}Dn(e,t){return qt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Jd)}getMinOffset(e,t){return m.mapArray(this.cn(t),r=>this.ln(e,r).next(i=>i||S())).next(Jd)}}function Xd(n){return ye(n,"collectionParents")}function Xn(n){return ye(n,"indexEntries")}function yi(n){return ye(n,"indexConfiguration")}function Jn(n){return ye(n,"indexState")}function Jd(n){C(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;la(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new $e(e.readTime,e.documentKey,t)}const ef={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ve{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Ve(e,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function tf(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.Y({range:o},(l,h,d)=>(a++,d.delete()));s.push(u.next(()=>{C(1===a)}));const c=[];for(const l of t.mutations){const h=wh(e,l.key.path,t.batchId);s.push(i.delete(h)),c.push(l.key)}return m.waitFor(s).next(()=>c)}function ks(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw S();e=n.noDocument}return JSON.stringify(e).length}Ve.DEFAULT_COLLECTION_PERCENTILE=10,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ve.DEFAULT=new Ve(41943040,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ve.DISABLED=new Ve(-1,0,0);class Fs{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Cn={}}static lt(e,t,r,i){C(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Fs(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Gt(e).Y({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=er(e),o=Gt(e);return o.add({}).next(a=>{C("number"==typeof a);const u=new Aa(a,t,r,i),c=function(f,_,v){const T=v.baseMutations.map(N=>mi(f.ct,N)),x=v.mutations.map(N=>mi(f.ct,N));return{userId:_,batchId:v.batchId,localWriteTimeMs:v.localWriteTime.toMillis(),baseMutations:T,mutations:x}}(this.serializer,this.userId,u),l=[];let h=new Q((d,f)=>k(d.canonicalString(),f.canonicalString()));for(const d of i){const f=wh(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(s.put(f,u_))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.Cn[a]=u.keys()}),m.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return Gt(e).get(t).next(r=>r?(C(r.userId===this.userId),hn(this.serializer,r)):null)}vn(e,t){return this.Cn[t]?m.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Cn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Gt(e).Y({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(C(a.batchId>=r),s=hn(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Gt(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Gt(e).W("userMutationsIndex",t).next(r=>r.map(i=>hn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=gs(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return er(e).Y({range:i},(o,a,u)=>{const[c,l,h]=o,d=ot(l);if(c===this.userId&&t.path.isEqual(d))return Gt(e).get(h).next(f=>{if(!f)throw S();C(f.userId===this.userId),s.push(hn(this.serializer,f))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Q(k);const i=[];return t.forEach(s=>{const o=gs(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=er(e).Y({range:a},(c,l,h)=>{const[d,f,_]=c,v=ot(f);d===this.userId&&s.path.isEqual(v)?r=r.add(_):h.done()});i.push(u)}),m.waitFor(i).next(()=>this.Fn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=gs(this.userId,r),o=IDBKeyRange.lowerBound(s);let a=new Q(k);return er(e).Y({range:o},(u,c,l)=>{const[h,d,f]=u,_=ot(d);h===this.userId&&r.isPrefixOf(_)?_.length===i&&(a=a.add(f)):l.done()}).next(()=>this.Fn(e,a))}Fn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(Gt(e).get(s).next(o=>{if(null===o)throw S();C(o.userId===this.userId),r.push(hn(this.serializer,o))}))}),m.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return tf(e.ae,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),m.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return m.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return er(e).Y({range:r},(s,o,a)=>{if(s[0]===this.userId){const u=ot(s[1]);i.push(u)}else a.done()}).next(()=>{C(0===i.length)})})}containsKey(e,t){return nf(e,this.userId,t)}xn(e){return rf(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function nf(n,e,t){const r=gs(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return er(n).Y({range:s,J:!0},(a,u,c)=>{const[l,h,d]=a;l===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function Gt(n){return ye(n,"mutations")}function er(n){return ye(n,"documentMutations")}function rf(n){return ye(n,"mutationQueues")}class mn{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new mn(0)}static Ln(){return new mn(-1)}}class Ey{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{const r=new mn(t.highestTargetId);return t.highestTargetId=r.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>b.fromTimestamp(new te(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.kn(e,i)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.Qn(t,r),this.kn(e,r))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>tr(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(C(r.targetCount>0),r.targetCount-=1,this.kn(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return tr(e).Y((o,a)=>{const u=gi(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>m.waitFor(s)).next(()=>i)}forEachTarget(e,t){return tr(e).Y((r,i)=>{const s=gi(i);t(s)})}Bn(e){return sf(e).get("targetGlobalKey").next(t=>(C(null!==t),t))}kn(e,t){return sf(e).put("targetGlobalKey",t)}qn(e,t){return tr(e).put(qd(this.serializer,t))}Qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=on(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return tr(e).Y({range:i,index:"queryTargetsIndex"},(o,a,u)=>{const c=gi(a);ri(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=zt(e);return t.forEach(o=>{const a=xe(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),m.waitFor(i)}removeMatchingKeys(e,t,r){const i=zt(e);return m.forEach(t,s=>{const o=xe(s.path);return m.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=zt(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=zt(e);let s=O();return i.Y({range:r,J:!0},(o,a,u)=>{const c=ot(o[1]),l=new A(c);s=s.add(l)}).next(()=>s)}containsKey(e,t){const r=xe(t.path),i=IDBKeyRange.bound([r],[mh(r)],!1,!0);let s=0;return zt(e).Y({index:"documentTargetsIndex",J:!0,range:i},([o,a],u,c)=>{0!==o&&(s++,c.done())}).next(()=>s>0)}_t(e,t){return tr(e).get(t).next(r=>r?gi(r):null)}}function tr(n){return ye(n,"targets")}function sf(n){return ye(n,"targetGlobal")}function zt(n){return ye(n,"targetDocuments")}function af([n,e],[t,r]){const i=k(n,t);return 0===i?k(e,r):i}class vy{constructor(e){this.Kn=e,this.buffer=new Q(af),this.$n=0}Un(){return++this.$n}Wn(e){const t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();af(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class uf{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){var t=this;I("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,p.Z)(function*(){t.Gn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){Dt(r)?I("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield bt(r)}yield t.zn(3e5)}))}}class wy{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return m.resolve(Ke._e);const r=new vy(t);return this.jn.forEachTarget(e,i=>r.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>r.Wn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector","Garbage collection skipped; disabled"),m.resolve(ef)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ef):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let r,i,s,o,a,u,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(I("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),Mn()<=nt.in.DEBUG&&I("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${i} in `+(a-o)+`ms\n\tRemoved ${s} targets in `+(u-a)+`ms\n\tRemoved ${h} documents in `+(c-u)+`ms\nTotal Duration: ${c-l}ms`),m.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}}class Ay{constructor(e,t){this.db=e,this.garbageCollector=function cf(n,e){return new wy(n,e)}(this,t)}Hn(e){const t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Zn(e){let t=0;return this.Jn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(r,i)=>t(i))}addReference(e,t,r){return Ms(e,r)}removeReference(e,t,r){return Ms(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Ms(e,t)}er(e,t){return function(i,s){let o=!1;return rf(i).Z(a=>nf(i,a,s).next(u=>(u&&(o=!0),m.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Xn(e,(o,a)=>{if(a<=t){const u=this.er(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,b.min()),zt(e).delete([0,xe(o.path)])))});i.push(u)}}).next(()=>m.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Ms(e,t)}Xn(e,t){const r=zt(e);let i,s=Ke._e;return r.Y({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{0===o?(s!==Ke._e&&t(new A(ot(i)),s),s=c,i=u):s=Ke._e}).next(()=>{s!==Ke._e&&t(new A(ot(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Ms(n,e){return zt(n).put((i=n.currentSequenceNumber,{targetId:0,path:xe(e.path),sequenceNumber:i}));var i}class lf{constructor(){this.changes=new Tt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,X.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?m.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Ry{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return gn(e).put(r)}removeEntry(e,t,r){return gn(e).delete(function(s,o){const a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Cs(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.tr(e,r)))}getEntry(e,t){let r=X.newInvalidDocument(t);return gn(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Ti(t))},(i,s)=>{r=this.nr(t,s)}).next(()=>r)}rr(e,t){let r={size:0,document:X.newInvalidDocument(t)};return gn(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Ti(t))},(i,s)=>{r={document:this.nr(t,s),size:ks(s)}}).next(()=>r)}getEntries(e,t){let r=qe();return this.ir(e,t,(i,s)=>{const o=this.nr(i,s);r=r.insert(i,o)}).next(()=>r)}sr(e,t){let r=qe(),i=new W(A.comparator);return this.ir(e,t,(s,o)=>{const a=this.nr(s,o);r=r.insert(s,a),i=i.insert(s,ks(o))}).next(()=>({documents:r,_r:i}))}ir(e,t,r){if(t.isEmpty())return m.resolve();let i=new Q(mf);t.forEach(u=>i=i.add(u));const s=IDBKeyRange.bound(Ti(i.first()),Ti(i.last())),o=i.getIterator();let a=o.getNext();return gn(e).Y({index:"documentKeyIndex",range:s},(u,c,l)=>{const h=A.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&mf(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.U(Ti(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Cs(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return gn(e).W(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=qe();for(const h of c){const d=this.nr(A.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(si(t,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(e,t,r,i){let s=qe();const o=ff(t,r),a=ff(t,$e.max());return gn(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{const h=this.nr(A.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(e){return new Py(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return df(e).get("remoteDocumentGlobalKey").next(t=>(C(!!t),t))}tr(e,t){return df(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){const r=function dy(n,e){let t;if(e.document)t=Nd(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=A.fromSegments(e.noDocument.path),i=ln(e.noDocument.readTime);t=X.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return S();{const r=A.fromSegments(e.unknownDocument.path),i=ln(e.unknownDocument.version);t=X.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new te(i[0],i[1]);return b.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(b.min()))return r}return X.newInvalidDocument(e)}}function hf(n){return new Ry(n)}class Py extends lf{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new Tt(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new Q((s,o)=>k(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,a.readTime)),o.isValidDocument()){const u=Bd(this.ar.serializer,o);i=i.add(s.path.popLast());const c=ks(u);r+=c-a.size,t.push(this.ar.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){const u=Bd(this.ar.serializer,o.convertToNoDocument(b.min()));t.push(this.ar.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ar.updateMetadata(e,r)),m.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(r=>(this.ur.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:r,_r:i})=>(i.forEach((s,o)=>{this.ur.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function df(n){return ye(n,"remoteDocumentGlobal")}function gn(n){return ye(n,"remoteDocumentsV14")}function Ti(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ff(n,e){const t=e.documentKey.path.toArray();return[n,Cs(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function mf(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=k(t[s],r[s]),i)return i;return i=k(t.length,r.length),i||(i=k(t[t.length-2],r[r.length-2]),i||k(t[t.length-1],r[r.length-1]))}class Sy{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class gf{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&ci(r.mutation,i,Be.empty(),te.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,O()).next(()=>r))}getLocalViewOfDocuments(e,t,r=O()){const i=ut();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=oi();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=ut();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,O()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=qe();const o=ai(),a=ai();return t.forEach((u,c)=>{const l=r.get(c.key);i.has(c.key)&&(void 0===l||l.mutation instanceof It)?s=s.insert(c.key,c):void 0!==l?(o.set(c.key,l.mutation.getFieldMask()),ci(l.mutation,c,l.mutation.getFieldMask(),te.now())):o.set(c.key,Be.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new Sy(l,null!==(h=o.get(c))&&void 0!==h?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=ai();let i=new W((o,a)=>o-a),s=O();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(null===c)return;let l=r.get(u)||Be.empty();l=a.applyToLocalView(c,l),r.set(u,l);const h=(i.get(a.batchId)||O()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,l=u.value,h=rd();l.forEach(d=>{if(!s.has(d)){const f=dd(t.get(d),r.get(d));null!==f&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return A.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Ia(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i);var o}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):m.resolve(ut());let a=-1,u=s;return o.next(c=>m.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?m.resolve():this.remoteDocumentCache.getEntry(e,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,O())).next(l=>({batchId:a,changes:nd(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new A(t)).next(r=>{let i=oi();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=oi();return this.indexManager.getCollectionParents(e,s).next(a=>m.forEach(a,u=>{const c=(h=t,d=u.child(s),new yt(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt));var h,d;return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{const l=c.getKey();null===o.get(l)&&(o=o.insert(l,X.newInvalidDocument(l)))});let a=oi();return o.forEach((u,c)=>{const l=s.get(u);void 0!==l&&ci(l.mutation,c,Be.empty(),te.now()),si(t,c)&&(a=a.insert(u,c))}),a})}}class xy{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return m.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,{id:(i=t).id,version:i.version,createTime:le(i.createTime)}),m.resolve();var i}getNamedQuery(e,t){return m.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,{name:(i=t).name,query:ka(i.bundledQuery),readTime:le(i.readTime)}),m.resolve();var i}}class Vy{constructor(){this.overlays=new W(A.comparator),this.hr=new Map}getOverlay(e,t){return m.resolve(this.overlays.get(t))}getOverlays(e,t){const r=ut();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),m.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.hr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),m.resolve()}getOverlaysForCollection(e,t,r){const i=ut(),s=t.length+1,o=new A(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return m.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new W((c,l)=>c-l);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=s.get(c.largestBatchId);null===l&&(l=ut(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}const a=ut(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return m.resolve(a)}ht(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Pa(t,r));let s=this.hr.get(t);void 0===s&&(s=O(),this.hr.set(t,s)),this.hr.set(t,s.add(r.key))}}class qa{constructor(){this.Pr=new Q(Te.Ir),this.Tr=new Q(Te.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const r=new Te(e,t);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Ar(new Te(e,t))}Rr(e,t){e.forEach(r=>this.removeReference(r,t))}Vr(e){const t=new A(new G([])),r=new Te(t,e),i=new Te(t,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new A(new G([])),r=new Te(t,e),i=new Te(t,e+1);let s=O();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new Te(e,0),r=this.Pr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class Te{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return A.comparator(e.key,t.key)||k(e.pr,t.pr)}static Er(e,t){return k(e.pr,t.pr)||A.comparator(e.key,t.key)}}class Cy{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new Q(Te.Ir)}checkEmpty(e){return m.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.yr;this.yr++;const o=new Aa(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.wr=this.wr.add(new Te(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(e,t){return m.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.br(t+1),s=i<0?0:i;return m.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Te(t,0),i=new Te(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{const a=this.Sr(o.pr);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Q(k);return t.forEach(i=>{const s=new Te(i,0),o=new Te(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),m.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;A.isDocumentKey(s)||(s=s.child(""));const o=new Te(new A(s),0);let a=new Q(k);return this.wr.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.pr)),!0)},o),m.resolve(this.Dr(a))}Dr(e){const t=[];return e.forEach(r=>{const i=this.Sr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){C(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let r=this.wr;return m.forEach(t.mutations,i=>{const s=new Te(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,t){const r=new Te(t,0),i=this.wr.firstAfterOrEqual(r);return m.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return m.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class by{constructor(e){this.vr=e,this.docs=new W(A.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return m.resolve(r?r.document.mutableCopy():X.newInvalidDocument(t))}getEntries(e,t){let r=qe();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():X.newInvalidDocument(i))}),m.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=qe();const o=t.path,a=new A(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||la(ph(l),r)<=0||(i.has(l.key)||si(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return m.resolve(s)}getAllFromCollectionGroup(e,t,r,i){S()}Fr(e,t){return m.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Dy(this)}getSize(e){return m.resolve(this.size)}}class Dy extends lf{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),m.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Ny{constructor(e){this.persistence=e,this.Mr=new Tt(t=>on(t),ri),this.lastRemoteSnapshotVersion=b.min(),this.highestTargetId=0,this.Or=0,this.Nr=new qa,this.targetCount=0,this.Lr=mn.Nn()}forEachTarget(e,t){return this.Mr.forEach((r,i)=>t(i)),m.resolve()}getLastRemoteSnapshotVersion(e){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return m.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Or&&(this.Or=t),m.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new mn(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,m.resolve()}updateTargetData(e,t){return this.qn(t),m.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,m.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),m.waitFor(s).next(()=>i)}getTargetCount(e){return m.resolve(this.targetCount)}getTargetData(e,t){const r=this.Mr.get(t)||null;return m.resolve(r)}addMatchingKeys(e,t,r){return this.Nr.dr(t,r),m.resolve()}removeMatchingKeys(e,t,r){this.Nr.Rr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),m.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Nr.gr(t);return m.resolve(r)}containsKey(e,t){return m.resolve(this.Nr.containsKey(t))}}class Ga{constructor(e,t){this.Br={},this.overlays={},this.kr=new Ke(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Ny(this),this.indexManager=new Ty,this.remoteDocumentCache=new by(r=>this.referenceDelegate.Kr(r)),this.serializer=new Ud(t),this.$r=new xy(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Vy,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new Cy(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,r){I("MemoryPersistence","Starting transaction:",e);const i=new ky(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return m.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}}class ky extends yh{constructor(e){super(),this.currentSequenceNumber=e}}class Os{constructor(e){this.persistence=e,this.zr=new qa,this.jr=null}static Hr(e){return new Os(e)}get Jr(){if(this.jr)return this.jr;throw S()}addReference(e,t,r){return this.zr.addReference(r,t),this.Jr.delete(r.toString()),m.resolve()}removeReference(e,t,r){return this.zr.removeReference(r,t),this.Jr.add(r.toString()),m.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),m.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.Jr,r=>{const i=A.fromPath(r);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,b.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(r=>{r?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return m.or([()=>m.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class Fy{constructor(e){this.serializer=e}N(e,t,r,i){const s=new ms("createOrUpgrade",t);var u;r<1&&i>=1&&(e.createObjectStore("owner"),(u=e).createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",vh,{unique:!0}),u.createObjectStore("documentMutations"),pf(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=m.resolve();return r<3&&i>=3&&(0!==r&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),pf(e)),o=o.next(()=>function(u){const c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:b.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(0!==r&&(o=o.next(()=>function(u,c){return c.store("mutations").W().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",vh,{unique:!0});const h=c.store("mutations"),d=l.map(f=>h.put(f));return m.waitFor(d)})}(e,s))),o=o.next(()=>{!function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(o=o.next(()=>this.Xr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),r<7&&i>=7&&(o=o.next(()=>this.ti(s))),r<8&&i>=8&&(o=o.next(()=>this.ni(e,s))),r<9&&i>=9&&(o=o.next(()=>{!function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(o=o.next(()=>this.ri(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{!function(u){const c=u.createObjectStore("documentOverlays",{keyPath:I_});c.createIndex("collectionPathOverlayIndex",E_,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",v_,{unique:!1})}(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){const c=u.createObjectStore("remoteDocumentsV14",{keyPath:c_});c.createIndex("documentKeyIndex",l_),c.createIndex("collectionGroupIndex",h_)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.si(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:p_}).createIndex("sequenceNumberIndex",__,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:y_}).createIndex("documentKeyIndex",T_,{unique:!1})}(e))),o}ei(e){let t=0;return e.store("remoteDocuments").Y((r,i)=>{t+=ks(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Xr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>m.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>m.forEach(a,u=>{C(u.userId===s.userId);const c=hn(this.serializer,u);return tf(e,s.userId,c).next(()=>{})}))}))}ti(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Y((o,a)=>{const u=new G(o),c=[0,xe(u)];s.push(t.get(c).next(l=>l?m.resolve():t.put({targetId:0,path:xe(u),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>m.waitFor(s))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:g_});const r=t.store("collectionParents"),i=new Ba,s=o=>{if(i.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:xe(u)})}};return t.store("remoteDocuments").Y({J:!0},(o,a)=>{const u=new G(o);return s(u.popLast())}).next(()=>t.store("documentMutations").Y({J:!0},([o,a,u],c)=>{const l=ot(a);return s(l.popLast())}))}ri(e){const t=e.store("targets");return t.Y((r,i)=>{const s=gi(i),o=qd(this.serializer,s);return t.put(o)})}ii(e,t){const r=t.store("remoteDocuments"),i=[];return r.Y((s,o)=>{const a=t.store("remoteDocumentsV14"),u=(h=o,h.document?new A(G.fromString(h.document.name).popFirst(5)):h.noDocument?A.fromSegments(h.noDocument.path):h.unknownDocument?A.fromSegments(h.unknownDocument.path):S()).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};var h;i.push(a.put(c))}).next(()=>m.waitFor(i))}si(e,t){const r=t.store("mutations"),i=hf(this.serializer),s=new Ga(Os.Hr,this.serializer.ct);return r.W().next(o=>{const a=new Map;return o.forEach(u=>{var c;let l=null!==(c=a.get(u.userId))&&void 0!==c?c:O();hn(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),m.forEach(a,(u,c)=>{const l=new _e(c),h=bs.lt(this.serializer,l),d=s.getIndexManager(l),f=Fs.lt(l,this.serializer,d,s.referenceDelegate);return new gf(i,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new fa(t,Ke._e),u).next()})})}}function pf(n){n.createObjectStore("targetDocuments",{keyPath:f_}).createIndex("documentTargetsIndex",m_,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",d_,{unique:!0}),n.createObjectStore("targetGlobal")}const za="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class ja{constructor(e,t,r,i,s,o,a,u,c,l,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.oi=s,this.window=o,this.document=a,this._i=c,this.ai=l,this.ui=h,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=d=>Promise.resolve(),!ja.D())throw new y(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ay(this,i),this.Ti=t+"main",this.serializer=new Ud(u),this.Ei=new Ye(this.Ti,this.ui,new Fy(this.serializer)),this.Qr=new Ey(this.referenceDelegate,this.serializer),this.remoteDocumentCache=hf(this.serializer),this.$r=new fy,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===l&&ce("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(g.FAILED_PRECONDITION,za);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new Ke(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){var t=this;return this.Ii=function(){var r=(0,p.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.B(function(){var t=(0,p.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget((0,p.Z)(function*(){t.started&&(yield t.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Us(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(t=>{t||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(Dt(e))return I("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return I("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return Ii(e).get("owner").next(t=>m.resolve(this.Si(t)))}bi(e){return Us(e).delete(this.clientId)}Di(){var e=this;return(0,p.Z)(function*(){if(e.isPrimary&&!e.Ci(e.Pi,18e5)){e.Pi=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=ye(r,"clientMetadata");return i.W().next(s=>{const o=e.vi(s,18e5),a=s.filter(u=>-1===o.indexOf(u));return m.forEach(a,u=>i.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.di)for(const r of t)e.di.removeItem(e.Fi(r.clientId))}})()}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?m.resolve(!0):Ii(e).get("owner").next(t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new y(g.FAILED_PRECONDITION,za);return!1}}return!(!this.networkEnabled||!this.inForeground)||Us(e).W().next(r=>void 0===this.vi(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&I("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,p.Z)(function*(){e.qr=!1,e.xi(),e.hi&&(e.hi.cancel(),e.hi=null),e.Oi(),e.Ni(),yield e.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new fa(t,Ke._e);return e.yi(r).next(()=>e.bi(r))}),e.Ei.close(),e.Li()})()}vi(e,t){return e.filter(r=>this.Ci(r.updateTimeMs,t)&&!this.Mi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>Us(e).W().next(t=>this.vi(t,18e5).map(r=>r.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return Fs.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Iy(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return bs.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,r){I("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(u=this.ui)?A_:14===u?Ph:13===u?Rh:12===u?w_:11===u?Ah:void S();var u;let o;return this.Ei.runTransaction(e,i,s,a=>(o=new fa(a,this.kr?this.kr.next():Ke._e),"readwrite-primary"===t?this.gi(o).next(u=>!!u||this.pi(o)).next(u=>{if(!u)throw ce(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new y(g.FAILED_PRECONDITION,_h);return r(o)}).next(u=>this.wi(o).next(()=>u)):this.ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}ki(e){return Ii(e).get("owner").next(t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)&&!this.Si(t)&&!(this.ai||this.allowTabSynchronization&&t.allowTabSynchronization))throw new y(g.FAILED_PRECONDITION,za)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ii(e).put("owner",t)}static D(){return Ye.D()}yi(e){const t=Ii(e);return t.get("owner").next(r=>this.Si(r)?(I("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):m.resolve())}Ci(e,t){const r=Date.now();return!(e<r-t||e>r&&(ce(`Detected an update time that is in the future: ${e} > ${r}`),1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const t=/(?:Version|Mobile)\/1[456]/;(0,L.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{const r=null!==(null===(t=this.di)||void 0===t?void 0:t.getItem(this.Fi(e)));return I("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ce("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){ce("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ii(n){return ye(n,"owner")}function Us(n){return ye(n,"clientMetadata")}function $a(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Ka{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.qi=r,this.Qi=i}static Ki(e,t){let r=O(),i=O();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Ka(e,t.fromCache,r,i)}}class My{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class _f{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=(0,L.G6)()?8:Ye.v((0,L.z$)())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.ji(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new My;return this.Ji(e,t,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(e,t,o,a.size)})}).next(()=>s.result)}Yi(e,t,r,i){return r.documentReadCount<this.Wi?(Mn()<=nt.in.DEBUG&&I("QueryEngine","SDK will not create cache indexes for query:",$n(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),m.resolve()):(Mn()<=nt.in.DEBUG&&I("QueryEngine","Query:",$n(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(Mn()<=nt.in.DEBUG&&I("QueryEngine","The SDK decides to create cache indexes for query:",$n(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ke(t))):m.resolve())}ji(e,t){if(Zh(t))return m.resolve(null);let r=ke(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=As(t,null,"F"),r=ke(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=O(...s);return this.zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const c=this.Zi(t,a);return this.Xi(t,c,o,u.readTime)?this.ji(e,As(t,null,"F")):this.es(e,c,t,u)}))})))}Hi(e,t,r,i){return Zh(t)||i.isEqual(b.min())?m.resolve(null):this.zi.getDocuments(e,r).next(s=>{const o=this.Zi(t,s);return this.Xi(t,o,r,i)?m.resolve(null):(Mn()<=nt.in.DEBUG&&I("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),$n(t)),this.es(e,o,t,gh(i,-1)).next(a=>a))})}Zi(e,t){let r=new Q(ed(e));return t.forEach((i,s)=>{si(e,s)&&(r=r.add(s))}),r}Xi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,r){return Mn()<=nt.in.DEBUG&&I("QueryEngine","Using full collection scan to execute query:",$n(t)),this.zi.getDocumentsMatchingQuery(e,t,$e.min(),r)}es(e,t,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class Oy{constructor(e,t,r,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new W(k),this.rs=new Tt(s=>on(s),ri),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new gf(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}}function yf(n,e,t,r){return new Oy(n,e,t,r)}function Tf(n,e){return Qa.apply(this,arguments)}function Qa(){return Qa=(0,p.Z)(function*(n,e){const t=w(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let u=O();for(const c of i){o.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}for(const c of s){a.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({us:c,removedBatchIds:o,addedBatchIds:a}))})})}),Qa.apply(this,arguments)}function If(n){const e=w(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function Ef(n,e,t){let r=O(),i=O();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=qe();return t.forEach((a,u)=>{const c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(b.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):I("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{cs:o,ls:i}})}function By(n,e){const t=w(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function nr(n,e){const t=w(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Qr.getTargetData(r,e).next(s=>s?(i=s,m.resolve(i)):t.Qr.allocateTargetId(r).next(o=>(i=new Et(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ns.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(r.targetId,r),t.rs.set(e,r.targetId)),r})}function rr(n,e,t){return Wa.apply(this,arguments)}function Wa(){return Wa=(0,p.Z)(function*(n,e,t){const r=w(n),i=r.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Dt(o))throw o;I("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)}),Wa.apply(this,arguments)}function Bs(n,e,t){const r=w(n);let i=b.min(),s=O();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){const h=w(u),d=h.rs.get(l);return void 0!==d?m.resolve(h.ns.get(d)):h.Qr.getTargetData(c,l)}(r,o,ke(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.ts.getDocumentsMatchingQuery(o,e,t?i:b.min(),t?s:O())).next(a=>(Af(r,Jh(e),a),{documents:a,hs:s})))}function vf(n,e){const t=w(n),r=w(t.Qr),i=t.ns.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r._t(s,e).next(o=>o?o.target:null))}function wf(n,e){const t=w(n),r=t.ss.get(e)||b.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.os.getAllFromCollectionGroup(i,e,gh(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Af(t,e,i),i))}function Af(n,e,t){let r=n.ss.get(e)||b.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.ss.set(e,r)}function Ha(){return Ha=(0,p.Z)(function*(n,e,t,r){const i=w(n);let s=O(),o=qe();for(const c of t){const l=e.Ps(c.metadata.name);c.document&&(s=s.add(l));const h=e.Is(c);h.setReadTime(e.Ts(c.metadata.readTime)),o=o.insert(l,h)}const a=i.os.newChangeBuffer({trackRemovals:!0}),u=yield nr(i,(l=r,ke(zn(G.fromString(`__bundle__/docs/${l}`)))));var l;return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>Ef(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.Qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.Qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.cs,l.ls)).next(()=>l.cs)))}),Ha.apply(this,arguments)}function Gy(n,e){return Za.apply(this,arguments)}function Za(){return Za=(0,p.Z)(function*(n,e,t=O()){const r=yield nr(n,ke(ka(e.bundledQuery))),i=w(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const o=le(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.$r.saveNamedQuery(s,e);const a=r.withResumeToken(me.EMPTY_BYTE_STRING,o);return i.ns=i.ns.insert(a.targetId,a),i.Qr.updateTargetData(s,a).next(()=>i.Qr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.Qr.addMatchingKeys(s,t,r.targetId)).next(()=>i.$r.saveNamedQuery(s,e))})}),Za.apply(this,arguments)}function Rf(n,e){return`firestore_clients_${n}_${e}`}function Pf(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Ya(n,e){return`firestore_targets_${n}_${e}`}class qs{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Es(e,t,r){const i=JSON.parse(r);let s,o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code,o&&(s=new y(i.error.code,i.error.message))),o?new qs(e,t,i.state,s):(ce("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ei{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Es(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new y(r.error.code,r.error.message))),s?new Ei(e,r.state,i):(ce("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Gs{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=va();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Ih(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new Gs(e,s):(ce("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Xa{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Xa(t.clientId,t.onlineState):(ce("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Ja{constructor(){this.activeTargetIds=va()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class eu{constructor(e,t,r,i,s){this.window=e,this.oi=t,this.persistenceKey=r,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new W(k),this.started=!1,this.ys=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=Rf(this.persistenceKey,this.Vs),this.Ss=`firestore_sequence_number_${this.persistenceKey}`,this.ps=this.ps.insert(this.Vs,new Ja),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=`firestore_online_state_${this.persistenceKey}`,this.Fs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,p.Z)(function*(){const t=yield e.syncEngine.Bi();for(const i of t){if(i===e.Vs)continue;const s=e.getItem(Rf(e.persistenceKey,i));if(s){const o=Gs.Es(i,s);o&&(e.ps=e.ps.insert(o.clientId,o))}}e.Ms();const r=e.storage.getItem(e.vs);if(r){const i=e.xs(r);i&&e.Os(i)}for(const i of e.ys)e.gs(i);e.ys=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,r){this.Ls(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Ya(this.persistenceKey,e));if(r){const i=Ei.Es(e,r);i&&(t=i.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ya(this.persistenceKey,e))}updateQueryState(e,t,r){this.qs(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return I("SharedClientState","READ",e,t),t}setItem(e,t){I("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){I("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){var t=this;const r=e;if(r.storageArea===this.storage){if(I("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ws)return void ce("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable((0,p.Z)(function*(){if(t.started){if(null!==r.key)if(t.bs.test(r.key)){if(null==r.newValue){const i=t.$s(r.key);return t.Us(i,null)}{const i=t.Ws(r.key,r.newValue);if(i)return t.Us(i.clientId,i)}}else if(t.Ds.test(r.key)){if(null!==r.newValue){const i=t.Gs(r.key,r.newValue);if(i)return t.zs(i)}}else if(t.Cs.test(r.key)){if(null!==r.newValue){const i=t.js(r.key,r.newValue);if(i)return t.Hs(i)}}else if(r.key===t.vs){if(null!==r.newValue){const i=t.xs(r.newValue);if(i)return t.Os(i)}}else if(r.key===t.Ss){const i=function(o){let a=Ke._e;if(null!=o)try{const u=JSON.parse(o);C("number"==typeof u),a=u}catch(u){ce("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(r.newValue);i!==Ke._e&&t.sequenceNumberHandler(i)}else if(r.key===t.Fs){const i=t.Js(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Ys(s)))}}else t.ys.push(r)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,r){const i=new qs(this.currentUser,e,t,r),s=Pf(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Bs(e){const t=Pf(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){this.storage.setItem(this.vs,JSON.stringify({clientId:this.Vs,onlineState:e}))}qs(e,t,r){const i=Ya(this.persistenceKey,e),s=new Ei(e,t,r);this.setItem(i,s.ds())}Ks(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){const t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){const r=this.$s(e);return Gs.Es(r,t)}Gs(e,t){const r=this.Ds.exec(e),i=Number(r[1]);return qs.Es(new _e(void 0!==r[2]?r[2]:null),i,t)}js(e,t){const r=this.Cs.exec(e),i=Number(r[1]);return Ei.Es(i,t)}xs(e){return Xa.Es(e)}Js(e){return JSON.parse(e)}zs(e){var t=this;return(0,p.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Zs(e.batchId,e.state,e.error);I("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){const r=t?this.ps.insert(e,t):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.eo(o,a).then(()=>{this.ps=r})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=va();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class Sf{constructor(){this.no=new Ja,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,r){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Ja,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class zy{io(e){}shutdown(){}}class xf{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){I("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){I("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let zs=null;function tu(){return null===zs?zs=268435456+Math.round(2147483648*Math.random()):zs++,"0x"+zs.toString(16)}const jy={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class $y{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}const Ce="WebChannelConnection";class Ky extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+t.host,this.po=`projects/${i}/databases/${s}`,this.yo="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(t,r,i,s,o){const a=tu(),u=this.bo(t,r.toUriEncodedString());I("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);const c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,s,o),this.Co(t,u,c,i).then(l=>(I("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw Ue("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}vo(t,r,i,s,o,a){return this.So(t,r,i,s,o)}Do(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Fn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}bo(t,r){return`${this.fo}/v1/${r}:${jy[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,r,i){const s=tu();return new Promise((o,a)=>{const u=new zp;u.setWithCredentials(!0),u.listenOnce(qp.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case aa.NO_ERROR:const l=u.getResponseJson();I(Ce,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case aa.TIMEOUT:I(Ce,`RPC '${e}' ${s} timed out`),a(new y(g.DEADLINE_EXCEEDED,"Request time out"));break;case aa.HTTP_ERROR:const h=u.getStatus();if(I(Ce,`RPC '${e}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);const f=d?.error;if(f&&f.status&&f.message){const _=function(T){const x=T.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(x)>=0?x:g.UNKNOWN}(f.status);a(new y(_,f.message))}else a(new y(g.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new y(g.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{I(Ce,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(i);I(Ce,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}Fo(e,t,r){const i=tu(),s=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Up(),a=Bp(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const l=s.join("");I(Ce,`Creating RPC '${e}' stream ${i}: ${l}`,u);const h=o.createWebChannel(l,u);let d=!1,f=!1;const _=new $y({lo:T=>{f?I(Ce,`Not sending because RPC '${e}' stream ${i} is closed:`,T):(d||(I(Ce,`Opening RPC '${e}' stream ${i} transport.`),h.open(),d=!0),I(Ce,`RPC '${e}' stream ${i} sending:`,T),h.send(T))},ho:()=>h.close()}),v=(T,x,N)=>{T.listen(x,R=>{try{N(R)}catch(V){setTimeout(()=>{throw V},0)}})};return v(h,fs.EventType.OPEN,()=>{f||I(Ce,`RPC '${e}' stream ${i} transport opened.`)}),v(h,fs.EventType.CLOSE,()=>{f||(f=!0,I(Ce,`RPC '${e}' stream ${i} transport closed`),_.Vo())}),v(h,fs.EventType.ERROR,T=>{f||(f=!0,Ue(Ce,`RPC '${e}' stream ${i} transport errored:`,T),_.Vo(new y(g.UNAVAILABLE,"The operation could not be completed")))}),v(h,fs.EventType.MESSAGE,T=>{var x;if(!f){const N=T.data[0];C(!!N);const V=N.error||(null===(x=N[0])||void 0===x?void 0:x.error);if(V){I(Ce,`RPC '${e}' stream ${i} received error:`,V);const U=V.status;let B=function(Bi){const Lg=de[Bi];if(void 0!==Lg)return yd(Lg)}(U),ee=V.message;void 0===B&&(B=g.INTERNAL,ee="Unknown error status: "+U+" with message "+V.message),f=!0,_.Vo(new y(B,ee)),h.close()}else I(Ce,`RPC '${e}' stream ${i} received:`,N),_.mo(N)}}),v(a,Gp.STAT_EVENT,T=>{T.stat===ch.PROXY?I(Ce,`RPC '${e}' stream ${i} detected buffering proxy`):T.stat===ch.NOPROXY&&I(Ce,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{_.Ro()},0),_}}function Vf(){return typeof window<"u"?window:null}function js(){return typeof document<"u"?document:null}function vi(n){return new ny(n,!0)}class nu{constructor(e,t,r=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const t=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,t-r);i>0&&I("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Lo&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){null!==this.Lo&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}}class Cf{constructor(e,t,r,i,s,o,a,u){this.oi=e,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new nu(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}stop(){var e=this;return(0,p.Z)(function*(){e.Ho()&&(yield e.close(0))})()}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}e_(){var e=this;return(0,p.Z)(function*(){if(e.Jo())return e.close(0)})()}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(e,t){var r=this;return(0,p.Z)(function*(){r.n_(),r.r_(),r.jo.cancel(),r.Wo++,4!==e?r.jo.reset():t&&t.code===g.RESOURCE_EXHAUSTED?(ce(t.toString()),ce("Using maximum backoff delay to prevent overloading the backend."),r.jo.ko()):t&&t.code===g.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.i_(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.To(t)})()}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===t&&this.o_(r,i)},r=>{e(()=>{const i=new y(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(e,t){const r=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){var e=this;this.state=5,this.jo.qo((0,p.Z)(function*(){e.state=0,e.start()}))}__(e){return I("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget(()=>this.Wo===e?t():(I("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Qy extends Cf{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();const t=function sy(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(c=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===c?1:"REMOVE"===c?2:"CURRENT"===c?3:"RESET"===c?4:S(),i=e.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(C(void 0===l||"string"==typeof l),me.fromBase64String(l||"")):(C(void 0===l||l instanceof Uint8Array),me.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const l=void 0===c.code?g.UNKNOWN:yd(c.code);return new y(l,c.message||"")}(o);t=new wd(r,i,s,a||null)}else if("documentChange"in e){const r=e.documentChange,i=ct(n,r.document.name),s=le(r.document.updateTime),o=r.document.createTime?le(r.document.createTime):b.min(),a=new Ae({mapValue:{fields:r.document.fields}}),u=X.newFoundDocument(i,s,o,a);t=new Vs(r.targetIds||[],r.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const r=e.documentDelete,i=ct(n,r.document),s=r.readTime?le(r.readTime):b.min(),o=X.newNoDocument(i,s);t=new Vs([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,i=ct(n,r.document);t=new Vs([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return S();{const r=e.filter,{count:i=0,unchangedNames:s}=r,o=new Z_(i,s);t=new vd(r.targetId,o)}}var c;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return b.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?b.min():o.readTime?le(o.readTime):b.min()}(e);return this.listener.u_(t,r)}c_(e){const t={};t.database=ba(this.serializer),t.addTarget=function(s,o){let a;const u=o.target;if(a=vs(u)?{documents:kd(s,u)}:{query:Na(s,u).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Sd(s,o.resumeToken);const c=xa(s,o.expectedCount);null!==c&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(b.min())>0){a.readTime=Zn(s,o.snapshotVersion.toTimestamp());const c=xa(s,o.expectedCount);null!==c&&(a.expectedCount=c)}return a}(this.serializer,e);const r=function ay(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return S()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.t_(t)}l_(e){const t={};t.database=ba(this.serializer),t.removeTarget=e,this.t_(t)}}class Wy extends Cf{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(C(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const t=function oy(n,e){return n&&n.length>0?(C(void 0!==e),n.map(t=>function(i,s){let o=le(i.updateTime?i.updateTime:s);return o.isEqual(b.min())&&(o=le(s)),new K_(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=le(e.commitTime);return this.listener.T_(r,t)}return C(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=ba(this.serializer),this.t_(e)}I_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>mi(this.serializer,r))};this.t_(t)}}class Hy extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new y(g.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(e,Ca(t,r),i,s,o)).catch(s=>{throw"FirebaseError"===s.name?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(g.UNKNOWN,s.toString())})}vo(e,t,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(e,Ca(t,r),i,o,a,s)).catch(o=>{throw"FirebaseError"===o.name?(o.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new y(g.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}}class Yy{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(ce(t),this.g_=!1):I("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class Xy{constructor(e,t,r,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(a=>{r.enqueueAndForget((0,p.Z)(function*(){var u;jt(o)&&(I("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,p.Z)(function*(l){const h=w(l);h.v_.add(4),yield ir(h),h.x_.set("Unknown"),h.v_.delete(4),yield wi(h)}),function c(l){return u.apply(this,arguments)})(o))}))}),this.x_=new Yy(r,i)}}function wi(n){return iu.apply(this,arguments)}function iu(){return iu=(0,p.Z)(function*(n){if(jt(n))for(const e of n.F_)yield e(!0)}),iu.apply(this,arguments)}function ir(n){return su.apply(this,arguments)}function su(){return su=(0,p.Z)(function*(n){for(const e of n.F_)yield e(!1)}),su.apply(this,arguments)}function $s(n,e){const t=w(n);t.C_.has(e.targetId)||(t.C_.set(e.targetId,e),uu(t)?au(t):ar(t).Jo()&&ou(t,e))}function sr(n,e){const t=w(n),r=ar(t);t.C_.delete(e),r.Jo()&&bf(t,e),0===t.C_.size&&(r.Jo()?r.Xo():jt(t)&&t.x_.set("Unknown"))}function ou(n,e){if(n.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(b.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ar(n).c_(e)}function bf(n,e){n.O_.Oe(e),ar(n).l_(e)}function au(n){n.O_=new X_({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.C_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),ar(n).start(),n.x_.p_()}function uu(n){return jt(n)&&!ar(n).Ho()&&n.C_.size>0}function jt(n){return 0===w(n).v_.size}function Df(n){n.O_=void 0}function Jy(n){return cu.apply(this,arguments)}function cu(){return cu=(0,p.Z)(function*(n){n.C_.forEach((e,t)=>{ou(n,e)})}),cu.apply(this,arguments)}function eT(n,e){return lu.apply(this,arguments)}function lu(){return lu=(0,p.Z)(function*(n,e){Df(n),uu(n)?(n.x_.S_(e),au(n)):n.x_.set("Unknown")}),lu.apply(this,arguments)}function tT(n,e,t){return hu.apply(this,arguments)}function hu(){return hu=(0,p.Z)(function*(n,e,t){if(n.x_.set("Online"),e instanceof wd&&2===e.state&&e.cause)try{yield(r=(0,p.Z)(function*(s,o){const a=o.cause;for(const u of o.targetIds)s.C_.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.C_.delete(u),s.O_.removeTarget(u))}),function i(s,o){return r.apply(this,arguments)})(n,e)}catch(r){I("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ks(n,r)}else if(e instanceof Vs?n.O_.$e(e):e instanceof vd?n.O_.Je(e):n.O_.Ge(e),!t.isEqual(b.min()))try{const r=yield If(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){const a=s.O_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){const l=s.C_.get(c);l&&s.C_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{const l=s.C_.get(u);if(!l)return;s.C_.set(u,l.withResumeToken(me.EMPTY_BYTE_STRING,l.snapshotVersion)),bf(s,u);const h=new Et(l.target,u,c,l.sequenceNumber);ou(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){I("RemoteStore","Failed to raise snapshot:",r),yield Ks(n,r)}var r}),hu.apply(this,arguments)}function Ks(n,e,t){return du.apply(this,arguments)}function du(){return du=(0,p.Z)(function*(n,e,t){if(!Dt(e))throw e;n.v_.add(1),yield ir(n),n.x_.set("Offline"),t||(t=()=>If(n.localStore)),n.asyncQueue.enqueueRetryable((0,p.Z)(function*(){I("RemoteStore","Retrying IndexedDB access"),yield t(),n.v_.delete(1),yield wi(n)}))}),du.apply(this,arguments)}function Nf(n,e){return e().catch(t=>Ks(n,t,e))}function or(n){return fu.apply(this,arguments)}function fu(){return fu=(0,p.Z)(function*(n){const e=w(n),t=$t(e);let r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;nT(e);)try{const i=yield By(e.localStore,r);if(null===i){0===e.D_.length&&t.Xo();break}r=i.batchId,rT(e,i)}catch(i){yield Ks(e,i)}kf(e)&&Ff(e)}),fu.apply(this,arguments)}function nT(n){return jt(n)&&n.D_.length<10}function rT(n,e){n.D_.push(e);const t=$t(n);t.Jo()&&t.P_&&t.I_(e.mutations)}function kf(n){return jt(n)&&!$t(n).Ho()&&n.D_.length>0}function Ff(n){$t(n).start()}function iT(n){return mu.apply(this,arguments)}function mu(){return mu=(0,p.Z)(function*(n){$t(n).d_()}),mu.apply(this,arguments)}function sT(n){return gu.apply(this,arguments)}function gu(){return gu=(0,p.Z)(function*(n){const e=$t(n);for(const t of n.D_)e.I_(t.mutations)}),gu.apply(this,arguments)}function oT(n,e,t){return pu.apply(this,arguments)}function pu(){return pu=(0,p.Z)(function*(n,e,t){const r=n.D_.shift(),i=Ra.from(r,e,t);yield Nf(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield or(n)}),pu.apply(this,arguments)}function aT(n,e){return _u.apply(this,arguments)}function _u(){return _u=(0,p.Z)(function*(n,e){var t;e&&$t(n).P_&&(yield(t=(0,p.Z)(function*(i,s){if(_d(a=s.code)&&a!==g.ABORTED){const o=i.D_.shift();$t(i).Zo(),yield Nf(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield or(i)}var a}),function r(i,s){return t.apply(this,arguments)})(n,e)),kf(n)&&Ff(n)}),_u.apply(this,arguments)}function Mf(n,e){return yu.apply(this,arguments)}function yu(){return yu=(0,p.Z)(function*(n,e){const t=w(n);t.asyncQueue.verifyOperationInProgress(),I("RemoteStore","RemoteStore received new credentials");const r=jt(t);t.v_.add(3),yield ir(t),r&&t.x_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.v_.delete(3),yield wi(t)}),yu.apply(this,arguments)}function Tu(n,e){return Iu.apply(this,arguments)}function Iu(){return Iu=(0,p.Z)(function*(n,e){const t=w(n);e?(t.v_.delete(2),yield wi(t)):e||(t.v_.add(2),yield ir(t),t.x_.set("Unknown"))}),Iu.apply(this,arguments)}function ar(n){return n.N_||(n.N_=function(t,r,i){const s=w(t);return s.R_(),new Qy(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:Jy.bind(null,n),To:eT.bind(null,n),u_:tT.bind(null,n)}),n.F_.push(function(){var e=(0,p.Z)(function*(t){t?(n.N_.Zo(),uu(n)?au(n):n.x_.set("Unknown")):(yield n.N_.stop(),Df(n))});return function(t){return e.apply(this,arguments)}}())),n.N_}function $t(n){return n.L_||(n.L_=function(t,r,i){const s=w(t);return s.R_(),new Wy(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:iT.bind(null,n),To:aT.bind(null,n),E_:sT.bind(null,n),T_:oT.bind(null,n)}),n.F_.push(function(){var e=(0,p.Z)(function*(t){t?(n.L_.Zo(),yield or(n)):(yield n.L_.stop(),n.D_.length>0&&(I("RemoteStore",`Stopping write stream with ${n.D_.length} pending writes`),n.D_=[]))});return function(t){return e.apply(this,arguments)}}())),n.L_}class Eu{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new fe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new Eu(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new y(g.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ur(n,e){if(ce("AsyncQueue",`${e}: ${n}`),Dt(n))return new y(g.UNAVAILABLE,`${e}: ${n}`);throw n}class cr{constructor(e){this.comparator=e?(t,r)=>e(t,r)||A.comparator(t.key,r.key):(t,r)=>A.comparator(t.key,r.key),this.keyedMap=oi(),this.sortedSet=new W(this.comparator)}static emptySet(e){return new cr(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof cr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new cr;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Of{constructor(){this.B_=new W(A.comparator)}track(e){const t=e.doc.key,r=this.B_.get(t);r?0!==e.type&&3===r.type?this.B_=this.B_.insert(t,e):3===e.type&&1!==r.type?this.B_=this.B_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.B_=this.B_.remove(t):1===e.type&&2===r.type?this.B_=this.B_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):S():this.B_=this.B_.insert(t,e)}k_(){const e=[];return this.B_.inorderTraversal((t,r)=>{e.push(r)}),e}}class lr{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new lr(e,t,cr.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ii(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class uT{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some(e=>e.U_())}}class cT{constructor(){this.queries=new Tt(e=>Xh(e),ii),this.onlineState="Unknown",this.W_=new Set}}function vu(n,e){return wu.apply(this,arguments)}function wu(){return wu=(0,p.Z)(function*(n,e){const t=w(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.K_()&&e.U_()&&(r=2):(s=new uT,r=e.U_()?0:1);try{switch(r){case 0:s.q_=yield t.onListen(i,!0);break;case 1:s.q_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){const a=ur(o,`Initialization of query '${$n(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.Q_.push(e),e.G_(t.onlineState),s.q_&&e.z_(s.q_)&&Pu(t)}),wu.apply(this,arguments)}function Au(n,e){return Ru.apply(this,arguments)}function Ru(){return Ru=(0,p.Z)(function*(n,e){const t=w(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const o=s.Q_.indexOf(e);o>=0&&(s.Q_.splice(o,1),0===s.Q_.length?i=e.U_()?0:1:!s.K_()&&e.U_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}),Ru.apply(this,arguments)}function lT(n,e){const t=w(n);let r=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const a of o.Q_)a.z_(i)&&(r=!0);o.q_=i}}r&&Pu(t)}function hT(n,e,t){const r=w(n),i=r.queries.get(e);if(i)for(const s of i.Q_)s.onError(t);r.queries.delete(e)}function Pu(n){n.W_.forEach(e=>{e.next()})}var Su,Lf;(Lf=Su||(Su={})).j_="default",Lf.Cache="cache";class xu{constructor(e,t,r){this.query=e,this.H_=t,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=r||{}}z_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new lr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.J_?this.Z_(e)&&(this.H_.next(e),t=!0):this.X_(e,this.onlineState)&&(this.ea(e),t=!0),this.Y_=e,t}onError(e){this.H_.error(e)}G_(e){this.onlineState=e;let t=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,e)&&(this.ea(this.Y_),t=!0),t}X_(e,t){return!e.fromCache||!this.U_()||(!this.options.ta||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Z_(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Y_&&this.Y_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}ea(e){e=lr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.J_=!0,this.H_.next(e)}U_(){return this.options.source!==Su.Cache}}class dT{constructor(e,t){this.na=e,this.byteLength=t}ra(){return"metadata"in this.na}}class Uf{constructor(e){this.serializer=e}Ps(e){return ct(this.serializer,e)}Is(e){return e.metadata.exists?Nd(this.serializer,e.document,!1):X.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return le(e)}}class fT{constructor(e,t,r){this.ia=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Bf(e)}sa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.na.namedQuery)this.queries.push(e.na.namedQuery);else if(e.na.documentMetadata){this.documents.push({metadata:e.na.documentMetadata}),e.na.documentMetadata.exists||++t;const r=G.fromString(e.na.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.na.document&&(this.documents[this.documents.length-1].document=e.na.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}oa(e){const t=new Map,r=new Uf(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.Ps(i.metadata.name);for(const o of i.metadata.queries){const a=(t.get(o)||O()).add(s);t.set(o,a)}}return t}complete(){var e=this;return(0,p.Z)(function*(){const t=yield function qy(n,e,t,r){return Ha.apply(this,arguments)}(e.localStore,new Uf(e.serializer),e.documents,e.ia.id),r=e.oa(e.documents);for(const i of e.queries)yield Gy(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,_a:e.collectionGroups,aa:t}})()}}function Bf(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class qf{constructor(e){this.key=e}}class Gf{constructor(e){this.key=e}}class zf{constructor(e,t){this.query=e,this.ua=t,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=O(),this.mutatedKeys=O(),this.ha=ed(e),this.Pa=new cr(this.ha)}get Ia(){return this.ua}Ta(e,t){const r=t?t.Ea:new Of,i=t?t.Pa:this.Pa;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const u="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{const d=i.get(l),f=si(this.query,h)?h:null,_=!!d&&this.mutatedKeys.has(d.key),v=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let T=!1;d&&f?d.data.isEqual(f.data)?_!==v&&(r.track({type:3,doc:f}),T=!0):this.da(d,f)||(r.track({type:2,doc:f}),T=!0,(u&&this.ha(f,u)>0||c&&this.ha(f,c)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),T=!0):d&&!f&&(r.track({type:1,doc:d}),T=!0,(u||c)&&(a=!0)),T&&(f?(o=o.add(f),s=v?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{Pa:o,Ea:r,Xi:a,mutatedKeys:s}}da(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.Pa;this.Pa=e.Pa,this.mutatedKeys=e.mutatedKeys;const o=e.Ea.k_();o.sort((l,h)=>function(f,_){const v=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return v(f)-v(_)}(l.type,h.type)||this.ha(l.doc,h.doc)),this.Aa(r),i=null!=i&&i;const a=t&&!i?this.Ra():[],u=0===this.la.size&&this.current&&!i?1:0,c=u!==this.ca;return this.ca=u,0!==o.length||c?{snapshot:new lr(this.query,e.Pa,s,o,e.mutatedKeys,0===u,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),Va:a}:{Va:a}}G_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new Of,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(e){return!this.ua.has(e)&&!!this.Pa.has(e)&&!this.Pa.get(e).hasLocalMutations}Aa(e){e&&(e.addedDocuments.forEach(t=>this.ua=this.ua.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.ua=this.ua.delete(t)),this.current=e.current)}Ra(){if(!this.current)return[];const e=this.la;this.la=O(),this.Pa.forEach(r=>{this.ma(r.key)&&(this.la=this.la.add(r.key))});const t=[];return e.forEach(r=>{this.la.has(r)||t.push(new Gf(r))}),this.la.forEach(r=>{e.has(r)||t.push(new qf(r))}),t}fa(e){this.ua=e.hs,this.la=O();const t=this.Ta(e.documents);return this.applyChanges(t,!0)}ga(){return lr.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,0===this.ca,this.hasCachedResults)}}class mT{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class gT{constructor(e){this.key=e,this.pa=!1}}class pT{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.ya={},this.wa=new Tt(a=>Xh(a),ii),this.Sa=new Map,this.ba=new Set,this.Da=new W(A.comparator),this.Ca=new Map,this.va=new qa,this.Fa={},this.Ma=new Map,this.xa=mn.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return!0===this.Oa}}function _T(n,e){return Vu.apply(this,arguments)}function Vu(){return Vu=(0,p.Z)(function*(n,e,t=!0){const r=Qs(n);let i;const s=r.wa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ga()):i=yield jf(r,e,t,!0),i}),Vu.apply(this,arguments)}function yT(n,e){return Cu.apply(this,arguments)}function Cu(){return Cu=(0,p.Z)(function*(n,e){const t=Qs(n);yield jf(t,e,!0,!1)}),Cu.apply(this,arguments)}function jf(n,e,t,r){return bu.apply(this,arguments)}function bu(){return bu=(0,p.Z)(function*(n,e,t,r){const i=yield nr(n.localStore,ke(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current";let a;return r&&(a=yield Du(n,e,s,"current"===o,i.resumeToken)),n.isPrimaryClient&&t&&$s(n.remoteStore,i),a}),bu.apply(this,arguments)}function Du(n,e,t,r,i){return Nu.apply(this,arguments)}function Nu(){return Nu=(0,p.Z)(function*(n,e,t,r,i){n.Na=(h,d,f)=>{return(_=(0,p.Z)(function*(T,x,N,R){let V=x.view.Ta(N);V.Xi&&(V=yield Bs(T.localStore,x.query,!1).then(({documents:Ie})=>x.view.Ta(Ie,V)));const U=R&&R.targetChanges.get(x.targetId),B=R&&null!=R.targetMismatches.get(x.targetId),ee=x.view.applyChanges(V,T.isPrimaryClient,U,B);return ju(T,x.targetId,ee.Va),ee.snapshot}),function v(T,x,N,R){return _.apply(this,arguments)})(n,h,d,f);var _};const s=yield Bs(n.localStore,e,!0),o=new zf(e,s.hs),a=o.Ta(s.documents),u=di.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),c=o.applyChanges(a,n.isPrimaryClient,u);ju(n,t,c.Va);const l=new mT(e,t,o);return n.wa.set(e,l),n.Sa.has(t)?n.Sa.get(t).push(e):n.Sa.set(t,[e]),c.snapshot}),Nu.apply(this,arguments)}function TT(n,e,t){return ku.apply(this,arguments)}function ku(){return ku=(0,p.Z)(function*(n,e,t){const r=w(n),i=r.wa.get(e),s=r.Sa.get(i.targetId);if(s.length>1)return r.Sa.set(i.targetId,s.filter(o=>!ii(o,e))),void r.wa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield rr(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&sr(r.remoteStore,i.targetId),hr(r,i.targetId)}).catch(bt))):(hr(r,i.targetId),yield rr(r.localStore,i.targetId,!0))}),ku.apply(this,arguments)}function IT(n,e){return Fu.apply(this,arguments)}function Fu(){return Fu=(0,p.Z)(function*(n,e){const t=w(n),r=t.wa.get(e),i=t.Sa.get(r.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),sr(t.remoteStore,r.targetId))}),Fu.apply(this,arguments)}function Mu(){return Mu=(0,p.Z)(function*(n,e,t){const r=tc(n);try{const i=yield function(o,a){const u=w(o),c=te.now(),l=a.reduce((f,_)=>f.add(_.key),O());let h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",f=>{let _=qe(),v=O();return u.os.getEntries(f,l).next(T=>{_=T,_.forEach((x,N)=>{N.isValidDocument()||(v=v.add(x))})}).next(()=>u.localDocuments.getOverlayedDocuments(f,_)).next(T=>{h=T;const x=[];for(const N of a){const R=W_(N,h.get(N.key).overlayedDocument);null!=R&&x.push(new It(N.key,R,Oh(R.value.mapValue),ne.exists(!0)))}return u.mutationQueue.addMutationBatch(f,c,x,a)}).next(T=>{d=T;const x=T.applyToLocalDocumentSet(h,v);return u.documentOverlayCache.saveOverlays(f,T.batchId,x)})}).then(()=>({batchId:d.batchId,changes:nd(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Fa[o.currentUser.toKey()];c||(c=new W(k)),c=c.insert(a,u),o.Fa[o.currentUser.toKey()]=c}(r,i.batchId,t),yield vt(r,i.changes),yield or(r.remoteStore)}catch(i){const s=ur(i,"Failed to persist write");t.reject(s)}}),Mu.apply(this,arguments)}function $f(n,e){return Ou.apply(this,arguments)}function Ou(){return Ou=(0,p.Z)(function*(n,e){const t=w(n);try{const r=yield function Uy(n,e){const t=w(n),r=e.snapshotVersion;let i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;const a=[];e.targetChanges.forEach((l,h)=>{const d=i.get(h);if(!d)return;a.push(t.Qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>t.Qr.addMatchingKeys(s,l.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);var v,T,x;null!==e.targetMismatches.get(h)?f=f.withResumeToken(me.EMPTY_BYTE_STRING,b.min()).withLastLimboFreeSnapshotVersion(b.min()):l.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(l.resumeToken,r)),i=i.insert(h,f),T=f,x=l,(0===(v=d).resumeToken.approximateByteSize()||T.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8||x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0)&&a.push(t.Qr.updateTargetData(s,f))});let u=qe(),c=O();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(Ef(s,o,e.documentUpdates).next(l=>{u=l.cs,c=l.ls})),!r.isEqual(b.min())){const l=t.Qr.getLastRemoteSnapshotVersion(s).next(h=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.ns=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Ca.get(s);o&&(C(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.pa=!0:i.modifiedDocuments.size>0?C(o.pa):i.removedDocuments.size>0&&(C(o.pa),o.pa=!1))}),yield vt(t,r,e)}catch(r){yield bt(r)}}),Ou.apply(this,arguments)}function Kf(n,e,t){const r=w(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.wa.forEach((s,o)=>{const a=o.view.G_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const u=w(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(const d of h.Q_)d.G_(a)&&(c=!0)}),c&&Pu(u)}(r.eventManager,e),i.length&&r.ya.u_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function vT(n,e,t){return Lu.apply(this,arguments)}function Lu(){return Lu=(0,p.Z)(function*(n,e,t){const r=w(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Ca.get(e),s=i&&i.key;if(s){let o=new W(A.comparator);o=o.insert(s,X.newNoDocument(s,b.min()));const a=O().add(s),u=new hi(b.min(),new Map,new W(k),o,a);yield $f(r,u),r.Da=r.Da.remove(s),r.Ca.delete(e),$u(r)}else yield rr(r.localStore,e,!1).then(()=>hr(r,e,t)).catch(bt)}),Lu.apply(this,arguments)}function wT(n,e){return Uu.apply(this,arguments)}function Uu(){return Uu=(0,p.Z)(function*(n,e){const t=w(n),r=e.batch.batchId;try{const i=yield function Ly(n,e){const t=w(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){const h=c.batch,d=h.keys();let f=m.resolve();return d.forEach(_=>{f=f.next(()=>l.getEntry(u,_)).next(v=>{const T=c.docVersions.get(_);C(null!==T),v.version.compareTo(T)<0&&(h.applyToRemoteDocument(v,c),v.isValidDocument()&&(v.setReadTime(c.commitVersion),l.addEntry(v)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=O();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);zu(t,r,null),Gu(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield vt(t,i)}catch(i){yield bt(i)}}),Uu.apply(this,arguments)}function AT(n,e,t){return Bu.apply(this,arguments)}function Bu(){return Bu=(0,p.Z)(function*(n,e,t){const r=w(n);try{const i=yield function(o,a){const u=w(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(C(null!==h),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,e);zu(r,e,t),Gu(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield vt(r,i)}catch(i){yield bt(i)}}),Bu.apply(this,arguments)}function qu(){return qu=(0,p.Z)(function*(n,e){const t=w(n);jt(t.remoteStore)||I("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(o){const a=w(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(-1===r)return void e.resolve();const i=t.Ma.get(r)||[];i.push(e),t.Ma.set(r,i)}catch(r){const i=ur(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),qu.apply(this,arguments)}function Gu(n,e){(n.Ma.get(e)||[]).forEach(t=>{t.resolve()}),n.Ma.delete(e)}function zu(n,e,t){const r=w(n);let i=r.Fa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Fa[r.currentUser.toKey()]=i}}function hr(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Sa.get(e))n.wa.delete(r),t&&n.ya.La(r,t);n.Sa.delete(e),n.isPrimaryClient&&n.va.Vr(e).forEach(r=>{n.va.containsKey(r)||Qf(n,r)})}function Qf(n,e){n.ba.delete(e.path.canonicalString());const t=n.Da.get(e);null!==t&&(sr(n.remoteStore,t),n.Da=n.Da.remove(e),n.Ca.delete(t),$u(n))}function ju(n,e,t){for(const r of t)r instanceof qf?(n.va.addReference(r.key,e),PT(n,r)):r instanceof Gf?(I("SyncEngine","Document no longer in limbo: "+r.key),n.va.removeReference(r.key,e),n.va.containsKey(r.key)||Qf(n,r.key)):S()}function PT(n,e){const t=e.key,r=t.path.canonicalString();n.Da.get(t)||n.ba.has(r)||(I("SyncEngine","New document in limbo: "+t),n.ba.add(r),$u(n))}function $u(n){for(;n.ba.size>0&&n.Da.size<n.maxConcurrentLimboResolutions;){const e=n.ba.values().next().value;n.ba.delete(e);const t=new A(G.fromString(e)),r=n.xa.next();n.Ca.set(r,new gT(t)),n.Da=n.Da.insert(t,r),$s(n.remoteStore,new Et(ke(zn(t.path)),r,"TargetPurposeLimboResolution",Ke._e))}}function vt(n,e,t){return Ku.apply(this,arguments)}function Ku(){return Ku=(0,p.Z)(function*(n,e,t){const r=w(n),i=[],s=[],o=[];var a;r.wa.isEmpty()||(r.wa.forEach((a,u)=>{o.push(r.Na(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);const l=Ka.Ki(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.ya.u_(i),yield(a=(0,p.Z)(function*(c,l){const h=w(c);try{yield h.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>m.forEach(l,f=>m.forEach(f.qi,_=>h.persistence.referenceDelegate.addReference(d,f.targetId,_)).next(()=>m.forEach(f.Qi,_=>h.persistence.referenceDelegate.removeReference(d,f.targetId,_)))))}catch(d){if(!Dt(d))throw d;I("LocalStore","Failed to update sequence numbers: "+d)}for(const d of l){const f=d.targetId;if(!d.fromCache){const _=h.ns.get(f),T=_.withLastLimboFreeSnapshotVersion(_.snapshotVersion);h.ns=h.ns.insert(f,T)}}}),function u(c,l){return a.apply(this,arguments)})(r.localStore,s))}),Ku.apply(this,arguments)}function ST(n,e){return Qu.apply(this,arguments)}function Qu(){return Qu=(0,p.Z)(function*(n,e){const t=w(n);if(!t.currentUser.isEqual(e)){I("SyncEngine","User change. New user:",e.toKey());const r=yield Tf(t.localStore,e);t.currentUser=e,(s=t).Ma.forEach(a=>{a.forEach(u=>{u.reject(new y(g.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Ma.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield vt(t,r.us)}var s}),Qu.apply(this,arguments)}function xT(n,e){const t=w(n),r=t.Ca.get(e);if(r&&r.pa)return O().add(r.key);{let i=O();const s=t.Sa.get(e);if(!s)return i;for(const o of s){const a=t.wa.get(o);i=i.unionWith(a.view.Ia)}return i}}function VT(n,e){return Wu.apply(this,arguments)}function Wu(){return Wu=(0,p.Z)(function*(n,e){const t=w(n),r=yield Bs(t.localStore,e.query,!0),i=e.view.fa(r);return t.isPrimaryClient&&ju(t,e.targetId,i.Va),i}),Wu.apply(this,arguments)}function CT(n,e){return Hu.apply(this,arguments)}function Hu(){return Hu=(0,p.Z)(function*(n,e){const t=w(n);return wf(t.localStore,e).then(r=>vt(t,r))}),Hu.apply(this,arguments)}function bT(n,e,t,r){return Zu.apply(this,arguments)}function Zu(){return Zu=(0,p.Z)(function*(n,e,t,r){const i=w(n),s=yield function(a,u){const c=w(a),l=w(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.vn(h,u).next(d=>d?c.localDocuments.getDocuments(h,d):m.resolve(null)))}(i.localStore,e);var u;null!==s?("pending"===t?yield or(i.remoteStore):"acknowledged"===t||"rejected"===t?(zu(i,e,r||null),Gu(i,e),u=e,w(w(i.localStore).mutationQueue).Mn(u)):S(),yield vt(i,s)):I("SyncEngine","Cannot apply mutation batch with id: "+e)}),Zu.apply(this,arguments)}function Yu(){return Yu=(0,p.Z)(function*(n,e){const t=w(n);if(Qs(t),tc(t),!0===e&&!0!==t.Oa){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Wf(t,r.toArray());t.Oa=!0,yield Tu(t.remoteStore,!0);for(const s of i)$s(t.remoteStore,s)}else if(!1===e&&!1!==t.Oa){const r=[];let i=Promise.resolve();t.Sa.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(hr(t,o),rr(t.localStore,o,!0))),sr(t.remoteStore,o)}),yield i,yield Wf(t,r),function(o){const a=w(o);a.Ca.forEach((u,c)=>{sr(a.remoteStore,c)}),a.va.mr(),a.Ca=new Map,a.Da=new W(A.comparator)}(t),t.Oa=!1,yield Tu(t.remoteStore,!1)}}),Yu.apply(this,arguments)}function Wf(n,e,t){return Xu.apply(this,arguments)}function Xu(){return Xu=(0,p.Z)(function*(n,e,t){const r=w(n),i=[],s=[];for(const o of e){let a;const u=r.Sa.get(o);if(u&&0!==u.length){a=yield nr(r.localStore,ke(u[0]));for(const c of u){const l=r.wa.get(c),h=yield VT(r,l);h.snapshot&&s.push(h.snapshot)}}else{const c=yield vf(r.localStore,o);a=yield nr(r.localStore,c),yield Du(r,Hf(c),o,!1,a.resumeToken)}i.push(a)}return r.ya.u_(s),i}),Xu.apply(this,arguments)}function Hf(n){return Hh(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function NT(n){return t=w(n).localStore,w(w(t).persistence).Bi();var t}function kT(n,e,t,r){return Ju.apply(this,arguments)}function Ju(){return Ju=(0,p.Z)(function*(n,e,t,r){const i=w(n);if(i.Oa)return void I("SyncEngine","Ignoring unexpected query state notification.");const s=i.Sa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const o=yield wf(i.localStore,Jh(s[0])),a=hi.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,me.EMPTY_BYTE_STRING);yield vt(i,o,a);break}case"rejected":yield rr(i.localStore,e,!0),hr(i,e,r);break;default:S()}}),Ju.apply(this,arguments)}function FT(n,e,t){return ec.apply(this,arguments)}function ec(){return ec=(0,p.Z)(function*(n,e,t){const r=Qs(n);if(r.Oa){for(const i of e){if(r.Sa.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){I("SyncEngine","Adding an already active target "+i);continue}const s=yield vf(r.localStore,i),o=yield nr(r.localStore,s);yield Du(r,Hf(s),o.targetId,!1,o.resumeToken),$s(r.remoteStore,o)}for(const i of t)r.Sa.has(i)&&(yield rr(r.localStore,i,!1).then(()=>{sr(r.remoteStore,i),hr(r,i)}).catch(bt))}}),ec.apply(this,arguments)}function Qs(n){const e=w(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=$f.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xT.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=vT.bind(null,e),e.ya.u_=lT.bind(null,e.eventManager),e.ya.La=hT.bind(null,e.eventManager),e}function tc(n){const e=w(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wT.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=AT.bind(null,e),e}class Ai{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,p.Z)(function*(){t.serializer=vi(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return yf(this.persistence,new _f,e.initialUser,this.serializer)}createPersistence(e){return new Ga(Os.Hr,this.serializer)}createSharedClientState(e){return new Sf}terminate(){var e=this;return(0,p.Z)(function*(){var t,r;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(r=e.indexBackfillerScheduler)||void 0===r||r.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class nc extends Ai{constructor(e,t,r){super(),this.ka=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e),yield r.ka.initialize(r,e),yield tc(r.ka.syncEngine),yield or(r.ka.remoteStore),yield r.persistence.fi(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return yf(this.persistence,new _f,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new uf(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new o_(t,this.persistence);return new s_(e.asyncQueue,r)}createPersistence(e){const t=$a(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Ve.withCacheSize(this.cacheSizeBytes):Ve.DEFAULT;return new ja(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Vf(),js(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Sf}}class Zf extends nc{constructor(e,t){super(e,t,!1),this.ka=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e);const i=r.ka.syncEngine;r.sharedClientState instanceof eu&&(r.sharedClientState.syncEngine={Zs:bT.bind(null,i),Xs:kT.bind(null,i),eo:FT.bind(null,i),Bi:NT.bind(null,i),Ys:CT.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.fi(function(){var s=(0,p.Z)(function*(o){yield function DT(n,e){return Yu.apply(this,arguments)}(r.ka.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=Vf();if(!eu.D(t))throw new y(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=$a(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new eu(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class dr{initialize(e,t){var r=this;return(0,p.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>Kf(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=ST.bind(null,r.syncEngine),yield Tu(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new cT}createDatastore(e){const t=vi(e.databaseInfo.databaseId),r=new Ky(e.databaseInfo);return new Hy(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,o=t=>Kf(this.syncEngine,t,0),a=xf.D()?new xf:new zy,new Xy(r,i,s,o,a);var r,i,s,o,a}createSyncEngine(e,t){return function(i,s,o,a,u,c,l){const h=new pT(i,s,o,a,u,c);return l&&(h.Oa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,p.Z)(function*(){var t,r;yield(r=(0,p.Z)(function*(s){const o=w(s);I("RemoteStore","RemoteStore shutting down."),o.v_.add(5),yield ir(o),o.M_.shutdown(),o.x_.set("Unknown")}),function i(s){return r.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate()})()}}function Yf(n,e=10240){let t=0;return{read:()=>(0,p.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,p.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Ws{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.qa(this.observer.next,e)}error(e){this.observer.error?this.qa(this.observer.error,e):ce("Uncaught Error in snapshot listener:",e.toString())}Qa(){this.muted=!0}qa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class LT{constructor(e,t){this.Ka=e,this.serializer=t,this.metadata=new fe,this.buffer=new Uint8Array,this.$a=new TextDecoder("utf-8"),this.Ua().then(r=>{r&&r.ra()?this.metadata.resolve(r.na.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(r?.na)}`))},r=>this.metadata.reject(r))}close(){return this.Ka.cancel()}getMetadata(){var e=this;return(0,p.Z)(function*(){return e.metadata.promise})()}Ba(){var e=this;return(0,p.Z)(function*(){return yield e.getMetadata(),e.Ua()})()}Ua(){var e=this;return(0,p.Z)(function*(){const t=yield e.Wa();if(null===t)return null;const r=e.$a.decode(t),i=Number(r);isNaN(i)&&e.Ga(`length string (${r}) is not valid number`);const s=yield e.za(i);return new dT(JSON.parse(s),t.length+i)})()}ja(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Wa(){var e=this;return(0,p.Z)(function*(){for(;e.ja()<0&&!(yield e.Ha()););if(0===e.buffer.length)return null;const t=e.ja();t<0&&e.Ga("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}za(e){var t=this;return(0,p.Z)(function*(){for(;t.buffer.length<e;)(yield t.Ha())&&t.Ga("Reached the end of bundle when more is expected.");const r=t.$a.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Ga(e){throw this.Ka.cancel(),new Error(`Invalid bundle format: ${e}`)}Ha(){var e=this;return(0,p.Z)(function*(){const t=yield e.Ka.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class UT{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,p.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new y(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const r=yield(i=(0,p.Z)(function*(o,a){const u=w(o),c={documents:a.map(f=>fi(u.serializer,f))},l=yield u.vo("BatchGetDocuments",u.serializer.databaseId,G.emptyPath(),c,a.length),h=new Map;l.forEach(f=>{const _=function iy(n,e){return"found"in e?function(r,i){C(!!i.found);const s=ct(r,i.found.name),o=le(i.found.updateTime),a=i.found.createTime?le(i.found.createTime):b.min(),u=new Ae({mapValue:{fields:i.found.fields}});return X.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){C(!!i.missing),C(!!i.readTime);const s=ct(r,i.missing),o=le(i.readTime);return X.newNoDocument(s,o)}(n,e):S()}(u.serializer,f);h.set(_.key.toString(),_)});const d=[];return a.forEach(f=>{const _=h.get(f.toString());C(!!_),d.push(_)}),d}),function s(o,a){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Hn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,p.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=A.fromPath(i);e.mutations.push(new wa(s,e.precondition(s)))}),yield(r=(0,p.Z)(function*(s,o){const a=w(s),u={writes:o.map(c=>mi(a.serializer,c))};yield a.So("Commit",a.serializer.databaseId,G.emptyPath(),u)}),function i(s,o){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw S();t=b.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new y(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(b.min())?ne.exists(!1):ne.updateTime(t):ne.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(b.min()))throw new y(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ne.updateTime(t)}return ne.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class BT{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Ja=r.maxAttempts,this.jo=new nu(this.asyncQueue,"transaction_retry")}Ya(){this.Ja-=1,this.Za()}Za(){var e=this;this.jo.qo((0,p.Z)(function*(){const t=new UT(e.datastore),r=e.Xa(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.eu(s)}))}).catch(i=>{e.eu(i)})}))}Xa(e){try{const t=this.updateFunction(e);return!Zr(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}eu(e){this.Ja>0&&this.tu(e)?(this.Ja-=1,this.asyncQueue.enqueueAndForget(()=>(this.Za(),Promise.resolve()))):this.deferred.reject(e)}tu(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!_d(t)}return!1}}class qT{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=_e.UNAUTHENTICATED,this.clientId=fh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,p.Z)(function*(a){I("FirestoreClient","Received user=",a.uid),yield s.authCredentialListener(a),s.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(I("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new fe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=ur(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Hs(n,e){return rc.apply(this,arguments)}function rc(){return rc=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),I("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,p.Z)(function*(s){r.isEqual(s)||(yield Tf(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),rc.apply(this,arguments)}function ic(n,e){return sc.apply(this,arguments)}function sc(){return sc=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield oc(n);I("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Mf(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Mf(e.remoteStore,i)),n._onlineComponents=e}),sc.apply(this,arguments)}function Xf(n){return"FirebaseError"===n.name?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function oc(n){return ac.apply(this,arguments)}function ac(){return ac=(0,p.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){I("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Hs(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Xf(t))throw t;Ue("Error using user provided cache. Falling back to memory cache: "+t),yield Hs(n,new Ai)}}else I("FirestoreClient","Using default OfflineComponentProvider"),yield Hs(n,new Ai);return n._offlineComponents}),ac.apply(this,arguments)}function Zs(n){return uc.apply(this,arguments)}function uc(){return uc=(0,p.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(I("FirestoreClient","Using user provided OnlineComponentProvider"),yield ic(n,n._uninitializedComponentsProvider._online)):(I("FirestoreClient","Using default OnlineComponentProvider"),yield ic(n,new dr))),n._onlineComponents}),uc.apply(this,arguments)}function Jf(n){return oc(n).then(e=>e.persistence)}function fr(n){return oc(n).then(e=>e.localStore)}function em(n){return Zs(n).then(e=>e.remoteStore)}function cc(n){return Zs(n).then(e=>e.syncEngine)}function mr(n){return lc.apply(this,arguments)}function lc(){return lc=(0,p.Z)(function*(n){const e=yield Zs(n),t=e.eventManager;return t.onListen=_T.bind(null,e.syncEngine),t.onUnlisten=TT.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=yT.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=IT.bind(null,e.syncEngine),t}),lc.apply(this,arguments)}function nm(n,e,t={}){const r=new fe;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,o,a,u,c){const l=new Ws({next:d=>{o.enqueueAndForget(()=>Au(s,h));const f=d.docs.has(a);!f&&d.fromCache?c.reject(new y(g.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&u&&"server"===u.source?c.reject(new y(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new xu(zn(a.path),l,{includeMetadataChanges:!0,ta:!0});return vu(s,h)}(yield mr(n),n.asyncQueue,e,t,r)})),r.promise}function rm(n,e,t={}){const r=new fe;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,o,a,u,c){const l=new Ws({next:d=>{o.enqueueAndForget(()=>Au(s,h)),d.fromCache&&"server"===u.source?c.reject(new y(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new xu(a,l,{includeMetadataChanges:!0,ta:!0});return vu(s,h)}(yield mr(n),n.asyncQueue,e,t,r)})),r.promise}function im(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const sm=new Map;function hc(n,e,t){if(!t)throw new y(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function om(n,e,t,r){if(!0===e&&!0===r)throw new y(g.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function am(n){if(!A.isDocumentKey(n))throw new y(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function um(n){if(A.isDocumentKey(n))throw new y(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ys(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":S()}function q(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new y(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ys(n);throw new y(g.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function cm(n,e){if(e<=0)throw new y(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class lm{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new y(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new y(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}om("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=im(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ri{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lm({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new y(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lm(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new Qp;switch(r.type){case"firstParty":return new Yp(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new y(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=sm.get(t);r&&(I("ComponentProvider","Removing Datastore"),sm.delete(t),r.terminate())}(this),Promise.resolve()}}class Re{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Re(this.firestore,e,this._query)}}class J{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new J(this.firestore,e,this._key)}}class lt extends Re{constructor(e,t,r){super(e,t,zn(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new J(this.firestore,null,new A(e))}withConverter(e){return new lt(this.firestore,e,this._path)}}function dm(n,e,...t){if(n=(0,L.m9)(n),hc("collection","path",e),n instanceof Ri){const r=G.fromString(e,...t);return um(r),new lt(n,null,r)}{if(!(n instanceof J||n instanceof lt))throw new y(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(G.fromString(e,...t));return um(r),new lt(n.firestore,null,r)}}function Xs(n,e,...t){if(n=(0,L.m9)(n),1===arguments.length&&(e=fh.newId()),hc("doc","path",e),n instanceof Ri){const r=G.fromString(e,...t);return am(r),new J(n,null,new A(r))}{if(!(n instanceof J||n instanceof lt))throw new y(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(G.fromString(e,...t));return am(r),new J(n.firestore,n instanceof lt?n.converter:null,new A(r))}}function fm(n,e){return n=(0,L.m9)(n),e=(0,L.m9)(e),(n instanceof J||n instanceof lt)&&(e instanceof J||e instanceof lt)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function dc(n,e){return n=(0,L.m9)(n),e=(0,L.m9)(e),n instanceof Re&&e instanceof Re&&n.firestore===e.firestore&&ii(n._query,e._query)&&n.converter===e.converter}class JT{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new nu(this,"async_queue_retry"),this.cu=()=>{const t=js();t&&I("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};const e=js();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.lu(),this.hu(e)}enterRestrictedMode(e){if(!this.iu){this.iu=!0,this.au=e||!1;const t=js();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.cu)}}enqueue(e){if(this.lu(),this.iu)return new Promise(()=>{});const t=new fe;return this.hu(()=>this.iu&&this.au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.ru.push(e),this.Pu()))}Pu(){var e=this;return(0,p.Z)(function*(){if(0!==e.ru.length){try{yield e.ru[0](),e.ru.shift(),e.jo.reset()}catch(t){if(!Dt(t))throw t;I("AsyncQueue","Operation failed with retryable error: "+t)}e.ru.length>0&&e.jo.qo(()=>e.Pu())}})()}hu(e){const t=this.nu.then(()=>(this._u=!0,e().catch(r=>{throw this.ou=r,this._u=!1,ce("INTERNAL UNHANDLED ERROR: ",function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),a}(r)),r}).then(r=>(this._u=!1,r))));return this.nu=t,t}enqueueAfterDelay(e,t,r){this.lu(),this.uu.indexOf(e)>-1&&(t=0);const i=Eu.createAndSchedule(this,e,t,r,s=>this.Iu(s));return this.su.push(i),i}lu(){this.ou&&S()}verifyOperationInProgress(){}Tu(){var e=this;return(0,p.Z)(function*(){let t;do{t=e.nu,yield t}while(t!==e.nu)})()}Eu(e){for(const t of this.su)if(t.timerId===e)return!0;return!1}du(e){return this.Tu().then(()=>{this.su.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.su)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tu()})}Au(e){this.uu.push(e)}Iu(e){const t=this.su.indexOf(e);this.su.splice(t,1)}}function fc(n){return function(t,r){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class eI{constructor(){this._progressObserver={},this._taskCompletionResolver=new fe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class H extends Ri{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new JT,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||mm(this),this._firestoreClient.terminate()}}function ue(n){return n._firestoreClient||mm(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function mm(n){var e,t,r;const i=n._freezeSettings(),s=(u=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new S_(n._databaseId,u,n._persistenceKey,(l=i).host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,im(l.experimentalLongPollingOptions),l.useFetchStreams));var u,l;n._firestoreClient=new qT(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function gm(n,e,t){const r=new fe;return n.asyncQueue.enqueue((0,p.Z)(function*(){try{yield Hs(n,t),yield ic(n,e),r.resolve()}catch(i){const s=i;if(!Xf(s))throw s;Ue("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function pm(n){if(n._initialized||n._terminated)throw new y(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class ht{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ht(me.fromBase64String(e))}catch(t){throw new y(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ht(me.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class wt{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new y(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Y(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class pn{constructor(e){this._methodName=e}}class Js{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new y(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new y(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return k(this._lat,e._lat)||k(this._long,e._long)}}const hI=/^__.*__$/;class dI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new It(e,this.data,this.fieldMask,t,this.fieldTransforms):new Wn(e,this.data,t,this.fieldTransforms)}}class _m{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new It(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function ym(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}class eo{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.Ru(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(e){return new eo(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.mu({path:r,gu:!1});return i.pu(e),i}yu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.mu({path:r,gu:!1});return i.Ru(),i}wu(e){return this.mu({path:void 0,gu:!0})}Su(e){return ro(e,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Ru(){if(this.path)for(let e=0;e<this.path.length;e++)this.pu(this.path.get(e))}pu(e){if(0===e.length)throw this.Su("Document fields must not be empty");if(ym(this.Vu)&&hI.test(e))throw this.Su('Document fields cannot begin and end with "__"')}}class fI{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||vi(e)}Cu(e,t,r,i=!1){return new eo({Vu:e,methodName:t,Du:r,path:Y.emptyPath(),gu:!1,bu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function _n(n){const e=n._freezeSettings(),t=vi(n._databaseId);return new fI(n._databaseId,!!e.ignoreUndefinedProperties,t)}function to(n,e,t,r,i,s={}){const o=n.Cu(s.merge||s.mergeFields?2:0,e,t,i);Ic("Data must be an object, but it was:",o,r);const a=Em(r,o);let u,c;if(s.merge)u=new Be(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const l=[];for(const h of s.mergeFields){const d=xi(e,h,t);if(!o.contains(d))throw new y(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);wm(l,d)||l.push(d)}u=new Be(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new dI(new Ae(a),u,c)}class Si extends pn{_toFieldTransform(e){if(2!==e.Vu)throw e.Su(1===e.Vu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Si}}function Tm(n,e,t){return new eo({Vu:3,Du:e.settings.Du,methodName:n._methodName,gu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class mc extends pn{_toFieldTransform(e){return new ui(e.path,new Kn)}isEqual(e){return e instanceof mc}}class gc extends pn{constructor(e,t){super(e),this.vu=t}_toFieldTransform(e){const t=Tm(this,e,!0),r=this.vu.map(s=>yn(s,t)),i=new an(r);return new ui(e.path,i)}isEqual(e){return e instanceof gc&&(0,L.vZ)(this.vu,e.vu)}}class pc extends pn{constructor(e,t){super(e),this.vu=t}_toFieldTransform(e){const t=Tm(this,e,!0),r=this.vu.map(s=>yn(s,t)),i=new un(r);return new ui(e.path,i)}isEqual(e){return e instanceof pc&&(0,L.vZ)(this.vu,e.vu)}}class _c extends pn{constructor(e,t){super(e),this.Fu=t}_toFieldTransform(e){const t=new Qn(e.serializer,od(e.serializer,this.Fu));return new ui(e.path,t)}isEqual(e){return e instanceof _c&&this.Fu===e.Fu}}function yc(n,e,t,r){const i=n.Cu(1,e,t);Ic("Data must be an object, but it was:",i,r);const s=[],o=Ae.empty();Nt(r,(u,c)=>{const l=no(e,u,t);c=(0,L.m9)(c);const h=i.yu(l);if(c instanceof Si)s.push(l);else{const d=yn(c,h);null!=d&&(s.push(l),o.set(l,d))}});const a=new Be(s);return new _m(o,a,i.fieldTransforms)}function Tc(n,e,t,r,i,s){const o=n.Cu(1,e,t),a=[xi(e,r,t)],u=[i];if(s.length%2!=0)throw new y(g.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(xi(e,s[d])),u.push(s[d+1]);const c=[],l=Ae.empty();for(let d=a.length-1;d>=0;--d)if(!wm(c,a[d])){const f=a[d];let _=u[d];_=(0,L.m9)(_);const v=o.yu(f);if(_ instanceof Si)c.push(f);else{const T=yn(_,v);null!=T&&(c.push(f),l.set(f,T))}}const h=new Be(c);return new _m(l,h,o.fieldTransforms)}function Im(n,e,t,r=!1){return yn(t,n.Cu(r?4:3,e))}function yn(n,e){if(vm(n=(0,L.m9)(n)))return Ic("Unsupported field value:",e,n),Em(n,e);if(n instanceof pn)return function(r,i){if(!ym(i.Vu))throw i.Su(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Su(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.gu&&4!==e.Vu)throw e.Su("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let u=yn(a,i.wu(o));null==u&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=(0,L.m9)(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return od(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=te.fromDate(r);return{timestampValue:Zn(i.serializer,s)}}if(r instanceof te){const s=new te(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Zn(i.serializer,s)}}if(r instanceof Js)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ht)return{bytesValue:Sd(i.serializer,r._byteString)};if(r instanceof J){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Su(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Va(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Su(`Unsupported field value: ${Ys(r)}`)}(n,e)}function Em(n,e){const t={};return xh(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Nt(n,(r,i)=>{const s=yn(i,e.fu(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function vm(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof te||n instanceof Js||n instanceof ht||n instanceof J||n instanceof pn)}function Ic(n,e,t){if(!vm(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=Ys(t);throw e.Su("an object"===r?n+" a custom object":n+" "+r)}var i}function xi(n,e,t){if((e=(0,L.m9)(e))instanceof wt)return e._internalPath;if("string"==typeof e)return no(n,e);throw ro("Field path arguments must be of type string or ",n,!1,void 0,t)}const mI=new RegExp("[~\\*/\\[\\]]");function no(n,e,t){if(e.search(mI)>=0)throw ro(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new wt(...e.split("."))._internalPath}catch{throw ro(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ro(n,e,t,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new y(g.INVALID_ARGUMENT,a+n+u)}function wm(n,e){return n.some(t=>t.isEqual(e))}class Vi{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new J(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new gI(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(io("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class gI extends Vi{data(){return super.data()}}function io(n,e){return"string"==typeof e?no(n,e):e instanceof wt?e._internalPath:e._delegate._internalPath}function Am(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new y(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ec{}class Ci extends Ec{}function Kt(n,e,...t){let r=[];e instanceof Ec&&r.push(e),r=r.concat(t),function(s){const o=s.filter(u=>u instanceof gr).length,a=s.filter(u=>u instanceof bi).length;if(o>1||o>0&&a>0)throw new y(g.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class bi extends Ci{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new bi(e,t,r)}_apply(e){const t=this._parse(e);return xm(e._query,t),new Re(e.firestore,e.converter,Ea(e._query,t))}_parse(e){const t=_n(e.firestore);return function(s,o,a,u,c,l,h){let d;if(c.isKeyField()){if("array-contains"===l||"array-contains-any"===l)throw new y(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if("in"===l||"not-in"===l){Sm(h,l);const f=[];for(const _ of h)f.push(Pm(u,s,_));d={arrayValue:{values:f}}}else d=Pm(u,s,h)}else"in"!==l&&"not-in"!==l&&"array-contains-any"!==l||Sm(h,l),d=Im(a,"where",h,"in"===l||"not-in"===l);return z.create(c,l,d)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class gr extends Ec{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new gr(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:K.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const u of a)xm(o,u),o=Ea(o,u)}(e._query,t),new Re(e.firestore,e.converter,Ea(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class vc extends Ci{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new vc(e,t)}_apply(e){const t=function(i,s,o){if(null!==i.startAt)throw new y(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new y(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ni(s,o)}(e._query,this._field,this._direction);return new Re(e.firestore,e.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new yt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class so extends Ci{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new so(e,t,r)}_apply(e){return new Re(e.firestore,e.converter,As(e._query,this._limit,this._limitType))}}class oo extends Ci{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new oo(e,t,r)}_apply(e){const t=Rm(e,this.type,this._docOrFields,this._inclusive);return new Re(e.firestore,e.converter,(s=t,new yt((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class ao extends Ci{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ao(e,t,r)}_apply(e){const t=Rm(e,this.type,this._docOrFields,this._inclusive);return new Re(e.firestore,e.converter,(s=t,new yt((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function Rm(n,e,t,r){if(t[0]=(0,L.m9)(t[0]),t[0]instanceof Vi)return function(s,o,a,u,c){if(!u)throw new y(g.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const l=[];for(const h of jn(s))if(h.field.isKeyField())l.push(sn(o,u.key));else{const d=u.data.field(h.field);if(_s(d))throw new y(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===d){const f=h.field.canonicalString();throw new y(g.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}l.push(d)}return new Ut(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=_n(n.firestore);return function(o,a,u,c,l,h){const d=o.explicitOrderBy;if(l.length>d.length)throw new y(g.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const f=[];for(let _=0;_<l.length;_++){const v=l[_];if(d[_].field.isKeyField()){if("string"!=typeof v)throw new y(g.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof v}`);if(!Ia(o)&&-1!==v.indexOf("/"))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${v}' contains a slash.`);const T=o.path.child(G.fromString(v));if(!A.isDocumentKey(T))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${T}' is not because it contains an odd number of segments.`);const x=new A(T);f.push(sn(a,x))}else{const T=Im(u,c,v);f.push(T)}}return new Ut(f,h)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Pm(n,e,t){if("string"==typeof(t=(0,L.m9)(t))){if(""===t)throw new y(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ia(e)&&-1!==t.indexOf("/"))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(G.fromString(t));if(!A.isDocumentKey(r))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return sn(n,new A(r))}if(t instanceof J)return sn(n,t._key);throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ys(t)}.`)}function Sm(n,e){if(!Array.isArray(n)||0===n.length)throw new y(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function xm(n,e){const t=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new y(g.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class wc{convertValue(e,t="none"){switch(Ot(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ae(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_t(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw S()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Nt(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Js(ae(e.latitude),ae(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=ys(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Xr(e));default:return null}}convertTimestamp(e){const t=kt(e);return new te(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=G.fromString(e);C(Ld(r));const i=new Ft(r.get(1),r.get(3)),s=new A(r.popFirst(5));return i.isEqual(t)||ce(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function uo(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class AI extends wc{constructor(e){super(),this.firestore=e}convertBytes(e){return new ht(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new J(this.firestore,null,t)}}class Tn{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class At extends Vi{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Di(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(io("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Di extends At{data(e={}){return super.data(e)}}class Qt{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Tn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Di(this._firestore,this._userDataWriter,r.key,r,new Tn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new y(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>({type:"added",doc:new Di(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Tn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||3!==a.type).map(a=>{const u=new Di(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Tn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,l=-1;return 0!==a.type&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),1!==a.type&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:PI(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function PI(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function Cm(n,e){return n instanceof At&&e instanceof At?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Qt&&e instanceof Qt&&n._firestore===e._firestore&&dc(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class Wt extends wc{constructor(e){super(),this.firestore=e}convertBytes(e){return new ht(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new J(this.firestore,null,t)}}function bm(n,e,t){n=q(n,J);const r=q(n.firestore,H),i=uo(n.converter,e,t);return pr(r,[to(_n(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,ne.none())])}function Dm(n,e,t,...r){n=q(n,J);const i=q(n.firestore,H),s=_n(i);let o;return o="string"==typeof(e=(0,L.m9)(e))||e instanceof wt?Tc(s,"updateDoc",n._key,e,t,r):yc(s,"updateDoc",n._key,e),pr(i,[o.toMutation(n._key,ne.exists(!0))])}function Nm(n,...e){var t,r,i;n=(0,L.m9)(n);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||fc(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(fc(e[o])){const h=e[o];e[o]=null===(t=h.next)||void 0===t?void 0:t.bind(h),e[o+1]=null===(r=h.error)||void 0===r?void 0:r.bind(h),e[o+2]=null===(i=h.complete)||void 0===i?void 0:i.bind(h)}let u,c,l;if(n instanceof J)c=q(n.firestore,H),l=zn(n._key.path),u={next:h=>{e[o]&&e[o](Ac(c,n,h))},error:e[o+1],complete:e[o+2]};else{const h=q(n,Re);c=q(h.firestore,H),l=h._query;const d=new Wt(c);u={next:f=>{e[o]&&e[o](new Qt(c,d,h,f))},error:e[o+1],complete:e[o+2]},Am(n._query)}return function(d,f,_,v){const T=new Ws(v),x=new xu(f,T,_);return d.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return vu(yield mr(d),x)})),()=>{T.Qa(),d.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return Au(yield mr(d),x)}))}}(ue(c),l,a,u)}function pr(n,e){return function(r,i){const s=new fe;return r.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function ET(n,e,t){return Mu.apply(this,arguments)}(yield cc(r),i,s)})),s.promise}(ue(n),e)}function Ac(n,e,t){const r=t.docs.get(e._key),i=new Wt(n);return new At(n,i,e._key,r,new Tn(t.hasPendingWrites,t.fromCache),e.converter)}const jI={maxAttempts:5};class km{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=_n(e)}set(e,t,r){this._verifyNotCommitted();const i=Ht(e,this._firestore),s=uo(i.converter,t,r),o=to(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(o.toMutation(i._key,ne.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=Ht(e,this._firestore);let o;return o="string"==typeof(t=(0,L.m9)(t))||t instanceof wt?Tc(this._dataReader,"WriteBatch.update",s._key,t,r,i):yc(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,ne.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ht(e,this._firestore);return this._mutations=this._mutations.concat(new Hn(t._key,ne.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ht(n,e){if((n=(0,L.m9)(n)).firestore!==e)throw new y(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class $I extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=_n(t)}get(t){const r=Ht(t,this._firestore),i=new AI(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||1!==s.length)return S();const o=s[0];if(o.isFoundDocument())return new Vi(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Vi(this._firestore,i,r._key,null,r.converter);throw S()})}set(t,r,i){const s=Ht(t,this._firestore),o=uo(s.converter,r,i),a=to(this._dataReader,"Transaction.set",s._key,o,null!==s.converter,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){const o=Ht(t,this._firestore);let a;return a="string"==typeof(r=(0,L.m9)(r))||r instanceof wt?Tc(this._dataReader,"Transaction.update",o._key,r,i,s):yc(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Ht(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Ht(e,this._firestore),r=new Wt(this._firestore);return super.get(e).then(i=>new At(this._firestore,r,t._key,i._document,new Tn(!1,!1),t.converter))}}function Pc(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Lm(){if(typeof Uint8Array>"u")throw new y("unimplemented","Uint8Arrays are not available in this environment.")}function Um(){if(!function R_(){return typeof atob<"u"}())throw new y("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){Fn=St.SDK_VERSION,(0,St._registerComponent)(new qi.wA("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new H(new Hp(r.getProvider("auth-internal")),new Xp(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new y(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ft(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),(0,St.registerVersion)(lh,"4.5.1",e),(0,St.registerVersion)(lh,"4.5.1","esm2017")}();class Ni{constructor(e){this._delegate=e}static fromBase64String(e){return Um(),new Ni(ht.fromBase64String(e))}static fromUint8Array(e){return Lm(),new Ni(ht.fromUint8Array(e))}toBase64(){return Um(),this._delegate.toBase64()}toUint8Array(){return Lm(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Sc(n){return function tE(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class nE{enableIndexedDbPersistence(e,t){return function nI(n,e){pm(n=q(n,H));const t=ue(n);if(t._uninitializedComponentsProvider)throw new y(g.FAILED_PRECONDITION,"SDK cache is already specified.");Ue("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new dr;return gm(t,i,new nc(i,r.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function rI(n){pm(n=q(n,H));const e=ue(n);if(e._uninitializedComponentsProvider)throw new y(g.FAILED_PRECONDITION,"SDK cache is already specified.");Ue("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new dr;return gm(e,r,new Zf(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function iI(n){if(n._initialized&&!n._terminated)throw new y(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new fe;return n._queue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{yield(t=(0,p.Z)(function*(i){if(!Ye.D())return Promise.resolve();const s=i+"main";yield Ye.delete(s)}),function r(i){return t.apply(this,arguments)})($a(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Bm{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Ft||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ue("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function hm(n,e,t,r={}){var i;const s=(n=q(n,Ri))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Ue("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if("string"==typeof r.mockUserToken)a=r.mockUserToken,u=_e.MOCK_USER;else{a=(0,L.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new y(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new _e(c)}n._authCredentials=new Wp(new hh(a,u))}}(this._delegate,e,t,r)}enableNetwork(){return function oI(n){return function GT(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield Jf(n),t=yield em(n);return e.setNetworkEnabled(!0),function(i){const s=w(i);return s.v_.delete(0),wi(s)}(t)}))}(ue(n=q(n,H)))}(this._delegate)}disableNetwork(){return function aI(n){return function zT(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield Jf(n),t=yield em(n);return e.setNetworkEnabled(!1),(r=(0,p.Z)(function*(s){const o=w(s);o.v_.add(0),yield ir(o),o.x_.set("Offline")}),function i(s){return r.apply(this,arguments)})(t);var r}))}(ue(n=q(n,H)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,om("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function sI(n){return function(t){const r=new fe;return t.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function RT(n,e){return qu.apply(this,arguments)}(yield cc(t),r)})),r.promise}(ue(n=q(n,H)))}(this._delegate)}onSnapshotsInSync(e){return function FI(n,e){return function KT(n,e){const t=new Ws(e);return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return i=yield mr(n),s=t,w(i).W_.add(s),void s.next();var i,s})),()=>{t.Qa(),n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return i=yield mr(n),s=t,void w(i).W_.delete(s);var i,s}))}}(ue(n=q(n,H)),fc(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new _r(this,dm(this._delegate,e))}catch(t){throw Fe(t,"collection()","Firestore.collection()")}}doc(e){try{return new Xe(this,Xs(this._delegate,e))}catch(t){throw Fe(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Me(this,function XT(n,e){if(n=q(n,Ri),hc("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new y(g.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Re(n,null,(r=e,new yt(G.emptyPath(),r)));var r}(this._delegate,e))}catch(t){throw Fe(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function KI(n,e,t){n=q(n,H);const r=Object.assign(Object.assign({},jI),t);return function(s){if(s.maxAttempts<1)throw new y(g.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){const u=new fe;return s.asyncQueue.enqueueAndForget((0,p.Z)(function*(){const c=yield function tm(n){return Zs(n).then(e=>e.datastore)}(s);new BT(s.asyncQueue,c,a,o,u).Ya()})),u.promise}(ue(n),i=>e(new $I(n,i)),r)}(this._delegate,t=>e(new qm(this,t)))}batch(){return ue(this._delegate),new Gm(new km(this._delegate,e=>pr(this._delegate,e)))}loadBundle(e){return function uI(n,e){const t=ue(n=q(n,H)),r=new eI;return function QT(n,e,t,r){const i=function(o,a){let u;return u="string"==typeof o?Td().encode(o):o,l=function(l,h){if(l instanceof Uint8Array)return Yf(l,h);if(l instanceof ArrayBuffer)return Yf(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),new LT(l,a);var l}(t,vi(e));n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){!function MT(n,e,t){const r=w(n);var i;(i=(0,p.Z)(function*(o,a,u){try{const c=yield a.getMetadata();if(yield function(_,v){const T=w(_),x=le(v.createTime);return T.persistence.runTransaction("hasNewerBundle","readonly",N=>T.$r.getBundleMetadata(N,v.id)).then(N=>!!N&&N.createTime.compareTo(x)>=0)}(o.localStore,c))return yield a.close(),u._completeWith({taskState:"Success",documentsLoaded:(_=c).totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}),Promise.resolve(new Set);u._updateProgress(Bf(c));const l=new fT(c,o.localStore,a.serializer);let h=yield a.Ba();for(;h;){const f=yield l.sa(h);f&&u._updateProgress(f),h=yield a.Ba()}const d=yield l.complete();return yield vt(o,d.aa,void 0),yield function(_,v){const T=w(_);return T.persistence.runTransaction("Save bundle","readwrite",x=>T.$r.saveBundleMetadata(x,v))}(o.localStore,c),u._completeWith(d.progress),Promise.resolve(d._a)}catch(c){return Ue("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}var _}),function s(o,a,u){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield cc(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function cI(n,e){return function WT(n,e){return n.asyncQueue.enqueue((0,p.Z)(function*(){return function(r,i){const s=w(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.$r.getNamedQuery(o,i))}(yield fr(n),e)}))}(ue(n=q(n,H)),e).then(t=>t?new Re(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Me(this,t):null)}}class lo extends wc{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ni(new ht(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Xe.forKey(t,this.firestore,null)}}class qm{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new lo(e)}get(e){const t=En(e);return this._delegate.get(t).then(r=>new ki(this._firestore,new At(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=En(e);return r?(Pc("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=En(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=En(e);return this._delegate.delete(t),this}}class Gm{constructor(e){this._delegate=e}set(e,t,r){const i=En(e);return r?(Pc("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=En(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=En(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class In{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new Di(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Fi(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=In.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new In(e,new lo(e),t),i.set(t,s)),s}}In.INSTANCES=new WeakMap;class Xe{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new lo(e)}static forPath(e,t,r){if(e.length%2!=0)throw new y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Xe(t,new J(t._delegate,r,new A(e)))}static forKey(e,t,r){return new Xe(t,new J(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new _r(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new _r(this.firestore,dm(this._delegate,e))}catch(t){throw Fe(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,L.m9)(e))instanceof J&&fm(this._delegate,e)}set(e,t){t=Pc("DocumentReference.set",t);try{return t?bm(this._delegate,e,t):bm(this._delegate,e)}catch(r){throw Fe(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Dm(this._delegate,e):Dm(this._delegate,e,t,...r)}catch(i){throw Fe(i,"updateDoc()","DocumentReference.update()")}}delete(){return function NI(n){return pr(q(n.firestore,H),[new Hn(n._key,ne.none())])}(this._delegate)}onSnapshot(...e){const t=zm(e),r=jm(e,i=>new ki(this.firestore,new At(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Nm(this._delegate,t,r)}get(e){let t;return t="cache"===e?.source?function xI(n){n=q(n,J);const e=q(n.firestore,H),t=ue(e),r=new Wt(e);return function jT(n,e){const t=new fe;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,o,a){try{const u=yield function(l,h){const d=w(l);return d.persistence.runTransaction("read document","readonly",f=>d.localDocuments.getDocument(f,h))}(s,o);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new y(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){const c=ur(u,`Failed to get document '${o} from cache`);a.reject(c)}}),function i(s,o,a){return r.apply(this,arguments)})(yield fr(n),e,t);var r})),t.promise}(t,n._key).then(i=>new At(e,r,n._key,i,new Tn(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===e?.source?function VI(n){n=q(n,J);const e=q(n.firestore,H);return nm(ue(e),n._key,{source:"server"}).then(t=>Ac(e,n,t))}(this._delegate):function SI(n){n=q(n,J);const e=q(n.firestore,H);return nm(ue(e),n._key).then(t=>Ac(e,n,t))}(this._delegate),t.then(r=>new ki(this.firestore,new At(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Xe(this.firestore,this._delegate.withConverter(e?In.getInstance(this.firestore,e):null))}}function Fe(n,e,t){return n.message=n.message.replace(e,t),n}function zm(n){for(const e of n)if("object"==typeof e&&!Sc(e))return e;return{}}function jm(n,e){var t,r;let i;return i=Sc(n[0])?n[0]:Sc(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class ki{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Xe(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Cm(this._delegate,e._delegate)}}class Fi extends ki{data(e){const t=this._delegate.data(e);return this._delegate._converter||function Kp(n,e){n||S()}(void 0!==t),t}}class Me{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new lo(e)}where(e,t,r){try{return new Me(this.firestore,Kt(this._delegate,function pI(n,e,t){const r=e,i=io("where",n);return bi._create(i,r,t)}(e,t,r)))}catch(i){throw Fe(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Me(this.firestore,Kt(this._delegate,function _I(n,e="asc"){const t=e,r=io("orderBy",n);return vc._create(r,t)}(e,t)))}catch(r){throw Fe(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Me(this.firestore,Kt(this._delegate,function yI(n){return cm("limit",n),so._create("limit",n,"F")}(e)))}catch(t){throw Fe(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Me(this.firestore,Kt(this._delegate,function TI(n){return cm("limitToLast",n),so._create("limitToLast",n,"L")}(e)))}catch(t){throw Fe(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Me(this.firestore,Kt(this._delegate,function II(...n){return oo._create("startAt",n,!0)}(...e)))}catch(t){throw Fe(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Me(this.firestore,Kt(this._delegate,function EI(...n){return oo._create("startAfter",n,!1)}(...e)))}catch(t){throw Fe(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Me(this.firestore,Kt(this._delegate,function vI(...n){return ao._create("endBefore",n,!1)}(...e)))}catch(t){throw Fe(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Me(this.firestore,Kt(this._delegate,function wI(...n){return ao._create("endAt",n,!0)}(...e)))}catch(t){throw Fe(t,"endAt()","Query.endAt()")}}isEqual(e){return dc(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function bI(n){n=q(n,Re);const e=q(n.firestore,H),t=ue(e),r=new Wt(e);return function $T(n,e){const t=new fe;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,o,a){try{const u=yield Bs(s,o,!0),c=new zf(o,u.hs),l=c.Ta(u.documents),h=c.applyChanges(l,!1);a.resolve(h.snapshot)}catch(u){const c=ur(u,`Failed to execute query '${o} against cache`);a.reject(c)}}),function i(s,o,a){return r.apply(this,arguments)})(yield fr(n),e,t);var r})),t.promise}(t,n._query).then(i=>new Qt(e,r,n,i))}(this._delegate):"server"===e?.source?function DI(n){n=q(n,Re);const e=q(n.firestore,H),t=ue(e),r=new Wt(e);return rm(t,n._query,{source:"server"}).then(i=>new Qt(e,r,n,i))}(this._delegate):function CI(n){n=q(n,Re);const e=q(n.firestore,H),t=ue(e),r=new Wt(e);return Am(n._query),rm(t,n._query).then(i=>new Qt(e,r,n,i))}(this._delegate),t.then(r=>new xc(this.firestore,new Qt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=zm(e),r=jm(e,i=>new xc(this.firestore,new Qt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Nm(this._delegate,t,r)}withConverter(e){return new Me(this.firestore,this._delegate.withConverter(e?In.getInstance(this.firestore,e):null))}}class iE{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Fi(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class xc{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Me(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Fi(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new iE(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Fi(this._firestore,r))})}isEqual(e){return Cm(this._delegate,e._delegate)}}class _r extends Me{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Xe(this.firestore,e):null}doc(e){try{return new Xe(this.firestore,void 0===e?Xs(this._delegate):Xs(this._delegate,e))}catch(t){throw Fe(t,"doc()","CollectionReference.doc()")}}add(e){return function kI(n,e){const t=q(n.firestore,H),r=Xs(n),i=uo(n.converter,e);return pr(t,[to(_n(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,ne.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Xe(this.firestore,t))}isEqual(e){return fm(this._delegate,e._delegate)}withConverter(e){return new _r(this.firestore,this._delegate.withConverter(e?In.getInstance(this.firestore,e):null))}}function En(n){return q(n,J)}class Vc{constructor(...e){this._delegate=new wt(...e)}static documentId(){return new Vc(Y.keyField().canonicalString())}isEqual(e){return(e=(0,L.m9)(e))instanceof wt&&this._delegate._internalPath.isEqual(e._internalPath)}}class vn{constructor(e){this._delegate=e}static serverTimestamp(){const e=function WI(){return new mc("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new vn(e)}static delete(){const e=function QI(){return new Si("deleteField")}();return e._methodName="FieldValue.delete",new vn(e)}static arrayUnion(...e){const t=function HI(...n){return new gc("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new vn(t)}static arrayRemove(...e){const t=function ZI(...n){return new pc("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new vn(t)}static increment(e){const t=function YI(n){return new _c("increment",n)}(e);return t._methodName="FieldValue.increment",new vn(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const sE={Firestore:Bm,GeoPoint:Js,Timestamp:te,Blob:Ni,Transaction:qm,WriteBatch:Gm,DocumentReference:Xe,DocumentSnapshot:ki,Query:Me,QueryDocumentSnapshot:Fi,QuerySnapshot:xc,CollectionReference:_r,FieldPath:Vc,FieldValue:vn,setLogLevel:function rE(n){!function $p(n){Ct.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};function $m(n,e){return function uE(n,e=Rn.z){return new Pn.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}(n,e)}function Cc(n,e){return $m(n,e).pipe((0,M.U)(t=>({payload:t,type:"query"})))}!function aE(n){(function oE(n,e){n.INTERNAL.registerComponent(new qi.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},sE)))})(n,(e,t)=>new Bm(e,t,new nE)),n.registerVersion("@firebase/firestore-compat","0.3.28")}(Kc.Z),D(7142);class Km{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:s}=Zm(r,t);return new Hm(i,s,this.afs)}snapshotChanges(){return function cE(n,e){return $m(n,e).pipe((0,Ar.O)(void 0),(0,Rr.G)(),(0,M.U)(t=>{const[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(se.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,M.U)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,ze.D)(this.ref.get(e)).pipe(se.iC)}}function ho(n,e){return Cc(n,e).pipe((0,Ar.O)(void 0),(0,Rr.G)(),(0,M.U)(t=>{const[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{const c=s.find(h=>h.doc.ref.isEqual(a.ref)),l=r?.payload.docs.find(h=>h.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&l&&JSON.stringify(l.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function Qm(n,e,t){return ho(n,t).pipe((0,Sn.R)((r,i)=>function lE(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function hE(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return bc(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return bc(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return bc(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(s=>s.payload),e),[]),(0,he.x)(),(0,M.U)(r=>r.map(i=>({type:i.type,payload:i}))))}function bc(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function Wm(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class Hm{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=ho(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,M.U)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,Ar.O)(void 0),(0,Rr.G)(),(0,De.h)(([r,i])=>i.length>0||!r),(0,M.U)(([,r])=>r),se.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Sn.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Wm(e);return Qm(this.query,t,this.afs.schedulers.outsideAngular).pipe(se.iC)}valueChanges(e={}){return Cc(this.query,this.afs.schedulers.outsideAngular).pipe((0,M.U)(t=>t.payload.docs.map(r=>e.idField?{...r.data(),[e.idField]:r.id}:r.data())),se.iC)}get(e){return(0,ze.D)(this.query.get(e)).pipe(se.iC)}add(e){return this.ref.add(e)}doc(e){return new Km(this.ref.doc(e),this.afs)}}class dE{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?ho(this.query,this.afs.schedulers.outsideAngular).pipe((0,M.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,De.h)(t=>t.length>0),se.iC):ho(this.query,this.afs.schedulers.outsideAngular).pipe(se.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Sn.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Wm(e);return Qm(this.query,t,this.afs.schedulers.outsideAngular).pipe(se.iC)}valueChanges(e={}){return Cc(this.query,this.afs.schedulers.outsideAngular).pipe((0,M.U)(r=>r.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),se.iC)}get(e){return(0,ze.D)(this.query.get(e)).pipe(se.iC)}}const fE=new E.OlP("angularfire2.enableFirestorePersistence"),mE=new E.OlP("angularfire2.firestore.persistenceSettings"),gE=new E.OlP("angularfire2.firestore.settings"),pE=new E.OlP("angularfire2.firestore.use-emulator");function Zm(n,e=(t=>t)){return{query:e(n),ref:n}}let _E=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,u,c,l,h,d,f,_,v,T,x,N){this.schedulers=u;const R=(0,We.on)(t,a,r),V=l;h&&(0,He.nw)(R,a,d,_,v,T,f,x),[this.firestore,this.persistenceEnabled$]=(0,We.cc)(`${R.name}.firestore`,"AngularFirestore",R.name,()=>{const U=a.runOutsideAngular(()=>R.firestore());if(s&&U.settings(s),V&&U.useEmulator(...V),i&&!(0,wr.PM)(o)){const B=()=>{try{return(0,ze.D)(U.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(ee){return typeof console<"u"&&console.warn(ee),(0,Zt.of)(!1)}};return[U,a.runOutsideAngular(B)]}return[U,(0,Zt.of)(!1)]},[s,V,i])}collection(t,r){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:o}=Zm(i,r),a=this.schedulers.ngZone.run(()=>s);return new Hm(a,o,this)}collectionGroup(t,r){const i=r||(o=>o),s=this.firestore.collectionGroup(t);return new dE(i(s),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const i=this.schedulers.ngZone.run(()=>r);return new Km(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(E.LFG(We.Dh),E.LFG(We.xv,8),E.LFG(fE,8),E.LFG(gE,8),E.LFG(E.Lbi),E.LFG(E.R0b),E.LFG(se.HU),E.LFG(mE,8),E.LFG(pE,8),E.LFG(He.zQ,8),E.LFG(He.Qv,8),E.LFG(He.L6,8),E.LFG(He._Q,8),E.LFG(He.rT,8),E.LFG(He.lh,8),E.LFG(He.f7,8),E.LFG(se.Rf,8))};static \u0275prov=E.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var yE=D(3620),Ym=D(4664);const Xm="firebasestorage.googleapis.com",Jm="storageBucket";class ie extends L.ZR{constructor(e,t,r=0){super(Dc(e),`Firebase Storage: ${t} (${Dc(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ie.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Dc(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.message=this.customData.serverResponse?`${this._baseMessage}\n${this.customData.serverResponse}`:this._baseMessage}}var re=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(re||{});function Dc(n){return"storage/"+n}function Nc(){return new ie(re.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function eg(){return new ie(re.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function tg(){return new ie(re.CANCELED,"User canceled the upload/download.")}function ng(){return new ie(re.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function yr(n){return new ie(re.INVALID_ARGUMENT,n)}function rg(){return new ie(re.APP_DELETED,"The Firebase app was deleted.")}function ig(n){return new ie(re.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Mi(n,e){return new ie(re.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Oi(n){throw new ie(re.INTERNAL_ERROR,"Internal error: "+n)}class be{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=be.makeFromUrl(e,t)}catch{return new be(e,"")}if(""===r.path)return r;throw function xE(n){return new ie(re.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}(e)}static makeFromUrl(e,t){let r=null;const i="([A-Za-z0-9.\\-_]+)",a=new RegExp("^gs://"+i+"(/(.*))?$","i");function c(V){V.path_=decodeURIComponent(V.path)}const h=t.replace(/[.]/g,"\\."),R=[{regex:a,indices:{bucket:1,path:3},postModify:function s(V){"/"===V.path.charAt(V.path.length-1)&&(V.path_=V.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${h}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:c},{regex:new RegExp(`^https?://${t===Xm?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:c}];for(let V=0;V<R.length;V++){const U=R[V],B=U.regex.exec(e);if(B){let Ie=B[U.indices.path];Ie||(Ie=""),r=new be(B[U.indices.bucket],Ie),U.postModify(r);break}}if(null==r)throw function SE(n){return new ie(re.INVALID_URL,"Invalid URL '"+n+"'.")}(e);return r}}class NE{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function fo(n){return"string"==typeof n||n instanceof String}function sg(n){return kc()&&n instanceof Blob}function kc(){return typeof Blob<"u"}function Fc(n,e,t,r){if(r<e)throw yr(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw yr(`Invalid value for '${n}'. Expected ${t} or less.`)}function Rt(n,e,t){let r=e;return null==t&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function og(n){const e=encodeURIComponent;let t="?";for(const r in n)n.hasOwnProperty(r)&&(t=t+(e(r)+"=")+e(n[r])+"&");return t=t.slice(0,-1),t}var Tr=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(Tr||{});function ag(n,e){const t=n>=500&&n<600,i=-1!==[408,429].indexOf(n),s=-1!==e.indexOf(n);return t||i||s}class UE{constructor(e,t,r,i,s,o,a,u,c,l,h,d=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=u,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=h,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((f,_)=>{this.resolve_=f,this.reject_=_,this.start_()})}start_(){const t=(r,i)=>{const s=this.resolve_,o=this.reject_,a=i.connection;if(i.wasSuccessCode)try{const u=this.callback_(a,a.getResponse());!function ME(n){return void 0!==n}(u)?s():s(u)}catch(u){o(u)}else if(null!==a){const u=Nc();u.serverResponse=a.getErrorText(),o(this.errorCallback_?this.errorCallback_(a,u):u)}else o(i.canceled?this.appDelete_?rg():tg():eg())};this.canceled_?t(0,new mo(!1,null,!0)):this.backoffId_=function kE(n,e,t){let r=1,i=null,s=null,o=!1,a=0;function u(){return 2===a}let c=!1;function l(...T){c||(c=!0,e.apply(null,T))}function h(T){i=setTimeout(()=>{i=null,n(f,u())},T)}function d(){s&&clearTimeout(s)}function f(T,...x){if(c)return void d();if(T)return d(),void l.call(null,T,...x);if(u()||o)return d(),void l.call(null,T,...x);let R;r<64&&(r*=2),1===a?(a=2,R=0):R=1e3*(r+Math.random()),h(R)}let _=!1;function v(T){_||(_=!0,d(),!c&&(null!==i?(T||(a=2),clearTimeout(i),h(0)):T||(a=1)))}return h(0),s=setTimeout(()=>{o=!0,v(!0)},t),v}((r,i)=>{if(i)return void r(!1,new mo(!1,null,!0));const s=this.connectionFactory_();this.pendingConnection_=s;const o=a=>{null!==this.progressCallback_&&this.progressCallback_(a.loaded,a.lengthComputable?a.total:-1)};null!==this.progressCallback_&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&s.removeUploadProgressListener(o),this.pendingConnection_=null;const a=s.getErrorCode()===Tr.NO_ERROR,u=s.getStatus();if(!a||ag(u,this.additionalRetryCodes_)&&this.retry){const l=s.getErrorCode()===Tr.ABORT;return void r(!1,new mo(!1,null,l))}const c=-1!==this.successCodes_.indexOf(u);r(!0,new mo(c,s))})},t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function FE(n){n(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class mo{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function KE(...n){const e=function $E(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}();if(void 0!==e){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}if(kc())return new Blob(n);throw new ie(re.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const Qe={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Mc{constructor(e,t){this.data=e,this.contentType=t||null}}function Oc(n,e){switch(n){case Qe.RAW:return new Mc(ug(e));case Qe.BASE64:case Qe.BASE64URL:return new Mc(cg(n,e));case Qe.DATA_URL:return new Mc(function ZE(n){const e=new lg(n);return e.base64?cg(Qe.BASE64,e.rest):function HE(n){let e;try{e=decodeURIComponent(n)}catch{throw Mi(Qe.DATA_URL,"Malformed data URL.")}return ug(e)}(e.rest)}(e),function YE(n){return new lg(n).contentType}(e))}throw Nc()}function ug(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);r<=127?e.push(r):r<=2047?e.push(192|r>>6,128|63&r):55296==(64512&r)?t<n.length-1&&56320==(64512&n.charCodeAt(t+1))?(r=65536|(1023&r)<<10|1023&n.charCodeAt(++t),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):e.push(239,191,189):56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function cg(n,e){switch(n){case Qe.BASE64:{const i=-1!==e.indexOf("-"),s=-1!==e.indexOf("_");if(i||s)throw Mi(n,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case Qe.BASE64URL:{const i=-1!==e.indexOf("+"),s=-1!==e.indexOf("/");if(i||s)throw Mi(n,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=function WE(n){if(typeof atob>"u")throw function DE(n){return new ie(re.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}("base-64");return atob(n)}(e)}catch(i){throw i.message.includes("polyfill")?i:Mi(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}class lg{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw Mi(Qe.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;null!=r&&(this.base64=function XE(n,e){return n.length>=e.length&&n.substring(n.length-e.length)===e}(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}class dt{constructor(e,t){let r=0,i="";sg(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(sg(this.data_)){const i=function QE(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}(this.data_,e,t);return null===i?null:new dt(i)}{const r=new Uint8Array(this.data_.buffer,e,t-e);return new dt(r,!0)}}static getBlob(...e){if(kc()){const t=e.map(r=>r instanceof dt?r.data_:r);return new dt(KE.apply(null,t))}{const t=e.map(o=>fo(o)?Oc(Qe.RAW,o).data:o.data_);let r=0;t.forEach(o=>{r+=o.byteLength});const i=new Uint8Array(r);let s=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)i[s++]=o[a]}),new dt(i,!0)}}uploadData(){return this.data_}}function Lc(n){let e;try{e=JSON.parse(n)}catch{return null}return function LE(n){return"object"==typeof n&&!Array.isArray(n)}(e)?e:null}function hg(n){const e=n.lastIndexOf("/",n.length-2);return-1===e?n:n.slice(e+1)}function tv(n,e){return e}class Oe{constructor(e,t,r,i){this.server=e,this.local=t||e,this.writable=!!r,this.xform=i||tv}}let go=null;function Li(){if(go)return go;const n=[];n.push(new Oe("bucket")),n.push(new Oe("generation")),n.push(new Oe("metageneration")),n.push(new Oe("name","fullPath",!0));const t=new Oe("name");t.xform=function e(s,o){return function nv(n){return!fo(n)||n.length<2?n:hg(n)}(o)},n.push(t);const i=new Oe("size");return i.xform=function r(s,o){return void 0!==o?Number(o):o},n.push(i),n.push(new Oe("timeCreated")),n.push(new Oe("updated")),n.push(new Oe("md5Hash",null,!0)),n.push(new Oe("cacheControl",null,!0)),n.push(new Oe("contentDisposition",null,!0)),n.push(new Oe("contentEncoding",null,!0)),n.push(new Oe("contentLanguage",null,!0)),n.push(new Oe("contentType",null,!0)),n.push(new Oe("metadata","customMetadata",!0)),go=n,go}function dg(n,e,t){const r=Lc(e);return null===r?null:function iv(n,e,t){const r={type:"file"},i=t.length;for(let s=0;s<i;s++){const o=t[s];r[o.local]=o.xform(r,e[o.server])}return function rv(n,e){Object.defineProperty(n,"ref",{get:function t(){const s=new be(n.bucket,n.fullPath);return e._makeStorageReference(s)}})}(r,n),r}(n,r,t)}function Uc(n,e){const t={},r=e.length;for(let i=0;i<r;i++){const s=e[i];s.writable&&(t[s.server]=n[s.local])}return JSON.stringify(t)}const fg="prefixes",mg="items";class ft{constructor(e,t,r,i){this.url=e,this.method=t,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function mt(n){if(!n)throw Nc()}function po(n,e){return function t(r,i){const s=dg(n,i,e);return mt(null!==s),s}}function Ir(n){return function e(t,r){let i;return i=401===t.getStatus()?t.getErrorText().includes("Firebase App Check token is invalid")?function RE(){return new ie(re.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}():function AE(){return new ie(re.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again.")}():402===t.getStatus()?function wE(n){return new ie(re.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(n.bucket):403===t.getStatus()?function PE(n){return new ie(re.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}(n.path):r,i.status=t.getStatus(),i.serverResponse=r.serverResponse,i}}function Ui(n){const e=Ir(n);return function t(r,i){let s=e(r,i);return 404===r.getStatus()&&(s=function vE(n){return new ie(re.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}(n.path)),s.serverResponse=i.serverResponse,s}}function gg(n,e,t){const i=Rt(e.fullServerUrl(),n.host,n._protocol),o=n.maxOperationRetryTime,a=new ft(i,"GET",po(n,t),o);return a.errorHandler=Ui(e),a}function lv(n,e,t,r,i){const s={};s.prefix=e.isRoot?"":e.path+"/",t&&t.length>0&&(s.delimiter=t),r&&(s.pageToken=r),i&&(s.maxResults=i);const a=Rt(e.bucketOnlyServerUrl(),n.host,n._protocol),c=n.maxOperationRetryTime,l=new ft(a,"GET",function uv(n,e){return function t(r,i){const s=function av(n,e,t){const r=Lc(t);return null===r?null:function ov(n,e,t){const r={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[fg])for(const i of t[fg]){const s=i.replace(/\/$/,""),o=n._makeStorageReference(new be(e,s));r.prefixes.push(o)}if(t[mg])for(const i of t[mg]){const s=n._makeStorageReference(new be(e,i.name));r.items.push(s)}return r}(n,e,r)}(n,e,i);return mt(null!==s),s}}(n,e.bucket),c);return l.urlParams=s,l.errorHandler=Ir(e),l}function _g(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=function mv(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}class _o{constructor(e,t,r,i){this.current=e,this.total=t,this.finalized=!!r,this.metadata=i||null}}function Bc(n,e){let t=null;try{t=n.getResponseHeader("X-Goog-Upload-Status")}catch{mt(!1)}return mt(!!t&&-1!==(e||["active"]).indexOf(t)),t}const yv={STATE_CHANGED:"state_changed"},Le={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function qc(n){switch(n){case"running":case"pausing":case"canceling":return Le.RUNNING;case"paused":return Le.PAUSED;case"success":return Le.SUCCESS;case"canceled":return Le.CANCELED;default:return Le.ERROR}}class Tv{constructor(e,t,r){if(function OE(n){return"function"==typeof n}(e)||null!=t||null!=r)this.next=e,this.error=t??void 0,this.complete=r??void 0;else{const s=e;this.next=s.next,this.error=s.error,this.complete=s.complete}}}function Er(n){return(...e)=>{Promise.resolve().then(()=>n(...e))}}let Ig=null;class Iv{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Tr.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Tr.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Tr.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,i){if(this.sent_)throw Oi("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==i)for(const s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return void 0!==r?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Oi("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Oi("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Oi("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Oi("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class Ev extends Iv{initXhr(){this.xhr_.responseType="text"}}function tt(){return Ig?Ig():new Ev}class Eg{constructor(e,t,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=r,this._mappings=Li(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=i=>{if(this._request=void 0,this._chunkMultiplier=1,i._codeEquals(re.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const s=this.isExponentialBackoffExpired();if(ag(i.status,[])){if(!s)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();i=eg()}this._error=i,this._transition("error")}},this._metadataErrorHandler=i=>{this._request=void 0,i._codeEquals(re.CANCELED)?this.completeTransitions_():(this._error=i,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((i,s)=>{this._resolve=i,this._reject=s,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,r])=>{switch(this._state){case"running":e(t,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{const r=function gv(n,e,t,r,i){const s=e.bucketOnlyServerUrl(),o=_g(e,r,i),a={name:o.fullPath},u=Rt(s,n.host,n._protocol),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=Uc(o,t),_=new ft(u,"POST",function f(v){let T;Bc(v);try{T=v.getResponseHeader("X-Goog-Upload-URL")}catch{mt(!1)}return mt(fo(T)),T},n.maxUploadRetryTime);return _.urlParams=a,_.headers=l,_.body=h,_.errorHandler=Ir(e),_}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,tt,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._uploadUrl=s,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((t,r)=>{const i=function pv(n,e,t,r){const u=new ft(t,"POST",function s(c){const l=Bc(c,["active","final"]);let h=null;try{h=c.getResponseHeader("X-Goog-Upload-Size-Received")}catch{mt(!1)}h||mt(!1);const d=Number(h);return mt(!isNaN(d)),new _o(d,r.size(),"final"===l)},n.maxUploadRetryTime);return u.headers={"X-Goog-Upload-Command":"query"},u.errorHandler=Ir(e),u}(this._ref.storage,this._ref._location,e,this._blob),s=this._ref.storage._makeRequest(i,tt,t,r);this._request=s,s.getPromise().then(o=>{this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=262144*this._chunkMultiplier,t=new _o(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((i,s)=>{let o;try{o=function _v(n,e,t,r,i,s,o,a){const u=new _o(0,0);if(o?(u.current=o.current,u.total=o.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw function CE(){return new ie(re.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}();const c=u.total-u.current;let l=c;i>0&&(l=Math.min(l,i));const h=u.current;let f="";f=0===l?"finalize":c===l?"upload, finalize":"upload";const _={"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":`${u.current}`},v=r.slice(h,h+l);if(null===v)throw ng();const R=new ft(t,"POST",function T(V,U){const B=Bc(V,["active","final"]),ee=u.current+l,Ie=r.size();let Bi;return Bi="final"===B?po(e,s)(V,U):null,new _o(ee,Ie,"final"===B,Bi)},e.maxUploadRetryTime);return R.headers=_,R.body=v.uploadData(),R.progressCallback=a||null,R.errorHandler=Ir(n),R}(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(u){return this._error=u,void this._transition("error")}const a=this._ref.storage._makeRequest(o,tt,i,s,!1);this._request=a,a.getPromise().then(u=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(u.current),u.finalized?(this._metadata=u.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){262144*this._chunkMultiplier*2<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{const r=gg(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(r,tt,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{const r=function yg(n,e,t,r,i){const s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},u=function a(){let R="";for(let V=0;V<2;V++)R+=Math.random().toString().slice(2);return R}();o["Content-Type"]="multipart/related; boundary="+u;const c=_g(e,r,i),l=Uc(c,t),f=dt.getBlob("--"+u+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+l+"\r\n--"+u+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",r,"\r\n--"+u+"--");if(null===f)throw ng();const _={name:c.fullPath},v=Rt(s,n.host,n._protocol),x=n.maxUploadRetryTime,N=new ft(v,"POST",po(n,t),x);return N.urlParams=_,N.headers=o,N.body=f.uploadData(),N.errorHandler=Ir(e),N}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,tt,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=e,this._notifyObservers();break;case"canceled":this._error=tg(),this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=qc(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,r,i){const s=new Tv(t||void 0,r||void 0,i||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(t=>{this._notifyObserver(t)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(qc(this._state)){case Le.SUCCESS:Er(this._resolve.bind(null,this.snapshot))();break;case Le.CANCELED:case Le.ERROR:Er(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(qc(this._state)){case Le.RUNNING:case Le.PAUSED:e.next&&Er(e.next.bind(e,this.snapshot))();break;case Le.SUCCESS:e.complete&&Er(e.complete.bind(e))();break;default:e.error&&Er(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class wn{constructor(e,t){this._service=e,this._location=t instanceof be?t:be.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new wn(e,t)}get root(){const e=new be(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return hg(this._location.path)}get storage(){return this._service}get parent(){const e=function JE(n){if(0===n.length)return null;const e=n.lastIndexOf("/");return-1===e?"":n.slice(0,e)}(this._location.path);if(null===e)return null;const t=new be(this._location.bucket,e);return new wn(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw ig(e)}}function wg(n,e,t){return Gc.apply(this,arguments)}function Gc(){return Gc=(0,p.Z)(function*(n,e,t){const i=yield Ag(n,{pageToken:t});e.prefixes.push(...i.prefixes),e.items.push(...i.items),null!=i.nextPageToken&&(yield wg(n,e,i.nextPageToken))}),Gc.apply(this,arguments)}function Ag(n,e){null!=e&&"number"==typeof e.maxResults&&Fc("options.maxResults",1,1e3,e.maxResults);const t=e||{},r=lv(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(r,tt)}function Nv(n){n._throwIfRoot("getDownloadURL");const e=function hv(n,e,t){const i=Rt(e.fullServerUrl(),n.host,n._protocol),o=n.maxOperationRetryTime,a=new ft(i,"GET",function cv(n,e){return function t(r,i){const s=dg(n,i,e);return mt(null!==s),function sv(n,e,t,r){const i=Lc(e);if(null===i||!fo(i.downloadTokens))return null;const s=i.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map(c=>{const h=n.fullPath;return Rt("/b/"+o(n.bucket)+"/o/"+o(h),t,r)+og({alt:"media",token:c})})[0]}(s,i,n.host,n._protocol)}}(n,t),o);return a.errorHandler=Ui(e),a}(n.storage,n._location,Li());return n.storage.makeRequestWithTokens(e,tt).then(t=>{if(null===t)throw function bE(){return new ie(re.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}();return t})}function Rg(n,e){const t=function ev(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return 0===n.length?t:n+"/"+t}(n._location.path,e),r=new be(n._location.bucket,t);return new wn(n.storage,r)}function Pg(n,e){if(n instanceof zc){const t=n;if(null==t._bucket)throw function VE(){return new ie(re.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Jm+"' property when initializing the app?")}();const r=new wn(t,t._bucket);return null!=e?Pg(r,e):r}return void 0!==e?Rg(n,e):n}function Ov(n,e){if(e&&function Fv(n){return/^[A-Za-z]+:\/\//.test(n)}(e)){if(n instanceof zc)return function Mv(n,e){return new wn(n,e)}(n,e);throw yr("To use ref(service, url), the first argument must be a Storage instance.")}return Pg(n,e)}function Sg(n,e){const t=e?.[Jm];return null==t?null:be.makeFromBucketSpec(t,n)}class zc{constructor(e,t,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=Xm,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?be.makeFromBucketSpec(i,this._host):Sg(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._bucket=null!=this._url?be.makeFromBucketSpec(this._url,e):Sg(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Fc("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Fc("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){var e=this;return(0,p.Z)(function*(){if(e._overrideAuthToken)return e._overrideAuthToken;const t=e._authProvider.getImmediate({optional:!0});if(t){const r=yield t.getToken();if(null!==r)return r.accessToken}return null})()}_getAppCheckToken(){var e=this;return(0,p.Z)(function*(){const t=e._appCheckProvider.getImmediate({optional:!0});return t?(yield t.getToken()).token:null})()}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new wn(this,e)}_makeRequest(e,t,r,i,s=!0){if(this._deleted)return new NE(rg());{const o=function jE(n,e,t,r,i,s,o=!0){const a=og(n.urlParams),u=n.url+a,c=Object.assign({},n.headers);return function GE(n,e){e&&(n["X-Firebase-GMPID"]=e)}(c,e),function BE(n,e){null!==e&&e.length>0&&(n.Authorization="Firebase "+e)}(c,t),function qE(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}(c,s),function zE(n,e){null!==e&&(n["X-Firebase-AppCheck"]=e)}(c,r),new UE(u,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o)}(e,this._appId,r,i,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){var r=this;return(0,p.Z)(function*(){const[i,s]=yield Promise.all([r._getAuthToken(),r._getAppCheckToken()]);return r._makeRequest(e,t,i,s).getPromise()})()}}const xg="@firebase/storage";function bg(n,e){return Ov(n=(0,L.m9)(n),e)}function Qv(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new zc(t,r,i,e,St.SDK_VERSION)}!function Wv(){(0,St._registerComponent)(new qi.wA("storage",Qv,"PUBLIC").setMultipleInstances(!0)),(0,St.registerVersion)(xg,"0.12.3",""),(0,St.registerVersion)(xg,"0.12.3","esm2017")}();class yo{constructor(e,t,r){this._delegate=e,this.task=t,this.ref=r}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class Ng{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new yo(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then(r=>{if(e)return e(new yo(r,this,this._ref))},t)}on(e,t,r,i){let s;return t&&(s="function"==typeof t?o=>t(new yo(o,this,this._ref)):{next:t.next?o=>t.next(new yo(o,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,s,r||void 0,i||void 0)}}class kg{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new Pt(e,this._service))}get items(){return this._delegate.items.map(e=>new Pt(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class Pt{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){const t=function Kv(n,e){return Rg(n,e)}(this._delegate,e);return new Pt(t,this.storage)}get root(){return new Pt(this._delegate.root,this.storage)}get parent(){const e=this._delegate.parent;return null==e?null:new Pt(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new Ng(function Uv(n,e,t){return function xv(n,e,t){return n._throwIfRoot("uploadBytesResumable"),new Eg(n,new dt(e),t)}(n=(0,L.m9)(n),e,t)}(this._delegate,e,t),this)}putString(e,t=Qe.RAW,r){this._throwIfRoot("putString");const i=Oc(t,e),s=Object.assign({},r);return null==s.contentType&&null!=i.contentType&&(s.contentType=i.contentType),new Ng(new Eg(this._delegate,new dt(i.data,!0),s),this)}listAll(){return function zv(n){return function Cv(n){const e={prefixes:[],items:[]};return wg(n,e).then(()=>e)}(n=(0,L.m9)(n))}(this._delegate).then(e=>new kg(e,this.storage))}list(e){return function Gv(n,e){return Ag(n=(0,L.m9)(n),e)}(this._delegate,e||void 0).then(t=>new kg(t,this.storage))}getMetadata(){return function Bv(n){return function bv(n){n._throwIfRoot("getMetadata");const e=gg(n.storage,n._location,Li());return n.storage.makeRequestWithTokens(e,tt)}(n=(0,L.m9)(n))}(this._delegate)}updateMetadata(e){return function qv(n,e){return function Dv(n,e){n._throwIfRoot("updateMetadata");const t=function dv(n,e,t,r){const s=Rt(e.fullServerUrl(),n.host,n._protocol),a=Uc(t,r),c=n.maxOperationRetryTime,l=new ft(s,"PATCH",po(n,r),c);return l.headers={"Content-Type":"application/json; charset=utf-8"},l.body=a,l.errorHandler=Ui(e),l}(n.storage,n._location,e,Li());return n.storage.makeRequestWithTokens(t,tt)}(n=(0,L.m9)(n),e)}(this._delegate,e)}getDownloadURL(){return function jv(n){return Nv(n=(0,L.m9)(n))}(this._delegate)}delete(){return this._throwIfRoot("delete"),function $v(n){return function kv(n){n._throwIfRoot("deleteObject");const e=function fv(n,e){const r=Rt(e.fullServerUrl(),n.host,n._protocol),a=new ft(r,"DELETE",function o(u,c){},n.maxOperationRetryTime);return a.successCodes=[200,204],a.errorHandler=Ui(e),a}(n.storage,n._location);return n.storage.makeRequestWithTokens(e,tt)}(n=(0,L.m9)(n))}(this._delegate)}_throwIfRoot(e){if(""===this._delegate._location.path)throw ig(e)}}class Fg{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(Mg(e))throw yr("ref() expected a child path but got a URL, use refFromURL instead.");return new Pt(bg(this._delegate,e),this)}refFromURL(e){if(!Mg(e))throw yr("refFromURL() expected a full URL but got a child path, use ref() instead.");try{be.makeFromUrl(e,this._delegate.host)}catch{throw yr("refFromUrl() expected a valid full URL but got an invalid one.")}return new Pt(bg(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,r={}){!function Dg(n,e,t,r={}){!function Lv(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:i}=r;i&&(n._overrideAuthToken="string"==typeof i?i:(0,L.Sg)(i,n.app.options.projectId))}(n,e,t,r)}(this._delegate,e,t,r)}}function Mg(n){return/^[A-Za-z]+:\/\//.test(n)}function Xv(n,{instanceIdentifier:e}){const t=n.getProvider("app-compat").getImmediate(),r=n.getProvider("storage").getImmediate({identifier:e});return new Fg(t,r)}function Og(n){const e=function ew(n){return new Pn.y(e=>{const t=o=>e.next(o);t(n.snapshot);const s=n.on("state_changed",t);return n.then(o=>{t(o),e.complete()},o=>{t(n.snapshot),(o=>{e.error(o)})(o)}),function(){s()}}).pipe((0,yE.b)(0))}(n);return{task:n,then:n.then.bind(n),catch:n.catch.bind(n),pause:n.pause.bind(n),cancel:n.cancel.bind(n),resume:n.resume.bind(n),snapshotChanges:()=>e,percentageChanges:()=>e.pipe((0,M.U)(t=>t.bytesTransferred/t.totalBytes*100))}}function To(n){return{getDownloadURL:()=>(0,Zt.of)(void 0).pipe(se.fc,(0,Ym.w)(()=>n.getDownloadURL()),se.iC),getMetadata:()=>(0,Zt.of)(void 0).pipe(se.fc,(0,Ym.w)(()=>n.getMetadata()),se.iC),delete:()=>(0,ze.D)(n.delete()),child:e=>To(n.child(e)),updateMetadata:e=>(0,ze.D)(n.updateMetadata(e)),put:(e,t)=>Og(n.put(e,t)),putString:(e,t,r)=>Og(n.putString(e,t,r)),list:e=>(0,ze.D)(n.list(e)),listAll:()=>(0,ze.D)(n.listAll())}}!function Jv(n){const e={TaskState:Le,TaskEvent:yv,StringFormat:Qe,Storage:Fg,Reference:Pt};n.INTERNAL.registerComponent(new qi.wA("storage-compat",Xv,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),n.registerVersion("@firebase/storage-compat","0.3.6")}(Kc.Z);const tw=new E.OlP("angularfire2.storageBucket"),nw=new E.OlP("angularfire2.storage.maxUploadRetryTime"),rw=new E.OlP("angularfire2.storage.maxOperationRetryTime"),iw=new E.OlP("angularfire2.storage.use-emulator");let sw=(()=>{class n{storage;constructor(t,r,i,s,o,a,u,c,l,h){const d=(0,We.on)(t,o,r);this.storage=(0,We.cc)(`${d.name}.storage.${i}`,"AngularFireStorage",d.name,()=>{const f=o.runOutsideAngular(()=>d.storage(i||void 0)),_=l;return _&&f.useEmulator(..._),u&&f.setMaxUploadRetryTime(u),c&&f.setMaxOperationRetryTime(c),f},[u,c])}ref(t){return To(this.storage.ref(t))}refFromURL(t){return To(this.storage.refFromURL(t))}upload(t,r,i){return To(this.storage.ref(t)).put(r,i)}static \u0275fac=function(r){return new(r||n)(E.LFG(We.Dh),E.LFG(We.xv,8),E.LFG(tw,8),E.LFG(E.Lbi),E.LFG(E.R0b),E.LFG(se.HU),E.LFG(nw,8),E.LFG(rw,8),E.LFG(iw,8),E.LFG(se.Rf,8))};static \u0275prov=E.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),ow=(()=>{class n{constructor(t,r,i){this.http=t,this.firestore=r,this.storage=i}createBlogPost(t){return this.http.post(`${Ge.N.apiBaseUrl}/api/blogposts?addAuth=true`,t)}getAllBlogPosts(){return this.http.get(`${Ge.N.apiBaseUrl}/api/blogposts`)}getBlogPostById(t){return this.http.get(`${Ge.N.apiBaseUrl}/api/blogposts/${t}`)}getBlogPostByUrlHandle(t){return this.http.get(`${Ge.N.apiBaseUrl}/api/blogposts/${t}`)}updateBlogPost(t,r){return this.http.put(`${Ge.N.apiBaseUrl}/api/blogposts/${t}?addAuth=true`,r)}deleteBlogPost(t){return this.http.delete(`${Ge.N.apiBaseUrl}/api/blogposts/${t}?addAuth=true`)}getAllBlogPostsFromFirebase(){var t=this;return(0,p.Z)(function*(){return t.firestore.collection("posts").snapshotChanges()})()}uploadImageToFireStore(t,r){var i=this;return(0,p.Z)(function*(){const s=t.target.files[0],a=i.storage.ref(`zenImageFolder/${r}_${s.name}`);try{yield a.put(s);const u=yield a.getDownloadURL().toPromise();return console.log("Image uploaded:",u),u.toString()}catch(u){return console.error("Error uploading image:",u),""}})()}createPostToFirebase(t,r){var i=this;return(0,p.Z)(function*(){try{const o=(yield i.firestore.collection("posts").add(t)).id;console.log("Post created successfully! > postId",o);const a=yield i.uploadImageToFireStore(r,o);return t.imageUrl=a,console.log("postData.url",t.url),yield i.updatePostToFirebase(o,t),o}catch(s){throw console.error("Error creating post:",s),s}})()}updatePostToFirebase(t,r){const i=this.firestore.collection("posts").doc(t).update(r);return console.log("updatePostToFirebase > postPromise",i),i}deletePostFromFirebase(t){return this.firestore.collection("posts").doc(t).delete()}getPostByIdFromFirebase(t){var r=this;return(0,p.Z)(function*(){return r.firestore.collection("posts").doc(t).get().toPromise().then(i=>i.exists?i.data():(console.log("No such document!"),null)).catch(i=>{throw console.error("Error getting document:",i),i})})()}static#e=this.\u0275fac=function(r){return new(r||n)(E.LFG(vr.eN),E.LFG(_E),E.LFG(sw))};static#t=this.\u0275prov=E.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})()},4450:(jc,An,D)=>{D.r(An),D.d(An,{FeaturesModule:()=>Rr});var p=D(6814),Ge=D(8145),E=D(5879),vr=D(8101),wr=D(6080);const se=function(M){return["/blog",M]};function We(M,Sn){if(1&M&&(E.TgZ(0,"div",7)(1,"div",8),E._UZ(2,"img",9),E.TgZ(3,"div",10)(4,"h5",11),E._uU(5),E.qZA(),E.TgZ(6,"p",12),E._uU(7),E.qZA(),E.TgZ(8,"span",13)(9,"a",3),E._uU(10,"Read More"),E.qZA()()()()()),2&M){const he=Sn.$implicit;E.xp6(2),E.Q6J("src",he.payload.doc.data().imageUrl,E.LSH)("alt",he.payload.doc.data().title),E.xp6(3),E.hij(" ",he.payload.doc.data().title," "),E.xp6(2),E.hij(" ",he.payload.doc.data().desc," "),E.xp6(2),E.Q6J("routerLink",E.VKq(5,se,he.payload.doc.id))}}function He(M,Sn){if(1&M&&(E.ynx(0),E.YNc(1,We,11,7,"div",6),E.ALo(2,"async"),E.BQk()),2&M){const he=E.oxw();E.xp6(1),E.Q6J("ngForOf",E.lcZ(2,1,he.blogsFromFirebase))}}const Rn=function(){return["/admin/blogposts/add"]};let Pn=(()=>{class M{constructor(he,De){this.blogPostServ=he,this.spinServ=De}ngOnInit(){this.spinServ.requestStarted(),this.blogPostServ.getAllBlogPostsFromFirebase().then(he=>{this.blogsFromFirebase=he,this.spinServ.requestEnded()}).catch(he=>{this.spinServ.requestEnded()}),console.log("this.blogsFromFirebase xdxd",this.blogsFromFirebase)}uploadImage(he,De){this.blogPostServ.uploadImageToFireStore(he,De)}static#e=this.\u0275fac=function(De){return new(De||M)(E.Y36(vr.u),E.Y36(wr.V))};static#t=this.\u0275cmp=E.Xpm({type:M,selectors:[["app-home"]],decls:7,vars:3,consts:[[1,"container"],[1,"my-5"],[1,"d-flex","justify-content-end","mt-3","mb-3"],[1,"btn","btn-primary",3,"routerLink"],[1,"row","align-items-stretch"],[4,"ngIf"],["class","col-12 col-md-4 mb-3",4,"ngFor","ngForOf"],[1,"col-12","col-md-4","mb-3"],[1,"card","h-100"],[1,"card-img-top",3,"src","alt"],[1,"card-body","d-flex","flex-column"],[1,"card-title"],[1,"card-text"],[1,"d-flex","align-items-end",2,"flex","1"]],template:function(De,$c){1&De&&(E.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),E._uU(4,"Add BlogPost"),E.qZA()(),E.TgZ(5,"div",4),E.YNc(6,He,3,3,"ng-container",5),E.qZA()()()),2&De&&(E.xp6(3),E.Q6J("routerLink",E.DdM(2,Rn)),E.xp6(3),E.Q6J("ngIf",$c.blogsFromFirebase))},dependencies:[Ge.rH,p.sg,p.O5,p.Ov]})}return M})();var ze=D(1333);const Zt=[{path:"",component:Pn},{path:"blog",loadChildren:()=>D.e(805).then(D.bind(D,6805)).then(M=>M.PublicModule)},{path:"admin/categories",loadChildren:()=>Promise.all([D.e(592),D.e(466)]).then(D.bind(D,4466)).then(M=>M.CategoryListModule),canActivate:[ze.p]},{path:"login",loadChildren:()=>D.e(960).then(D.bind(D,2960)).then(M=>M.AuthModule)},{path:"admin/blogposts",loadChildren:()=>Promise.all([D.e(592),D.e(745)]).then(D.bind(D,1745)).then(M=>M.BlogPostModule),canActivate:[ze.p]}];let Ar=(()=>{class M{static#e=this.\u0275fac=function(De){return new(De||M)};static#t=this.\u0275mod=E.oAB({type:M});static#n=this.\u0275inj=E.cJS({imports:[Ge.Bz.forChild(Zt),Ge.Bz]})}return M})(),Rr=(()=>{class M{static#e=this.\u0275fac=function(De){return new(De||M)};static#t=this.\u0275mod=E.oAB({type:M});static#n=this.\u0275inj=E.cJS({imports:[Ar,Ge.Bz,p.ez]})}return M})()}}]);